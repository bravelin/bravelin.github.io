import{_ as P,c as _,f as u,w as v,m as w,v as b,D,p as k,r as B,E as N,b as h,G as R,u as T,d as E,i as C,o as Z}from"./index-CxcENImR.js";const y="974d3f8fd3cba3f83d098b4220669a93",S="./imgs/gis/null.png";function I(l){const t=L.map(l,{preferCanvas:!0,positionControl:!1,attributionControl:!1,zoomControl:!1,zoomSnap:window.devicePixelRatio>1?.5:.1,scrollWheelZoom:!0,dragging:!0,keyboard:!1,touchZoom:!0,doubleClickZoom:!0,boxZoom:!0,tap:!0,maxBoundsViscosity:1,zoom:10,center:[25.87524527709376,114.89366983570925]});return L.tileLayer(`https://t{s}.tianditu.gov.cn/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=${y}`,{subdomains:["0","1","2","3","4","5","6","7"],minZoom:4,maxZoom:18,maxNativeZoom:window.devicePixelRatio>1?17:18,detectRetina:!0,errorTileUrl:S}).addTo(t),L.tileLayer(`https://t{s}.tianditu.gov.cn/DataServer?T=cia_w&x={x}&y={y}&l={z}&tk=${y}`,{subdomains:["0","1","2","3","4","5","6","7"],minZoom:5,maxZoom:18,maxNativeZoom:window.devicePixelRatio>1?17:18,detectRetina:!0,errorTileUrl:S}).addTo(t),t}function U(){return new Promise(l=>{/localhost/.test(location.host)?l({status:!0,latlng:[25.87524527709376,114.89366983570925]}):navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{const s=t.coords.latitude,e=t.coords.longitude;l({status:!0,latlng:[s,e]})},t=>{let s="";t.code==t.PERMISSION_DENIED?s="定位失败,用户拒绝请求地理定位！":t.code==t.POSITION_UNAVAILABLE?s="定位失败,位置信息是不可用！":t.code==t.TIMEOUT?s="定位失败,请求获取用户位置超时！":t.code==t.UNKNOWN_ERROR&&(s="定位失败！"),l({status:!1,msg:s})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4}):l({status:!1,msg:"定位失败,用户已禁用位置获取权限！"})})}function p(l,t){const s=L.icon({iconUrl:"./imgs/gis/location.png",iconSize:[32,32],iconAnchor:[16,16]});return L.marker(t,{icon:s,draggable:!0}).addTo(l)}function M(l,t){const e=`https://api.tianditu.gov.cn/geocoder?postStr=${encodeURIComponent(JSON.stringify({lon:t,lat:l,ver:1}))}&type=geocode&tk=${y}`;return fetch(e).then(n=>n.json()).then(n=>n.msg=="ok"&&n.result?n.result.formatted_address:"-")}const V={setup(){const l=C(),t=T(),s=k(),e=B(null);let n=null,i=null,r=0;const g=N({lat:"",lng:"",address:""}),d=N({lat:"",lng:""}),f=async(o,a)=>{g.lat=o,g.lng=a,g.address=await M(o,a),d.lat=o+"",d.lng=a+"",l.replace({name:"tools-currLocation",query:{lat:o,lng:a}})},m=()=>{i.on("drag",o=>{g.lat=o.latlng.lat,g.lng=o.latlng.lng,g.address=""}),i.on("dragend",async o=>{const a=o.target._latlng;f(a.lat,a.lng)})},x=()=>{if(r=Date.now(),d.lat&&d.lng&&!isNaN(d.lat)&&!isNaN(d.lng)){const o=[d.lat-0,d.lng-0];f(...o),i?i.setLatLng(o):(i=p(n,o),m()),n.setView(o,17)}};return h(async()=>{await R(),n=I(e.value),n.on("click",a=>{if(Date.now()-r>2e3){const c=a.latlng;f(c.lat,c.lng),i?i.setLatLng([c.lat,c.lng]):(i=p(n,[c.lat,c.lng]),m())}});const o=t.query;if(o&&o.lat&&o.lng&&!isNaN(o.lat)&&!isNaN(o.lng)){const a=[o.lat-0,o.lng-0];n.setView(a,17),i=p(n,a),m(),f(...a)}else{const a=await U();if(a.status){const c=a.latlng;n.setView(c,17),i=p(n,c),m(),f(...c)}else s.warning(a.msg)}}),E(()=>{n.remove()}),{mapContainerEl:e,currLocation:g,selfDefPos:d,doBlurSelfDefPos:x}}},O={class:"tools-location-page _page"},z={class:"map-container",ref:"mapContainerEl"},A={class:"info"},q={class:"self-def-pos"};function j(l,t,s,e,n,i){return Z(),_("div",O,[u("div",z,null,512),u("div",A,[u("div",null,w(e.currLocation.lng?"经度："+e.currLocation.lng:""),1),u("div",null,w(e.currLocation.lat?"纬度："+e.currLocation.lat:""),1),v(u("div",null,w(e.currLocation.address),513),[[b,e.currLocation.address]])]),u("div",q,[v(u("input",{type:"number",onBlur:t[0]||(t[0]=(...r)=>e.doBlurSelfDefPos&&e.doBlurSelfDefPos(...r)),placeholder:"纬度","onUpdate:modelValue":t[1]||(t[1]=r=>e.selfDefPos.lat=r)},null,544),[[D,e.selfDefPos.lat,void 0,{trim:!0}]]),v(u("input",{type:"number",onBlur:t[2]||(t[2]=(...r)=>e.doBlurSelfDefPos&&e.doBlurSelfDefPos(...r)),placeholder:"经度","onUpdate:modelValue":t[3]||(t[3]=r=>e.selfDefPos.lng=r)},null,544),[[D,e.selfDefPos.lng,void 0,{trim:!0}]])])])}const G=P(V,[["render",j]]);export{G as default};
