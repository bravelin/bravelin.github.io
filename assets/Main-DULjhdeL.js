import{_ as ln,r as di,H as uo,t as $a,e as lo,I as co,b as fo,d as ho,c as cn,w as Vr,v as Rn,f as ai,o as fn,n as vo,g as Mn,h as Nn,D as po}from"./index-CxcENImR.js";function Fn(s,o){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);o&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable})),i.push.apply(i,t)}return i}function Ae(s){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?arguments[o]:{};o%2?Fn(Object(i),!0).forEach(function(t){I(s,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):Fn(Object(i)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(i,t))})}return s}function Ve(s){"@babel/helpers - typeof";return Ve=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Ve(s)}function X(s,o){if(!(s instanceof o))throw new TypeError("Cannot call a class as a function")}function Bn(s,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,Ka(t.key),t)}}function q(s,o,i){return o&&Bn(s.prototype,o),i&&Bn(s,i),Object.defineProperty(s,"prototype",{writable:!1}),s}function I(s,o,i){return o=Ka(o),o in s?Object.defineProperty(s,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[o]=i,s}function J(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(o&&o.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),o&&Gr(s,o)}function re(s){return re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},re(s)}function Gr(s,o){return Gr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Gr(s,o)}function go(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function hn(s,o){if(o&&(typeof o=="object"||typeof o=="function"))return o;if(o!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return P(s)}function ee(s){var o=go();return function(){var t=re(s),e;if(o){var r=re(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return hn(this,e)}}function mo(s,o){for(;!Object.prototype.hasOwnProperty.call(s,o)&&(s=re(s),s!==null););return s}function se(){return typeof Reflect<"u"&&Reflect.get?se=Reflect.get.bind():se=function(o,i,t){var e=mo(o,i);if(e){var r=Object.getOwnPropertyDescriptor(e,i);return r.get?r.get.call(arguments.length<3?o:t):r.value}},se.apply(this,arguments)}function nt(s){return yo(s)||_o(s)||bo(s)||So()}function yo(s){if(Array.isArray(s))return jr(s)}function _o(s){if(typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)}function bo(s,o){if(s){if(typeof s=="string")return jr(s,o);var i=Object.prototype.toString.call(s).slice(8,-1);if(i==="Object"&&s.constructor&&(i=s.constructor.name),i==="Map"||i==="Set")return Array.from(s);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return jr(s,o)}}function jr(s,o){(o==null||o>s.length)&&(o=s.length);for(var i=0,t=new Array(o);i<o;i++)t[i]=s[i];return t}function So(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Eo(s,o){if(typeof s!="object"||s===null)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var t=i.call(s,o);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}function Ka(s){var o=Eo(s,"string");return typeof o=="symbol"?o:String(o)}function dn(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var hr={exports:{}},Un;function ko(){return Un||(Un=1,(function(s){var o=Object.prototype.hasOwnProperty,i="~";function t(){}Object.create&&(t.prototype=Object.create(null),new t().__proto__||(i=!1));function e(u,l,c){this.fn=u,this.context=l,this.once=c||!1}function r(u,l,c,f,h){if(typeof c!="function")throw new TypeError("The listener must be a function");var d=new e(c,f||u,h),v=i?i+l:l;return u._events[v]?u._events[v].fn?u._events[v]=[u._events[v],d]:u._events[v].push(d):(u._events[v]=d,u._eventsCount++),u}function n(u,l){--u._eventsCount===0?u._events=new t:delete u._events[l]}function a(){this._events=new t,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],c,f;if(this._eventsCount===0)return l;for(f in c=this._events)o.call(c,f)&&l.push(i?f.slice(1):f);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},a.prototype.listeners=function(l){var c=i?i+l:l,f=this._events[c];if(!f)return[];if(f.fn)return[f.fn];for(var h=0,d=f.length,v=new Array(d);h<d;h++)v[h]=f[h].fn;return v},a.prototype.listenerCount=function(l){var c=i?i+l:l,f=this._events[c];return f?f.fn?1:f.length:0},a.prototype.emit=function(l,c,f,h,d,v){var y=i?i+l:l;if(!this._events[y])return!1;var p=this._events[y],b=arguments.length,k,E;if(p.fn){switch(p.once&&this.removeListener(l,p.fn,void 0,!0),b){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,c),!0;case 3:return p.fn.call(p.context,c,f),!0;case 4:return p.fn.call(p.context,c,f,h),!0;case 5:return p.fn.call(p.context,c,f,h,d),!0;case 6:return p.fn.call(p.context,c,f,h,d,v),!0}for(E=1,k=new Array(b-1);E<b;E++)k[E-1]=arguments[E];p.fn.apply(p.context,k)}else{var w=p.length,T;for(E=0;E<w;E++)switch(p[E].once&&this.removeListener(l,p[E].fn,void 0,!0),b){case 1:p[E].fn.call(p[E].context);break;case 2:p[E].fn.call(p[E].context,c);break;case 3:p[E].fn.call(p[E].context,c,f);break;case 4:p[E].fn.call(p[E].context,c,f,h);break;default:if(!k)for(T=1,k=new Array(b-1);T<b;T++)k[T-1]=arguments[T];p[E].fn.apply(p[E].context,k)}}return!0},a.prototype.on=function(l,c,f){return r(this,l,c,f,!1)},a.prototype.once=function(l,c,f){return r(this,l,c,f,!0)},a.prototype.removeListener=function(l,c,f,h){var d=i?i+l:l;if(!this._events[d])return this;if(!c)return n(this,d),this;var v=this._events[d];if(v.fn)v.fn===c&&(!h||v.once)&&(!f||v.context===f)&&n(this,d);else{for(var y=0,p=[],b=v.length;y<b;y++)(v[y].fn!==c||h&&!v[y].once||f&&v[y].context!==f)&&p.push(v[y]);p.length?this._events[d]=p.length===1?p[0]:p:n(this,d)}return this},a.prototype.removeAllListeners=function(l){var c;return l?(c=i?i+l:l,this._events[c]&&n(this,c)):(this._events=new t,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,s.exports=a})(hr)),hr.exports}var Ya=ko();const jt=dn(Ya);var To=typeof window<"u"&&window.location&&window.location.href.indexOf("xgplayerdebugger=1")>-1,dr={info:"color: #525252; background-color: #90ee90;",error:"color: #525252; background-color: red;",warn:"color: #525252; background-color: yellow; "},vr="%c[xgplayer]",he={config:{debug:To?3:0},logInfo:function(o){for(var i,t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];this.config.debug>=3&&(i=console).log.apply(i,[vr,dr.info,o].concat(e))},logWarn:function(o){for(var i,t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];this.config.debug>=1&&(i=console).warn.apply(i,[vr,dr.warn,o].concat(e))},logError:function(o){var i;if(!(this.config.debug<1)){for(var t=this.config.debug>=2?"trace":"error",e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];(i=console)[t].apply(i,[vr,dr.error,o].concat(r))}}};function wo(s){s.logInfo=he.logInfo.bind(s),s.logWarn=he.logWarn.bind(s),s.logError=he.logError.bind(s)}var Co=(function(){function s(o){X(this,s),this.bufferedList=o}return q(s,[{key:"start",value:function(i){return this.bufferedList[i].start}},{key:"end",value:function(i){return this.bufferedList[i].end}},{key:"length",get:function(){return this.bufferedList.length}}]),s})(),g={};g.createDom=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"div",o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"",e=document.createElement(s);return e.className=t,e.innerHTML=o,Object.keys(i).forEach(function(r){var n=r,a=i[r];s==="video"||s==="audio"||s==="live-video"?a&&e.setAttribute(n,a):e.setAttribute(n,a)}),e};g.createDomFromHtml=function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";try{var t=document.createElement("div");t.innerHTML=s;var e=t.children;return t=null,e.length>0?(e=e[0],i&&g.addClass(e,i),o&&Object.keys(o).forEach(function(r){e.setAttribute(r,o[r])}),e):null}catch(r){return he.logError("util.createDomFromHtml",r),null}};g.hasClass=function(s,o){if(!s||!o)return!1;try{return Array.prototype.some.call(s.classList,function(t){return t===o})}catch{var i=s.className&&Ve(s.className)==="object"?s.getAttribute("class"):s.className;return i&&!!i.match(new RegExp("(\\s|^)"+o+"(\\s|$)"))}};g.addClass=function(s,o){if(!(!s||!o))try{o.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(i){i&&s.classList.add(i)})}catch{g.hasClass(s,o)||(s.className&&Ve(s.className)==="object"?s.setAttribute("class",s.getAttribute("class")+" "+o):s.className+=" "+o)}};g.removeClass=function(s,o){if(!(!s||!o))try{o.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(i){i&&s.classList.remove(i)})}catch{g.hasClass(s,o)&&o.split(/\s+/g).forEach(function(t){var e=new RegExp("(\\s|^)"+t+"(\\s|$)");s.className&&Ve(s.className)==="object"?s.setAttribute("class",s.getAttribute("class").replace(e," ")):s.className=s.className.replace(e," ")})}};g.toggleClass=function(s,o){s&&o.split(/\s+/g).forEach(function(i){g.hasClass(s,i)?g.removeClass(s,i):g.addClass(s,i)})};g.classNames=function(){for(var s=arguments,o=[],i=function(r){g.typeOf(s[r])==="String"?o.push(s[r]):g.typeOf(s[r])==="Object"&&Object.keys(s[r]).map(function(n){s[r][n]&&o.push(n)})},t=0;t<arguments.length;t++)i(t);return o.join(" ")};g.findDom=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document,o=arguments.length>1?arguments[1]:void 0,i;try{i=s.querySelector(o)}catch(t){he.logError("util.findDom",t),o.indexOf("#")===0&&(i=s.getElementById(o.slice(1)))}return i};g.getCss=function(s,o){return s.currentStyle?s.currentStyle[o]:document.defaultView.getComputedStyle(s,!1)[o]};g.padStart=function(s,o,i){for(var t=String(i),e=o>>0,r=Math.ceil(e/t.length),n=[],a=String(s);r--;)n.push(t);return n.join("").substring(0,e-a.length)+a};g.format=function(s){if(window.isNaN(s))return"";s=Math.round(s);var o=g.padStart(Math.floor(s/3600),2,0),i=g.padStart(Math.floor((s-o*3600)/60),2,0),t=g.padStart(Math.floor(s-o*3600-i*60),2,0);return(o==="00"?[i,t]:[o,i,t]).join(":")};g.event=function(s){if(s.touches){var o=s.touches[0]||s.changedTouches[0];s.clientX=o.clientX||0,s.clientY=o.clientY||0,s.offsetX=o.pageX-o.target.offsetLeft,s.offsetY=o.pageY-o.target.offsetTop}s._target=s.target||s.srcElement};g.typeOf=function(s){return Object.prototype.toString.call(s).match(/([^\s.*]+)(?=]$)/g)[0]};g.deepCopy=function(s,o){if(g.typeOf(o)==="Object"&&g.typeOf(s)==="Object")return Object.keys(o).forEach(function(i){g.typeOf(o[i])==="Object"&&!(o[i]instanceof Node)?s[i]===void 0||s[i]===void 0?s[i]=o[i]:g.deepCopy(s[i],o[i]):g.typeOf(o[i])==="Array"?s[i]=g.typeOf(s[i])==="Array"?s[i].concat(o[i]):o[i]:s[i]=o[i]}),s};g.deepMerge=function(s,o){return Object.keys(o).map(function(i){if(g.typeOf(o[i])==="Array"&&g.typeOf(s[i])==="Array"){if(g.typeOf(s[i])==="Array"){var t;(t=s[i]).push.apply(t,nt(o[i]))}}else g.typeOf(s[i])===g.typeOf(o[i])&&s[i]!==null&&g.typeOf(s[i])==="Object"&&!(o[i]instanceof window.Node)?g.deepMerge(s[i],o[i]):o[i]!==null&&(s[i]=o[i])}),s};g.getBgImage=function(s){var o=(s.currentStyle||window.getComputedStyle(s,null)).backgroundImage;if(!o||o==="none")return"";var i=document.createElement("a");return i.href=o.replace(/url\("|"\)/g,""),i.href};g.copyDom=function(s){if(s&&s.nodeType===1){var o=document.createElement(s.tagName);return Array.prototype.forEach.call(s.attributes,function(i){o.setAttribute(i.name,i.value)}),s.innerHTML&&(o.innerHTML=s.innerHTML),o}else return""};g.setInterval=function(s,o,i,t){s._interval[o]||(s._interval[o]=window.setInterval(i.bind(s),t))};g.clearInterval=function(s,o){clearInterval(s._interval[o]),s._interval[o]=null};g.setTimeout=function(s,o,i){s._timers||(s._timers=[]);var t=setTimeout(function(){o(),g.clearTimeout(s,t)},i);return s._timers.push(t),t};g.clearTimeout=function(s,o){var i=s._timers;if(g.typeOf(i)==="Array"){for(var t=0;t<i.length;t++)if(i[t]===o){i.splice(t,1),clearTimeout(o);break}}else clearTimeout(o)};g.clearAllTimers=function(s){var o=s._timers;g.typeOf(o)==="Array"&&(o.map(function(i){clearTimeout(i)}),s._timerIds=[])};g.createImgBtn=function(s,o,i,t){var e=g.createDom("xg-".concat(s),"",{},"xgplayer-".concat(s,"-img"));if(e.style.backgroundImage='url("'.concat(o,'")'),i&&t){var r,n,a;["px","rem","em","pt","dp","vw","vh","vm","%"].every(function(u){return i.indexOf(u)>-1&&t.indexOf(u)>-1?(r=parseFloat(i.slice(0,i.indexOf(u)).trim()),n=parseFloat(t.slice(0,t.indexOf(u)).trim()),a=u,!1):!0}),e.style.width="".concat(r).concat(a),e.style.height="".concat(n).concat(a),e.style.backgroundSize="".concat(r).concat(a," ").concat(n).concat(a),s==="start"?e.style.margin="-".concat(n/2).concat(a," auto auto -").concat(r/2).concat(a):e.style.margin="auto 5px auto 5px"}return e};g.Hex2RGBA=function(s,o){var i=[];if(/^\#[0-9A-F]{3}$/i.test(s)){var t="#";s.replace(/[0-9A-F]/ig,function(e){t+=e+e}),s=t}return/^#[0-9A-F]{6}$/i.test(s)?(s.replace(/[0-9A-F]{2}/ig,function(e){i.push(parseInt(e,16))}),"rgba(".concat(i.join(","),", ").concat(o,")")):"rgba(255, 255, 255, 0.1)"};g.getFullScreenEl=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement};g.checkIsFunction=function(s){return s&&typeof s=="function"};g.checkIsObject=function(s){return s!==null&&Ve(s)==="object"};g.hide=function(s){s.style.display="none"};g.show=function(s,o){s.style.display=o||"block"};g.isUndefined=function(s){if(typeof s>"u"||s===null)return!0};g.isNotNull=function(s){return s!=null};g.setStyleFromCsstext=function(s,o){if(o)if(g.typeOf(o)==="String"){var i=o.replace(/\s+/g,"").split(";");i.map(function(t){if(t){var e=t.split(":");e.length>1&&(s.style[e[0]]=e[1])}})}else Object.keys(o).map(function(t){s.style[t]=o[t]})};function Ao(s,o){for(var i=0,t=o.length;i<t;i++)if(s.indexOf(o[i])>-1)return!0;return!1}g.filterStyleFromText=function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["width","height","top","left","bottom","right","position","z-index","padding","margin","transform"],i=s.style.cssText;if(!i)return{};var t=i.replace(/\s+/g,"").split(";"),e={},r={};return t.map(function(n){if(n){var a=n.split(":");a.length>1&&(Ao(a[0],o)?e[a[0]]=a[1]:r[a[0]]=a[1])}}),s.setAttribute("style",""),Object.keys(r).map(function(n){s.style[n]=r[n]}),e};g.getStyleFromCsstext=function(s){var o=s.style.cssText;if(!o)return{};var i=o.replace(/\s+/g,"").split(";"),t={};return i.map(function(e){if(e){var r=e.split(":");r.length>1&&(t[r[0]]=r[1])}}),t};g.preloadImg=function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){};if(s){var t=new window.Image;t.onload=function(e){t=null,o&&o(e)},t.onerror=function(e){t=null,i&&i(e)},t.src=s}};g.stopPropagation=function(s){s&&s.stopPropagation()};g.scrollTop=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0};g.scrollLeft=function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0};g.checkTouchSupport=function(){return"ontouchstart"in window};g.getBuffered2=function(s){for(var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5,i=[],t=0;t<s.length;t++)i.push({start:s.start(t)<.5?0:s.start(t),end:s.end(t)});i.sort(function(u,l){var c=u.start-l.start;return c||l.end-u.end});var e=[];if(o)for(var r=0;r<i.length;r++){var n=e.length;if(n){var a=e[n-1].end;i[r].start-a<o?i[r].end>a&&(e[n-1].end=i[r].end):e.push(i[r])}else e.push(i[r])}else e=i;return new Co(e)};g.getEventPos=function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return s.touches&&s.touches.length>0&&(s=s.touches[0]),{x:s.x/o,y:s.y/o,clientX:s.clientX/o,clientY:s.clientY/o,offsetX:s.offsetX/o,offsetY:s.offsetY/o,pageX:s.pageX/o,pageY:s.pageY/o}};g.requestAnimationFrame=function(s){var o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(o)return o(s)};g.getHostFromUrl=function(s){if(g.typeOf(s)!=="String")return"";var o=s.split("/"),i="";return o.length>3&&o[2]&&(i=o[2]),i};g.cancelAnimationFrame=function(s){var o=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame;o&&o(s)};g.isMSE=function(s){return s.media&&(s=s.media),!s||!(s instanceof HTMLMediaElement)?!1:/^blob/.test(s.currentSrc)||/^blob/.test(s.src)};g.isBlob=function(s){return typeof s=="string"&&/^blob/.test(s)};g.generateSessionId=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=new Date().getTime();try{s=parseInt(s)}catch{s=0}o+=s,window.performance&&typeof window.performance.now=="function"&&(o+=parseInt(window.performance.now()));var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(o+Math.random()*16)%16|0;return o=Math.floor(o/16),(t==="x"?e:e&3|8).toString(16)});return i};g.createEvent=function(s){var o;return typeof window.Event=="function"?o=new Event(s):(o=document.createEvent("Event"),o.initEvent(s,!0,!0)),o};g.adjustTimeByDuration=function(s,o,i){return!o||!s?s:s>o||i&&s<o?o:s};g.createPositionBar=function(s,o){var i=g.createDom("xg-bar","",{"data-index":-1},s);return o.appendChild(i),i};g.getTransformStyle=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{x:0,y:0,scale:1,rotate:0},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i={scale:"".concat(s.scale||1),translate:"".concat(s.x||0,"%, ").concat(s.y||0,"%"),rotate:"".concat(s.rotate||0,"deg")},t=Object.keys(i);return t.forEach(function(e){var r=new RegExp("".concat(e,"\\([^\\(]+\\)"),"g"),n="".concat(e,"(").concat(i[e],")");r.test(o)?(r.lastIndex=-1,o=o.replace(r,n)):o+="".concat(n," ")}),o};g.convertDeg=function(s){return Math.abs(s)<=1?s*360:s%360};g.getIndexByTime=function(s,o){var i=o.length,t=-1;if(i<1)return t;if(s<=o[0].end||i<2)t=0;else if(s>o[i-1].end)t=i-1;else for(var e=1;e<i;e++)if(s>o[e-1].end&&s<=o[e].end){t=e;break}return t};g.getOffsetCurrentTime=function(s,o){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,t=-1;if(i>=0&&i<o.length?t=i:t=g.getIndexByTime(s,o),t<0)return-1;var e=o.length,r=o[t],n=r.start,a=r.end,u=r.cTime,l=r.offset;return s<n?u:s>=n&&s<=a?s-l:s>a&&t>=e-1?a:-1};g.getCurrentTimeByOffset=function(s,o){var i=-1;if(!o||o.length<0)return s;for(var t=0;t<o.length;t++)if(s<=o[t].duration){i=t;break}if(i!==-1){var e=o[i].start;return i-1<0?e+s:e+(s-o[i-1].duration)}return s};function Xa(s){var o=Ve(s);return s!==null&&(o==="object"||o==="function")}function Do(s,o,i){var t,e,r,n,a,u,l=0,c=!1,f=!1,h=!0,d=!o&&o!==0&&typeof window.requestAnimationFrame=="function";if(typeof s!="function")throw new TypeError("Expected a function");o=+o||0,Xa(i)&&(c=!!i.leading,f="maxWait"in i,r=f?Math.max(+i.maxWait||0,o):r,h="trailing"in i?!!i.trailing:h);function v(U){var W=t,m=e;return t=e=void 0,l=U,n=s.apply(m,W),n}function y(U,W){return d?(window.cancelAnimationFrame(a),window.requestAnimationFrame(U)):setTimeout(U,W)}function p(U){if(d)return window.cancelAnimationFrame(U);clearTimeout(U)}function b(U){return l=U,a=y(w,o),c?v(U):n}function k(U){var W=U-u,m=U-l,_=o-W;return f?Math.min(_,r-m):_}function E(U){var W=U-u,m=U-l;return u===void 0||W>=o||W<0||f&&m>=r}function w(){var U=Date.now();if(E(U))return T(U);a=y(w,k(U))}function T(U){return a=void 0,h&&t?v(U):(t=e=void 0,n)}function L(){a!==void 0&&p(a),l=0,t=u=e=a=void 0}function O(){return a===void 0?n:T(Date.now())}function B(){return a!==void 0}function x(){for(var U=Date.now(),W=E(U),m=arguments.length,_=new Array(m),S=0;S<m;S++)_[S]=arguments[S];if(t=_,e=this,u=U,W){if(a===void 0)return b(u);if(f)return a=y(w,o),v(u)}return a===void 0&&(a=y(w,o)),n}return x.cancel=L,x.flush=O,x.pending=B,x}function Po(s,o,i){var t=!0,e=!0;if(typeof s!="function")throw new TypeError("Expected a function");return Xa(i)&&(t="leading"in i?!!i.leading:t,e="trailing"in i?!!i.trailing:e),Do(s,o,{leading:t,trailing:e,maxWait:o})}function Lo(){var s=(document.documentElement.getAttribute("lang")||navigator.language||"zh-cn").toLocaleLowerCase();return s==="zh-cn"&&(s="zh"),s}function Io(s,o,i){if(s){var t=s.getAttribute(i);return!!(t&&t===o&&(s.tagName==="VIDEO"||s.tagName==="AUDIO"))}}var Hn={android:/(Android)\s([\d.]+)/,ios:/(Version)\/([\d.]+)/},xo=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],ue={get device(){var s=ue.os;return s.isPc?"pc":"mobile"},get browser(){if(typeof navigator>"u")return"";var s=navigator.userAgent.toLowerCase(),o={ie:/rv:([\d.]+)\) like gecko/,firefox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(o).filter(function(i){return o[i].test(s)}))[0]},get os(){if(typeof navigator>"u")return{};var s=navigator.userAgent,o=/(?:Windows Phone)/.test(s),i=/(?:SymbianOS)/.test(s)||o,t=/(?:Tizen)/ig.test(s),e=/(?:Web0S)/ig.test(s),r=/(?:Android)/.test(s),n=/(?:Firefox)/.test(s),a=/(?:iPad|PlayBook)/.test(s)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,u=a||r&&!/(?:Mobile)/.test(s)||n&&/(?:Tablet)/.test(s),l=/(?:iPhone)/.test(s)&&!u,c=!l&&!r&&!i&&!u;return{isTablet:u,isPhone:l,isIpad:a,isIos:l||a,isAndroid:r,isPc:c,isSymbian:i,isWindowsPhone:o,isFireFox:n,isTizen:t,isWebOS:e}},get osVersion(){if(typeof navigator>"u")return 0;var s=navigator.userAgent,o="";/(?:iPhone)|(?:iPad|PlayBook)/.test(s)?o=Hn.ios:o=Hn.android;var i=o?o.exec(s):[];if(i&&i.length>=3){var t=i[2].split(".");return t.length>0?parseInt(t[0]):0}return 0},get isWeixin(){if(typeof navigator>"u")return!1;var s=/(micromessenger)\/([\d.]+)/,o=s.exec(navigator.userAgent.toLocaleLowerCase());return!!o},isSupportMP4:function(){var o={isSupport:!1,mime:""};if(typeof document>"u")return o;if(this.supportResult)return this.supportResult;var i=document.createElement("video");return typeof i.canPlayType=="function"&&xo.map(function(t){i.canPlayType('video/mp4; codecs="'.concat(t,'"'))==="probably"&&(o.isSupport=!0,o.mime+="||".concat(t))}),this.supportResult=o,i=null,o},isMSESupport:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(typeof MediaSource>"u"||!MediaSource)return!1;try{return MediaSource.isTypeSupported(o)}catch(i){return this._logger.error(o,i),!1}},isHevcSupported:function(){return typeof MediaSource>"u"||!MediaSource.isTypeSupported?!1:MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"')},probeConfigSupported:function(o){var i={supported:!1,smooth:!1,powerEfficient:!1};if(!o||typeof navigator>"u")return Promise.resolve(i);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(o);var t=o.video||{},e=o.audio||{};try{var r=MediaSource.isTypeSupported(t.contentType),n=MediaSource.isTypeSupported(e.contentType);return Promise.resolve({supported:r&&n,smooth:!1,powerEfficient:!1})}catch{return Promise.resolve(i)}}},zr="3.0.23",Vn={1:"media",2:"media",3:"media",4:"media",5:"media",6:"media"},Gn={1:5101,2:5102,3:5103,4:5104,5:5105,6:5106},si=q(function s(o){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{errorType:"",errorCode:0,errorMessage:"",originError:"",ext:{},mediaError:null};X(this,s);var t=o&&o.i18n?o.i18n.ERROR_TYPES:null;if(o.media){var e=i.mediaError?i.mediaError:o.media.error||{},r=o.duration,n=o.currentTime,a=o.ended,u=o.src,l=o.currentSrc,c=o.media,f=c.readyState,h=c.networkState,d=i.errorCode||e.code;Gn[d]&&(d=Gn[d]);var v={playerVersion:zr,currentTime:n,duration:r,ended:a,readyState:f,networkState:h,src:u||l,errorType:i.errorType,errorCode:d,message:i.errorMessage||e.message,mediaError:e,originError:i.originError?i.originError.stack:"",host:g.getHostFromUrl(u||l)};return i.ext&&Object.keys(i.ext).map(function(k){v[k]=i.ext[k]}),v}else if(arguments.length>1){for(var y={playerVersion:zr,domain:document.domain},p=["errorType","currentTime","duration","networkState","readyState","src","currentSrc","ended","errd","errorCode","mediaError"],b=0;b<arguments.length;b++)y[p[b]]=arguments[b];return y.ex=t?(t[arguments[0]]||{}).msg:"",y}}),Qe="play",vn="playing",zt="ended",ui="pause",Wt="error",rr="seeking",mt="seeked",qe="timeupdate",Si="waiting",gt="canplay",Oo="canplaythrough",Et="durationchange",qa="volumechange",bt="loadeddata",Ro="loadedmetadata",Qa="ratechange",Za="progress",pn="loadstart",$t="emptied",Mo="stalled",No="suspend",Fo="abort",Bo="bufferedChange",gn="focus",Ja="blur",mn="ready",es="urlNull",Bt="autoplay_started",yn="autoplay_was_prevented",nr="complete",ji="replay",Ei="destroy",li="urlchange",Wr="download_speed_change",ts="leaveplayer",is="enterplayer",rs="loading",pt="fullscreen_change",zi="cssFullscreen_change",Wi="mini_state_change",_n="definition_change",Uo="before_definition_change",$r="after_definition_change",Ho="SEI_PARSED",Vo="retry",Dt="video_resize",Kr="pip_change",ns="rotate",as="screenShot",$i="playnext",ss="shortcut",os="xglog",Ki="user_action",ar="reset",us="source_error",ls="source_success",cs="switch_subtitle",fs=["play","playing","ended","pause","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","loadeddata","loadedmetadata","ratechange","progress","loadstart","emptied","stalled","suspend","abort","lowdecode"],hs={STATS_INFO:"stats_info",STATS_DOWNLOAD:"stats_download",STATS_RESET:"stats_reset"},ds="fps_stuck";const Go=Object.freeze(Object.defineProperty({__proto__:null,ABORT:Fo,AFTER_DEFINITION_CHANGE:$r,AUTOPLAY_PREVENTED:yn,AUTOPLAY_STARTED:Bt,BEFORE_DEFINITION_CHANGE:Uo,BUFFER_CHANGE:Bo,CANPLAY:gt,CANPLAY_THROUGH:Oo,COMPLETE:nr,CSS_FULLSCREEN_CHANGE:zi,DEFINITION_CHANGE:_n,DESTROY:Ei,DOWNLOAD_SPEED_CHANGE:Wr,DURATION_CHANGE:Et,EMPTIED:$t,ENDED:zt,ENTER_PLAYER:is,ERROR:Wt,FPS_STUCK:ds,FULLSCREEN_CHANGE:pt,LEAVE_PLAYER:ts,LOADED_DATA:bt,LOADED_METADATA:Ro,LOADING:rs,LOAD_START:pn,MINI_STATE_CHANGE:Wi,PAUSE:ui,PIP_CHANGE:Kr,PLAY:Qe,PLAYER_BLUR:Ja,PLAYER_FOCUS:gn,PLAYING:vn,PLAYNEXT:$i,PROGRESS:Za,RATE_CHANGE:Qa,READY:mn,REPLAY:ji,RESET:ar,RETRY:Vo,ROTATE:ns,SCREEN_SHOT:as,SEEKED:mt,SEEKING:rr,SEI_PARSED:Ho,SHORTCUT:ss,SOURCE_ERROR:us,SOURCE_SUCCESS:ls,STALLED:Mo,STATS_EVENTS:hs,SUSPEND:No,SWITCH_SUBTITLE:cs,TIME_UPDATE:qe,URL_CHANGE:li,URL_NULL:es,USER_ACTION:Ki,VIDEO_EVENTS:fs,VIDEO_RESIZE:Dt,VOLUME_CHANGE:qa,WAITING:Si,XGLOG:os},Symbol.toStringTag,{value:"Module"}));function pr(s,o){!this||!this.emit||(s==="error"?this.errorHandler(s,o.error):this.emit(s,o))}function jo(s,o){return function(i,t){var e={player:o,eventName:s,originalEvent:i,detail:i.detail||{},timeStamp:i.timeStamp,currentTime:o.currentTime,duration:o.duration,paused:o.paused,ended:o.ended,isInternalOp:!!o._internalOp[i.type],muted:o.muted,volume:o.volume,host:g.getHostFromUrl(o.currentSrc),vtype:o.vtype};if(o.removeInnerOP(i.type),s==="timeupdate"&&(o._currentTime=o.media&&o.media.currentTime),s==="ratechange"){var r=o.media?o.media.playbackRate:0;if(r&&o._rate===r)return;o._rate=o.media&&o.media.playbackRate}if(s==="durationchange"&&(o._duration=o.media.duration),s==="volumechange"&&(e.isMutedChange=o._lastMuted!==o.muted,o._lastMuted=o.muted),s==="error"&&(e.error=t||o.video.error),o.mediaEventMiddleware[s]){var n=pr.bind(o,s,e);try{o.mediaEventMiddleware[s].call(o,e,n)}catch(a){throw pr.call(o,s,e),a}}else pr.call(o,s,e)}}var zo=(function(s){J(i,s);var o=ee(i);function i(t){var e;X(this,i),e=o.call(this,t),e._hasStart=!1,e._currentTime=0,e._duration=0,e._internalOp={},e._lastMuted=!1,e.vtype="MP4",e._rate=-1,e.mediaConfig=Object.assign({},{controls:!1,autoplay:t.autoplay,playsinline:t.playsinline,"x5-playsinline":t.playsinline,"webkit-playsinline":t.playsinline,"x5-video-player-fullscreen":t["x5-video-player-fullscreen"]||t.x5VideoPlayerFullscreen,"x5-video-orientation":t["x5-video-orientation"]||t.x5VideoOrientation,airplay:t.airplay,"webkit-airplay":t.airplay,tabindex:t.tabindex|0,mediaType:t.mediaType||"video","data-index":-1},t.videoConfig,t.videoAttributes);var r=t["x5-video-player-type"]||t.x5VideoPlayerType;return ue.isWeixin&&ue.os.isAndroid&&r&&(e.mediaConfig["x5-video-player-type"]=r,delete e.mediaConfig.playsinline,delete e.mediaConfig["webkit-playsinline"],delete e.mediaConfig["x5-playsinline"]),t.loop&&(e.mediaConfig.loop="loop"),t.autoplayMuted&&!Object.prototype.hasOwnProperty.call(e.mediaConfig,"muted")&&(e.mediaConfig.muted=!0),e.media=t.mediaEl instanceof HTMLMediaElement?t.mediaEl:typeof t.mediaEl=="function"?t.mediaEl(e.mediaConfig):g.createDom(e.mediaConfig.mediaType,"",e.mediaConfig,""),t.defaultPlaybackRate&&(e.media.defaultPlaybackRate=e.media.playbackRate=t.defaultPlaybackRate),g.typeOf(t.volume)==="Number"&&(e.volume=t.volume),t.autoplayMuted&&(e.media.muted=!0,e._lastMuted=!0),t.autoplay&&(e.media.autoplay=!0),t.playsinline&&(e.media.playsinline=!0),e._interval={},e.mediaEventMiddleware={},e.attachVideoEvents(),e}return q(i,[{key:"setEventsMiddleware",value:function(e){var r=this;Object.keys(e).map(function(n){r.mediaEventMiddleware[n]=e[n]})}},{key:"removeEventsMiddleware",value:function(e){var r=this;Object.keys(e).map(function(n){delete r.mediaEventMiddleware[n]})}},{key:"attachVideoEvents",value:function(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.media;this._evHandlers||(this._evHandlers=fs.map(function(n){var a="on".concat(n.charAt(0).toUpperCase()).concat(n.slice(1));return typeof e[a]=="function"&&e.on(n,e[a]),I({},n,jo(n,e))})),this._evHandlers.forEach(function(n){var a=Object.keys(n)[0];r.addEventListener(a,n[a],!1)})}},{key:"detachVideoEvents",value:function(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.media;this._evHandlers.forEach(function(n){var a=Object.keys(n)[0];r.removeEventListener(a,n[a],!1)}),this._evHandlers.forEach(function(n){var a=Object.keys(n)[0],u="on".concat(a.charAt(0).toUpperCase()).concat(a.slice(1));typeof e[u]=="function"&&e.off(a,e[u])}),this._evHandlers=null}},{key:"_attachSourceEvents",value:function(e,r){var n=this;e.removeAttribute("src"),e.load(),r.forEach(function(f,h){n.media.appendChild(g.createDom("source","",{src:"".concat(f.src),type:"".concat(f.type||""),"data-index":h+1}))});var a=e.children;if(a){this._videoSourceCount=a.length,this._videoSourceIndex=a.length,this._vLoadeddata=function(f){n.emit(ls,{src:f.target.currentSrc,host:g.getHostFromUrl(f.target.currentSrc)})};for(var u=null,l=0;l<this._evHandlers.length;l++)if(Object.keys(this._evHandlers[l])[0]==="error"){u=this._evHandlers[l];break}!this._sourceError&&(this._sourceError=function(f){var h=parseInt(f.target.getAttribute("data-index"),10);if(n._videoSourceIndex--,n._videoSourceIndex===0||h>=n._videoSourceCount){var d={code:4,message:"sources_load_error"};u?u.error(f,d):n.errorHandler("error",d)}var v=Vn[4];n.emit(us,new si(n,{errorType:v,errorCode:4,errorMessage:"sources_load_error",mediaError:{code:4,message:"sources_load_error"},src:f.target.src}))});for(var c=0;c<a.length;c++)a[c].addEventListener("error",this._sourceError);e.addEventListener("loadeddata",this._vLoadeddata)}}},{key:"_detachSourceEvents",value:function(e){var r=e.children;if(!(!r||r.length===0||!this._sourceError)){for(var n=0;n<r.length;n++)r[n].removeEventListener("error",this._sourceError);for(;r.length>0;)e.removeChild(r[0]);this._vLoadeddata&&e.removeEventListener("loadeddata",this._vLoadeddata)}}},{key:"errorHandler",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.media&&(this.media.error||r)){var n=this.media.error||r,a=n.code?Vn[n.code]:"other",u=n.message;this.media.currentSrc||this.media.srcObject||(u="empty_src",n={code:6,message:u}),this.emit(e,new si(this,{errorType:a,errorCode:n.code,errorMessage:n.message||"",mediaError:n}))}}},{key:"destroy",value:function(){this.media&&(this.media.pause&&(this.media.pause(),this.media.muted=!0),this.media.removeAttribute("src"),this.media.load()),this._currentTime=0,this._duration=0,this.mediaConfig=null;for(var e in this._interval)Object.prototype.hasOwnProperty.call(this._interval,e)&&(clearInterval(this._interval[e]),this._interval[e]=null);this.detachVideoEvents(),this.media=null,this.mediaEventMiddleware={},this.removeAllListeners()}},{key:"video",get:function(){return this.media},set:function(e){this.media=e}},{key:"play",value:function(){var e=this.media?this.media.play():null;return e}},{key:"pause",value:function(){this.media&&this.media.pause()}},{key:"load",value:function(){this.media&&this.media.load()}},{key:"canPlayType",value:function(e){return this.media?this.media.canPlayType(e):!1}},{key:"getBufferedRange",value:function(e){var r=[0,0];if(!this.media)return r;e||(e=this.media.buffered);var n=this.media.currentTime;if(e)for(var a=0,u=e.length;a<u&&(r[0]=e.start(a),r[1]=e.end(a),!(r[0]<=n&&n<=r[1]));a++);return r[0]-n<=0&&n-r[1]<=0?r:[0,0]}},{key:"autoplay",get:function(){return this.media?this.media.autoplay:!1},set:function(e){this.media&&(this.media.autoplay=e)}},{key:"buffered",get:function(){return this.media?this.media.buffered:null}},{key:"buffered2",get:function(){return this.media&&this.media.buffered?g.getBuffered2(this.media.buffered):null}},{key:"bufferedPoint",get:function(){var e={start:0,end:0};if(!this.media)return e;var r=this.media.buffered;if(!r||r.length===0)return e;for(var n=0;n<r.length;n++)if((r.start(n)<=this.currentTime||r.start(n)<.1)&&r.end(n)>=this.currentTime)return{start:r.start(n),end:r.end(n)};return e}},{key:"crossOrigin",get:function(){return this.media?this.media.crossOrigin:""},set:function(e){this.media&&(this.media.crossOrigin=e)}},{key:"currentSrc",get:function(){return this.media?this.media.currentSrc:""},set:function(e){this.media&&(this.media.currentSrc=e)}},{key:"currentTime",get:function(){return this.media?this.media.currentTime!==void 0?this.media.currentTime:this._currentTime:0},set:function(e){this.media&&(this.media.currentTime=e)}},{key:"defaultMuted",get:function(){return this.media?this.media.defaultMuted:!1},set:function(e){this.media&&(this.media.defaultMuted=e)}},{key:"duration",get:function(){return this._duration}},{key:"ended",get:function(){return this.media?this.media.ended:!1}},{key:"error",get:function(){return this.media.error}},{key:"errorNote",get:function(){var e=this.media.error;if(!e)return"";var r=["MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED"];return r[this.media.error.code-1]}},{key:"loop",get:function(){return this.media?this.media.loop:!1},set:function(e){this.media&&(this.media.loop=e)}},{key:"muted",get:function(){return this.media?this.media.muted:!1},set:function(e){!this.media||this.media.muted===e||(this._lastMuted=this.media.muted,this.media.muted=e)}},{key:"networkState",get:function(){return this.media.networkState}},{key:"paused",get:function(){return this.media?this.media.paused:!0}},{key:"playbackRate",get:function(){return this.media?this.media.playbackRate:0},set:function(e){!this.media||e===1/0||(this.media.defaultPlaybackRate=e,this.media.playbackRate=e)}},{key:"played",get:function(){return this.media?this.media.played:null}},{key:"preload",get:function(){return this.media?this.media.preload:!1},set:function(e){this.media&&(this.media.preload=e)}},{key:"readyState",get:function(){return this.media.readyState}},{key:"seekable",get:function(){return this.media?this.media.seekable:!1}},{key:"seeking",get:function(){return this.media?this.media.seeking:!1}},{key:"src",get:function(){return this.media?this.media.src:""},set:function(e){if(this.media){if(this.emit(li,e),this.emit(Si),this._currentTime=0,this._duration=0,g.isMSE(this.media)){this.onWaiting();return}this._detachSourceEvents(this.media),g.typeOf(e)==="Array"?this._attachSourceEvents(this.media,e):e?this.media.src=e:this.media.removeAttribute("src"),this.load()}}},{key:"volume",get:function(){return this.media?this.media.volume:0},set:function(e){e===1/0||!this.media||(this.media.volume=e)}},{key:"aspectRatio",get:function(){return this.media?this.media.videoWidth/this.media.videoHeight:0}},{key:"addInnerOP",value:function(e){this._internalOp[e]=!0}},{key:"removeInnerOP",value:function(e){delete this._internalOp[e]}},{key:"emit",value:function(e,r){for(var n,a=arguments.length,u=new Array(a>2?a-2:0),l=2;l<a;l++)u[l-2]=arguments[l];(n=se(re(i.prototype),"emit",this)).call.apply(n,[this,e,r].concat(u))}},{key:"on",value:function(e,r){for(var n,a=arguments.length,u=new Array(a>2?a-2:0),l=2;l<a;l++)u[l-2]=arguments[l];(n=se(re(i.prototype),"on",this)).call.apply(n,[this,e,r].concat(u))}},{key:"once",value:function(e,r){for(var n,a=arguments.length,u=new Array(a>2?a-2:0),l=2;l<a;l++)u[l-2]=arguments[l];(n=se(re(i.prototype),"once",this)).call.apply(n,[this,e,r].concat(u))}},{key:"off",value:function(e,r){for(var n,a=arguments.length,u=new Array(a>2?a-2:0),l=2;l<a;l++)u[l-2]=arguments[l];(n=se(re(i.prototype),"off",this)).call.apply(n,[this,e,r].concat(u))}},{key:"offAll",value:function(){se(re(i.prototype),"removeAllListeners",this).call(this)}}]),i})(jt),Wo=(function(){function s(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{name:"xgplayer",version:1,db:null,ojstore:{name:"xg-m4a",keypath:"vid"}};X(this,s),this.indexedDB=window.indexedDB||window.webkitindexedDB,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,this.myDB=o}return q(s,[{key:"openDB",value:function(i){var t=this,e=this,r=this.myDB.version||1,n=e.indexedDB.open(e.myDB.name,r);n.onerror=function(a){},n.onsuccess=function(a){t.myDB.db=a.target.result,i.call(e)},n.onupgradeneeded=function(a){var u=a.target.result;a.target.transaction,u.objectStoreNames.contains(e.myDB.ojstore.name)||u.createObjectStore(e.myDB.ojstore.name,{keyPath:e.myDB.ojstore.keypath})}}},{key:"deletedb",value:function(){var i=this;i.indexedDB.deleteDatabase(this.myDB.name)}},{key:"closeDB",value:function(){this.myDB.db.close()}},{key:"addData",value:function(i,t){for(var e=this.myDB.db.transaction(i,"readwrite").objectStore(i),r,n=0;n<t.length;n++)r=e.add(t[n]),r.onerror=function(){},r.onsuccess=function(){}}},{key:"putData",value:function(i,t){for(var e=this.myDB.db.transaction(i,"readwrite").objectStore(i),r,n=0;n<t.length;n++)r=e.put(t[n]),r.onerror=function(){},r.onsuccess=function(){}}},{key:"getDataByKey",value:function(i,t,e){var r=this,n=this.myDB.db.transaction(i,"readwrite").objectStore(i),a=n.get(t);a.onerror=function(){e.call(r,null)},a.onsuccess=function(u){var l=u.target.result;e.call(r,l)}}},{key:"deleteData",value:function(i,t){var e=this.myDB.db.transaction(i,"readwrite").objectStore(i);e.delete(t)}},{key:"clearData",value:function(i){var t=this.myDB.db.transaction(i,"readwrite").objectStore(i);t.clear()}}]),s})(),jn=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],zn=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],Wn=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],Ct="data-xgplayerid";function Di(s,o,i){for(var t=arguments.length,e=new Array(t>3?t-3:0),r=3;r<t;r++)e[r-3]=arguments[r];var n=o.call.apply(o,[s].concat(e));!i||typeof i!="function"||(n&&n.then?n.then(function(){for(var a=arguments.length,u=new Array(a),l=0;l<a;l++)u[l]=arguments[l];i.call.apply(i,[s].concat(u))}):i.call.apply(i,[s].concat(e)))}function Yi(s,o){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{pre:null,next:null};return this.__hooks||(this.__hooks={}),!this.__hooks[s]&&(this.__hooks[s]=null),(function(){var t=arguments,e=this;if(i.pre)try{var r;(r=i.pre).call.apply(r,[this].concat(Array.prototype.slice.call(arguments)))}catch(a){throw a.message="[pluginName: ".concat(this.pluginName,":").concat(s,":pre error] >> ").concat(a.message),a}if(this.__hooks&&this.__hooks[s])try{var n=ft.apply(void 0,[this,s,o].concat(Array.prototype.slice.call(arguments)));n?n.then?n.then(function(a){a!==!1&&Di.apply(void 0,[e,o,i.next].concat(nt(t)))}).catch(function(a){throw a}):Di.apply(void 0,[this,o,i.next].concat(Array.prototype.slice.call(arguments))):n===void 0&&Di.apply(void 0,[this,o,i.next].concat(Array.prototype.slice.call(arguments)))}catch(a){throw a.message="[pluginName: ".concat(this.pluginName,":").concat(s,"] >> ").concat(a.message),a}else Di.apply(void 0,[this,o,i.next].concat(Array.prototype.slice.call(arguments)))}).bind(this)}function vs(s,o){var i=this.__hooks;if(!i||!Array.isArray(i[s]))return-1;for(var t=i[s],e=0;e<t.length;e++)if(t[e]===o)return e;return-1}function Xi(s,o){var i=this.__hooks;if(i)return i.hasOwnProperty(s)?(Array.isArray(i[s])||(i[s]=[]),vs.call(this,s,o)===-1&&i[s].push(o),!0):(console.warn("has no supported hook which name [".concat(s,"]")),!1)}function qi(s,o){var i=this.__hooks;if(i)if(Array.isArray(i[s])){var t=i[s],e=vs.call(this,s,o);e!==-1&&t.splice(e,1)}else i[s]&&(i[s]=null)}function $n(s){if(!(!this.plugins||!this.plugins[s.toLowerCase()])){for(var o=this.plugins[s.toLowerCase()],i=arguments.length,t=new Array(i>1?i-1:0),e=1;e<i;e++)t[e-1]=arguments[e];return o.useHooks&&o.useHooks.apply(o,t)}}function Kn(s){if(!(!this.plugins||!this.plugins[s.toLowerCase()])){var o=this.plugins[s.toLowerCase()];if(o){for(var i=arguments.length,t=new Array(i>1?i-1:0),e=1;e<i;e++)t[e-1]=arguments[e];return o.removeHooks&&o.removeHooks.apply(o,t)}}}function ps(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];s.__hooks={},o&&o.map(function(i){s.__hooks[i]=null}),Object.defineProperty(s,"hooks",{get:function(){return s.__hooks&&Object.keys(s.__hooks).map(function(t){if(s.__hooks[t])return t})}})}function gs(s){s.__hooks=null}function ft(s,o,i){for(var t=arguments.length,e=new Array(t>3?t-3:0),r=3;r<t;r++)e[r-3]=arguments[r];if(s.__hooks&&Array.isArray(s.__hooks[o])){var n=s.__hooks[o],a=-1,u=function l(c,f,h){for(var d=arguments.length,v=new Array(d>3?d-3:0),y=3;y<d;y++)v[y-3]=arguments[y];if(a++,n.length===0||a===n.length)return h.call.apply(h,[c,c].concat(v));var p=n[a],b=p.call.apply(p,[c,c].concat(v));if(b&&b.then)return b.then(function(k){return k===!1?null:l.apply(void 0,[c,f,h].concat(v))}).catch(function(k){console.warn("[runHooks]".concat(f," reject"),k.message)});if(b!==!1)return l.apply(void 0,[c,f,h].concat(v));if(b===!1)return!1};return u.apply(void 0,[s,o,i].concat(e))}else return i.call.apply(i,[s,s].concat(e))}function gr(s,o){he.logError("[".concat(s,"] event or callback cant be undefined or null when call ").concat(o))}var tt=(function(){function s(o){X(this,s),g.checkIsFunction(this.beforeCreate)&&this.beforeCreate(o),ps(this),this.__args=o,this.__events={},this.__onceEvents={},this.config=o.config||{},this.player=null,this.playerConfig={},this.pluginName="",this.__init(o)}return q(s,[{key:"beforeCreate",value:function(i){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerInit",value:function(){}},{key:"onPluginsReady",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(i){this.player=i.player,this.playerConfig=i.player&&i.player.config,this.pluginName=i.pluginName?i.pluginName.toLowerCase():this.constructor.pluginName.toLowerCase(),this.logger=i.player&&i.player.logger}},{key:"updateLang",value:function(i){i||(i=this.lang)}},{key:"lang",get:function(){return this.player.lang}},{key:"i18n",get:function(){return this.player.i18n}},{key:"i18nKeys",get:function(){return this.player.i18nKeys}},{key:"domEventType",get:function(){var i=g.checkTouchSupport()?"touch":"mouse";return this.playerConfig&&(this.playerConfig.domEventType==="touch"||this.playerConfig.domEventType==="mouse")&&(i=this.playerConfig.domEventType),i}},{key:"on",value:function(i,t){var e=this;if(!i||!t||!this.player){gr(this.pluginName,"plugin.on(event, callback)");return}typeof i=="string"?(this.__events[i]=t,this.player.on(i,t)):Array.isArray(i)&&i.forEach(function(r){e.__events[r]=t,e.player.on(r,t)})}},{key:"once",value:function(i,t){var e=this;if(!i||!t||!this.player){gr(this.pluginName,"plugin.once(event, callback)");return}typeof i=="string"?(this.__onceEvents[i]=t,this.player.once(i,t)):Array.isArray(i)&&i.forEach(function(r){e.__onceEvents[r]=t,e.player.once(i,t)})}},{key:"off",value:function(i,t){var e=this;if(!i||!t||!this.player){gr(this.pluginName,"plugin.off(event, callback)");return}typeof i=="string"?(delete this.__events[i],this.player.off(i,t)):Array.isArray(i)&&i.forEach(function(r){delete e.__events[i],e.player.off(r,t)})}},{key:"offAll",value:function(){var i=this;["__events","__onceEvents"].forEach(function(t){Object.keys(i[t]).forEach(function(e){i[t][e]&&i.off(e,i[t][e]),e&&delete i[t][e]})}),this.__events={},this.__onceEvents={}}},{key:"emit",value:function(i){var t;if(this.player){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];(t=this.player).emit.apply(t,[i].concat(r))}}},{key:"emitUserAction",value:function(i,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.player){var r=Ae(Ae({},e),{},{pluginName:this.pluginName});this.player.emitUserAction(i,t,r)}}},{key:"hook",value:function(i,t){return Yi.call.apply(Yi,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(i,t){for(var e=arguments.length,r=new Array(e>2?e-2:0),n=2;n<e;n++)r[n-2]=arguments[n];return Xi.call.apply(Xi,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(i,t){for(var e=arguments.length,r=new Array(e>2?e-2:0),n=2;n<e;n++)r[n-2]=arguments[n];return qi.call.apply(qi,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"registerPlugin",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(this.player)return e&&(t.pluginName=e),this.player.registerPlugin({plugin:i,options:t})}},{key:"getPlugin",value:function(i){return this.player?this.player.getPlugin(i):null}},{key:"__destroy",value:function(){var i=this,t=this.player,e=this.pluginName;this.offAll(),g.clearAllTimers(this),g.checkIsFunction(this.destroy)&&this.destroy(),["player","playerConfig","pluginName","logger","__args","__hooks"].map(function(r){i[r]=null}),t.unRegisterPlugin(e),gs(this)}}],[{key:"defineGetterOrSetter",value:function(i,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&Object.defineProperty(i,e,t[e])}},{key:"defineMethod",value:function(i,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&typeof t[e]=="function"&&Object.defineProperty(i,e,{configurable:!0,value:t[e]})}},{key:"defaultConfig",get:function(){return{}}},{key:"pluginName",get:function(){return"pluginName"}}]),s})(),mr,Yn;function $o(){if(Yn)return mr;Yn=1;var s=9;if(typeof Element<"u"&&!Element.prototype.matches){var o=Element.prototype;o.matches=o.matchesSelector||o.mozMatchesSelector||o.msMatchesSelector||o.oMatchesSelector||o.webkitMatchesSelector}function i(t,e){for(;t&&t.nodeType!==s;){if(typeof t.matches=="function"&&t.matches(e))return t;t=t.parentNode}}return mr=i,mr}var yr,Xn;function Ko(){if(Xn)return yr;Xn=1;var s=$o();function o(e,r,n,a,u){var l=t.apply(this,arguments);return e.addEventListener(n,l,u),{destroy:function(){e.removeEventListener(n,l,u)}}}function i(e,r,n,a,u){return typeof e.addEventListener=="function"?o.apply(null,arguments):typeof n=="function"?o.bind(null,document).apply(null,arguments):(typeof e=="string"&&(e=document.querySelectorAll(e)),Array.prototype.map.call(e,function(l){return o(l,r,n,a,u)}))}function t(e,r,n,a){return function(u){u.delegateTarget=s(u.target,r),u.delegateTarget&&a.call(e,u)}}return yr=i,yr}var Yo=Ko();const qn=dn(Yo);var Xo={CONTROLS:"controls",ROOT:"root"},Ee={ROOT:"root",ROOT_LEFT:"rootLeft",ROOT_RIGHT:"rootRight",ROOT_TOP:"rootTop",CONTROLS_LEFT:"controlsLeft",CONTROLS_RIGTH:"controlsRight",CONTROLS_RIGHT:"controlsRight",CONTROLS_CENTER:"controlsCenter",CONTROLS:"controls"},Qn={ICON_DISABLE:"xg-icon-disable"};function _r(s){return s?s.indexOf&&/^(?:http|data:|\/)/.test(s):!1}function qo(s,o){return Ve(s)==="object"&&s.class&&typeof s.class=="string"?"".concat(o," ").concat(s.class):o}function Qo(s,o){return Ve(s)==="object"&&s.attr&&Ve(s.attr)==="object"&&Object.keys(s.attr).map(function(i){o[i]=s.attr[i]}),o}function Zn(s,o){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"",t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},e=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"",r=null;if(s instanceof window.Element)return g.addClass(s,i),Object.keys(t).map(function(n){s.setAttribute(n,t[n])}),s;if(_r(s)||_r(s.url))return t.src=_r(s)?s:s.url||"",r=g.createDom(s.tag||"img","",t,"xg-img ".concat(i)),r;if(typeof s=="function")try{return r=s(),r instanceof window.Element?(g.addClass(r,i),Object.keys(t).map(function(n){r.setAttribute(n,t[n])}),r):(he.logWarn("warn>>icons.".concat(o," in config of plugin named [").concat(e,"] is a function mast return an Element Object")),null)}catch(n){return he.logError("Plugin named [".concat(e,"]:createIcon"),n),null}return typeof s=="string"?g.createDomFromHtml(s,t,i):(he.logWarn("warn>>icons.".concat(o," in config of plugin named [").concat(e,"] is invalid")),null)}function Zo(s,o){var i=o.config.icons||o.playerConfig.icons;Object.keys(s).map(function(t){var e=s[t],r=e&&e.class?e.class:"",n=e&&e.attr?e.attr:{},a=null;i&&i[t]&&(r=qo(i[t],r),n=Qo(i[t],n),a=Zn(i[t],t,r,n,o.pluginName)),!a&&e&&(a=Zn(e.icon?e.icon:e,n,r,{},o.pluginName)),o.icons[t]=a})}function Jo(s,o){Object.keys(s).map(function(i){Object.defineProperty(o.langText,i,{get:function(){var e=o.lang,r=o.i18n;return r[i]?r[i]:s[i]&&s[i][e]||""}})})}var pe=(function(s){J(i,s);var o=ee(i);function i(){var t,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return X(this,i),t=o.call(this,e),t.__delegates=[],t}return q(i,[{key:"__init",value:function(e){if(se(re(i.prototype),"__init",this).call(this,e),!!e.root){var r=e.root,n=null;this.icons={},this.root=null,this.parent=null,this.extraEls=[];var a=this.registerIcons()||{};Zo(a,this),this.langText={};var u=this.registerLanguageTexts()||{};Jo(u,this);var l="";try{l=this.render()}catch(h){throw he.logError("Plugin:".concat(this.pluginName,":render"),h),new Error("Plugin:".concat(this.pluginName,":render:").concat(h.message))}if(l)n=i.insert(l,r,e.index),n.setAttribute("data-index",e.index);else if(e.tag)n=g.createDom(e.tag,"",e.attr,e.name),n.setAttribute("data-index",e.index),r.appendChild(n);else return;this.root=n,this.parent=r;var c=this.config.attr||{},f=this.config.style||{};this.setAttr(c),this.setStyle(f),this.config.index&&this.root.setAttribute("data-index",this.config.index),this.__registerChildren()}}},{key:"__registerChildren",value:function(){var e=this;if(this.root){this._children=[];var r=this.children();r&&Ve(r)==="object"&&Object.keys(r).length>0&&Object.keys(r).map(function(n){var a=n,u=r[a],l={root:e.root},c,f;typeof u=="function"?(c=e.config[a]||{},f=u):Ve(u)==="object"&&typeof u.plugin=="function"&&(c=u.options?g.deepCopy(e.config[a]||{},u.options):e.config[a]||{},f=u.plugin),l.config=c,c.index!==void 0&&(l.index=c.index),c.root&&(l.root=c.root),e.registerPlugin(f,l,a)})}}},{key:"updateLang",value:function(e){e||(e=this.lang);function r(l,c){for(var f=0;f<l.children.length;f++)l.children[f].children.length>0?r(l.children[f],c):c(l.children[f])}var n=this.root,a=this.i18n,u=this.langText;n&&r(n,function(l){var c=l.getAttribute&&l.getAttribute("lang-key");if(c){var f=a[c.toUpperCase()]||u[c];f&&(l.innerHTML=typeof f=="function"?f(e):f)}})}},{key:"lang",get:function(){return this.player.lang}},{key:"changeLangTextKey",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=this.i18n||{},a=this.langText;e.setAttribute&&e.setAttribute("lang-key",r);var u=n[r]||a[r]||"";u&&(e.innerHTML=u)}},{key:"plugins",value:function(){return this._children}},{key:"disable",value:function(){this.config.disable=!0,g.addClass(this.find(".xgplayer-icon"),Qn.ICON_DISABLE)}},{key:"enable",value:function(){this.config.disable=!1,g.removeClass(this.find(".xgplayer-icon"),Qn.ICON_DISABLE)}},{key:"children",value:function(){return{}}},{key:"registerPlugin",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";r.root=r.root||this.root;var a=se(re(i.prototype),"registerPlugin",this).call(this,e,r,n);return this._children.push(a),a}},{key:"registerIcons",value:function(){return{}}},{key:"registerLanguageTexts",value:function(){return{}}},{key:"find",value:function(e){if(this.root)return this.root.querySelector(e)}},{key:"bind",value:function(e,r,n){var a=this;if(arguments.length<3&&typeof r=="function")Array.isArray(e)?e.forEach(function(l){a.bindEL(l,r)}):this.bindEL(e,r);else{var u=i.delegate.call(this,this.root,e,r,n);this.__delegates=this.__delegates.concat(u)}}},{key:"unbind",value:function(e,r){var n=this;if(arguments.length<3&&typeof r=="function")Array.isArray(e)?e.forEach(function(l){n.unbindEL(l,r)}):this.unbindEL(e,r);else for(var a="".concat(e,"_").concat(r),u=0;u<this.__delegates.length;u++)if(this.__delegates[u].key===a){this.__delegates[u].destroy(),this.__delegates.splice(u,1);break}}},{key:"setStyle",value:function(e,r){var n=this;if(this.root){if(g.typeOf(e)==="String")return this.root.style[e]=r;g.typeOf(e)==="Object"&&Object.keys(e).map(function(a){n.root.style[a]=e[a]})}}},{key:"setAttr",value:function(e,r){var n=this;if(this.root){if(g.typeOf(e)==="String")return this.root.setAttribute(e,r);g.typeOf(e)==="Object"&&Object.keys(e).map(function(a){n.root.setAttribute(a,e[a])})}}},{key:"setHtml",value:function(e,r){this.root&&(this.root.innerHTML=e,typeof r=="function"&&r())}},{key:"bindEL",value:function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.root&&"on".concat(e)in this.root&&typeof r=="function"&&this.root.addEventListener(e,r,n)}},{key:"unbindEL",value:function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.root&&"on".concat(e)in this.root&&typeof r=="function"&&this.root.removeEventListener(e,r,n)}},{key:"show",value:function(e){if(this.root){this.root.style.display=e!==void 0?e:"block";var r=window.getComputedStyle(this.root,null),n=r.getPropertyValue("display");if(n==="none")return this.root.style.display="block"}}},{key:"hide",value:function(){this.root&&(this.root.style.display="none")}},{key:"appendChild",value:function(e,r){if(!this.root)return null;if(arguments.length<2&&arguments[0]instanceof window.Element)return this.root.appendChild(arguments[0]);if(!r||!(r instanceof window.Element))return null;try{return typeof e=="string"?this.find(e).appendChild(r):e.appendChild(r)}catch(n){return he.logError("Plugin:appendChild",n),null}}},{key:"render",value:function(){return""}},{key:"destroy",value:function(){}},{key:"__destroy",value:function(){var e=this,r=this.player;this.__delegates.map(function(n){n.destroy()}),this.__delegates=[],this._children instanceof Array&&(this._children.map(function(n){r.unRegisterPlugin(n.pluginName)}),this._children=null),this.root&&(this.root.hasOwnProperty("remove")?this.root.remove():this.root.parentNode&&this.root.parentNode.removeChild(this.root)),se(re(i.prototype),"__destroy",this).call(this),this.icons={},["root","parent"].map(function(n){e[n]=null}),this.extraEls=[]}}],[{key:"insert",value:function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=r.children.length,u=Number(n),l=e instanceof window.Node;if(a){for(var c=0,f=null,h="";c<a;c++){f=r.children[c];var d=Number(f.getAttribute("data-index"));if(d>=u){h="beforebegin";break}else d<u&&(h="afterend")}return l?h==="afterend"?r.appendChild(e):r.insertBefore(e,f):f.insertAdjacentHTML(h,e),h==="afterend"?r.children[r.children.length-1]:r.children[c]}else return l?r.appendChild(e):r.insertAdjacentHTML("beforeend",e),r.children[r.children.length-1]}},{key:"defaultConfig",get:function(){return{}}},{key:"delegate",value:function(e,r,n,a){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,l=[];if(e instanceof window.Node&&typeof a=="function")if(Array.isArray(n))n.forEach(function(f){var h=qn(e,r,f,a,u);h.key="".concat(r,"_").concat(f),l.push(h)});else{var c=qn(e,r,n,a,u);c.key="".concat(r,"_").concat(n),l.push(c)}return l}},{key:"ROOT_TYPES",get:function(){return Xo}},{key:"POSITIONS",get:function(){return Ee}}]),i})(tt),eu=(function(){function s(){var o=this;if(X(this,s),I(this,"__trigger",function(i){var t=new Date().getTime();o.timeStamp=t;for(var e=0;e<i.length;e++)o.__runHandler(i[e].target)}),this.__handlers=[],this.timeStamp=0,this.observer=null,!!window.ResizeObserver)try{this.observer=new window.ResizeObserver(Po(this.__trigger,100,{trailing:!0})),this.timeStamp=new Date().getTime()}catch(i){console.error(i)}}return q(s,[{key:"addObserver",value:function(i,t){if(this.observer){this.observer.observe(i);for(var e=i.getAttribute(Ct),r=this.__handlers,n=-1,a=0;a<r.length;a++)r[a]&&i===r[a].target&&(n=a);n>-1?this.__handlers[n].handler=t:this.__handlers.push({target:i,handler:t,playerId:e})}}},{key:"unObserver",value:function(i){var t=-1;this.__handlers.map(function(r,n){i===r.target&&(t=n)});try{var e;(e=this.observer)===null||e===void 0||e.unobserve(i)}catch{}t>-1&&this.__handlers.splice(t,1)}},{key:"destroyObserver",value:function(){var i;(i=this.observer)===null||i===void 0||i.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(i){for(var t=this.__handlers,e=0;e<t.length;e++)if(t[e]&&i===t[e].target){try{t[e].handler(i)}catch(r){console.error(r)}return!0}return!1}}]),s})(),hi=null;function tu(s,o){return hi||(hi=new eu),hi.addObserver(s,o),hi}function iu(s,o){var i;(i=hi)===null||i===void 0||i.unObserver(s,o)}var Ne={pluginGroup:{},init:function(o){var i=o._pluginInfoId;i||(i=new Date().getTime(),o._pluginInfoId=i),!o.config.closeResizeObserver&&tu(o.root,function(){o.resize()}),this.pluginGroup[i]={_originalOptions:o.config||{},_plugins:{}}},formatPluginInfo:function(o,i){var t=null,e=null;return o.plugin&&typeof o.plugin=="function"?(t=o.plugin,e=o.options):(t=o,e={}),i&&(e.config=i||{}),{PLUFGIN:t,options:e}},checkPluginIfExits:function(o,i){for(var t=0;t<i.length;t++)if(o.toLowerCase()===i[t].pluginName.toLowerCase())return!0;return!1},getRootByConfig:function(o,i){for(var t=Object.keys(i),e=null,r=0;r<t.length;r++)if(o.toLowerCase()===t[r].toLowerCase()){e=i[t[r]];break}return g.typeOf(e)==="Object"?{root:e.root,position:e.position}:{}},lazyRegister:function(o,i){var t=this,e=i.timeout||1500;return Promise.race([i.loader().then(function(r){var n;r&&r.__esModule?n=r.default:n=r,t.register(o,n,r.options)}),new Promise(function(r,n){setTimeout(function(){n(new Error("timeout"))},e)})])},register:function(o,i){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!(!o||!i||typeof i!="function"||i.prototype===void 0)){var e=o._pluginInfoId;if(!(!e||!this.pluginGroup[e])){this.pluginGroup[e]._plugins||(this.pluginGroup[e]._plugins={});var r=this.pluginGroup[e]._plugins,n=this.pluginGroup[e]._originalOptions;t.player=o;var a=t.pluginName||i.pluginName;if(!a)throw new Error("The property pluginName is necessary");if(i.isSupported&&!i.isSupported(o.config.mediaType,o.config.codecType)){console.warn("not supported plugin [".concat(a,"]"));return}t.config||(t.config={});for(var u=Object.keys(n),l=0;l<u.length;l++)if(a.toLowerCase()===u[l].toLowerCase()){var c=n[u[l]];g.typeOf(c)==="Object"?t.config=Object.assign({},t.config,n[u[l]]):g.typeOf(c)==="Boolean"&&(t.config.disable=!c);break}i.defaultConfig&&Object.keys(i.defaultConfig).forEach(function(h){typeof t.config[h]>"u"&&(t.config[h]=i.defaultConfig[h])}),t.root?typeof t.root=="string"&&(t.root=o[t.root]):t.root=o.root,t.index=t.config.index||0;try{r[a.toLowerCase()]&&(this.unRegister(e,a.toLowerCase()),console.warn("the is one plugin with same pluginName [".concat(a,"] exist, destroy the old instance")));var f=new i(t);return r[a.toLowerCase()]=f,r[a.toLowerCase()].func=i,f&&typeof f.afterCreate=="function"&&f.afterCreate(),f}catch(h){throw console.error(h),h}}}},unRegister:function(o,i){o._pluginInfoId&&(o=o._pluginInfoId),i=i.toLowerCase();try{var t=this.pluginGroup[o]._plugins[i];t&&(t.pluginName&&t.__destroy(),delete this.pluginGroup[o]._plugins[i])}catch(e){console.error("[unRegister:".concat(i,"] cgid:[").concat(o,"] error"),e)}},deletePlugin:function(o,i){var t=o._pluginInfoId;t&&this.pluginGroup[t]&&this.pluginGroup[t]._plugins&&delete this.pluginGroup[t]._plugins[i]},getPlugins:function(o){var i=o._pluginInfoId;return i&&this.pluginGroup[i]?this.pluginGroup[i]._plugins:{}},findPlugin:function(o,i){var t=o._pluginInfoId;if(!t||!this.pluginGroup[t])return null;var e=i.toLowerCase();return this.pluginGroup[t]._plugins[e]},beforeInit:function(o){var i=this;function t(e){return!e||!e.then?new Promise(function(r){r()}):e}return new Promise(function(e){if(i.pluginGroup){var r;return o._loadingPlugins&&o._loadingPlugins.length?r=Promise.all(o._loadingPlugins):r=Promise.resolve(),r.then(function(){var n=o._pluginInfoId;if(!i.pluginGroup[n]){e();return}var a=i.pluginGroup[n]._plugins,u=[];Object.keys(a).forEach(function(l){if(a[l]&&a[l].beforePlayerInit)try{var c=a[l].beforePlayerInit();u.push(t(c))}catch(f){throw u.push(t(null)),f}}),Promise.all([].concat(u)).then(function(){e()}).catch(function(l){console.error(l),e()})})}})},afterInit:function(o){var i=o._pluginInfoId;if(!(!i||!this.pluginGroup[i])){var t=this.pluginGroup[i]._plugins;Object.keys(t).forEach(function(e){t[e]&&t[e].afterPlayerInit&&t[e].afterPlayerInit()})}},setLang:function(o,i){var t=i._pluginInfoId;if(!(!t||!this.pluginGroup[t])){var e=this.pluginGroup[t]._plugins;Object.keys(e).forEach(function(r){if(e[r].updateLang)e[r].updateLang(o);else try{e[r].lang=o}catch{console.warn("".concat(r," setLang"))}})}},reRender:function(o){var i=this,t=o._pluginInfoId;if(!(!t||!this.pluginGroup[t])){var e=[],r=this.pluginGroup[t]._plugins;Object.keys(r).forEach(function(n){n!=="controls"&&r[n]&&(e.push({plugin:r[n].func,options:r[n].__args}),i.unRegister(t,n))}),e.forEach(function(n){i.register(o,n.plugin,n.options)})}},onPluginsReady:function(o){var i=o._pluginInfoId;if(!(!i||!this.pluginGroup[i])){var t=this.pluginGroup[i]._plugins||{};Object.keys(t).forEach(function(e){t[e].onPluginsReady&&typeof t[e].onPluginsReady=="function"&&t[e].onPluginsReady()})}},destroy:function(o){var i=o._pluginInfoId;if(this.pluginGroup[i]){iu(o.root);for(var t=this.pluginGroup[i]._plugins,e=0,r=Object.keys(t);e<r.length;e++){var n=r[e];this.unRegister(i,n)}delete this.pluginGroup[i],delete o._pluginInfoId}}},H={DEFAULT:"xgplayer",DEFAULT_SKIN:"xgplayer-skin-default",ENTER:"xgplayer-is-enter",PAUSED:"xgplayer-pause",PLAYING:"xgplayer-playing",ENDED:"xgplayer-ended",CANPLAY:"xgplayer-canplay",LOADING:"xgplayer-isloading",ERROR:"xgplayer-is-error",REPLAY:"xgplayer-replay",NO_START:"xgplayer-nostart",ACTIVE:"xgplayer-active",INACTIVE:"xgplayer-inactive",FULLSCREEN:"xgplayer-is-fullscreen",CSS_FULLSCREEN:"xgplayer-is-cssfullscreen",ROTATE_FULLSCREEN:"xgplayer-rotate-fullscreen",PARENT_ROTATE_FULLSCREEN:"xgplayer-rotate-parent",PARENT_FULLSCREEN:"xgplayer-fullscreen-parent",INNER_FULLSCREEN:"xgplayer-fullscreen-inner",NO_CONTROLS:"no-controls",FLEX_CONTROLS:"flex-controls",CONTROLS_FOLLOW:"controls-follow",CONTROLS_AUTOHIDE:"controls-autohide",TOP_BAR_AUTOHIDE:"top-bar-autohide",NOT_ALLOW_AUTOPLAY:"not-allow-autoplay",SEEKING:"seeking",PC:"xgplayer-pc",MOBILE:"xgplayer-mobile",MINI:"xgplayer-mini"};function Jn(){return{id:"",el:null,url:"",domEventType:"default",nullUrlStart:!1,width:600,height:337.5,fluid:!1,fitVideoSize:"fixed",videoFillMode:"auto",volume:.6,autoplay:!1,autoplayMuted:!1,loop:!1,isLive:!1,zoom:1,videoInit:!0,poster:"",isMobileSimulateMode:!1,defaultPlaybackRate:1,execBeforePluginsCall:null,allowSeekAfterEnded:!0,enableContextmenu:!0,closeVideoClick:!1,closeVideoDblclick:!1,closePlayerBlur:!1,closeDelayBlur:!1,leavePlayerTime:3e3,closePlayVideoFocus:!1,closePauseVideoFocus:!1,closeFocusVideoFocus:!0,closeControlsBlur:!0,topBarAutoHide:!0,videoAttributes:{},startTime:0,seekedStatus:"play",miniprogress:!1,disableSwipeHandler:function(){},enableSwipeHandler:function(){},preProcessUrl:null,ignores:[],whitelist:[],inactive:3e3,lang:Lo(),controls:!0,marginControls:!1,fullscreenTarget:null,screenShot:!1,rotate:!1,pip:!1,download:!1,mini:!1,cssFullscreen:!0,keyShortcut:!0,presets:[],plugins:[],playbackRate:1,definition:{list:[]},playsinline:!0,customDuration:0,timeOffset:0,icons:{},i18n:[],tabindex:0,thumbnail:null,videoConfig:{},isHideTips:!1,minWaitDelay:200,commonStyle:{progressColor:"",playedColor:"",cachedColor:"",sliderBtnStyle:{},volumeColor:""}}}var ru=function(o,i){var t,e,r;i.preset&&i.options?r=new i.preset(i.options,o.config):r=new i({},o.config);var n=r,a=n.plugins,u=a===void 0?[]:a,l=n.ignores,c=l===void 0?[]:l,f=n.icons,h=f===void 0?{}:f,d=n.i18n,v=d===void 0?[]:d;o.config.plugins||(o.config.plugins=[]),o.config.ignores||(o.config.ignores=[]),(t=o.config.plugins).push.apply(t,nt(u)),(e=o.config.ignores).push.apply(e,nt(c)),Object.keys(h).map(function(p){o.config.icons[p]||(o.config.icons[p]=h[p])});var y=o.config.i18n||[];v.push.apply(v,nt(y)),o.config.i18n=v},nu=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"onMouseEnter",function(a){var u=P(t),l=u.player,c=u.playerConfig;c.closeControlsBlur&&l.focus({autoHide:!1})}),I(P(t),"onMouseLeave",function(a){var u=P(t),l=u.player;l.focus()}),t}return q(i,[{key:"beforeCreate",value:function(e){!e.config.mode&&ue.device==="mobile"&&(e.config.mode="flex"),e.player.config.marginControls&&(e.config.autoHide=!1)}},{key:"afterCreate",value:function(){var e=this,r=this.config,n=r.disable,a=r.height,u=r.mode;if(!n){u==="flex"&&this.player.addClass(H.FLEX_CONTROLS);var l={height:"".concat(a,"px")};Object.keys(l).map(function(f){e.root.style[f]=l[f]}),this.left=this.find("xg-left-grid"),this.center=this.find("xg-center-grid"),this.right=this.find("xg-right-grid"),this.innerRoot=this.find("xg-inner-controls"),this.on(Wi,function(f){f?g.addClass(e.root,"mini-controls"):g.removeClass(e.root,"mini-controls")});var c=this.playerConfig.isMobileSimulateMode;ue.device!=="mobile"&&c!=="mobile"&&(this.bind("mouseenter",this.onMouseEnter),this.bind("mouseleave",this.onMouseLeave))}}},{key:"focus",value:function(){this.player.focus({autoHide:!1})}},{key:"focusAwhile",value:function(){this.player.focus({autoHide:!0})}},{key:"blur",value:function(){this.player.blur({ignorePaused:!0})}},{key:"recoverAutoHide",value:function(){this.config.autoHide&&g.addClass(this.root,H.CONTROLS_AUTOHIDE)}},{key:"pauseAutoHide",value:function(){g.removeClass(this.root,H.CONTROLS_AUTOHIDE)}},{key:"show",value:function(e){this.root.style.display="",this.player.focus()}},{key:"hide",value:function(){this.root.style.display="none"}},{key:"mode",get:function(){return this.config.mode}},{key:"registerPlugin",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(this.root){var a=e.defaultConfig||{};if(!r.root){var u=r.position?r.position:r.config&&r.config.position?r.config.position:a.position;switch(u){case Ee.CONTROLS_LEFT:r.root=this.left;break;case Ee.CONTROLS_RIGHT:r.root=this.right;break;case Ee.CONTROLS_CENTER:r.root=this.center;break;case Ee.CONTROLS:r.root=this.root;break;default:r.root=this.left}return se(re(i.prototype),"registerPlugin",this).call(this,e,r,n)}}}},{key:"destroy",value:function(){ue.device!=="mobile"&&(this.unbind("mouseenter",this.onMouseEnter),this.unbind("mouseleave",this.onMouseLeave)),this.left=null,this.center=null,this.right=null,this.innerRoot=null}},{key:"render",value:function(){var e=this.config,r=e.mode,n=e.autoHide,a=e.initShow,u=e.disable;if(!u){var l=g.classNames({"xgplayer-controls":!0},{"flex-controls":r==="flex"},{"bottom-controls":r==="bottom"},I({},H.CONTROLS_AUTOHIDE,n),{"xgplayer-controls-initshow":a||!n});return'<xg-controls class="'.concat(l,`" unselectable="on">
    <xg-inner-controls class="xg-inner-controls xg-pos">
      <xg-left-grid class="xg-left-grid">
      </xg-left-grid>
      <xg-center-grid class="xg-center-grid"></xg-center-grid>
      <xg-right-grid class="xg-right-grid">
      </xg-right-grid>
    </xg-inner-controls>
    </xg-controls>`)}}}],[{key:"pluginName",get:function(){return"controls"}},{key:"defaultConfig",get:function(){return{disable:!1,autoHide:!0,mode:"",initShow:!1}}}]),i})(pe),au={LANG:"en",TEXT:{ERROR_TYPES:{network:{code:1,msg:"video download error"},mse:{code:2,msg:"stream append error"},parse:{code:3,msg:"parsing error"},format:{code:4,msg:"wrong format"},decoder:{code:5,msg:"decoding error"},runtime:{code:6,msg:"grammatical errors"},timeout:{code:7,msg:"play timeout"},other:{code:8,msg:"other errors"}},HAVE_NOTHING:"There is no information on whether audio/video is ready",HAVE_METADATA:"Audio/video metadata is ready ",HAVE_CURRENT_DATA:"Data about the current play location is available, but there is not enough data to play the next frame/millisecond",HAVE_FUTURE_DATA:"Current and at least one frame of data is available",HAVE_ENOUGH_DATA:"The available data is sufficient to start playing",NETWORK_EMPTY:"Audio/video has not been initialized",NETWORK_IDLE:"Audio/video is active and has been selected for resources, but no network is used",NETWORK_LOADING:"The browser is downloading the data",NETWORK_NO_SOURCE:"No audio/video source was found",MEDIA_ERR_ABORTED:"The fetch process is aborted by the user",MEDIA_ERR_NETWORK:"An error occurred while downloading",MEDIA_ERR_DECODE:"An error occurred while decoding",MEDIA_ERR_SRC_NOT_SUPPORTED:"Audio/video is not supported",REPLAY:"Replay",ERROR:"Network is offline",PLAY_TIPS:"Play",PAUSE_TIPS:"Pause",PLAYNEXT_TIPS:"Play next",DOWNLOAD_TIPS:"Download",ROTATE_TIPS:"Rotate",RELOAD_TIPS:"Reload",FULLSCREEN_TIPS:"Fullscreen",EXITFULLSCREEN_TIPS:"Exit fullscreen",CSSFULLSCREEN_TIPS:"Cssfullscreen",EXITCSSFULLSCREEN_TIPS:"Exit cssfullscreen",TEXTTRACK:"Caption",PIP:"PIP",SCREENSHOT:"Screenshot",LIVE:"LIVE",OFF:"Off",OPEN:"Open",MINI_DRAG:"Click and hold to drag",MINISCREEN:"Miniscreen",REFRESH_TIPS:"Please Try",REFRESH:"Refresh",FORWARD:"forward",LIVE_TIP:"Live"}},Xe={lang:{},langKeys:[],textKeys:[]};function pi(s,o){return Object.keys(o).forEach(function(i){var t=g.typeOf(o[i]),e=g.typeOf(s[i]);if(t==="Array"){var r;e!=="Array"&&(s[i]=[]),(r=s[i]).push.apply(r,nt(o[i]))}else t==="Object"?(e!=="Object"&&(s[i]={}),pi(s[i],o[i])):s[i]=o[i]}),s}function ms(){Object.keys(Xe.lang.en).map(function(s){Xe.textKeys[s]=s})}function su(s,o){var i=[];if(o||(o=Xe),!!o.lang){g.typeOf(s)!=="Array"?i=Object.keys(s).map(function(r){var n=r==="zh"?"zh-cn":r;return{LANG:n,TEXT:s[r]}}):i=s;var t=o,e=t.lang;i.map(function(r){r.LANG==="zh"&&(r.LANG="zh-cn"),e[r.LANG]?pi(e[r.LANG]||{},r.TEXT||{}):bn(r,o)}),ms()}}function bn(s,o){var i=s.LANG;if(o||(o=Xe),!!o.lang){var t=s.TEXT||{};i==="zh"&&(i="zh-cn"),o.lang[i]?pi(o.lang[i],t):(o.langKeys.push(i),o.lang[i]=t),ms()}}function ou(s){var o,i={lang:{},langKeys:[],textKeys:{},pId:s};return pi(i.lang,Xe.lang),(o=i.langKeys).push.apply(o,nt(Xe.langKeys)),pi(i.textKeys,Xe.textKeys),i}bn(au);var ri={get textKeys(){return Xe.textKeys},get langKeys(){return Xe.langKeys},get lang(){var s={};return Xe.langKeys.map(function(o){s[o]=Xe.lang[o]}),Xe.lang["zh-cn"]&&(s.zh=Xe.lang["zh-cn"]||{}),s},extend:su,use:bn,init:ou},ve={INITIAL:1,READY:2,ATTACHING:3,ATTACHED:4,NOTALLOW:5,RUNNING:6,ENDED:7},ea=["ERROR","INITIAL","READY","ATTACHING","ATTACHED","NOTALLOW","RUNNING","ENDED","DESTROYED"],je={},br=null,ys=(function(s){J(i,s);var o=ee(i);function i(){return X(this,i),o.apply(this,arguments)}return q(i,[{key:"add",value:function(e){e&&(je[e.playerId]=e,Object.keys(je).length===1&&this.setActive(e.playerId,!0))}},{key:"remove",value:function(e){e&&(e.isUserActive,delete je[e.playerId])}},{key:"_iterate",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(var n in je)if(Object.prototype.hasOwnProperty.call(je,n)){var a=je[n];if(r){if(e(a))break}else e(a)}}},{key:"forEach",value:function(e){this._iterate(e)}},{key:"find",value:function(e){var r=null;return this._iterate(function(n){var a=e(n);return a&&(r=n),a},!0),r}},{key:"findAll",value:function(e){var r=[];return this._iterate(function(n){e(n)&&r.push(n)}),r}},{key:"setActive",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(je[e])return r?this.forEach(function(n){e===n.playerId?(n.isUserActive=!0,n.isInstNext=!1):n.isUserActive=!1}):je[e].isUserActive=r,e}},{key:"getActiveId",value:function(){for(var e=Object.keys(je),r=0;r<e.length;r++){var n=je[e[r]];if(n&&n.isUserActive)return e[r]}return null}},{key:"setNext",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(je[e])return r?this.forEach(function(n){e===n.playerId?(n.isUserActive=!1,n.isInstNext=!0):n.isInstNext=!1}):je[e].isInstNext=r,e}}],[{key:"getInstance",value:function(){return br||(br=new i),br}}]),i})(Ya.EventEmitter);function uu(s){for(var o=Object.keys(je),i=0;i<o.length;i++){var t=je[o[i]];if(t.root===s)return t}return null}var lu=["play","pause","replay","retry"],ta=0,ia=0,kt=null,sr=(function(s){J(i,s);var o=ee(i);function i(t){var e;X(this,i);var r=g.deepMerge(Jn(),t);e=o.call(this,r),I(P(e),"canPlayFunc",function(){if(e.config){var v=e.config,y=v.autoplay,p=v.defaultPlaybackRate;he.logInfo("player","canPlayFunc, startTime",e.__startTime),e._seekToStartTime(),e.playbackRate=p,(y||e._useAutoplay)&&e.mediaPlay(),e.off(gt,e.canPlayFunc),e.removeClass(H.ENTER)}}),I(P(e),"onFullscreenChange",function(v,y){var p=function(){g.setTimeout(P(e),function(){e.resize()},100)},b=g.getFullScreenEl();e._fullActionFrom?e._fullActionFrom="":e.emit(Ki,{eventType:"system",action:"switch_fullscreen",pluginName:"player",currentTime:e.currentTime,duration:e.duration,props:[{prop:"fullscreen",from:!0,to:!1}]});var k=Io(b,e.playerId,Ct);if(y||b&&(b===e._fullscreenEl||k))p(),!e.config.closeFocusVideoFocus&&e.media.focus(),e.fullscreen=!0,e.changeFullStyle(e.root,b,H.FULLSCREEN),e.emit(pt,!0,e._fullScreenOffset),e.cssfullscreen&&e.exitCssFullscreen();else if(e.fullscreen){p();var E=P(e),w=E._fullScreenOffset,T=E.config;if(T.needFullscreenScroll?(window.scrollTo(w.left,w.top),g.setTimeout(P(e),function(){e.fullscreen=!1,e._fullScreenOffset=null},100)):(!e.config.closeFocusVideoFocus&&e.media.focus(),e.fullscreen=!1,e._fullScreenOffset=null),e.cssfullscreen)e.removeClass(H.FULLSCREEN);else{var L=e._fullscreenEl;!L&&(e.root.contains(v.target)||v.target===e.root)&&(L=v.target),e.recoverFullStyle(e.root,L,H.FULLSCREEN)}e._fullscreenEl=null,e.emit(pt,!1)}}),I(P(e),"_onWebkitbeginfullscreen",function(v){e._fullscreenEl=e.media,e.onFullscreenChange(v,!0)}),I(P(e),"_onWebkitendfullscreen",function(v){e.onFullscreenChange(v,!1)}),ps(P(e),lu),e.config=r,e._pluginInfoId=g.generateSessionId(),wo(P(e));var n=e.constructor.defaultPreset;if(e.config.presets.length){var a=e.config.presets.indexOf("default");a>=0&&n&&(e.config.presets[a]=n)}else n&&e.config.presets.push(n);e.userTimer=null,e.waitTimer=null,e.handleSource=!0,e._state=ve.INITIAL,e.isAd=!1,e.isError=!1,e._hasStart=!1,e.isSeeking=!1,e.isCanplay=!1,e._useAutoplay=!1,e.__startTime=-1,e.rotateDeg=0,e.isActive=!1,e.fullscreen=!1,e.cssfullscreen=!1,e.isRotateFullscreen=!1,e._fullscreenEl=null,e.timeSegments=[],e._cssfullscreenEl=null,e.curDefinition=null,e._orgCss="",e._fullScreenOffset=null,e._videoHeight=0,e._videoWidth=0,e.videoPos={pi:1,scale:0,rotate:-1,x:0,y:0,h:-1,w:-1,vy:0,vx:0},e.sizeInfo={width:0,height:0,left:0,top:0},e._accPlayed={t:0,acc:0,loopAcc:0},e._offsetInfo={currentTime:-1,duration:0},e.innerContainer=null,e.controls=null,e.topBar=null,e.root=null,e.__i18n=ri.init(e._pluginInfoId),ue.os.isAndroid&&ue.osVersion>0&&ue.osVersion<6&&(e.config.autoplay=!1),e.database=new Wo,e.isUserActive=!1,e._onceSeekCanplay=null,e._isPauseBeforeSeek=0,e.innerStates={isActiveLocked:!1},e.instManager=kt;var u=e._initDOM();if(!u)return console.error(new Error("can't find the dom which id is ".concat(e.config.id," or this.config.el does not exist"))),hn(e);var l=e.config,c=l.definition,f=c===void 0?{}:c,h=l.url;if(!h&&f.list&&f.list.length>0){var d=f.list.find(function(v){return v.definition&&v.definition===f.defaultDefinition});d||(f.defaultDefinition=f.list[0].definition,d=f.list[0]),e.config.url=d.url,e.curDefinition=d}return e._bindEvents(),e._registerPresets(),e._registerPlugins(),Ne.onPluginsReady(P(e)),e.getInitDefinition(),e.setState(ve.READY),g.setTimeout(P(e),function(){e.emit(mn)},0),e.onReady&&e.onReady(),(e.config.videoInit||e.config.autoplay)&&(!e.hasStart||e.state<ve.ATTACHED)&&e.start(),e}return q(i,[{key:"_initDOM",value:function(){var e,r=this;if(this.root=this.config.id?document.getElementById(this.config.id):null,!this.root){var n=this.config.el;if(n&&n.nodeType===1)this.root=n;else return this.emit(Wt,new si("use",this.config.vid,{line:32,handle:"Constructor",msg:"container id can't be empty"})),console.error("this.confg.id or this.config.el can't be empty"),!1}var a=uu(this.root);if(a&&(he.logWarn("The is an Player instance already exists in this.root, destroy it and reinitialize"),a.destroy()),this.root.setAttribute(Ct,this.playerId),this.media.setAttribute(Ct,this.playerId),(e=kt)===null||e===void 0||e.add(this),Ne.init(this),this._initBaseDoms(),this.config.controls){var u=this.config.controls.root||null,l=Ne.register(this,nu,{root:u});this.controls=l}var c=this.config.isMobileSimulateMode==="mobile"?"mobile":ue.device;if(this.addClass("".concat(H.DEFAULT," ").concat(H.INACTIVE," xgplayer-").concat(c," ").concat(this.config.controls?"":H.NO_CONTROLS)),this.config.autoplay?this.addClass(H.ENTER):this.addClass(H.NO_START),this.config.fluid){var f=this.config,h=f.width,d=f.height;(typeof h!="number"||typeof d!="number")&&(h=600,d=337.5);var v={width:"100%",height:"0","max-width":"100%","padding-top":"".concat(d*100/h,"%")};Object.keys(v).forEach(function(w){r.root.style[w]=v[w]})}else["width","height"].forEach(function(w){r.config[w]&&(typeof r.config[w]!="number"?r.root.style[w]=r.config[w]:r.root.style[w]="".concat(r.config[w],"px"))});var y=this.root.getBoundingClientRect(),p=y.width,b=y.height,k=y.left,E=y.top;return this.sizeInfo.width=p,this.sizeInfo.height=b,this.sizeInfo.left=k,this.sizeInfo.top=E,!0}},{key:"_initBaseDoms",value:function(){this.topBar=null,this.leftBar=null,this.rightBar=null,this.config.marginControls&&(this.innerContainer=g.createDom("xg-video-container","",{"data-index":-1},"xg-video-container"),this.root.appendChild(this.innerContainer))}},{key:"_bindEvents",value:function(){var e=this;["focus","blur"].forEach(function(r){e.on(r,e["on"+r.charAt(0).toUpperCase()+r.slice(1)])}),jn.forEach(function(r){document&&document.addEventListener(r,e.onFullscreenChange)}),ue.os.isIos&&(this.media.addEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.addEventListener("webkitendfullscreen",this._onWebkitendfullscreen)),this.once(bt,this.resize),this.playFunc=function(){e.config.closeFocusVideoFocus||e.media.focus()},this.once(Qe,this.playFunc)}},{key:"_unbindEvents",value:function(){var e=this;this.root.removeEventListener("mousemove",this.mousemoveFunc),jn.forEach(function(r){document.removeEventListener(r,e.onFullscreenChange)}),this.playFunc&&this.off(Qe,this.playFunc),this.off(gt,this.canPlayFunc),this.media.removeEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.removeEventListener("webkitendfullscreen",this._onWebkitendfullscreen)}},{key:"_clearUserTimer",value:function(){this.userTimer&&(g.clearTimeout(this,this.userTimer),this.userTimer=null)}},{key:"_startInit",value:function(e){var r=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.media&&!((!e||e===""||g.typeOf(e)==="Array"&&e.length===0)&&(e="",this.emit(es),he.logWarn("config.url is null, please get url and run player._startInit(url)"),this.config.nullUrlStart))){g.isNotNull(n.playSessionId)&&(this._playSessionId=n.playSessionId),this.handleSource&&(this._detachSourceEvents(this.media),g.typeOf(e)==="Array"&&e.length>0?this._attachSourceEvents(this.media,e):!this.media.src||this.media.src!==e?this.media.src=e:e||this.media.removeAttribute("src")),g.typeOf(this.config.volume)==="Number"&&(this.volume=this.config.volume);var a=this.innerContainer?this.innerContainer:this.root;this.media instanceof window.Element&&!a.contains(this.media)&&a.insertBefore(this.media,a.firstChild);var u=this.media.readyState;he.logInfo("_startInit readyState",u),this.config.autoplay&&(!g.isMSE(this.media)&&this.load(),(ue.os.isIpad||ue.os.isPhone)&&this.mediaPlay());var l=this.config.startTime;this.__startTime=l>0?l:-1,this.config.startTime=0,u>=2&&this.duration>0?this.canPlayFunc():this.on(gt,this.canPlayFunc),(!this.hasStart||this.state<ve.ATTACHED)&&Ne.afterInit(this),this.hasStart=!0,this.setState(ve.ATTACHED),g.setTimeout(this,function(){r.emit(nr)},0)}}},{key:"_registerPlugins",value:function(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._loadingPlugins=[];var n=this.config.ignores||[],a=this.config.plugins||[],u=this.config.i18n||[];r&&ri.extend(u,this.__i18n);var l=n.join("||").toLowerCase().split("||"),c=this.plugins;a.forEach(function(f){try{var h=f.plugin?f.plugin.pluginName:f.pluginName;if(h&&l.indexOf(h.toLowerCase())>-1)return null;if(!r&&c[h.toLowerCase()])return;if(f.lazy&&f.loader){var d=Ne.lazyRegister(e,f);f.forceBeforeInit&&(d.then(function(){e._loadingPlugins.splice(e._loadingPlugins.indexOf(d),1)}).catch(function(v){he.logError("_registerPlugins:loadingPlugin",v),e._loadingPlugins.splice(e._loadingPlugins.indexOf(d),1)}),e._loadingPlugins.push(d));return}return e.registerPlugin(f)}catch(v){he.logError("_registerPlugins:",v)}})}},{key:"_registerPresets",value:function(){var e=this;this.config.presets.forEach(function(r){ru(e,r)})}},{key:"_getRootByPosition",value:function(e){var r=null;switch(e){case Ee.ROOT_RIGHT:this.rightBar||(this.rightBar=g.createPositionBar("xg-right-bar",this.root)),r=this.rightBar;break;case Ee.ROOT_LEFT:this.leftBar||(this.leftBar=g.createPositionBar("xg-left-bar",this.root)),r=this.leftBar;break;case Ee.ROOT_TOP:this.topBar||(this.topBar=g.createPositionBar("xg-top-bar",this.root),this.config.topBarAutoHide&&g.addClass(this.topBar,H.TOP_BAR_AUTOHIDE)),r=this.topBar;break;default:r=this.innerContainer||this.root;break}return r}},{key:"registerPlugin",value:function(e,r){var n=Ne.formatPluginInfo(e,r),a=n.PLUFGIN,u=n.options,l=this.config.plugins,c=Ne.checkPluginIfExits(a.pluginName,l);!c&&l.push(a);var f=Ne.getRootByConfig(a.pluginName,this.config);f.root&&(u.root=f.root),f.position&&(u.position=f.position);var h=u.position?u.position:u.config&&u.config.position||a.defaultConfig&&a.defaultConfig.position;if(!u.root&&typeof h=="string"&&h.indexOf("controls")>-1){var d;return(d=this.controls)===null||d===void 0?void 0:d.registerPlugin(a,u,a.pluginName)}return u.root||(u.root=this._getRootByPosition(h)),Ne.register(this,a,u)}},{key:"deregister",value:function(e){typeof e=="string"?Ne.unRegister(this,e):e instanceof tt&&Ne.unRegister(this,e.pluginName)}},{key:"unRegisterPlugin",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this.deregister(e),r&&this.removePluginFromConfig(e)}},{key:"removePluginFromConfig",value:function(e){var r;if(typeof e=="string"?r=e:e instanceof tt&&(r=e.pluginName),!!r)for(var n=this.config.plugins.length-1;n>-1;n--){var a=this.config.plugins[n];if(a.pluginName.toLowerCase()===r.toLowerCase()){this.config.plugins.splice(n,1);break}}}},{key:"plugins",get:function(){return Ne.getPlugins(this)}},{key:"getPlugin",value:function(e){var r=Ne.findPlugin(this,e);return r&&r.pluginName?r:null}},{key:"addClass",value:function(e){this.root&&(g.hasClass(this.root,e)||g.addClass(this.root,e))}},{key:"removeClass",value:function(e){this.root&&g.removeClass(this.root,e)}},{key:"hasClass",value:function(e){if(this.root)return g.hasClass(this.root,e)}},{key:"setAttribute",value:function(e,r){this.root&&this.root.setAttribute(e,r)}},{key:"removeAttribute",value:function(e,r){this.root&&this.root.removeAttribute(e,r)}},{key:"start",value:function(e){var r=this;if(!(this.state>ve.ATTACHING)){var n=this._playSessionId;return g.isNotNull(n)&&(this._playSessionId=void 0),!e&&!this.config.url&&this.getInitDefinition(),this.hasStart=!0,this.setState(ve.ATTACHING),this._registerPlugins(!1),Ne.beforeInit(this).then(function(){if(r.config){e||(e=r.url||r.config.url);var a=r.preProcessUrl(e),u=r._startInit(a.url,{playSessionId:n});return u}}).catch(function(a){throw a.fileName="player",a.lineNumber="236",he.logError("start:beforeInit:",a),a})}}},{key:"switchURL",value:function(e,r){var n=this,a=e;g.typeOf(e)==="Object"&&(a=e.url),a=this.preProcessUrl(a).url;var u=this.currentTime;this.__startTime=u;var l=this.paused&&!this.isError;return this.src=a,new Promise(function(c,f){var h=function(y){n.off("timeupdate",d),n.off("canplay",d),f(y)},d=function(){n._seekToStartTime(),l&&n.pause(),n.off("error",h),c(!0)};if(n.once("error",h),!a){n.errorHandler("error",{code:6,message:"empty_src"});return}ue.os.isAndroid?n.once("timeupdate",d):n.once("canplay",d),n.play()})}},{key:"videoPlay",value:function(){this.mediaPlay()}},{key:"mediaPlay",value:function(){var e=this;if(!this.hasStart&&this.state<ve.ATTACHED){this.removeClass(H.NO_START),this.addClass(H.ENTER),this.start(),this._useAutoplay=!0;return}this.state<ve.RUNNING&&(this.removeClass(H.NO_START),!this.isCanplay&&this.addClass(H.ENTER));var r=se(re(i.prototype),"play",this).call(this);return r!==void 0&&r&&r.then?r.then(function(){e.removeClass(H.NOT_ALLOW_AUTOPLAY),e.addClass(H.PLAYING),e.state<ve.RUNNING&&(he.logInfo(">>>>playPromise.then"),e.setState(ve.RUNNING),e.emit(Bt))}).catch(function(n){if(he.logWarn(">>>>playPromise.catch",n.name),e.media&&e.media.error){e.onError(),e.removeClass(H.ENTER);return}n.name==="NotAllowedError"&&(e._errorTimer=g.setTimeout(e,function(){e._errorTimer=null,e.emit(yn),e.addClass(H.NOT_ALLOW_AUTOPLAY),e.removeClass(H.ENTER),e.pause(),e.setState(ve.NOTALLOW)},0))}):(he.logWarn("video.play not return promise"),this.state<ve.RUNNING&&(this.setState(ve.RUNNING),this.removeClass(H.NOT_ALLOW_AUTOPLAY),this.removeClass(H.NO_START),this.removeClass(H.ENTER),this.addClass(H.PLAYING),this.emit(Bt))),r}},{key:"mediaPause",value:function(){se(re(i.prototype),"pause",this).call(this)}},{key:"videoPause",value:function(){se(re(i.prototype),"pause",this).call(this)}},{key:"play",value:function(){var e=this;return this.removeClass(H.PAUSED),ft(this,"play",function(){return e.mediaPlay()})}},{key:"pause",value:function(){var e=this;ft(this,"pause",function(){se(re(i.prototype),"pause",e).call(e)})}},{key:"seek",value:function(e,r){var n=this;if(!(!this.media||Number.isNaN(Number(e))||!this.hasStart)){var a=this.config,u=a.isSeekedPlay,l=a.seekedStatus,c=r||(u?"play":l);e=e<0?0:e>this.duration?parseInt(this.duration,10):e,!this._isPauseBeforeSeek&&(this._isPauseBeforeSeek=this.paused?2:1),this._onceSeekCanplay&&this.off(mt,this._onceSeekCanplay),this._onceSeekCanplay=function(){switch(n.removeClass(H.ENTER),n.isSeeking=!1,c){case"play":n.play();break;case"pause":n.pause();break;default:n._isPauseBeforeSeek>1||n.paused?n.pause():n.play()}n._isPauseBeforeSeek=0,n._onceSeekCanplay=null},this.once(mt,this._onceSeekCanplay),this.state<ve.RUNNING?(this.removeClass(H.NO_START),this.currentTime=e,this.play()):this.currentTime=e}}},{key:"getInitDefinition",value:function(){var e=this,r=this.config,n=r.definition,a=r.url;!a&&n&&n.list&&n.list.length>0&&n.defaultDefinition&&n.list.map(function(u){u.definition===n.defaultDefinition&&(e.config.url=u.url,e.curDefinition=u)})}},{key:"changeDefinition",value:function(e,r){var n=this,a=this.config.definition;if(Array.isArray(a==null?void 0:a.list)&&a.list.forEach(function(l){(e==null?void 0:e.definition)===l.definition&&(n.curDefinition=l)}),e!=null&&e.bitrate&&typeof e.bitrate!="number"&&(e.bitrate=parseInt(e.bitrate,10)||0),this.emit(_n,{from:r,to:e}),!this.hasStart){this.config.url=e.url;return}var u=this.switchURL(e.url,Ae({seamless:a.seamless!==!1&&typeof MediaSource<"u"&&typeof MediaSource.isTypeSupported=="function"},e));u&&u.then?u.then(function(){n.emit($r,{from:r,to:e})}):this.emit($r,{from:r,to:e})}},{key:"reload",value:function(){this.load(),this.reloadFunc=function(){this.play()},this.once(bt,this.reloadFunc)}},{key:"resetState",value:function(){var e=this,r=H.NOT_ALLOW_AUTOPLAY,n=H.PLAYING,a=H.NO_START,u=H.PAUSED,l=H.REPLAY,c=H.ENTER,f=H.ENDED,h=H.ERROR,d=H.LOADING,v=[r,n,a,u,l,c,f,h,d];this.hasStart=!1,this.isError=!1,this._useAutoplay=!1,this.mediaPause(),this._accPlayed.acc=0,this._accPlayed.t=0,this._accPlayed.loopAcc=0,v.forEach(function(y){e.removeClass(y)}),this.addClass(H.NO_START),this.emit(ar)}},{key:"reset",value:function(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;this.resetState();var a=this.plugins;if(a&&(r.map(function(l){e.deregister(l)}),n)){var u=Jn();Object.keys(this.config).forEach(function(l){e.config[l]!=="undefined"&&(l==="plugins"||l==="presets"||l==="el"||l==="id")&&(e.config[l]=u[l])})}}},{key:"destroy",value:function(){var e,r=this,n=this.innerContainer,a=this.root,u=this.media;if(!(!a||!u)){if(this.hasStart=!1,this._useAutoplay=!1,a.removeAttribute(Ct),u.removeAttribute(Ct),this.updateAcc("destroy"),this._unbindEvents(),this._detachSourceEvents(this.media),g.clearAllTimers(this),this.emit(Ei),(e=kt)===null||e===void 0||e.remove(this),Ne.destroy(this),gs(this),se(re(i.prototype),"destroy",this).call(this),this.fullscreen&&this._fullscreenEl===this.root&&this.exitFullscreen(),n)for(var l=n.children,c=0;c<l.length;c++)n.removeChild(l[c]);!n&&u instanceof window.Node&&a.contains(u)&&!this.config.remainMediaAfterDestroy&&a.removeChild(u),["topBar","leftBar","rightBar","innerContainer"].map(function(h){r[h]&&a.removeChild(r[h]),r[h]=null});var f=a.className.split(" ");f.length>0?a.className=f.filter(function(h){return h.indexOf("xgplayer")<0}).join(" "):a.className="",this.removeAttribute("data-xgfill"),["isSeeking","isCanplay","isActive","cssfullscreen","fullscreen"].forEach(function(h){r[h]=!1})}}},{key:"replay",value:function(){var e=this;this.removeClass(H.ENDED),this.currentTime=0,this.isSeeking=!1,ft(this,"replay",function(){e.once(mt,function(){var r=e.mediaPlay();r&&r.catch&&r.catch(function(n){console.log(n)})}),e.emit(ji),e.onPlay()})}},{key:"retry",value:function(){var e=this;this.removeClass(H.ERROR),this.addClass(H.LOADING),ft(this,"retry",function(){var r=e.currentTime,n=e.config.url,a=g.isMSE(e.media)?{url:n}:e.preProcessUrl(n);e.src=a.url,!e.config.isLive&&(e.currentTime=r),e.once(gt,function(){e.mediaPlay()})})}},{key:"changeFullStyle",value:function(e,r,n,a){e&&(a||(a=H.PARENT_FULLSCREEN),this._orgCss||(this._orgCss=g.filterStyleFromText(e)),g.addClass(e,n),r&&r!==e&&!this._orgPCss&&(this._orgPCss=g.filterStyleFromText(r),g.addClass(r,a),r.setAttribute(Ct,this.playerId)))}},{key:"recoverFullStyle",value:function(e,r,n,a){a||(a=H.PARENT_FULLSCREEN),this._orgCss&&(g.setStyleFromCsstext(e,this._orgCss),this._orgCss=""),g.removeClass(e,n),r&&r!==e&&this._orgPCss&&(g.setStyleFromCsstext(r,this._orgPCss),this._orgPCss="",g.removeClass(r,a),r.removeAttribute(Ct))}},{key:"getFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget,r=this.root,n=this.media;(e==="video"||e==="media")&&(e=this[e]),e||(e=r),this._fullScreenOffset={top:g.scrollTop(),left:g.scrollLeft()},this._fullscreenEl=e,this._fullActionFrom="get";var a=g.getFullScreenEl();if(a===this._fullscreenEl)return this.onFullscreenChange(),Promise.resolve();try{for(var u=0;u<zn.length;u++){var l=zn[u];if(e[l]){var c=l==="webkitRequestFullscreen"?e.webkitRequestFullscreen(window.Element.ALLOW_KEYBOARD_INPUT):e[l]();return c&&c.then?c:Promise.resolve()}}return n.fullscreenEnabled||n.webkitSupportsFullscreen?(n.webkitEnterFullscreen(),Promise.resolve()):Promise.reject(new Error("call getFullscreen fail"))}catch{return Promise.reject(new Error("call getFullscreen fail"))}}},{key:"exitFullscreen",value:function(e){if(this.isRotateFullscreen&&this.exitRotateFullscreen(),!(!this._fullscreenEl&&!g.getFullScreenEl())){this.root;var r=this.media;this._fullActionFrom="exit";try{for(var n=0;n<Wn.length;n++){var a=Wn[n];if(document[a]){var u=document[a]();return u&&u.then?u:Promise.resolve()}}return r&&r.webkitSupportsFullscreen?(r.webkitExitFullScreen(),Promise.resolve()):Promise.reject(new Error("call exitFullscreen fail"))}catch{return Promise.reject(new Error("call exitFullscreen fail"))}}}},{key:"getCssFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget;this.isRotateFullscreen?this.exitRotateFullscreen():this.fullscreen&&this.exitFullscreen();var r=e?"".concat(H.INNER_FULLSCREEN," ").concat(H.CSS_FULLSCREEN):H.CSS_FULLSCREEN;this.changeFullStyle(this.root,e,r);var n=this.config.fullscreen,a=n===void 0?{}:n,u=a.useCssFullscreen===!0||typeof a.useCssFullscreen=="function"&&a.useCssFullscreen();u&&(this.fullscreen=!0,this.emit(pt,!0)),this._cssfullscreenEl=e,this.cssfullscreen=!0,this.emit(zi,!0)}},{key:"exitCssFullscreen",value:function(){var e=this._cssfullscreenEl?"".concat(H.INNER_FULLSCREEN," ").concat(H.CSS_FULLSCREEN):H.CSS_FULLSCREEN;if(!this.fullscreen)this.recoverFullStyle(this.root,this._cssfullscreenEl,e);else{var r=this.config.fullscreen,n=r===void 0?{}:r,a=n.useCssFullscreen===!0||typeof n.useCssFullscreen=="function"&&n.useCssFullscreen();a?(this.recoverFullStyle(this.root,this._cssfullscreenEl,e),this.fullscreen=!1,this.emit(pt,!1)):this.removeClass(e)}this._cssfullscreenEl=null,this.cssfullscreen=!1,this.emit(zi,!1)}},{key:"getRotateFullscreen",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.fullscreenTarget;this.cssfullscreen&&this.exitCssFullscreen(e);var r=e?"".concat(H.INNER_FULLSCREEN," ").concat(H.ROTATE_FULLSCREEN):H.ROTATE_FULLSCREEN;this._fullscreenEl=e||this.root,this.changeFullStyle(this.root,e,r,H.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!0,this.fullscreen=!0,this.setRotateDeg(90),this._rootStyle=this.root.getAttribute("style");var n=Math.abs(window.orientation)===90||Math.abs(screen.orientation.angle)===90;this.root.style.width=n?"".concat(window.innerWidth,"px"):"".concat(window.innerHeight,"px"),this.emit(pt,!0)}},{key:"exitRotateFullscreen",value:function(e){var r=this._fullscreenEl!==this.root?"".concat(H.INNER_FULLSCREEN," ").concat(H.ROTATE_FULLSCREEN):H.ROTATE_FULLSCREEN;this.recoverFullStyle(this.root,this._fullscreenEl,r,H.PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!1,this.fullscreen=!1,this.setRotateDeg(0),this.emit(pt,!1),this._rootStyle&&(this.root.style.style=this._rootStyle,this._rootStyle=!1)}},{key:"setRotateDeg",value:function(e){window.orientation===90||window.orientation===-90?this.rotateDeg=0:this.rotateDeg=e}},{key:"focus",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{autoHide:!this.config.closeDelayBlur,delay:this.config.inactive};if(this.isActive){this.onFocus(e);return}this.emit(gn,Ae({paused:this.paused,ended:this.ended},e))}},{key:"blur",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{ignorePaused:!1};if(!this.isActive){this.onBlur(e);return}this._clearUserTimer(),this.emit(Ja,Ae({paused:this.paused,ended:this.ended},e))}},{key:"onFocus",value:function(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{autoHide:!0,delay:3e3},n=this.innerStates;if(this.isActive=!0,this.removeClass(H.INACTIVE),this._clearUserTimer(),r.isLock!==void 0&&(n.isActiveLocked=r.isLock),r.autoHide===!1||r.isLock===!0||n.isActiveLocked){this._clearUserTimer();return}var a=r&&r.delay?r.delay:this.config.inactive;this.userTimer=g.setTimeout(this,function(){e.userTimer=null,e.blur()},a)}},{key:"onBlur",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.ignorePaused,n=r===void 0?!1:r;if(!this.innerStates.isActiveLocked){var a=this.config.closePauseVideoFocus;this.isActive=!1,(n||a||!this.paused&&!this.ended)&&this.addClass(H.INACTIVE)}}},{key:"onEmptied",value:function(){this.updateAcc("emptied")}},{key:"onCanplay",value:function(){this.removeClass(H.ENTER),this.removeClass(H.ERROR),this.removeClass(H.LOADING),this.isCanplay=!0,this.waitTimer&&g.clearTimeout(this,this.waitTimer)}},{key:"onLoadeddata",value:function(){var e=this;this.isError=!1,this.isSeeking=!1,this.__startTime>0&&(this.duration>0?this._seekToStartTime():this.once(Et,function(){e._seekToStartTime()}))}},{key:"onLoadstart",value:function(){this.removeClass(H.ERROR),this.isCanplay=!1}},{key:"onPlay",value:function(){this.state===ve.ENDED&&this.setState(ve.RUNNING),this.removeClass(H.PAUSED),this.ended&&this.removeClass(H.ENDED),!this.config.closePlayVideoFocus&&this.focus()}},{key:"onPause",value:function(){this.addClass(H.PAUSED),this.updateAcc("pause"),this.config.closePauseVideoFocus||(this._clearUserTimer(),this.focus())}},{key:"onEnded",value:function(){this.updateAcc("ended"),this.addClass(H.ENDED),this.setState(ve.ENDED)}},{key:"onError",value:function(){this.isError=!0,this.updateAcc("error"),this.removeClass(H.NOT_ALLOW_AUTOPLAY),this.removeClass(H.NO_START),this.removeClass(H.ENTER),this.removeClass(H.LOADING),this.addClass(H.ERROR)}},{key:"onSeeking",value:function(){this.isSeeking||this.updateAcc("seeking"),this.isSeeking=!0,this.addClass(H.SEEKING)}},{key:"onSeeked",value:function(){this.isSeeking=!1,this.waitTimer&&g.clearTimeout(this,this.waitTimer),this.removeClass(H.LOADING),this.removeClass(H.SEEKING)}},{key:"onWaiting",value:function(){var e=this;this.waitTimer&&g.clearTimeout(this,this.waitTimer),this.updateAcc("waiting"),this.waitTimer=g.setTimeout(this,function(){e.addClass(H.LOADING),e.emit(rs),g.clearTimeout(e,e.waitTimer),e.waitTimer=null},this.config.minWaitDelay)}},{key:"onPlaying",value:function(){var e=this;this.isError=!1;var r=H.NO_START,n=H.PAUSED,a=H.ENDED,u=H.ERROR,l=H.REPLAY,c=H.LOADING,f=[r,n,a,u,l,c];f.forEach(function(h){e.removeClass(h)}),!this._accPlayed.t&&!this.paused&&!this.ended&&(this._accPlayed.t=new Date().getTime())}},{key:"onTimeupdate",value:function(){!this._videoHeight&&this.media.videoHeight&&this.resize(),(this.waitTimer||this.hasClass(H.LOADING))&&this.media.readyState>2&&(this.removeClass(H.LOADING),g.clearTimeout(this,this.waitTimer),this.waitTimer=null),!this.paused&&this.state===ve.NOTALLOW&&this.duration&&(this.setState(ve.RUNNING),this.emit(Bt)),!this._accPlayed.t&&!this.paused&&!this.ended&&(this._accPlayed.t=new Date().getTime())}},{key:"onVolumechange",value:function(){g.typeOf(this.config.volume)==="Number"&&(this.config.volume=this.volume)}},{key:"onRatechange",value:function(){this.config.defaultPlaybackRate=this.playbackRate}},{key:"emitUserAction",value:function(e,r,n){if(!(!this.media||!r||!e)){var a=g.typeOf(e)==="String"?e:e.type||"";n.props&&g.typeOf(n.props)!=="Array"&&(n.props=[n.props]),this.emit(Ki,Ae({eventType:a,action:r,currentTime:this.currentTime,duration:this.duration,ended:this.ended,event:e},n))}}},{key:"updateAcc",value:function(e){if(this._accPlayed.t){var r=new Date().getTime()-this._accPlayed.t;this._accPlayed.acc+=r,this._accPlayed.t=0,(e==="ended"||this.ended)&&(this._accPlayed.loopAcc=this._accPlayed.acc)}}},{key:"checkBuffer",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{startDiff:0,endDiff:0},n=r||{},a=n.startDiff,u=a===void 0?0:a,l=n.endDiff,c=l===void 0?0:l,f=this.media.buffered;if(!f||f.length===0||!this.duration)return!0;for(var h=e||this.media.currentTime||.2,d=f.length,v=0;v<d;v++)if(f.start(v)+u<=h&&f.end(v)-c>h)return!0;return!1}},{key:"resizePosition",value:function(){var e=this,r=this.videoPos,n=r.vy,a=r.vx,u=r.h,l=r.w,c=this.videoPos.rotate;if(!(c<0&&u<0&&l<0)){var f=this.videoPos._pi;if(!f&&this.media.videoHeight&&(f=this.media.videoWidth/this.media.videoHeight*100),!!f){this.videoPos.pi=f,c=c<0?0:c;var h={rotate:c},d=0,v=0,y=1,p=Math.abs(c/90),b=this.root,k=this.innerContainer,E=b.offsetWidth,w=k?k.offsetHeight:b.offsetHeight,T={},L=w,O=E;if(p%2===0)y=u>0?100/u:l>0?100/l:1,h.scale=y,d=n>0?(100-u)/2-n:0,h.y=p===2?0-d:d,v=a>0?(100-l)/2-a:0,h.x=p===2?0-v:v,T.width="".concat(O,"px"),T.height="".concat(L,"px"),T.maxWidth="",T.maxHeight="";else if(p%2===1){O=w,L=E;var B=w-E;v=-B/2/O*100,h.x=p===3?v+n/2:v-n/2,d=B/2/L*100,h.y=p===3?d+a/2:d-a/2,h.scale=y,T.width="".concat(O,"px"),T.maxWidth="".concat(O,"px"),T.height="".concat(L,"px"),T.maxHeight="".concat(L,"px")}var x=g.getTransformStyle(h,this.media.style.transform||this.media.style.webkitTransform);T.transform=x,T.webkitTransform=x,Object.keys(T).map(function(U){e.media.style[U]=T[U]})}}}},{key:"position",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{h:0,y:0,x:0,w:0};if(!(!this.media||!e||!e.h)){var r=this.videoPos;r.h=e.h*100||0,r.w=e.w*100||0,r.vx=e.x*100||0,r.vy=e.y*100||0,this.resizePosition()}}},{key:"setConfig",value:function(e){var r=this;e&&Object.keys(e).map(function(n){if(n!=="plugins"){r.config[n]=e[n];var a=r.plugins[n.toLowerCase()];a&&g.typeOf(a.setConfig)==="Function"&&a.setConfig(e[n])}})}},{key:"playNext",value:function(e){var r=this;this.resetState(),this.setConfig(e),this._currentTime=0,this._duration=0,ft(this,"playnext",function(){r.start(),r.emit($i,e)})}},{key:"resize",value:function(){var e=this;if(!(!this.media||!this.root)){var r=this.root.getBoundingClientRect();this.sizeInfo.width=r.width,this.sizeInfo.height=r.height,this.sizeInfo.left=r.left,this.sizeInfo.top=r.top;var n=this.media,a=n.videoWidth,u=n.videoHeight,l=this.config,c=l.fitVideoSize,f=l.videoFillMode;if((f==="fill"||f==="cover"||f==="contain")&&this.setAttribute("data-xgfill",f),!(!u||!a)){this._videoHeight=u,this._videoWidth=a;var h=this.controls&&this.innerContainer?this.controls.root.getBoundingClientRect().height:0,d=r.width,v=r.height-h,y=parseInt(a/u*1e3,10),p=parseInt(d/v*1e3,10),b=d,k=v,E={};c==="auto"&&p>y||c==="fixWidth"?(k=d/y*1e3,this.config.fluid?E.paddingTop="".concat(k*100/b,"%"):E.height="".concat(k+h,"px")):(c==="auto"&&p<y||c==="fixHeight")&&(b=y*v/1e3,E.width="".concat(b,"px")),!this.fullscreen&&!this.cssfullscreen&&Object.keys(E).forEach(function(T){e.root.style[T]=E[T]}),(f==="fillHeight"&&p<y||f==="fillWidth"&&p>y)&&this.setAttribute("data-xgfill","cover");var w={videoScale:y,vWidth:b,vHeight:k,cWidth:b,cHeight:k+h};this.resizePosition(),this.emit(Dt,w)}}}},{key:"updateObjectPosition",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(this.media.updateObjectPosition){this.media.updateObjectPosition(e,r);return}this.media.style.objectPosition="".concat(e*100,"% ").concat(r*100,"%")}},{key:"setState",value:function(e){he.logInfo("setState","state from:".concat(ea[this.state]," to:").concat(ea[e])),this._state=e}},{key:"preProcessUrl",value:function(e,r){var n=this.config,a=n.preProcessUrl,u=n.preProcessUrlOptions,l=Object.assign({},u,r);return!g.isBlob(e)&&typeof a=="function"?a(e,l):{url:e}}},{key:"_seekToStartTime",value:function(){this.__startTime>0&&this.duration>0&&(this.currentTime=this.__startTime>this.duration?this.duration:this.__startTime,this.__startTime=-1)}},{key:"state",get:function(){return this._state}},{key:"isFullscreen",get:function(){return this.fullscreen}},{key:"isCssfullScreen",get:function(){return this.cssfullscreen}},{key:"hasStart",get:function(){return this._hasStart},set:function(e){typeof e=="boolean"&&(this._hasStart=e,e===!1&&this.setState(ve.READY),this.emit("hasstart"))}},{key:"isPlaying",get:function(){return this._state===ve.RUNNING||this._state===ve.ENDED},set:function(e){e?this.setState(ve.RUNNING):this._state>=ve.RUNNING&&this.setState(ve.ATTACHED)}},{key:"definitionList",get:function(){return!this.config||!this.config.definition?[]:this.config.definition.list||[]},set:function(e){var r=this,n=this.config.definition,a=null,u=null;n.list=e,this.emit("resourceReady",e),e.forEach(function(l){var c;((c=r.curDefinition)===null||c===void 0?void 0:c.definition)===l.definition&&(a=l),n.defaultDefinition===l.definition&&(u=l)}),!u&&e.length>0&&(u=e[0]),a?this.changeDefinition(a):u&&this.changeDefinition(u)}},{key:"videoFrameInfo",get:function(){var e={total:0,dropped:0,corrupted:0,droppedRate:0,droppedDuration:0};if(!this.media||!this.media.getVideoPlaybackQuality)return e;var r=this.media.getVideoPlaybackQuality();return e.dropped=r.droppedVideoFrames||0,e.total=r.totalVideoFrames||0,e.corrupted=r.corruptedVideoFrames||0,e.total>0&&(e.droppedRate=e.dropped/e.total*100,e.droppedDuration=parseInt(this.cumulateTime/e.total*e.dropped,0)),e}},{key:"lang",get:function(){return this.config.lang},set:function(e){var r=ri.langKeys.filter(function(n){return n===e});if(r.length===0&&e!=="zh"){console.error("Sorry, set lang fail, because the language [".concat(e,"] is not supported now, list of all supported languages is [").concat(ri.langKeys.join(),"] "));return}this.config.lang=e,Ne.setLang(e,this)}},{key:"i18n",get:function(){var e=this.config.lang;return e==="zh"&&(e="zh-cn"),this.__i18n.lang[e]||this.__i18n.lang.en}},{key:"i18nKeys",get:function(){return this.__i18n.textKeys||{}}},{key:"version",get:function(){return zr}},{key:"playerId",get:function(){return this._pluginInfoId}},{key:"url",get:function(){return this.__url||this.config.url},set:function(e){this.__url=e}},{key:"poster",get:function(){return this.plugins.poster?this.plugins.poster.config.poster:this.config.poster},set:function(e){this.plugins.poster&&this.plugins.poster.update(e)}},{key:"readyState",get:function(){return se(re(i.prototype),"readyState",this)}},{key:"error",get:function(){var e=se(re(i.prototype),"error",this);return this.i18n[e]||e}},{key:"networkState",get:function(){return se(re(i.prototype),"networkState",this)}},{key:"fullscreenChanging",get:function(){return this._fullScreenOffset!==null}},{key:"cumulateTime",get:function(){var e=this._accPlayed,r=e.acc,n=e.t;return n?new Date().getTime()-n+r:r}},{key:"zoom",get:function(){return this.config.zoom},set:function(e){this.config.zoom=e}},{key:"videoRotateDeg",get:function(){return this.videoPos.rotate},set:function(e){e=g.convertDeg(e),!(e%90!==0||e===this.videoPos.rotate)&&(this.videoPos.rotate=e,this.resizePosition())}},{key:"avgSpeed",get:function(){return ia},set:function(e){ia=e}},{key:"realTimeSpeed",get:function(){return ta},set:function(e){ta=e}},{key:"offsetCurrentTime",get:function(){return this._offsetInfo.currentTime||0},set:function(e){this._offsetInfo.currentTime=e}},{key:"offsetDuration",get:function(){return this._offsetInfo.duration||0},set:function(e){this._offsetInfo.duration=e||0}},{key:"hook",value:function(e,r){return Yi.call.apply(Yi,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,r){return Xi.call.apply(Xi,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(e,r){return qi.call.apply(qi,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"usePluginHooks",value:function(e,r,n){for(var a=arguments.length,u=new Array(a>3?a-3:0),l=3;l<a;l++)u[l-3]=arguments[l];return $n.call.apply($n,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removePluginHooks",value:function(e,r,n){for(var a=arguments.length,u=new Array(a>3?a-3:0),l=3;l<a;l++)u[l-3]=arguments[l];return Kn.call.apply(Kn,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"setUserActive",value:function(e,r){var n;typeof r=="boolean"&&r!==this.muted&&(this.addInnerOP("volumechange"),g.typeOf(r)===Boolean&&(this.muted=r)),(n=kt)===null||n===void 0||n.setActive(this.playerId,e)}}],[{key:"debugger",get:function(){return he.config.debug},set:function(e){he.config.debug=e}},{key:"instManager",get:function(){return kt},set:function(e){kt=e}},{key:"getCurrentUserActivePlayerId",value:function(){var e;return(e=kt)===null||e===void 0?void 0:e.getActiveId()}},{key:"setCurrentUserActive",value:function(e,r){var n;(n=kt)===null||n===void 0||n.setActive(e,r)}},{key:"isHevcSupported",value:function(){return ue.isHevcSupported()}},{key:"probeConfigSupported",value:function(e){return ue.probeConfigSupported(e)}},{key:"install",value:function(e,r){i.plugins||(i.plugins={}),i.plugins[e]||(i.plugins[e]=r)}},{key:"use",value:function(e,r){i.plugins||(i.plugins={}),i.plugins[e]=r}}]),i})(zo);I(sr,"defaultPreset",null);I(sr,"XgVideoProxy",null);sr.instManager=ys.getInstance();function Pt(s,o,i){try{return' <div class="xg-tips '.concat(i?"hide":" ",'" lang-key="').concat(s.i18nKeys[o],`">
    `).concat(s.i18n[o],`
    </div>`)}catch{return'<div class="xg-tips hide"></div>'}}var Kt=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"_onMouseenter",function(a){t.emit("icon_mouseenter",{pluginName:t.pluginName})}),I(P(t),"_onMouseLeave",function(a){t.emit("icon_mouseleave",{pluginName:t.pluginName})}),t}return q(i,[{key:"afterCreate",value:function(){this.bind("mouseenter",this._onMouseenter),this.bind("mouseleave",this._onMouseLeave),this.config.disable&&this.disable()}},{key:"destroy",value:function(){this.unbind("mouseenter",this._onMouseenter),this.unbind("mouseleave",this._onMouseLeave)}}]),i})(pe);function cu(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">
  <path fill="#fff" transform="scale(1.3, 1.3)" class='path_full' d="M9,10v1a.9.9,0,0,1-1,1,.9.9,0,0,1-1-1V9A.9.9,0,0,1,8,8h2a.9.9,0,0,1,1,1,.9.9,0,0,1-1,1Zm6,4V13a1,1,0,0,1,2,0v2a.9.9,0,0,1-1,1H14a1,1,0,0,1,0-2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>
</svg>
`,"image/svg+xml").firstChild}function fu(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">
  <path fill="#fff" transform="scale(1.3, 1.3)" d="M9,10V9a.9.9,0,0,1,1-1,.9.9,0,0,1,1,1v2a.9.9,0,0,1-1,1H8a.9.9,0,0,1-1-1,.9.9,0,0,1,1-1Zm6,4v1a1,1,0,0,1-2,0V13a.9.9,0,0,1,1-1h2a1,1,0,0,1,0,2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>
</svg>
`,"image/svg+xml").firstChild}var Yr=(function(s){J(i,s);var o=ee(i);function i(){return X(this,i),o.apply(this,arguments)}return q(i,[{key:"beforeCreate",value:function(e){typeof e.player.config.cssFullscreen=="boolean"&&(e.config.disable=!e.player.config.cssFullscreen)}},{key:"afterCreate",value:function(){var e=this;se(re(i.prototype),"afterCreate",this).call(this),!this.config.disable&&(this.config.target&&(this.playerConfig.fullscreenTarget=this.config.target),this.initIcons(),this.on(zi,function(r){e.animate(r)}),this.btnClick=this.btnClick.bind(this),this.handleCssFullscreen=this.hook("cssFullscreen_change",this.btnClick,{pre:function(n){n.preventDefault(),n.stopPropagation()}}),this.bind(["click","touchend"],this.handleCssFullscreen))}},{key:"initIcons",value:function(){var e=this.icons,r=this.find(".xgplayer-icon");r.appendChild(e.cssFullscreen),r.appendChild(e.exitCssFullscreen)}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation();var r=this.player.isCssfullScreen;this.emitUserAction(e,"switch_cssfullscreen",{cssfullscreen:r}),r?this.player.exitCssFullscreen():this.player.getCssFullscreen()}},{key:"animate",value:function(e){this.root&&(e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.switchTips(e))}},{key:"switchTips",value:function(e){var r=this.i18nKeys,n=this.find(".xg-tips");n&&this.changeLangTextKey(n,e?r.EXITCSSFULLSCREEN_TIPS:r.CSSFULLSCREEN_TIPS)}},{key:"registerIcons",value:function(){return{cssFullscreen:{icon:cu,class:"xg-get-cssfull"},exitCssFullscreen:{icon:fu,class:"xg-exit-cssfull"}}}},{key:"destroy",value:function(){se(re(i.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class='xgplayer-cssfullscreen'>
    <div class="xgplayer-icon">
    </div>
    `.concat(Pt(this,"CSSFULLSCREEN_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"cssFullscreen"}},{key:"defaultConfig",get:function(){return{position:Ee.CONTROLS_RIGHT,index:1,disable:!1,target:null}}}]),i})(Kt);function hu(){return new DOMParser().parseFromString(`<svg width="32px" height="40px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <path d="M11.2374369,14 L17.6187184,7.61871843 C17.9604272,7.27700968 17.9604272,6.72299032 17.6187184,6.38128157 C17.2770097,6.03957281 16.7229903,6.03957281 16.3812816,6.38128157 L9.38128157,13.3812816 C9.03957281,13.7229903 9.03957281,14.2770097 9.38128157,14.6187184 L16.3812816,21.6187184 C16.7229903,21.9604272 17.2770097,21.9604272 17.6187184,21.6187184 C17.9604272,21.2770097 17.9604272,20.7229903 17.6187184,20.3812816 L11.2374369,14 L11.2374369,14 Z" fill="#FFFFFF"></path>
    </g>
</svg>`,"image/svg+xml").firstChild}var du=(function(s){J(i,s);var o=ee(i);function i(){return X(this,i),o.apply(this,arguments)}return q(i,[{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.onClick=function(r){r.preventDefault(),r.stopPropagation(),e.config.onClick(r)},this.bind(["click","touchend"],this.onClick)}},{key:"registerIcons",value:function(){return{screenBack:{icon:hu,class:"xg-fullscreen-back"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(this.root,e.screenBack)}},{key:"show",value:function(){g.addClass(this.root,"show")}},{key:"hide",value:function(){g.removeClass(this.root,"show")}},{key:"render",value:function(){return`<xg-icon class="xgplayer-back">
    </xg-icon>`}}],[{key:"pluginName",get:function(){return"topbackicon"}},{key:"defaultConfig",get:function(){return{position:Ee.ROOT_TOP,index:0}}}]),i})(pe);function vu(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598 214h212v212h-84v-128h-128v-84zM726 726v-128h84v212h-212v-84h128zM214 426v-212h212v84h-128v128h-84zM298 598v128h128v84h-212v-212h84z"></path>
</svg>
`,"image/svg+xml").firstChild}function pu(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M682 342h128v84h-212v-212h84v128zM598 810v-212h212v84h-128v128h-84zM342 342v-128h84v212h-212v-84h128zM214 682v-84h212v212h-84v-128h-128z"></path>
</svg>
`,"image/svg+xml").firstChild}var _s=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"_onOrientationChange",function(a){t.player.fullscreen&&t.config.rotateFullscreen&&(window.orientation===90||window.orientation===-90?t.player.setRotateDeg(0):t.player.setRotateDeg(90))}),t}return q(i,[{key:"afterCreate",value:function(){var e=this;se(re(i.prototype),"afterCreate",this).call(this);var r=this.config,n=this.playerConfig;if(!r.disable){r.target&&(this.playerConfig.fullscreenTarget=this.config.target);var a=g.getFullScreenEl();n.fullscreenTarget===a&&this.player.getFullscreen().catch(function(u){}),this.initIcons(),this.handleFullscreen=this.hook("fullscreenChange",this.toggleFullScreen,{pre:function(l){var c=e.player.fullscreen;e.emitUserAction(l,"switch_fullscreen",{prop:"fullscreen",from:c,to:!c})}}),this.bind(".xgplayer-fullscreen",["touchend","click"],this.handleFullscreen),this.on(pt,function(u){var l=e.find(".xg-tips");l&&e.changeLangTextKey(l,u?e.i18nKeys.EXITFULLSCREEN_TIPS:e.i18nKeys.FULLSCREEN_TIPS),e.animate(u)}),this.config.needBackIcon&&(this.topBackIcon=this.player.registerPlugin({plugin:du,options:{config:{onClick:function(l){e.handleFullscreen(l)}}}})),ue.device==="mobile"&&window.addEventListener("orientationchange",this._onOrientationChange)}}},{key:"registerIcons",value:function(){return{fullscreen:{icon:vu,class:"xg-get-fullscreen"},exitFullscreen:{icon:pu,class:"xg-exit-fullscreen"}}}},{key:"destroy",value:function(){se(re(i.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",ue.device==="mobile"?"touchend":"click",this.handleFullscreen),ue.device==="mobile"&&window.removeEventListener("orientationchange",this._onOrientationChange)}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.fullscreen),this.appendChild(".xgplayer-icon",e.exitFullscreen)}},{key:"toggleFullScreen",value:function(e){e instanceof Event&&(e.preventDefault(),e.stopPropagation());var r=this.player,n=this.config,a=n.useCssFullscreen===!0||typeof n.useCssFullscreen=="function"&&n.useCssFullscreen();a?(r.fullscreen?r.exitCssFullscreen():r.getCssFullscreen(),this.animate(r.fullscreen)):n.rotateFullscreen?(r.fullscreen?r.exitRotateFullscreen():r.getRotateFullscreen(),this.animate(r.fullscreen)):n.switchCallback&&typeof n.switchCallback=="function"?n.switchCallback(r.fullscreen):r.fullscreen?(r.exitFullscreen(),n.useScreenOrientation&&this.unlockScreen()):(r.getFullscreen().catch(function(u){}),n.useScreenOrientation&&r.aspectRatio>1&&this.lockScreen(n.lockOrientationType))}},{key:"animate",value:function(e){e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.topBackIcon&&(e?(this.topBackIcon.show(),this.hide()):(this.topBackIcon.hide(),this.show()))}},{key:"render",value:function(){if(!this.config.disable){var e="FULLSCREEN_TIPS";return`<xg-icon class="xgplayer-fullscreen">
    <div class="xgplayer-icon">
    </div>
    `.concat(Pt(this,e,this.playerConfig.isHideTips),`
    </xg-icon>`)}}},{key:"lockScreen",value:function(e){try{screen.orientation.lock(e).catch(function(r){})}catch{}}},{key:"unlockScreen",value:function(){try{screen.orientation.unlock().catch(function(e){})}catch{}}}],[{key:"pluginName",get:function(){return"fullscreen"}},{key:"defaultConfig",get:function(){return{position:Ee.CONTROLS_RIGHT,index:0,useCssFullscreen:!1,rotateFullscreen:!1,useScreenOrientation:!1,lockOrientationType:"landscape",switchCallback:null,target:null,disable:!1,needBackIcon:!1}}}]),i})(Kt);function Sn(){return new DOMParser().parseFromString(`<svg class="play" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M576,363L810,512L576,661zM342,214L576,363L576,661L342,810z"></path>
</svg>
`,"image/svg+xml").firstChild}function En(){return new DOMParser().parseFromString(`<svg class="pause" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">
  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598,214h170v596h-170v-596zM256 810v-596h170v596h-170z"></path>
</svg>
`,"image/svg+xml").firstChild}var bs=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"btnClick",function(a){a.preventDefault(),a.stopPropagation();var u=P(t),l=u.player;return t.emitUserAction(a,"switch_play_pause",{prop:"paused",from:l.paused,to:!l.paused}),l.ended?l.replay():l.paused?(l.play(),t.animate(!1)):(l.pause(),t.animate(!0)),!1}),t}return q(i,[{key:"afterCreate",value:function(){se(re(i.prototype),"afterCreate",this).call(this);var e=this.config;e.disable||(this.initIcons(),this.bind(["touchend","click"],this.btnClick),this.listenEvents(),this.animate(!0))}},{key:"listenEvents",value:function(){var e=this,r=this.player;this.on([Qe,ui,Wt,$t],function(){e.animate(r.paused)})}},{key:"registerIcons",value:function(){return{play:{icon:Sn,class:"xg-icon-play"},pause:{icon:En,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.play),this.appendChild(".xgplayer-icon",e.pause)}},{key:"animate",value:function(e){if(this.player){var r=this.i18nKeys,n=this.find(".xg-tips");e?(this.setAttr("data-state","pause"),n&&this.changeLangTextKey(n,r.PLAY_TIPS)):(this.setAttr("data-state","play"),n&&this.changeLangTextKey(n,r.PAUSE_TIPS))}}},{key:"destroy",value:function(){se(re(i.prototype),"destroy",this).call(this),this.unbind(["touchend","click"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-play">
    <div class="xgplayer-icon">
    </div>
    `.concat(Pt(this,"PLAY_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"play"}},{key:"defaultConfig",get:function(){return{position:Ee.CONTROLS_LEFT,index:0,disable:!1}}}]),i})(Kt),gu=[{tag:"xg-cache",className:"xgplayer-progress-cache",styleKey:"cachedColor"},{tag:"xg-played",className:"xgplayer-progress-played",styleKey:"playedColor"}],mu=(function(){function s(o){X(this,s),this.fragments=o.fragments||[],this.fragments.length===0&&this.fragments.push({percent:1}),this._callBack=o.actionCallback,this.fragConfig={fragFocusClass:o.fragFocusClass||"inner-focus-point",fragAutoFocus:!!o.fragAutoFocus,fragClass:o.fragClass||""},this.style=o.style||{playedColor:"",cachedColor:"",progressColor:""},this.duration=0,this.cachedIndex=0,this.playedIndex=0,this.focusIndex=-1}return q(s,[{key:"updateDuration",value:function(i){var t=this;this.duration=i;var e=0,r=this.fragments;this.fragments=r.map(function(n){return n.start=parseInt(e,10),n.end=parseInt(e+n.percent*t.duration,10),n.duration=parseInt(n.percent*t.duration,10),e+=n.percent*t.duration,n})}},{key:"updateProgress",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"played",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{newIndex:0,curIndex:0,millisecond:0},e=this.progressList,r=this.fragments;if(!(e.length<1)){var n=t.newIndex,a=t.curIndex,u=t.millisecond;n!==a&&e.map(function(f,h){h<n?f[i].style.width="100%":h>n&&(f[i].style.width=0)});var l=r[n],c=u===0?0:(u-l.start)/l.duration;e[n][i].style.width=c<0?0:"".concat(c*100,"%")}}},{key:"updateFocus",value:function(i){if(!(!this.fragConfig.fragAutoFocus||this.fragments.length<2)){if(!i){if(this.focusIndex>-1){this.unHightLight(this.focusIndex);var t={index:-1,preIndex:this.focusIndex,fragment:null};this._callBack&&this._callBack(t),this.focusIndex=-1}return}var e=this.findIndex(i.currentTime*1e3,this.focusIndex);if(e>=0&&e!==this.focusIndex){this.focusIndex>-1&&this.unHightLight(this.focusIndex),this.setHightLight(e);var r={index:e,preIndex:this.focusIndex,fragment:this.fragments[this.focusIndex]};this.focusIndex=e,this._callBack&&this._callBack(r)}}}},{key:"update",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cached:0,played:0},t=arguments.length>1?arguments[1]:void 0;if(!this.duration||parseInt(t*1e3,10)!==this.duration){if(!t&&t!==0)return;this.updateDuration(parseInt(t*1e3,10))}var e=this.playedIndex,r=this.cachedIndex;if(g.typeOf(i.played)!=="Undefined"){var n=this.findIndex(i.played*1e3,e);if(n<0)return;this.updateProgress("played",{newIndex:n,curIndex:e,millisecond:parseInt(i.played*1e3,10)}),this.playedIndex=n}if(g.typeOf(i.cached)!=="Undefined"){var a=this.findIndex(i.cached*1e3,r);if(a<0)return;this.updateProgress("cached",{newIndex:a,curIndex:r,millisecond:parseInt(i.cached*1e3,10)}),this.cachedIndex=a}}},{key:"findIndex",value:function(i,t){var e=this.fragments;if(!e||e.length===0)return-1;if(e.length===1)return 0;if(t>-1&&t<e.length&&i>e[t].start&&i<e[t].end)return t;if(i>e[e.length-1].start)return e.length-1;for(var r=0;r<e.length;r++)if(i>e[r].start&&i<=e[r].end){t=r;break}return t}},{key:"findHightLight",value:function(){for(var i=this.root.children,t=0;t<i.length;t++)if(g.hasClass(i[t],this.fragConfig.fragFocusClass))return{dom:i[t],pos:i[t].getBoundingClientRect()}}},{key:"findFragment",value:function(i){var t=this.root.children;return i<0||i>=t.length?null:{dom:t[i],pos:t[i].getBoundingClientRect()}}},{key:"unHightLight",value:function(){for(var i=this.root.children,t=0;t<i.length;t++)g.removeClass(i[t],this.fragConfig.fragFocusClass)}},{key:"setHightLight",value:function(i){var t=this.root.children;if(i<t.length)return g.addClass(t[i],this.fragConfig.fragFocusClass),{dom:t[i],pos:t[i].getBoundingClientRect()}}},{key:"destroy",value:function(){this.progressList=null,this.fragments=null,this.root.innerHTML=""}},{key:"reset",value:function(i){var t=this;if(Object.keys(this.fragConfig).forEach(function(r){i[r]!==void 0&&(t.fragConfig[r]=i[r])}),i.fragments){if(this.fragments=i.fragments.length===0?[{percent:1}]:i.fragments,this.updateDuration(this.duration),this.playedIndex=0,this.cachedIndex=0,this.root)for(var e=this.root.children;e.length>0;)this.root.removeChild(e[0]);this.render()}}},{key:"render",value:function(){var i=this,t=this.style.progressColor;if(this.root||(this.root=g.createDom("xg-inners","",{},"progress-list")),this.fragments){var e=this.fragConfig,r=e.fragClass,n=e.fragFocusClass;this.progressList=this.fragments.map(function(a){var u=g.createDom("xg-inner","",{style:t?"background:".concat(t,"; flex: ").concat(a.percent):"flex: ".concat(a.percent)},"".concat(a.isFocus?n:""," xgplayer-progress-inner ").concat(r));return i.root.appendChild(u),gu.forEach(function(l){u.appendChild(g.createDom(l.tag,"",{style:l.styleKey?"background: ".concat(i.style[l.styleKey],"; width:0;"):"width:0;"},l.className))}),{cached:u.children[0],played:u.children[1]}})}return this.root}}]),s})(),ra={POINT:"inner-focus-point",HIGHLIGHT:"inner-focus-highlight"},Ss=(function(s){J(i,s);var o=ee(i);function i(t){var e;return X(this,i),e=o.call(this,t),I(P(e),"onMoveOnly",function(r,n){var a=P(e),u=a.pos,l=a.config,c=a.player,f=n;if(r){g.event(r);var h=g.getEventPos(r,c.zoom),d=c.rotateDeg===90?h.clientY:h.clientX;if(u.moving&&Math.abs(u.x-d)<l.miniMoveStep)return;u.moving=!0,u.x=d,f=e.computeTime(r,d)}e.triggerCallbacks("dragmove",f,r),e._updateInnerFocus(f)}),I(P(e),"onBodyClick",function(r){e.pos.isLocked&&(e.pos.isLocked=!1,r.preventDefault(),r.stopPropagation())}),I(P(e),"_mouseDownHandler",function(r,n){e._state.time=n.currentTime,e.updateWidth(n.currentTime,n.seekTime,n.percent,0),e._updateInnerFocus(n)}),I(P(e),"_mouseUpHandler",function(r,n){var a=P(e),u=a.pos;u.moving&&e.updateWidth(n.currentTime,n.seekTime,n.percent,2)}),I(P(e),"_mouseMoveHandler",function(r,n){var a=P(e),u=a._state,l=a.pos,c=a.config,f=a.player;u.time<n.currentTime?n.forward=!0:n.forward=!1,u.time=n.currentTime,l.isDown&&!l.moving&&(l.moving=!0,c.isPauseMoving&&f.pause(),e.triggerCallbacks("dragstart",n,r),e.emitUserAction("drag","dragstart",n)),e.updateWidth(n.currentTime,n.seekTime,n.percent,1),e.triggerCallbacks("dragmove",n,r),e._updateInnerFocus(n)}),I(P(e),"onMouseDown",function(r){var n=P(e),a=n._state,u=n.player,l=n.pos,c=n.config,f=n.playerConfig,h=g.getEventPos(r,u.zoom),d=u.rotateDeg===90?h.clientY:h.clientX;if(!(u.isMini||c.closeMoveSeek||!f.allowSeekAfterEnded&&u.ended)){if(!u.duration&&!u.isPlaying){u.play();return}r.stopPropagation(),e.focus(),g.checkIsFunction(f.disableSwipeHandler)&&f.disableSwipeHandler(),g.checkIsFunction(c.onMoveStart)&&c.onMoveStart(),g.event(r),l.x=d,l.isDown=!0,l.moving=!1,a.prePlayTime=u.currentTime,u.focus({autoHide:!1}),e.isProgressMoving=!0,g.addClass(e.progressBtn,"active");var v=e.computeTime(r,d);v.prePlayTime=a.prePlayTime,e._mouseDownHandlerHook(r,v);var y=r.type;return y==="touchstart"?(e.root.addEventListener("touchmove",e.onMouseMove),e.root.addEventListener("touchend",e.onMouseUp),e.root.addEventListener("touchcancel",e.onMouseUp)):(e.unbind("mousemove",e.onMoveOnly),document.addEventListener("mousemove",e.onMouseMove,!1),document.addEventListener("mouseup",e.onMouseUp,!1)),!0}}),I(P(e),"onMouseUp",function(r){var n=P(e),a=n.player,u=n.config,l=n.pos,c=n.playerConfig,f=n._state;if(l){r.stopPropagation(),r.preventDefault(),g.checkIsFunction(c.enableSwipeHandler)&&c.enableSwipeHandler(),g.checkIsFunction(u.onMoveEnd)&&u.onMoveEnd(),g.event(r),g.removeClass(e.progressBtn,"active");var h=e.computeTime(r,l.x);h.prePlayTime=f.prePlayTime,l.moving?(e.triggerCallbacks("dragend",h,r),e.emitUserAction("drag","dragend",h)):(e.triggerCallbacks("click",h,r),e.emitUserAction("click","click",h)),e._mouseUpHandlerHook(r,h),l.moving=!1,l.isDown=!1,l.x=0,l.y=0,l.isLocked=!0,f.prePlayTime=0,f.time=0;var d=r.type;d==="touchend"||d==="touchcancel"?(e.root.removeEventListener("touchmove",e.onMouseMove),e.root.removeEventListener("touchend",e.onMouseUp),e.root.removeEventListener("touchcancel",e.onMouseUp),e.blur()):(document.removeEventListener("mousemove",e.onMouseMove,!1),document.removeEventListener("mouseup",e.onMouseUp,!1),l.isEnter?c.isMobileSimulateMode!=="mobile"&&e.bind("mousemove",e.onMoveOnly):e.onMouseLeave(r)),g.setTimeout(P(e),function(){e.resetSeekState()},1),a.focus()}}),I(P(e),"onMouseMove",function(r){var n=P(e),a=n._state,u=n.pos,l=n.player,c=n.config;g.checkTouchSupport()&&r.preventDefault(),g.event(r);var f=g.getEventPos(r,l.zoom),h=l.rotateDeg===90?f.clientY:f.clientX,d=Math.abs(u.x-h);if(!(u.moving&&d<c.miniMoveStep||!u.moving&&d<c.miniStartStep)){u.x=h;var v=e.computeTime(r,h);v.prePlayTime=a.prePlayTime,e._mouseMoveHandlerHook(r,v)}}),I(P(e),"onMouseOut",function(r){e.triggerCallbacks("mouseout",null,r)}),I(P(e),"onMouseOver",function(r){e.triggerCallbacks("mouseover",null,r)}),I(P(e),"onMouseEnter",function(r){var n=P(e),a=n.player,u=n.pos;if(!(u.isDown||u.isEnter||a.isMini||!a.config.allowSeekAfterEnded&&a.ended)){u.isEnter=!0,e.bind("mousemove",e.onMoveOnly),e.bind("mouseleave",e.onMouseLeave),g.event(r);var l=g.getEventPos(r,a.zoom),c=a.rotateDeg===90?l.clientY:l.clientX,f=e.computeTime(r,c);e.triggerCallbacks("mouseenter",f,r),e.focus()}}),I(P(e),"onMouseLeave",function(r){e.triggerCallbacks("mouseleave",null,r),e.unlock(),e._updateInnerFocus(null)}),I(P(e),"onVideoResize",function(){var r=e.pos,n=r.x,a=r.isDown,u=r.isEnter;if(u&&!a){var l=e.computeTime(null,n);e.onMoveOnly(null,l)}}),e.useable=!1,e.isProgressMoving=!1,e.__dragCallBacks=[],e._state={now:-1,direc:0,time:0,prePlayTime:-1},e._disableBlur=!1,typeof e.config.isDragingSeek=="boolean"&&(console.warn("[XGPLAYER] 'isDragingSeek' is deprecated, please use 'isDraggingSeek' instead"),e.config.isDraggingSeek=e.config.isDragingSeek),e}return q(i,[{key:"offsetDuration",get:function(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}},{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"currentTime",get:function(){var e=this.player,r=e.offsetCurrentTime,n=e.currentTime;return r>=0?r:n+this.timeOffset}},{key:"changeState",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.useable=e}},{key:"show",value:function(e){this.root&&(this.root.style.display="flex")}},{key:"_initInner",value:function(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(!r||r.length===0)&&(r=[{percent:1}]);var a=Ae(Ae({fragments:r},n),{},{actionCallback:function(l){e.emitUserAction("fragment_focus","fragment_focus",l)}});this.innerList?this.innerList.reset(a):(this.innerList=new mu(a),this.outer.insertBefore(this.innerList.render(),this.outer.children[0]),["findHightLight","unHightLight","setHightLight","findFragment"].map(function(u){e[u]=e.innerList[u].bind(e.innerList)}))}},{key:"_updateInnerFocus",value:function(e){this.innerList&&this.innerList.updateFocus(e)}},{key:"afterCreate",value:function(){if(!(this.config.disable||this.playerConfig.isLive)){this.pos={x:0,y:0,moving:!1,isDown:!1,isEnter:!1,isLocked:!1},this.outer=this.find("xg-outer");var e=this.config,r=e.fragFocusClass,n=e.fragAutoFocus,a=e.fragClass;this._initInner(this.config.fragments,{fragFocusClass:r,fragAutoFocus:n,fragClass:a,style:this.playerConfig.commonStyle||{}}),ue.device==="mobile"&&(this.config.isDraggingSeek=!1,this.isMobile=!0),this.progressBtn=this.find(".xgplayer-progress-btn"),this.listenEvents(),this.bindDomEvents(),this.initCustomStyle()}}},{key:"listenEvents",value:function(){var e=this;this.on(Et,function(){e.onMouseLeave()}),this.on(qe,function(){e.onTimeupdate()}),this.on(mt,function(){e.onTimeupdate(),e.onCacheUpdate()}),this.on(Za,function(){e.onCacheUpdate()}),this.on(zt,function(){e.onCacheUpdate(!0),e.onTimeupdate(!0),e._state.now=0}),this.on($t,function(){e.onReset()}),this.on(Dt,function(){e.onVideoResize()})}},{key:"setConfig",value:function(e){var r=this,n=null;Object.keys(e).forEach(function(a){r.config[a]=e[a],a==="fragments"&&(n=e[a])}),n&&this._initInner(n,e)}},{key:"initCustomStyle",value:function(){var e=this.playerConfig||{},r=e.commonStyle,n=r.sliderBtnStyle,a=this.progressBtn;n&&(typeof n=="string"?a.style.boxShadow=n:Ve(n)==="object"&&Object.keys(n).map(function(u){a.style[u]=n[u]}))}},{key:"triggerCallbacks",value:function(e,r,n){this.__dragCallBacks.length>0&&this.__dragCallBacks.map(function(a){if(a&&a.handler&&a.type===e)try{a.handler(r,n)}catch(u){console.error("[XGPLAYER][triggerCallbacks] ".concat(a," error"),u)}})}},{key:"addCallBack",value:function(e,r){r&&typeof r=="function"&&this.__dragCallBacks.push({type:e,handler:r})}},{key:"removeCallBack",value:function(e,r){var n=this.__dragCallBacks,a=-1;n.map(function(u,l){u&&u.type===e&&u.handler===r&&(a=l)}),a>-1&&n.splice(a,1)}},{key:"unlock",value:function(){var e=this.player,r=this.pos;if(r.isEnter=!1,r.isLocked=!1,!e.isMini){if(this.unbind("mousemove",this.onMoveOnly),r.isDown){this.unbind("mouseleave",this.onMouseLeave);return}this.blur()}}},{key:"bindDomEvents",value:function(){var e=this.player.config;this._mouseDownHandlerHook=this.hook("dragstart",this._mouseDownHandler),this._mouseUpHandlerHook=this.hook("dragend",this._mouseUpHandler),this._mouseMoveHandlerHook=this.hook("drag",this._mouseMoveHandler),(this.domEventType==="touch"||this.domEventType==="compatible")&&this.root.addEventListener("touchstart",this.onMouseDown),(this.domEventType==="mouse"||this.domEventType==="compatible")&&(this.bind("mousedown",this.onMouseDown),e.isMobileSimulateMode!=="mobile"&&this.bind("mouseenter",this.onMouseEnter),this.bind("mouseover",this.onMouseOver),this.bind("mouseout",this.onMouseOut),this.player.root.addEventListener("click",this.onBodyClick,!0))}},{key:"focus",value:function(){this.player.controls.pauseAutoHide(),g.addClass(this.root,"active")}},{key:"blur",value:function(){this._disableBlur||(this.player.controls.recoverAutoHide(),g.removeClass(this.root,"active"))}},{key:"disableBlur",value:function(){this._disableBlur=!0}},{key:"enableBlur",value:function(){this._disableBlur=!1}},{key:"updateWidth",value:function(e,r,n,a){var u=this.config,l=this.player;if(!(u.isCloseClickSeek&&a===0)){var c=r=r>=l.duration?l.duration-u.endedDiff:Number(r).toFixed(1);this.updatePercent(n),this.updateTime(e),!(a===1&&(!u.isDraggingSeek||l.config.mediaType==="audio"))&&(this._state.now=c,this._state.direc=c>l.currentTime?0:1,l.seek(c))}}},{key:"computeTime",value:function(e,r){var n=this.player,a=this.root.getBoundingClientRect(),u=a.width,l=a.height,c=a.top,f=a.left,h,d,v=r;n.rotateDeg===90?(h=l,d=c):(h=u,d=f);var y=v-d;y=y>h?h:y<0?0:y;var p=y/h;p=p<0?0:p>1?1:p,Number.isNaN(p)&&(p=this.player.currentTime/this.offsetDuration);var b=parseInt(p*this.offsetDuration*1e3,10)/1e3,k=g.getCurrentTimeByOffset(b,n.timeSegments);return{percent:p,currentTime:b,seekTime:k,offset:y,width:h,left:d,e}}},{key:"updateTime",value:function(e){var r=this.player,n=this.duration;e>n?e=n:e<0&&(e=0);var a=r.plugins.time;a&&a.updateTime(e)}},{key:"resetSeekState",value:function(){this.isProgressMoving=!1;var e=this.player.plugins.time;e&&e.resetActive()}},{key:"updatePercent",value:function(e,r){if(this.isProgressMoving=!0,!this.config.disable){e=e>1?1:e<0?0:e,this.progressBtn.style.left="".concat(e*100,"%"),this.innerList.update({played:e*this.offsetDuration},this.offsetDuration);var n=this.player.plugins.miniprogress;n&&n.update({played:e*this.offsetDuration},this.offsetDuration)}}},{key:"onTimeupdate",value:function(e){var r=this.player,n=this._state,a=this.offsetDuration;if(!(r.isSeeking&&r.media.seeking||this.isProgressMoving||!r.hasStart)){if(n.now>-1){var u=parseInt(n.now*1e3,10)-parseInt(r.currentTime*1e3,10);if(n.direc===0&&u>300||n.direc===1&&u>-300){n.now=-1;return}else n.now=-1}var l=this.currentTime;l=g.adjustTimeByDuration(l,a,e),this.innerList.update({played:l},a),this.progressBtn.style.left="".concat(l/a*100,"%")}}},{key:"onCacheUpdate",value:function(e){var r=this.player,n=this.duration;if(r){var a=r.bufferedPoint.end;a=g.adjustTimeByDuration(a,n,e),this.innerList.update({cached:a},n)}}},{key:"onReset",value:function(){this.innerList.update({played:0,cached:0},0),this.progressBtn.style.left="0%"}},{key:"destroy",value:function(){var e=this.player;this.thumbnailPlugin=null,this.innerList.destroy(),this.innerList=null;var r=this.domEventType;(r==="touch"||r==="compatible")&&(this.root.removeEventListener("touchstart",this.onMouseDown),this.root.removeEventListener("touchmove",this.onMouseMove),this.root.removeEventListener("touchend",this.onMouseUp),this.root.removeEventListener("touchcancel",this.onMouseUp)),(r==="mouse"||r==="compatible")&&(this.unbind("mousedown",this.onMouseDown),this.unbind("mouseenter",this.onMouseEnter),this.unbind("mousemove",this.onMoveOnly),this.unbind("mouseleave",this.onMouseLeave),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),e.root.removeEventListener("click",this.onBodyClick,!0))}},{key:"render",value:function(){if(!(this.config.disable||this.playerConfig.isLive)){var e=this.player.controls?this.player.controls.config.mode:"",r=e==="bottom"?"xgplayer-progress-bottom":"";return`
    <xg-progress class="xgplayer-progress `.concat(r,`">
      <xg-outer class="xgplayer-progress-outer">
        <xg-progress-btn class="xgplayer-progress-btn"></xg-progress-btn>
      </xg-outer>
    </xg-progress>
    `)}}}],[{key:"pluginName",get:function(){return"progress"}},{key:"defaultConfig",get:function(){return{position:Ee.CONTROLS_CENTER,index:0,disable:!1,isDraggingSeek:!0,closeMoveSeek:!1,isPauseMoving:!1,isCloseClickSeek:!1,fragments:[{percent:1}],fragFocusClass:ra.POINT,fragClass:"",fragAutoFocus:!1,miniMoveStep:5,miniStartStep:2,onMoveStart:function(){},onMoveEnd:function(){},endedDiff:.2}}},{key:"FRAGMENT_FOCUS_CLASS",get:function(){return ra}}]),i})(pe),Es=(function(s){J(i,s);var o=ee(i);function i(t){var e;return X(this,i),e=o.call(this,t),e.isActiving=!1,e}return q(i,[{key:"duration",get:function(){var e=this.player,r=e.offsetDuration,n=e.duration;return this.playerConfig.customDuration||r||n}},{key:"currentTime",get:function(){var e=this.player,r=e.offsetCurrentTime,n=e.currentTime;return r>=0?r:n}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"afterCreate",value:function(){var e=this.player.controls.config.mode;this.mode=e==="flex"?"flex":"normal",!this.config.disable&&(this.mode==="flex"&&(this.createCenterTime(),this.root.style.display="none"),this.durationDom=this.find(".time-duration"),this.timeDom=this.find(".time-current"),this.listenEvents())}},{key:"listenEvents",value:function(){var e=this;this.on([Et,mt,qe],function(r){r.eventName==="durationchange"&&(e.isActiving=!1),e.onTimeUpdate()}),this.on(zt,function(){e.onTimeUpdate(!0)}),this.on($t,function(){e.onReset()})}},{key:"show",value:function(e){if(this.mode==="flex"){this.centerCurDom&&(this.centerCurDom.style.display="block"),this.centerDurDom&&(this.centerDurDom.style.display="block");return}this.root.style.display="block"}},{key:"hide",value:function(){if(this.mode==="flex"){this.centerCurDom&&(this.centerCurDom.style.display="none"),this.centerDurDom&&(this.centerDurDom.style.display="none");return}this.root.style.display="none"}},{key:"onTimeUpdate",value:function(e){var r=this.player,n=this.config,a=this.duration;if(!(n.disable||this.isActiving||!r.hasStart)){var u=this.currentTime+this.timeOffset;u=g.adjustTimeByDuration(u,a,e),this.mode==="flex"?(this.centerCurDom.innerHTML=this.minWidthTime(g.format(u)),a!==1/0&&a>0&&(this.centerDurDom.innerHTML=g.format(a))):(this.timeDom.innerHTML=this.minWidthTime(g.format(u)),a!==1/0&&a>0&&(this.durationDom.innerHTML=g.format(a)))}}},{key:"onReset",value:function(){this.mode==="flex"?(this.centerCurDom.innerHTML=this.minWidthTime(g.format(0)),this.centerDurDom.innerHTML=g.format(0)):(this.timeDom.innerHTML=this.minWidthTime(g.format(0)),this.durationDom.innerHTML=g.format(0))}},{key:"createCenterTime",value:function(){var e=this.player;if(!(!e.controls||!e.controls.center)){var r=e.controls.center;this.centerCurDom=g.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-left"),this.centerDurDom=g.createDom("xg-icon","00:00",{},"xgplayer-time xg-time-right"),r.children.length>0?r.insertBefore(this.centerCurDom,r.children[0]):r.appendChild(this.centerCurDom),r.appendChild(this.centerDurDom),this.extraEls=[this.centerCurDom,this.centerDurDom]}}},{key:"afterPlayerInit",value:function(){var e=this.config;if(this.duration===1/0||this.playerConfig.isLive?(g.hide(this.durationDom),g.hide(this.timeDom),g.hide(this.find(".time-separator")),g.show(this.find(".time-live-tag"))):g.hide(this.find(".time-live-tag")),e.hide){this.hide();return}this.show()}},{key:"changeLiveState",value:function(e){e?(g.hide(this.durationDom),g.hide(this.timeDom),g.hide(this.find(".time-separator")),g.show(this.find(".time-live-tag"))):(g.hide(this.find(".time-live-tag")),g.show(this.find(".time-separator")),g.show(this.durationDom),g.show(this.timeDom))}},{key:"updateTime",value:function(e){if(this.isActiving=!0,!(!e&&e!==0||e>this.duration)){if(this.mode==="flex"){this.centerCurDom.innerHTML=this.minWidthTime(g.format(e));return}this.timeDom.innerHTML=this.minWidthTime(g.format(e))}}},{key:"minWidthTime",value:function(e){return e.split(":").map(function(r){return'<span class="time-min-width">'.concat(r,"</span>")}).join(":")}},{key:"resetActive",value:function(){var e=this,r=this.player,n=function(){e.isActiving=!1};this.off(mt,n),r.isSeeking&&r.media.seeking?this.once(mt,n):this.isActiving=!1}},{key:"destroy",value:function(){var e=this.player.controls.center;this.centerCurDom&&e.removeChild(this.centerCurDom),this.centerCurDom=null,this.centerDurDom&&e.removeChild(this.centerDurDom),this.centerDurDom=null}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-time">
    <span class="time-current">00:00</span>
    <span class="time-separator">/</span>
    <span class="time-duration">00:00</span>
    <span class="time-live-tag">`.concat(this.i18n.LIVE_TIP,`</span>
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"time"}},{key:"defaultConfig",get:function(){return{position:Ee.CONTROLS_LEFT,index:2,disable:!1}}}]),i})(pe);function yu(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M940.632 837.632l-72.192-72.192c65.114-64.745 105.412-154.386 105.412-253.44s-40.299-188.695-105.396-253.424l-0.016-0.016 72.192-72.192c83.639 83.197 135.401 198.37 135.401 325.632s-51.762 242.434-135.381 325.612l-0.020 0.020zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>
</svg>
`,"image/svg+xml").firstChild}function _u(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>
</svg>
`,"image/svg+xml").firstChild}function bu(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>
  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M920.4 439.808l-108.544-109.056-72.704 72.704 109.568 108.544-109.056 108.544 72.704 72.704 108.032-109.568 108.544 109.056 72.704-72.704-109.568-108.032 109.056-108.544-72.704-72.704-108.032 109.568z"></path>
</svg>
`,"image/svg+xml").firstChild}var ks=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"onBarMousedown",function(a){var u=P(t),l=u.player,c=t.find(".xgplayer-bar");g.event(a);var f=c.getBoundingClientRect(),h=g.getEventPos(a,l.zoom),d=f.height-(h.clientY-f.top);if(h.h=d,h.barH=f.height,t.pos=h,!(d<-2))return t.updateVolumePos(d,a),document.addEventListener("mouseup",t.onBarMouseUp),t._d.isStart=!0,!1}),I(P(t),"onBarMouseMove",function(a){var u=P(t),l=u._d;if(l.isStart){var c=P(t),f=c.pos,h=c.player;a.preventDefault(),a.stopPropagation(),g.event(a);var d=g.getEventPos(a,h.zoom);l.isMoving=!0;var v=f.h-d.clientY+f.clientY;v>f.barH||t.updateVolumePos(v,a)}}),I(P(t),"onBarMouseUp",function(a){g.event(a),document.removeEventListener("mouseup",t.onBarMouseUp);var u=P(t),l=u._d;l.isStart=!1,l.isMoving=!1}),I(P(t),"onMouseenter",function(a){t._d.isActive=!0,t.focus(),t.emit("icon_mouseenter",{pluginName:t.pluginName})}),I(P(t),"onMouseleave",function(a){t._d.isActive=!1,t.unFocus(100,!1,a),t.emit("icon_mouseleave",{pluginName:t.pluginName})}),I(P(t),"onVolumeChange",function(a){if(t.player){var u=t.player,l=u.muted,c=u.volume;t._d.isMoving||(t.find(".xgplayer-drag").style.height=l||c===0?"4px":"".concat(c*100,"%"),t.config.showValueLabel&&t.updateVolumeValue()),t.animate(l,c)}}),t}return q(i,[{key:"registerIcons",value:function(){return{volumeSmall:{icon:_u,class:"xg-volume-small"},volumeLarge:{icon:yu,class:"xg-volume"},volumeMuted:{icon:bu,class:"xg-volume-mute"}}}},{key:"afterCreate",value:function(){var e=this;if(this._timerId=null,this._d={isStart:!1,isMoving:!1,isActive:!1},!this.config.disable){this.initIcons();var r=this.playerConfig,n=r.commonStyle,a=r.volume;n.volumeColor&&(this.find(".xgplayer-drag").style.backgroundColor=n.volumeColor),this.changeMutedHandler=this.hook("mutedChange",function(u){e.changeMuted(u)},{pre:function(l){l.preventDefault(),l.stopPropagation()}}),this._onMouseenterHandler=this.hook("mouseenter",this.onMouseenter),this._onMouseleaveHandler=this.hook("mouseleave",this.onMouseleave),ue.device!=="mobile"&&this.playerConfig.isMobileSimulateMode!=="mobile"&&(this.bind("mouseenter",this._onMouseenterHandler),this.bind(["blur","mouseleave"],this._onMouseleaveHandler),this.bind(".xgplayer-slider","mousedown",this.onBarMousedown),this.bind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.bind(".xgplayer-slider","mouseup",this.onBarMouseUp)),this.bind(".xgplayer-icon",["touchend","click"],this.changeMutedHandler),this.on(qa,this.onVolumeChange),this.once(bt,this.onVolumeChange),g.typeOf(a)!=="Number"&&(this.player.volume=this.config.default),this.onVolumeChange()}}},{key:"updateVolumePos",value:function(e,r){var n=this.player,a=this.find(".xgplayer-drag"),u=this.find(".xgplayer-bar");if(!(!u||!a)){var l=parseInt(e/u.getBoundingClientRect().height*1e3,10);a.style.height="".concat(e,"px");var c=Math.max(Math.min(l/1e3,1),0),f={volume:{from:n.volume,to:c}};n.muted&&(f.muted={from:!0,to:!1}),this.emitUserAction(r,"change_volume",{muted:n.muted,volume:n.volume,props:f}),n.volume=Math.max(Math.min(l/1e3,1),0),n.muted&&(n.muted=!1),this.config.showValueLabel&&this.updateVolumeValue()}}},{key:"updateVolumeValue",value:function(){var e=this.player,r=e.volume,n=e.muted,a=this.find(".xgplayer-value-label"),u=Math.max(Math.min(r,1),0);a.innerText=n?0:Math.round(u*100)}},{key:"focus",value:function(){var e=this.player;e.focus({autoHide:!1}),this._timerId&&(g.clearTimeout(this,this._timerId),this._timerId=null),g.addClass(this.root,"slide-show")}},{key:"unFocus",value:function(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,a=arguments.length>2?arguments[2]:void 0,u=this._d,l=this.player;u.isActive||(this._timerId&&(g.clearTimeout(this,this._timerId),this._timerId=null),this._timerId=g.setTimeout(this,function(){u.isActive||(n?l.blur():l.focus(),g.removeClass(e.root,"slide-show"),u.isStart&&e.onBarMouseUp(a)),e._timerId=null},r))}},{key:"changeMuted",value:function(e){e&&e.stopPropagation();var r=this.player,n=this._d;n.isStart&&this.onBarMouseUp(e),this.emitUserAction(e,"change_muted",{muted:r.muted,volume:r.volume,props:{muted:{from:r.muted,to:!r.muted}}}),r.volume>0&&(r.muted=!r.muted),r.volume<.01&&(r.volume=this.config.miniVolume)}},{key:"animate",value:function(e,r){e||r===0?this.setAttr("data-state","mute"):r<.5&&this.icons.volumeSmall?this.setAttr("data-state","small"):this.setAttr("data-state","normal")}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.volumeSmall),this.appendChild(".xgplayer-icon",e.volumeLarge),this.appendChild(".xgplayer-icon",e.volumeMuted)}},{key:"destroy",value:function(){this._timerId&&(g.clearTimeout(this,this._timerId),this._timerId=null),this.unbind("mouseenter",this.onMouseenter),this.unbind(["blur","mouseleave"],this.onMouseleave),this.unbind(".xgplayer-slider","mousedown",this.onBarMousedown),this.unbind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.unbind(".xgplayer-slider","mouseup",this.onBarMouseUp),document.removeEventListener("mouseup",this.onBarMouseUp),this.unbind(".xgplayer-icon",ue.device==="mobile"?"touchend":"click",this.changeMutedHandler)}},{key:"render",value:function(){if(!this.config.disable){var e=this.config.default||this.player.volume,r=this.config.showValueLabel;return`
    <xg-icon class="xgplayer-volume" data-state="normal">
      <div class="xgplayer-icon">
      </div>
      <xg-slider class="xgplayer-slider">
        `.concat(r?'<div class="xgplayer-value-label">'.concat(e*100,"</div>"):"",`
        <div class="xgplayer-bar">
          <xg-drag class="xgplayer-drag" style="height: `).concat(e*100,`%"></xg-drag>
        </div>
      </xg-slider>
    </xg-icon>`)}}}],[{key:"pluginName",get:function(){return"volume"}},{key:"defaultConfig",get:function(){return{position:Ee.CONTROLS_RIGHT,index:1,disable:!1,showValueLabel:!1,default:.6,miniVolume:.2}}}]),i})(pe);function Ue(){return new Date().getTime()}var Tt={LOAD_START:"loadstart",LOADED_DATA:"loadeddata",FIRST_FRAME:"firstFrame",WAIT_START:"waitingStart",WAIT_END:"waitingEnd",SEEK_START:"seekStart",SEEK_END:"seekEnd"},Su=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"_onTimeupdate",function(){t._state.isTimeUpdate=!0,t._state.autoplayStart&&(he.logInfo("[xgLogger]".concat(t.player.playerId," _onTimeupdate")),t._sendFF("onTimeupdate"))}),I(P(t),"_onAutoplayStart",function(){he.logInfo("[xgLogger]".concat(t.player.playerId," _onAutoplayStart")),t._state.autoplayStart=!0,t.vt&&t._sendFF("onAutoplayStart")}),I(P(t),"_onReset",function(){t._state={autoplayStart:!1,isFFLoading:!1,isTimeUpdate:!1,isFFSend:!1,isLs:!1},t.vt=0,t.pt=0,t.fvt=0,t.newPointTime=Ue(),t.loadedCostTime=0,t.startCostTime=0,t._isSeeking=!1,t.seekingStart=0,t.waitingStart=0,t.fixedWaitingStart=0,t._isWaiting=!1,t._waitTimer&&g.clearTimeout(P(t),t._waitTimer),t._waittTimer&&g.clearTimeout(P(t),t._waittTimer),t._waitTimer=null,t._waittTimer=null,t._waitType=0}),I(P(t),"_onSeeking",function(){t.seekingStart||(t.suspendWaitingStatus("seek"),t.seekingStart=Ue(),t.emitLog(Tt.SEEK_START,{start:Ue()}))}),I(P(t),"_onSeeked",function(){t.suspendSeekingStatus("seeked")}),I(P(t),"_onWaitingLoadStart",function(){t._isWaiting||t.vt||(t._isWaiting=!0,t.waitingStart=Ue(),t.fixedWaitingStart=Ue(),t._waitType=1,t.emitLog(Tt.WAIT_START,{fixedStart:t.fixedWaitingStart,start:t.waitingStart,type:1,endType:"loadstart"}))}),I(P(t),"_onWaiting",function(){t._isWaiting||!t.vt||(t._isWaiting=!0,t.vt?t.seekingStart?t._waitType=2:t._waitType=0:t._waitType=1,t.fixedWaitingStart=Ue(),t._waitTimer=g.setTimeout(P(t),function(){t._isWaiting&&(t.waitingStart=Ue(),g.clearTimeout(P(t),t._waitTimer),t._waitTimer=null,t._startWaitTimeout(),t.emitLog(Tt.WAIT_START,{fixedStart:t.fixedWaitingStart,start:t.waitingStart,type:t._waitType,endType:t._waitType===2?"seek":"playing"}))},200))}),I(P(t),"_onError",function(){t.suspendSeekingStatus("error"),t.suspendWaitingStatus("error")}),I(P(t),"_onPlaying",function(){t._isWaiting&&t.suspendWaitingStatus("playing")}),t}return q(i,[{key:"afterCreate",value:function(){var e=this;this._onReset(),this._waitType="firstFrame",this._initOnceEvents(),this.newPointTime=Ue(),this.loadedCostTime=0,this.startCostTime=0,this.on(pn,function(){var r=e._state,n=r.autoplayStart,a=r.isFFSend;e.startCostTime=Ue()-e.newPointTime,he.logInfo("[xgLogger]".concat(e.player.playerId," LOAD_START"),"autoplayStart:".concat(n," isFFSend:").concat(a," startCostTime:").concat(e.startCostTime," newPointTime").concat(e.newPointTime)),!a&&(!r.isLs&&e.emitLog(Tt.LOAD_START,{}),r.isLs=!0,r.isTimeUpdate=!1,r.isFFLoading=!0,e.pt=Ue(),e.vt=0,e.fvt=0,e._initOnceEvents(),e._onWaitingLoadStart())}),this.on(bt,function(){e.vt=Ue(),e.fvt=e.vt-e.pt,e.loadedCostTime=e.vt-e.newPointTime;var r=e._state,n=r.isTimeUpdate,a=r.isFFSend,u=r.autoplayStart;he.logInfo("[xgLogger]".concat(e.player.playerId," LOADED_DATA"),"fvt:".concat(e.fvt," isTimeUpdate:").concat(e._state.isTimeUpdate," loadedCostTime:").concat(e.loadedCostTime)),(n||u)&&e._sendFF("loadedData"),a||e.emitLog(Tt.LOADED_DATA,{}),e.suspendWaitingStatus("loadeddata")}),this.on(rr,this._onSeeking),this.on(mt,this._onSeeked),this.on(Ei,function(){e.endState("destroy")}),this.on(li,function(){e.endState("urlChange"),he.logInfo("[xgLogger]".concat(e.player.playerId," URL_CHANGE")),e._state.isFFSend&&e._onReset()}),this.on([vn,gt],this._onPlaying),this.on(Si,this._onWaiting),this.on(Wt,this._onError),this.on(ar,function(){he.logInfo("[xgLogger]".concat(e.player.playerId," RESET")),e.endState("reset"),e._initOnceEvents(),e._onReset()})}},{key:"_initOnceEvents",value:function(){this.off(Bt,this._onAutoplayStart),this.off(qe,this._onTimeupdate),this.once(Bt,this._onAutoplayStart),this.once(qe,this._onTimeupdate)}},{key:"_sendFF",value:function(e){this.s=Ue();var r=this._state,n=r.isFFLoading,a=r.isFFSend;he.logInfo("[xgLogger]".concat(this.player.playerId," _sendFF"),"".concat(e," fvt:").concat(this.fvt," isFFLoading:").concat(n," !isFFSend:").concat(!a)),this.vt>0&&n&&!a&&(he.logInfo("[xgLogger]".concat(this.player.playerId," emitLog_firstFrame"),e),this._state.isFFLoading=!1,this._state.isFFSend=!0,this.emitLog(Tt.FIRST_FRAME,{fvt:this.fvt,costTime:this.fvt,vt:this.vt,startCostTime:this.startCostTime,loadedCostTime:this.loadedCostTime}))}},{key:"_startWaitTimeout",value:function(){var e=this;this._waittTimer&&g.clearTimeout(this,this._waittTimer),this._waittTimer=g.setTimeout(this,function(){e.suspendWaitingStatus("timeout"),g.clearTimeout(e,e._waittTimer),e._waittTimer=null},this.config.waitTimeout)}},{key:"endState",value:function(e){this.suspendWaitingStatus(e),this.suspendSeekingStatus(e)}},{key:"suspendSeekingStatus",value:function(e){if(this.seekingStart){var r=Ue(),n=r-this.seekingStart;this.seekingStart=0,this.emitLog(Tt.SEEK_END,{end:r,costTime:n,endType:e})}}},{key:"suspendWaitingStatus",value:function(e){if(this._waitTimer&&(g.clearTimeout(this,this._waitTimer),this._waitTimer=null),this._waittTimer&&(g.clearTimeout(this,this._waittTimer),this._waittTimer=null),this._isWaiting=!1,!!this.waitingStart){var r=Ue(),n=r-this.waitingStart,a=r-this.fixedWaitingStart,u=this.config.waitTimeout;this._isWaiting=!1,this.waitingStart=0,this.fixedWaitingStart=0,this.emitLog(Tt.WAIT_END,{fixedCostTime:a>u?u:a,costTime:n>u?u:n,type:e==="loadeddata"?1:this._waitType,endType:this._waitType===2?"seek":e})}}},{key:"emitLog",value:function(e,r){var n=this.player;this.emit(os,Ae({t:Ue(),host:g.getHostFromUrl(n.currentSrc),vtype:n.vtype,eventType:e,currentTime:this.player.currentTime,readyState:n.video.readyState,networkState:n.video.networkState},r))}}],[{key:"pluginName",get:function(){return"xgLogger"}},{key:"defaultConfig",get:function(){return{waitTimeout:1e4}}}]),i})(pe);function Eu(){return new DOMParser().parseFromString(`<svg class="xgplayer-replay-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 78 78" width="78" height="78">
  <path fill="#fff" transform="translate(20, 20)" d="M8.22708362,13.8757234 L11.2677371,12.6472196 C11.7798067,12.4403301 12.3626381,12.6877273 12.5695276,13.1997969 L12.9441342,14.1269807 C13.1510237,14.6390502 12.9036264,15.2218816 12.3915569,15.4287712 L6.8284538,17.6764107 L5.90126995,18.0510173 C5.38920044,18.2579068 4.80636901,18.0105096 4.5994795,17.49844 L1.97723335,11.0081531 C1.77034384,10.4960836 2.0177411,9.91325213 2.52981061,9.70636262 L3.45699446,9.33175602 C3.96906396,9.12486652 4.5518954,9.37226378 4.75878491,9.88433329 L5.67885163,12.1615783 C7.99551726,6.6766934 13.3983951,3 19.5,3 C27.7842712,3 34.5,9.71572875 34.5,18 C34.5,26.2842712 27.7842712,33 19.5,33 C15.4573596,33 11.6658607,31.3912946 8.87004692,28.5831991 C8.28554571,27.9961303 8.28762719,27.0463851 8.87469603,26.4618839 C9.46176488,25.8773827 10.4115101,25.8794641 10.9960113,26.466533 C13.2344327,28.7147875 16.263503,30 19.5,30 C26.127417,30 31.5,24.627417 31.5,18 C31.5,11.372583 26.127417,6 19.5,6 C14.4183772,6 9.94214483,9.18783811 8.22708362,13.8757234 Z"></path>
</svg>
`,"image/svg+xml").firstChild}var ku=(function(s){J(i,s);var o=ee(i);function i(){return X(this,i),o.apply(this,arguments)}return q(i,[{key:"registerIcons",value:function(){return{replay:Eu}}},{key:"afterCreate",value:function(){var e=this;pe.insert(this.icons.replay,this.root,0),this.__handleReplay=this.hook("replayClick",function(){e.player.replay()},{pre:function(n){n.preventDefault(),n.stopPropagation()}}),this.bind(".xgplayer-replay",["click","touchend"],this.__handleReplay),this.on(zt,function(){if(e.playerConfig.loop||g.addClass(e.player.root,"replay"),!e.config.disable){e.show();var r=e.root.querySelector("path");if(r){var n=window.getComputedStyle(r).getPropertyValue("transform");if(typeof n=="string"&&n.indexOf("none")>-1)return null;r.setAttribute("transform",n)}}}),this.on(Qe,function(){e.hide()})}},{key:"handleReplay",value:function(e){e.preventDefault(),e.stopPropagation(),this.player.replay(),g.removeClass(this.player.root,"replay")}},{key:"show",value:function(e){this.config.disable||(this.root.style.display="flex")}},{key:"enable",value:function(){this.config.disable=!1}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){this.unbind(".xgplayer-replay",["click","touchend"],this.__handleReplay)}},{key:"render",value:function(){return`<xg-replay class="xgplayer-replay">
      <xg-replay-txt class="xgplayer-replay-txt" lang-key="`.concat(this.i18nKeys.REPLAY,'">').concat(this.i18n.REPLAY,`</xg-replay-txt>
    </xg-replay>`)}}],[{key:"pluginName",get:function(){return"replay"}},{key:"defaultConfig",get:function(){return{disable:!1}}}]),i})(pe),Tu=(function(s){J(i,s);var o=ee(i);function i(){return X(this,i),o.apply(this,arguments)}return q(i,[{key:"isEndedShow",get:function(){return this.config.isEndedShow},set:function(e){this.config.isEndedShow=e}},{key:"hide",value:function(){g.addClass(this.root,"hide")}},{key:"show",value:function(e){g.removeClass(this.root,"hide")}},{key:"beforeCreate",value:function(e){typeof e.player.config.poster=="string"&&(e.config.poster=e.player.config.poster)}},{key:"afterCreate",value:function(){var e=this;this.on(zt,function(){e.isEndedShow&&g.removeClass(e.root,"hide")}),this.config.hideCanplay?(this.once(qe,function(){e.onTimeUpdate()}),this.on(li,function(){g.removeClass(e.root,"hide"),g.addClass(e.root,"xg-showplay"),e.once(qe,function(){e.onTimeUpdate()})})):this.on(Qe,function(){g.addClass(e.root,"hide")})}},{key:"setConfig",value:function(e){var r=this;Object.keys(e).forEach(function(a){r.config[a]=e[a]});var n=this.config.poster;this.update(n)}},{key:"onTimeUpdate",value:function(){var e=this;this.player.currentTime?g.removeClass(this.root,"xg-showplay"):this.once(qe,function(){e.onTimeUpdate()})}},{key:"update",value:function(e){e&&(this.config.poster=e,this.root.style.backgroundImage="url(".concat(e,")"))}},{key:"getBgSize",value:function(e){var r="";switch(e){case"cover":r="cover";break;case"contain":r="contain";break;case"fixHeight":r="auto 100%";break;default:r=""}return r?"background-size: ".concat(r,";"):""}},{key:"render",value:function(){var e=this.config,r=e.poster,n=e.hideCanplay,a=e.fillMode,u=e.notHidden,l=this.getBgSize(a),c=r?"background-image:url(".concat(r,");").concat(l):l,f=u?"xg-not-hidden":n?"xg-showplay":"";return'<xg-poster class="xgplayer-poster '.concat(f,'" style="').concat(c,`">
    </xg-poster>`)}}],[{key:"pluginName",get:function(){return"poster"}},{key:"defaultConfig",get:function(){return{isEndedShow:!0,hideCanplay:!1,notHidden:!1,poster:"",fillMode:"fixWidth"}}}]),i})(pe),ct={};function wu(s,o){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{start:null,end:null};return ct[s]&&window.clearTimeout(ct[s].id),ct[s]={},i.start&&i.start(),ct[s].id=window.setTimeout(function(){i.end&&i.end(),window.clearTimeout(ct[s].id),delete ct[s]},o),ct[s].id}function na(s){if(s){window.clearTimeout(s);return}Object.keys(ct).map(function(o){window.clearTimeout(ct[o].id),delete ct[o]})}var Cu=(function(s){J(i,s);var o=ee(i);function i(t){var e;return X(this,i),e=o.call(this,t),I(P(e),"onPlayerReset",function(){e.autoPlayStart=!1;var r=e.config.mode==="auto"?"auto-hide":"hide";e.setAttr("data-state","play"),g.removeClass(e.root,r),e.show()}),I(P(e),"onAutoplayStart",function(){if(!e.autoPlayStart){var r=e.config.mode==="auto"?"auto-hide":"hide";g.addClass(e.root,r),e.autoPlayStart=!0,e.toggleTo("play")}}),e.autoPlayStart=!1,e}return q(i,[{key:"afterCreate",value:function(){var e=this.playerConfig;this.initIcons(),this.listenEvents(),this.bindClickEvents(),e.autoplay||this.show()}},{key:"listenEvents",value:function(){var e=this,r=this.player,n=this.playerConfig;this.once(mn,function(){n&&(n.lang&&n.lang==="en"?g.addClass(r.root,"lang-is-en"):n.lang==="jp"&&g.addClass(r.root,"lang-is-jp"))}),this.on(Bt,this.onAutoplayStart),this.on(yn,function(){var a=e.config.mode==="auto"?"auto-hide":"hide";e.setAttr("data-state","play"),g.removeClass(e.root,a),e.show()}),this.on(Qe,function(){e.toggleTo("play")}),this.on(ui,function(){e.toggleTo("pause")}),this.on(ar,function(){e.onPlayerReset()})}},{key:"bindClickEvents",value:function(){var e=this;this.clickHandler=this.hook("startClick",this.switchPausePlay,{pre:function(n){n.cancelable&&n.preventDefault(),n.stopPropagation();var a=e.player.paused;e.emitUserAction(n,"switch_play_pause",{props:"paused",from:a,to:!a})}}),this.bind(["click","touchend"],this.clickHandler)}},{key:"registerIcons",value:function(){return{startPlay:{icon:Sn,class:"xg-icon-play"},startPause:{icon:En,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild("xg-start-inner",e.startPlay),this.appendChild("xg-start-inner",e.startPause)}},{key:"hide",value:function(){g.addClass(this.root,"hide")}},{key:"show",value:function(e){g.removeClass(this.root,"hide")}},{key:"focusHide",value:function(){g.addClass(this.root,"focus-hide")}},{key:"recover",value:function(){g.removeClass(this.root,"focus-hide")}},{key:"switchStatus",value:function(e){e?this.setAttr("data-state",this.player.paused?"pause":"play"):this.setAttr("data-state",this.player.paused?"play":"pause")}},{key:"animate",value:function(e){var r=this;this._animateId=wu("pauseplay",400,{start:function(){g.addClass(r.root,"interact"),r.show(),r.switchStatus(!0)},end:function(){g.removeClass(r.root,"interact"),!e&&r.hide(),r._animateId=null}})}},{key:"endAnimate",value:function(){g.removeClass(this.root,"interact"),na(this._animateId),this._animateId=null}},{key:"switchPausePlay",value:function(e){var r=this.player;if(e.cancelable&&e.preventDefault(),e.stopPropagation(),!(r.state<ve.READY)){var n=this.player.paused;!n&&r.state===ve.RUNNING?r.pause():r.play()}}},{key:"onPlayPause",value:function(e){this.toggleTo(e)}},{key:"toggleTo",value:function(e){var r=this.config,n=this.player;if(!(!n||n.state<ve.RUNNING||!this.autoPlayStart)){if(r.mode==="show"){this.switchStatus(),this.show();return}if(r.mode==="auto"){this.switchStatus();return}if(r.isShowPause&&n.paused&&!n.ended||r.isShowEnd&&n.ended){this.switchStatus(),this.show(),this.endAnimate();return}if(r.disableAnimate){this.switchStatus(),this.hide();return}if(e==="play")this.autoPlayStart?this.animate():this.hide();else{if(!this.autoPlayStart||n.ended)return;this.animate()}}}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.clickHandler),na(this._animateId)}},{key:"render",value:function(){var e=this.playerConfig.autoplay?this.config.mode==="auto"?"auto-hide":"hide":"";return`
    <xg-start class="xgplayer-start `.concat(e,`">
    <xg-start-inner></xg-start-inner>
    </xg-start>`)}}],[{key:"pluginName",get:function(){return"start"}},{key:"defaultConfig",get:function(){return{isShowPause:!1,isShowEnd:!1,disableAnimate:!1,mode:"hide"}}}]),i})(pe),Au=(function(s){J(i,s);var o=ee(i);function i(){return X(this,i),o.apply(this,arguments)}return q(i,[{key:"render",value:function(){var e=this.config.innerHtml,r=g.createDom("xg-enter","",{},"xgplayer-enter");if(e&&e instanceof window.HTMLElement)r.appendChild(e);else if(e&&typeof e=="string")r.innerHTML=e;else{for(var n="",a=1;a<=12;a++)n+='<div class="xgplayer-enter-bar'.concat(a,'"></div>');r.innerHTML='<div class="xgplayer-enter-spinner">'.concat(n,"</div>")}return r}}],[{key:"pluginName",get:function(){return"enter"}},{key:"defaultConfig",get:function(){return{innerHtml:"",logo:""}}}]),i})(pe),aa=(function(s){J(i,s);var o=ee(i);function i(){return X(this,i),o.apply(this,arguments)}return q(i,[{key:"afterCreate",value:function(){this.getMini=this.getMini.bind(this),this.exitMini=this.exitMini.bind(this),this.bind("click",this.getMini)}},{key:"getMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"exitMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.getMini)}},{key:"render",value:function(){var e="MINISCREEN";return`
      <xg-icon class="xgplayer-miniicon">
      <div class="xgplayer-icon btn-text"><span class="icon-text" lang-key="`.concat(this.i18nKeys[e],'">').concat(this.i18n[e],`</span></div>
      </xg-icon>`)}}],[{key:"pluginName",get:function(){return"miniscreenIcon"}},{key:"defaultConfig",get:function(){return{position:Ee.CONTROLS_RIGHT,index:10}}}]),i})(pe);function sa(s){var o=parseFloat(s),i=s.indexOf("%")===-1&&!Number.isNaN(o);return i&&o}var kn=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],Ts=kn.length;function Du(){for(var s={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},o=0;o<Ts;o++){var i=kn[o];s[i]=0}return s}function Pu(s){var o=window.getComputedStyle(s);return o}function oa(s){if(typeof s=="string"&&(s=document.querySelector(s)),!(!s||Ve(s)!=="object"||!s.nodeType)){var o=Pu(s);if(o.display==="none")return Du();var i={};i.width=s.offsetWidth,i.height=s.offsetHeight;for(var t=i.isBorderBox=o.boxSizing==="border-box",e=0;e<Ts;e++){var r=kn[e],n=o[r],a=parseFloat(n);i[r]=Number.isNaN(a)?0:a}var u=i.paddingLeft+i.paddingRight,l=i.paddingTop+i.paddingBottom,c=i.marginLeft+i.marginRight,f=i.marginTop+i.marginBottom,h=i.borderLeftWidth+i.borderRightWidth,d=i.borderTopWidth+i.borderBottomWidth,v=t,y=sa(o.width);y!==!1&&(i.width=y+(v?0:u+h));var p=sa(o.height);return p!==!1&&(i.height=p+(v?0:l+d)),i.innerWidth=i.width-(u+h),i.innerHeight=i.height-(l+d),i.outerWidth=i.width+c,i.outerHeight=i.height+f,i}}function Sr(s,o){for(var i=0;i<s.length;i++){var t=s[i];if(t.identifier===o)return t}}var Er={START:"dragStart",MOVE:"dragMove",ENDED:"dragEnded"},ua={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]},Lu=(function(s){J(i,s);var o=ee(i);function i(t){var e,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return X(this,i),e=o.call(this),e.isEnabled=!0,e.isDragging=!1,e.isDown=!1,e.position={},e.downPoint={},e.dragPoint={x:0,y:0},e.startPos={x:0,y:0},e._root=t instanceof Element?t:document.querySelector(t),e._handlerDom=r.handle instanceof Element?r.handle:document.querySelector(r.handle),!e._root||!e._handlerDom?hn(e):(e._bindStartEvent(),e)}return q(i,[{key:"_bindStartEvent",value:function(){var e=this;"ontouchstart"in window?this._startKey="touchstart":this._startKey="mousedown",this["on".concat(this._startKey)]=this["on".concat(this._startKey)].bind(this),this._handlerDom.addEventListener(this._startKey,this["on".concat(this._startKey)]),ua[this._startKey].map(function(r){e["on".concat(r)]=e["on".concat(r)].bind(e)})}},{key:"_unbindStartEvent",value:function(){this._handlerDom.removeEventListener(this._startKey,this["on".concat(this._startKey)])}},{key:"_bindPostStartEvents",value:function(e){var r=this;if(e){var n=ua[this._startKey];n.map(function(a){window.addEventListener(a,r["on".concat(a)])}),this._boundPointerEvents=n}}},{key:"_unbindPostStartEvents",value:function(){var e=this;this._boundPointerEvents&&(this._boundPointerEvents.map(function(r){window.removeEventListener(r,e["on".concat(r)])}),delete this._boundPointerEvents)}},{key:"enable",value:function(){this.isEnabled=!0}},{key:"disable",value:function(){this.isEnabled=!1,this.isDragging&&this.onUp()}},{key:"onDocUp",value:function(e){this.onUp()}},{key:"animate",value:function(){var e=this;this.isDragging&&(this.positionDrag(),window.requestAnimationFrame(function(){e.animate()}))}},{key:"positionDrag",value:function(){var e="translate3d(".concat(this.dragPoint.x,"px, ").concat(this.dragPoint.y,"px, 0)");this._root.style.transform=e,this._root.style.webKitTransform=e}},{key:"setLeftTop",value:function(){this._root.style.left=this.position.x+"px",this._root.style.top=this.position.y+"px"}},{key:"onmousedown",value:function(e){this.dragStart(e,e)}},{key:"onmousemove",value:function(e){this.dragMove(e,e)}},{key:"onmouseup",value:function(e){this.dragEnd(e,e)}},{key:"ontouchstart",value:function(e){var r=e.changedTouches[0];this.dragStart(e,r),this.touchIdentifier=r.pointerId!==void 0?r.pointerId:r.identifier,e.preventDefault()}},{key:"ontouchmove",value:function(e){var r=Sr(e.changedTouches,this.touchIdentifier);r&&this.dragMove(e,r)}},{key:"ontouchend",value:function(e){var r=Sr(e.changedTouches,this.touchIdentifier);r&&this.dragEnd(e,r),e.preventDefault()}},{key:"ontouchcancel",value:function(e){var r=Sr(e.changedTouches,this.touchIdentifier);r&&this.dragCancel(e,r)}},{key:"dragStart",value:function(e,r){if(!(!this._root||this.isDown||!this.isEnabled)){this.downPoint=r,this.dragPoint.x=0,this.dragPoint.y=0,this._getPosition();var n=oa(this._root);this.startPos.x=this.position.x,this.startPos.y=this.position.y,this.startPos.maxY=window.innerHeight-n.height,this.startPos.maxX=window.innerWidth-n.width,this.setLeftTop(),this.isDown=!0,this._bindPostStartEvents(e)}}},{key:"dragRealStart",value:function(e,r){this.isDragging=!0,this.animate(),this.emit(Er.START,this.startPos)}},{key:"dragEnd",value:function(e,r){this._root&&(this._unbindPostStartEvents(),this.isDragging&&(this._root.style.transform="",this.setLeftTop(),this.emit(Er.ENDED)),this.presetInfo())}},{key:"_dragPointerMove",value:function(e,r){var n={x:r.pageX-this.downPoint.pageX,y:r.pageY-this.downPoint.pageY};return!this.isDragging&&this.hasDragStarted(n)&&this.dragRealStart(e,r),n}},{key:"dragMove",value:function(e,r){if(e=e||window.event,!!this.isDown){var n=this.startPos,a=n.x,u=n.y,l=this._dragPointerMove(e,r),c=l.x,f=l.y;c=this.checkContain("x",c,a),f=this.checkContain("y",f,u),this.position.x=a+c,this.position.y=u+f,this.dragPoint.x=c,this.dragPoint.y=f,this.emit(Er.MOVE,this.position)}}},{key:"dragCancel",value:function(e,r){this.dragEnd(e,r)}},{key:"presetInfo",value:function(){this.isDragging=!1,this.startPos={x:0,y:0},this.dragPoint={x:0,y:0},this.isDown=!1}},{key:"destroy",value:function(){this._unbindStartEvent(),this._unbindPostStartEvents(),this.isDragging&&this.dragEnd(),this.removeAllListeners(),this._handlerDom=null}},{key:"hasDragStarted",value:function(e){return Math.abs(e.x)>3||Math.abs(e.y)>3}},{key:"checkContain",value:function(e,r,n){return r+n<0?0-n:e==="x"&&r+n>this.startPos.maxX?this.startPos.maxX-n:e==="y"&&r+n>this.startPos.maxY?this.startPos.maxY-n:r}},{key:"_getPosition",value:function(){var e=window.getComputedStyle(this._root),r=this._getPositionCoord(e.left,"width"),n=this._getPositionCoord(e.top,"height");this.position.x=Number.isNaN(r)?0:r,this.position.y=Number.isNaN(n)?0:n,this._addTransformPosition(e)}},{key:"_addTransformPosition",value:function(e){var r=e.transform;if(r.indexOf("matrix")===0){var n=r.split(","),a=r.indexOf("matrix3d")===0?12:4,u=parseInt(n[a],10),l=parseInt(n[a+1],10);this.position.x+=u,this.position.y+=l}}},{key:"_getPositionCoord",value:function(e,r){if(e.indexOf("%")!==-1){var n=oa(this._root.parentNode);return n?parseFloat(e)/100*n[r]:0}return parseInt(e,10)}}]),i})(jt),Iu=(function(s){J(i,s);var o=ee(i);function i(t){var e;X(this,i),e=o.call(this,t),I(P(e),"onCancelClick",function(a){e.exitMini(),e.isClose=!0}),I(P(e),"onCenterClick",function(a){var u=P(e),l=u.player;l.paused?l.play():l.pause()}),I(P(e),"onScroll",function(a){if(!(!window.scrollY&&window.scrollY!==0||Math.abs(window.scrollY-e.pos.scrollY)<50)){var u=parseInt(g.getCss(e.player.root,"height"));u+=e.config.scrollTop,e.pos.scrollY=window.scrollY,window.scrollY>u+5?!e.isMini&&!e.isClose&&e.getMini():window.scrollY<=u&&(e.isMini&&e.exitMini(),e.isClose=!1)}}),e.isMini=!1,e.isClose=!1;var r=P(e),n=r.config;return e.pos={left:n.left<0?window.innerWidth-n.width-20:n.left,top:n.top<0?window.innerHeight-n.height-20:n.top,height:e.config.height,width:e.config.width,scrollY:window.scrollY||0},e.lastStyle=null,e}return q(i,[{key:"beforeCreate",value:function(e){typeof e.player.config.mini=="boolean"&&(e.config.isShowIcon=e.player.config.mini)}},{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.on(ui,function(){e.setAttr("data-state","pause")}),this.on(Qe,function(){e.setAttr("data-state","play")})}},{key:"onPluginsReady",value:function(){var e=this,r=this.player,n=this.config;if(!n.disable){if(this.config.isShowIcon){var a={config:{onClick:function(){e.getMini()}}};r.controls.registerPlugin(aa,a,aa.pluginName)}var u=g.checkTouchSupport()?"touchend":"click";this.bind(".mini-cancel-btn",u,this.onCancelClick),this.bind(".play-icon",u,this.onCenterClick),this.config.disableDrag||(this._draggabilly=new Lu(this.player.root,{handle:this.root})),this.config.isScrollSwitch&&window.addEventListener("scroll",this.onScroll)}}},{key:"registerIcons",value:function(){return{play:{icon:Sn,class:"xg-icon-play"},pause:{icon:En,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".play-icon",e.play),this.appendChild(".play-icon",e.pause)}},{key:"getMini",value:function(){var e=this;if(!this.isMini){var r=this.player,n=this.playerConfig,a=this.config.target||this.player.root;this.lastStyle={},g.addClass(r.root,"xgplayer-mini"),["width","height","top","left"].map(function(u){e.lastStyle[u]=a.style[u],a.style[u]="".concat(e.pos[u],"px")}),n.fluid&&(a.style["padding-top"]=""),this.emit(Wi,!0),r.isMini=this.isMini=!0}}},{key:"exitMini",value:function(){var e=this;if(!this.isMini)return!1;var r=this.player,n=this.playerConfig,a=this.config.target||this.player.root;g.removeClass(r.root,"xgplayer-mini"),this.lastStyle&&Object.keys(this.lastStyle).map(function(u){a.style[u]=e.lastStyle[u]}),this.lastStyle=null,n.fluid&&(r.root.style.width="100%",r.root.style.height="0",r.root.style["padding-top"]="".concat(n.height*100/n.width,"%")),this.emit(Wi,!1),this.isMini=r.isMini=!1}},{key:"updatePos",value:function(e){this.pos=Object.assign(this.pos,e),this.isMini&&(this.player.root.style.left="".concat(this.pos.left,"px"),this.player.root.style.top="".concat(this.pos.top,"px"),this.player.root.style.width="".concat(this.pos.width,"px"),this.player.root.style.height="".concat(this.pos.height,"px"))}},{key:"destroy",value:function(){window.removeEventListener("scroll",this.onScroll);var e=g.checkTouchSupport()?"touchend":"click";this.unbind(".mini-cancel-btn",e,this.onCancelClick),this.unbind(".play-icon",e,this.onCenterClick),this._draggabilly&&this._draggabilly.destroy(),this._draggabilly=null,this.exitMini()}},{key:"render",value:function(){if(!this.config.disable)return`
      <xg-mini-layer class="xg-mini-layer">
      <xg-mini-header class="xgplayer-mini-header">
      `.concat(Pt(this,"MINI_DRAG",this.playerConfig.isHideTips),`
      </xg-mini-header>
      <div class="mini-cancel-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
          <path fill="#fff" fill-rule="evenodd" d="M3.99 3.49a1 1 0 0 1 1.414 0L10 8.085l4.596-4.595a1 1 0 1 1 1.414 1.414L11.414 9.5l4.596 4.596a1 1 0 0 1 .084 1.32l-.084.094a1 1 0 0 1-1.414 0L10 10.914 5.404 15.51a1 1 0 0 1-1.414-1.414L8.585 9.5 3.99 4.904a1 1 0 0 1-.084-1.32z"></path>
        </svg>
      </div>
      <div class="play-icon">
      </div>
      </xg-mini-layer>`)}}],[{key:"pluginName",get:function(){return"miniscreen"}},{key:"defaultConfig",get:function(){return{index:10,disable:!1,width:320,height:180,left:-1,top:-1,isShowIcon:!1,isScrollSwitch:!1,scrollTop:0,disableDrag:!1}}}]),i})(pe),Pi={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousemove:"onMouseMove"},kr=["videoClick","videoDbClick"],Tr=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"onMouseMove",function(a){var u=P(t),l=u.player,c=u.playerConfig;l.isActive||(l.focus({autoHide:!c.closeDelayBlur}),!c.closeFocusVideoFocus&&l.media.focus())}),I(P(t),"onMouseEnter",function(a){var u=P(t),l=u.playerConfig,c=u.player;!l.closeFocusVideoFocus&&c.media.focus(),l.closeDelayBlur?c.focus({autoHide:!1}):c.focus(),t.emit(is)}),I(P(t),"onMouseLeave",function(a){var u=t.playerConfig,l=u.closePlayerBlur,c=u.leavePlayerTime,f=u.closeDelayBlur;!l&&!f&&(c?t.player.focus({autoHide:!0,delay:c}):t.player.blur({ignorePaused:!0})),t.emit(ts)}),I(P(t),"onVideoClick",function(a){var u=P(t),l=u.player,c=u.playerConfig;a.target&&c.closeVideoClick||(a.target===l.root||a.target===l.media||a.target===l.innerContainer||a.target===l.media.__canvas)&&(a.preventDefault(),c.closeVideoStopPropagation||a.stopPropagation(),t._clickCount++,t.clickTimer&&(clearTimeout(t.clickTimer),t.clickTimer=null),t.clickTimer=setTimeout(function(){t._clickCount&&(t._clickCount--,ft(P(t),kr[0],function(f,h){t.switchPlayPause(h.e)},{e:a,paused:l.paused}),clearTimeout(t.clickTimer),t.clickTimer=null)},300))}),I(P(t),"onVideoDblClick",function(a){var u=P(t),l=u.player,c=u.playerConfig;if(!(c.closeVideoDblclick||!a.target||a.target!==l.media&&a.target!==l.media.__canvas)){if(!c.closeVideoClick&&t._clickCount<2){t._clickCount=0;return}t._clickCount=0,t.clickTimer&&(clearTimeout(t.clickTimer),t.clickTimer=null),a.preventDefault(),a.stopPropagation(),ft(P(t),kr[1],function(f,h){t.emitUserAction(h.e,"switch_fullscreen",{props:"fullscreen",from:l.fullscreen,to:!l.fullscreen}),l.fullscreen?l.exitFullscreen():l.getFullscreen()},{e:a,fullscreen:l.fullscreen})}}),t}return q(i,[{key:"afterCreate",value:function(){var e=this;this._clickCount=0,kr.map(function(n){e.__hooks[n]=null});var r=this.playerConfig.isMobileSimulateMode;r==="mobile"||ue.device==="mobile"&&!ue.os.isIpad||this.initEvents()}},{key:"initEvents",value:function(){var e=this,r=this.player,n=r.media,a=r.root,u=this.playerConfig.enableContextmenu;a&&a.addEventListener("click",this.onVideoClick,!1),a&&a.addEventListener("dblclick",this.onVideoDblClick,!1),Object.keys(Pi).map(function(l){a.addEventListener(l,e[Pi[l]],!1)}),!u&&n&&n.addEventListener("contextmenu",this.onContextmenu,!1)}},{key:"switchPlayPause",value:function(e){var r=this.player;this.emitUserAction(e,"switch_play_pause",{props:"paused",from:r.paused,to:!r.paused}),r.ended?r.duration!==1/0&&r.duration>0&&r.replay():r.paused?r.play():r.pause()}},{key:"onContextmenu",value:function(e){e=e||window.event,e.preventDefault&&e.preventDefault(),e.stopPropagation?e.stopPropagation():(e.returnValue=!1,e.cancelBubble=!0)}},{key:"destroy",value:function(){var e=this,r=this.player,n=r.video,a=r.root;this.clickTimer&&clearTimeout(this.clickTimer),a.removeEventListener("click",this.onVideoClick,!1),a.removeEventListener("dblclick",this.onVideoDblClick,!1),n.removeEventListener("contextmenu",this.onContextmenu,!1),Object.keys(Pi).map(function(u){a.removeEventListener(u,e[Pi[u]],!1)})}}],[{key:"pluginName",get:function(){return"pc"}},{key:"defaultConfig",get:function(){return{}}}]),i})(tt),wt={PRESS:"press",PRESS_END:"pressend",DOUBlE_CLICK:"doubleclick",CLICK:"click",TOUCH_MOVE:"touchmove",TOUCH_START:"touchstart",TOUCH_END:"touchend"},xu={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},Ou={start:"mousedown",end:"mouseup",move:"mousemove",cancel:"mouseleave"};function la(s){return s&&s.length>0?s[s.length-1]:null}function Ru(){return{pressDelay:600,dbClickDelay:200,disablePress:!1,disableDbClick:!1,miniStep:2,needPreventDefault:!0}}var Mu=(function(){function s(o){var i=this,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{eventType:"touch"};X(this,s),I(this,"onTouchStart",function(e){var r=i._pos,n=i.root,a=la(e.touches);r.x=a?parseInt(a.pageX,10):e.pageX,r.y=a?parseInt(a.pageX,10):e.pageX,r.start=!0,i.__setPress(e),n.addEventListener(i.events.end,i.onTouchEnd),n.addEventListener(i.events.cancel,i.onTouchCancel),n.addEventListener(i.events.move,i.onTouchMove),i.trigger(wt.TOUCH_START,e)}),I(this,"onTouchCancel",function(e){i.onTouchEnd(e)}),I(this,"onTouchEnd",function(e){var r=i._pos,n=i.root;i.__clearPress(),n.removeEventListener(i.events.cancel,i.onTouchCancel),n.removeEventListener(i.events.end,i.onTouchEnd),n.removeEventListener(i.events.move,i.onTouchMove),e.moving=r.moving,e.press=r.press,r.press&&i.trigger(wt.PRESS_END,e),i.trigger(wt.TOUCH_END,e),!r.press&&!r.moving&&i.__setDb(e),r.press=!1,r.start=!1,r.moving=!1}),I(this,"onTouchMove",function(e){var r=i._pos,n=i.config,a=la(e.touches),u=a?parseInt(a.pageX,10):e.pageX,l=a?parseInt(a.pageY,10):e.pageX,c=u-r.x,f=l-r.y;Math.abs(f)<n.miniStep&&Math.abs(c)<n.miniStep||(i.__clearPress(),r.press&&i.trigger(wt.PRESS_END,e),r.press=!1,r.moving=!0,i.trigger(wt.TOUCH_MOVE,e))}),this._pos={moving:!1,start:!1,x:0,y:0},this.config=Ru(),Object.keys(t).map(function(e){i.config[e]=t[e]}),this.root=o,this.events=t.eventType==="mouse"?Ou:xu,this.pressIntrvalId=null,this.dbIntrvalId=null,this.__handlers={},this._initEvent()}return q(s,[{key:"_initEvent",value:function(){this.root.addEventListener(this.events.start,this.onTouchStart)}},{key:"__setPress",value:function(i){var t=this,e=this.config;this.pressIntrvalId&&this.__clearPress(),this.pressIntrvalId=setTimeout(function(){t.trigger(wt.PRESS,i),t._pos.press=!0,t.__clearPress()},e.pressDelay)}},{key:"__clearPress",value:function(){window.clearTimeout(this.pressIntrvalId),this.pressIntrvalId=null}},{key:"__setDb",value:function(i){var t=this,e=this.config;if(this.dbIntrvalId){this.__clearDb(),this.trigger(wt.DOUBlE_CLICK,i);return}this.dbIntrvalId=setTimeout(function(){t.__clearDb(),!t._pos.start&&!t._pos.press&&!t._pos.moving&&t.trigger(wt.CLICK,i)},e.dbClickDelay)}},{key:"__clearDb",value:function(){clearTimeout(this.dbIntrvalId),this.dbIntrvalId=null}},{key:"on",value:function(i,t){this.__handlers[i]||(this.__handlers[i]=[]),this.__handlers[i].push(t)}},{key:"off",value:function(i,t){if(this.__handlers[i]){for(var e=this.__handlers[i],r=-1,n=0;n<e.length;n++)if(e[n]===t){r=n;break}r>=0&&this.__handlers[i].splice(r,1)}}},{key:"trigger",value:function(i,t){this.__handlers[i]&&this.__handlers[i].map(function(e){try{e(t)}catch(r){console.error("trigger>>:".concat(i),r)}})}},{key:"destroy",value:function(){var i=this,t={touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart"};Object.keys(t).forEach(function(e){i.root.removeEventListener(e,i[t[e]])})}}]),s})();function Nu(){return new DOMParser().parseFromString(`<svg width="20" height="9" viewBox="0 0 8 9" fill="none" xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <path opacity="0.54"
    d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z"
    fill="white" />
  <path transform="translate(5 0)" d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z" fill="white"/>
</svg>`,"image/svg+xml").firstChild}var Xt={AUTO:"auto",SEEKING:"seeking",PLAYBACK:"playbackrate"},wr=["videoClick","videoDbClick"],Fu=(function(s){J(i,s);var o=ee(i);function i(t){var e;return X(this,i),e=o.call(this,t),I(P(e),"onTouchStart",function(r){var n=P(e),a=n.player,u=n.config,l=n.pos,c=n.playerConfig,f=e.getTouche(r);if(f&&!u.disableGesture&&e.duration>0&&!a.ended){l.isStart=!0,e.timer&&clearTimeout(e.timer),g.checkIsFunction(c.disableSwipeHandler)&&c.disableSwipeHandler(),e.find(".xg-dur").innerHTML=g.format(e.duration);var h=e.root.getBoundingClientRect();a.rotateDeg===90?(l.top=h.left,l.left=h.top,l.width=h.height,l.height=h.width):(l.top=h.top,l.left=h.left,l.width=h.width,l.height=h.height);var d=parseInt(f.pageX-l.left,10),v=parseInt(f.pageY-l.top,10);l.x=a.rotateDeg===90?v:d,l.y=a.rotateDeg===90?d:v,l.scopeL=u.scopeL*l.width,l.scopeR=(1-u.scopeR)*l.width,l.scopeM1=l.width*(1-u.scopeM)/2,l.scopeM2=l.width-l.scopeM1}}),I(P(e),"onTouchMove",function(r){var n=e.getTouche(r),a=P(e),u=a.pos,l=a.config,c=a.player;if(!(!n||l.disableGesture||!e.duration||!u.isStart)){var f=l.miniMoveStep,h=l.hideControlsActive,d=parseInt(n.pageX-u.left,10),v=parseInt(n.pageY-u.top,10),y=c.rotateDeg===90?v:d,p=c.rotateDeg===90?d:v;if(Math.abs(y-u.x)>f||Math.abs(p-u.y)>f){var b=y-u.x,k=p-u.y,E=u.scope;if(E===-1&&(E=e.checkScope(y,p,b,k,u),E===0&&(h?c.blur():c.focus({autoHide:!1}),!u.time&&(u.time=parseInt(c.currentTime*1e3,10)+e.timeOffset*1e3)),u.scope=E),E===-1||E>0&&!l.gestureY||E===0&&!l.gestureX)return;e.executeMove(b,k,E,u.width,u.height),u.x=y,u.y=p}}}),I(P(e),"onTouchEnd",function(r){var n=P(e),a=n.player,u=n.pos,l=n.playerConfig;if(setTimeout(function(){a.getPlugin("progress")&&a.getPlugin("progress").resetSeekState()},10),!!u.isStart){u.scope>-1&&r.cancelable&&r.preventDefault();var c=e.config,f=c.disableGesture,h=c.gestureX;!f&&h?e.endLastMove(u.scope):u.time=0,u.scope=-1,e.resetPos(),g.checkIsFunction(l.enableSwipeHandler)&&l.enableSwipeHandler(),e.changeAction(Xt.AUTO)}}),I(P(e),"onRootTouchMove",function(r){e.config.disableGesture||!e.config.gestureX||e.checkIsRootTarget(r)&&(r.stopPropagation(),e.pos.isStart?e.onTouchMove(r):e.onTouchStart(r))}),I(P(e),"onRootTouchEnd",function(r){e.pos.scope>-1&&e.onTouchEnd(r)}),e.pos={isStart:!1,x:0,y:0,time:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1},e.timer=null,e}return q(i,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"registerIcons",value:function(){return{seekTipIcon:{icon:Nu,class:"xg-seek-pre"}}}},{key:"afterCreate",value:function(){var e=this;wr.map(function(h){e.__hooks[h]=null});var r=this.playerConfig,n=this.config,a=this.player;r.closeVideoDblclick===!0&&(n.closedbClick=!0),this.resetPos(),g.isUndefined(r.disableGesture)||(n.disableGesture=!!r.disableGesture),this.appendChild(".xg-seek-icon",this.icons.seekTipIcon),this.xgMask=g.createDom("xg-mask","",{},"xgmask"),a.root.appendChild(this.xgMask),this.initCustomStyle(),this.registerThumbnail();var u=this.domEventType==="mouse"?"mouse":"touch";this.touch=new Mu(this.root,{eventType:u,needPreventDefault:!this.config.disableGesture}),this.root.addEventListener("contextmenu",function(h){h.preventDefault()}),a.root.addEventListener("touchmove",this.onRootTouchMove,!0),a.root.addEventListener("touchend",this.onRootTouchEnd,!0),a.root.addEventListener("touchcancel",this.onRootTouchEnd,!0);var l=this.player.controls;l&&l.center&&(l.center.addEventListener("touchmove",this.onRootTouchMove,!0),l.center.addEventListener("touchend",this.onRootTouchEnd,!0),l.center.addEventListener("touchcancel",this.onRootTouchEnd,!0)),this.on(Et,function(){var h=e.player,d=e.config;h.duration>0&&h.duration*1e3<d.moveDuration&&(d.moveDuration=h.duration*1e3)}),this.on([gt,zt],function(){var h=e.pos,d=h.time,v=h.isStart;!v&&d>0&&(e.pos.time=0)});var c={touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",press:"onPress",pressend:"onPressEnd",click:"onClick",doubleclick:"onDbClick"};if(Object.keys(c).map(function(h){e.touch.on(h,function(d){e[c[h]](d)})}),!n.disableActive){var f=a.plugins.progress;f&&(f.addCallBack("dragmove",function(h){e.activeSeekNote(h.currentTime,h.forward)}),["dragend","click"].forEach(function(h){f.addCallBack(h,function(){e.changeAction(Xt.AUTO)})}))}}},{key:"registerThumbnail",value:function(){var e=this.player,r=e.plugins.thumbnail;if(r&&r.usable){this.thumbnail=r.createThumbnail(null,"mobile-thumbnail");var n=this.find(".time-preview");n.insertBefore(this.thumbnail,n.children[0])}}},{key:"initCustomStyle",value:function(){var e=this.playerConfig||{},r=e.commonStyle,n=r.playedColor,a=r.progressColor,u=r.timePreviewStyle,l=r.curTimeColor,c=r.durationColor;if(n&&(this.find(".xg-curbar").style.backgroundColor=n),a&&(this.find(".xg-bar").style.backgroundColor=a),u){var f=this.find(".time-preview");Object.keys(u).forEach(function(v){f.style[v]=u[v]})}var h=l||n,d=c;h&&(this.find(".xg-cur").style.color=h),d&&(this.find(".xg-dur").style.color=d),this.config.disableTimeProgress&&g.addClass(this.find(".xg-timebar"),"hide")}},{key:"resetPos",value:function(){var e=this;this.pos?(this.pos.isStart=!1,this.pos.scope=-1,["x","y","width","height","scopeL","scopeR","scopeM1","scopeM2"].map(function(r){e.pos[r]=0})):this.pos={isStart:!1,x:0,y:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1,time:0}}},{key:"changeAction",value:function(e){var r=this.player,n=this.root;n.setAttribute("data-xg-action",e);var a=r.plugins.start;a&&a.recover()}},{key:"getTouche",value:function(e){var r=this.player.rotateDeg,n=e.touches&&e.touches.length>0?e.touches[e.touches.length-1]:e;return r===0?{pageX:n.pageX,pageY:n.pageY}:{pageX:n.pageX,pageY:n.pageY}}},{key:"checkScope",value:function(e,r,n,a,u){var l=u.width,c=-1;if(e<0||e>l)return c;var f=Math.abs(a===0?n:n/a);return Math.abs(n)>0&&f>=1.73&&e>u.scopeM1&&e<u.scopeM2?c=0:(Math.abs(n)===0||f<=.57)&&(c=e<u.scopeL?1:e>u.scopeR?2:3),c}},{key:"executeMove",value:function(e,r,n,a,u){switch(n){case 0:this.updateTime(e/a*this.config.scopeM);break;case 1:this.updateBrightness(r/u);break;case 2:ue.os.isIos||this.updateVolume(r/u);break}}},{key:"endLastMove",value:function(e){var r=this,n=this.pos,a=this.player,u=this.config,l=(n.time-this.timeOffset)/1e3;switch(e){case 0:a.seek(Number(l).toFixed(1)),u.hideControlsEnd?a.blur():a.focus(),this.timer=setTimeout(function(){r.pos.time=0},500);break}this.changeAction(Xt.AUTO)}},{key:"checkIsRootTarget",value:function(e){var r=this.player.plugins||{};return r.progress&&r.progress.root.contains(e.target)?!1:r.start&&r.start.root.contains(e.target)||r.controls&&r.controls.root.contains(e.target)}},{key:"sendUseAction",value:function(e){var r=this.player.paused;this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:r,to:!r})}},{key:"clickHandler",value:function(e){var r=this.player,n=this.config,a=this.playerConfig;if(r.state<ve.RUNNING){a.closeVideoClick||(this.sendUseAction(g.createEvent("click")),r.play());return}!n.closedbClick||a.closeVideoClick?r.isActive?r.blur():r.focus():a.closeVideoClick||((r.isActive||n.focusVideoClick)&&(this.sendUseAction(g.createEvent("click")),this.switchPlayPause()),r.focus())}},{key:"dbClickHandler",value:function(e){var r=this.config,n=this.player;!r.closedbClick&&n.state>=ve.RUNNING&&(this.sendUseAction(g.createEvent("dblclick")),this.switchPlayPause())}},{key:"onClick",value:function(e){var r=this,n=this.player;ft(this,wr[0],function(a,u){r.clickHandler(u.e)},{e,paused:n.paused})}},{key:"onDbClick",value:function(e){var r=this,n=this.player;ft(this,wr[1],function(a,u){r.dbClickHandler(u.e)},{e,paused:n.paused})}},{key:"onPress",value:function(e){var r=this.pos,n=this.config,a=this.player;n.disablePress||(r.rate=this.player.playbackRate,this.emitUserAction("press","change_rate",{prop:"playbackRate",from:a.playbackRate,to:n.pressRate}),a.playbackRate=n.pressRate,this.changeAction(Xt.PLAYBACK))}},{key:"onPressEnd",value:function(e){var r=this.pos,n=this.config,a=this.player;n.disablePress||(this.emitUserAction("pressend","change_rate",{prop:"playbackRate",from:a.playbackRate,to:r.rate}),a.playbackRate=r.rate,r.rate=1,this.changeAction(Xt.AUTO))}},{key:"updateTime",value:function(e){var r=this.player,n=this.config,a=this.player.duration;e=Number(e.toFixed(4));var u=parseInt(e*n.moveDuration,10)+this.timeOffset;u+=this.pos.time,u=u<0?0:u>a*1e3?a*1e3-200:u,r.getPlugin("time")&&r.getPlugin("time").updateTime(u/1e3),r.getPlugin("progress")&&r.getPlugin("progress").updatePercent(u/1e3/this.duration,!0),this.activeSeekNote(u/1e3,e>0),n.isTouchingSeek&&r.seek(Number((u-this.timeOffset)/1e3).toFixed(1)),this.pos.time=u}},{key:"updateVolume",value:function(e){this.player.rotateDeg&&(e=-e);var r=this.player,n=this.pos;if(e=parseInt(e*100,10),n.volume+=e,!(Math.abs(n.volume)<10)){var a=parseInt(r.volume*10,10)-parseInt(n.volume/10,10);a=a>10?10:a<1?0:a,r.volume=a/10,n.volume=0}}},{key:"updateBrightness",value:function(e){var r=this.pos,n=this.config,a=this.xgMask;if(n.darkness){this.player.rotateDeg&&(e=-e);var u=r.light+.8*e;u=u>n.maxDarkness?n.maxDarkness:u<0?0:u,a&&(a.style.backgroundColor="rgba(0,0,0,".concat(u,")")),r.light=u}}},{key:"activeSeekNote",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=this.player,a=this.config,u=!(this.duration!==1/0&&this.duration>0);if(!(!e||typeof e!="number"||u||a.disableActive)){e<0?e=0:e>n.duration&&(e=n.duration-.2),this.changeAction(Xt.SEEKING);var l=n.plugins.start;l&&l.focusHide(),this.find(".xg-dur").innerHTML=g.format(this.duration),this.find(".xg-cur").innerHTML=g.format(e),this.find(".xg-curbar").style.width="".concat(e/this.duration*100,"%"),r?g.removeClass(this.find(".xg-seek-show"),"xg-back"):g.addClass(this.find(".xg-seek-show"),"xg-back"),this.updateThumbnails(e)}}},{key:"updateThumbnails",value:function(e){var r=this.player,n=r.plugins.thumbnail;n&&n.usable&&this.thumbnail&&n.update(this.thumbnail,e,160,90)}},{key:"switchPlayPause",value:function(){var e=this.player;if(e.state<ve.ATTACHED)return!1;e.ended||(e.paused?e.play():e.pause())}},{key:"disableGesture",value:function(){this.config.disableGesture=!0}},{key:"enableGesture",value:function(){this.config.disableGesture=!1}},{key:"destroy",value:function(){var e=this.player;this.timer&&clearTimeout(this.timer),this.thumbnail=null,e.root.removeChild(this.xgMask),this.xgMask=null,this.touch&&this.touch.destroy(),this.touch=null,e.root.removeEventListener("touchmove",this.onRootTouchMove,!0),e.root.removeEventListener("touchend",this.onRootTouchEnd,!0),e.root.removeEventListener("touchcancel",this.onRootTouchEnd,!0);var r=this.player.controls;r&&r.center&&(r.center.removeEventListener("touchmove",this.onRootTouchMove,!0),r.center.removeEventListener("touchend",this.onRootTouchEnd,!0),r.center.removeEventListener("touchcancel",this.onRootTouchEnd,!0))}},{key:"render",value:function(){var e=this.config.gradient!=="normal"?"gradient ".concat(this.config.gradient):"gradient";return`
     <xg-trigger class="trigger">
     <div class="`.concat(e,`"></div>
        <div class="time-preview">
            <div class="xg-seek-show `).concat(this.config.disableSeekIcon?" hide-seek-icon":"",`">
              <i class="xg-seek-icon"></i>
              <span class="xg-cur">00:00</span>
              <span class="xg-separator">/</span>
              <span class="xg-dur">00:00</span>
            </div>
              <div class="xg-bar xg-timebar">
                <div class="xg-curbar"></div>
              </div>
        </div>
        <div class="xg-playbackrate xg-top-note">
            <span><i>`).concat(this.config.pressRate,"X</i>").concat(this.i18n.FORWARD,`</span>
        </div>
     </xg-trigger>
    `)}}],[{key:"pluginName",get:function(){return"mobile"}},{key:"defaultConfig",get:function(){return{index:0,disableGesture:!1,gestureX:!0,gestureY:!0,gradient:"normal",isTouchingSeek:!1,miniMoveStep:5,miniYPer:5,scopeL:.25,scopeR:.25,scopeM:.9,pressRate:2,darkness:!0,maxDarkness:.8,disableActive:!1,disableTimeProgress:!1,hideControlsActive:!1,hideControlsEnd:!1,moveDuration:360*1e3,closedbClick:!1,disablePress:!0,disableSeekIcon:!1,focusVideoClick:!1}}}]),i})(pe);function Bu(s){s.preventDefault(),s.returnValue=!1}function ca(s){var o=s.tagName;return!!(o==="INPUT"||o==="TEXTAREA"||s.isContentEditable)}var fa=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"onBodyKeyDown",function(a){if(t.player){var u=a||window.event,l=u.keyCode,c=P(t),f=c._keyState,h=c.player,d=t.config,v=d.disable,y=d.disableBodyTrigger,p=d.isIgnoreUserActive;if(v||y||!(h.isUserActive||p)||ca(u.target)||!t.checkIsVisible()||u.metaKey||u.altKey||u.ctrlKey){f.isBodyKeyDown=!1;return}!a.repeat&&!f.isKeyDown&&((u.target===document.body||t.config.isGlobalTrigger&&!ca(u.target))&&t.checkCode(l,!0)&&(f.isBodyKeyDown=!0),document.addEventListener("keyup",t.onBodyKeyUp)),f.isBodyKeyDown&&t.handleKeyDown(u)}}),I(P(t),"onBodyKeyUp",function(a){t.player&&(document.removeEventListener("keyup",t.onBodyKeyUp),t.handleKeyUp(a))}),I(P(t),"onKeydown",function(a){if(t.player){var u=a||window.event,l=P(t),c=l._keyState;if(!u.repeat){if(t.config.disable||t.config.disableRootTrigger||u.metaKey||u.altKey||u.ctrlKey)return;u&&(u.keyCode===37||t.checkCode(u.keyCode))&&(u.target===t.player.root||u.target===t.player.video||u.target===t.player.controls.el)&&(c.isKeyDown=!0),t.player.root.addEventListener("keyup",t.onKeyup)}c.isKeyDown&&t.handleKeyDown(u)}}),I(P(t),"onKeyup",function(a){t.player&&(t.player.root.removeEventListener("keyup",t.onKeyup),t.handleKeyUp(a))}),t}return q(i,[{key:"mergekeyCodeMap",value:function(){var e=this,r=this.config.keyCodeMap;r&&Object.keys(r).map(function(n){e.keyCodeMap[n]?["keyCode","action","disable","pressAction","disablePress","isBodyTarget"].map(function(a){r[n][a]&&(e.keyCodeMap[n][a]=r[n][a])}):e.keyCodeMap[n]=r[n]})}},{key:"afterCreate",value:function(){this.config.disable=!this.playerConfig.keyShortcut;var e=typeof this.config.seekStep=="function"?this.config.seekStep(this.player):this.config.seekStep;!e||typeof e!="number"||(this.seekStep=e),this.keyCodeMap={space:{keyCode:32,action:"playPause",disable:!1,disablePress:!1,noBodyTarget:!1},up:{keyCode:38,action:"upVolume",disable:!1,disablePress:!1,noBodyTarget:!0},down:{keyCode:40,action:"downVolume",disable:!1,disablePress:!1,noBodyTarget:!0},left:{keyCode:37,action:"seekBack",disablePress:!1,disable:!1},right:{keyCode:39,action:"seek",pressAction:"changePlaybackRate",disablePress:!1,disable:!1},esc:{keyCode:27,action:"exitFullscreen",disablePress:!0,disable:!1}},this.mergekeyCodeMap(),this._keyState={isKeyDown:!1,isBodyKeyDown:!1,isPress:!1,tt:0,playbackRate:0},this.player.root.addEventListener("keydown",this.onKeydown),document.addEventListener("keydown",this.onBodyKeyDown)}},{key:"setConfig",value:function(e){var r=this;Object.keys(e).forEach(function(n){r.config[n]=e[n]})}},{key:"checkIsVisible",value:function(){if(!this.config.checkVisible)return!0;var e=this.player.root.getBoundingClientRect(),r=e.height,n=e.top,a=e.bottom,u=window.innerHeight;return!(n<0&&n<0-r*.9||a>0&&a-u>r*.9)}},{key:"checkCode",value:function(e,r){var n=this,a=!1;return Object.keys(this.keyCodeMap).map(function(u){n.keyCodeMap[u]&&e===n.keyCodeMap[u].keyCode&&!n.keyCodeMap[u].disable&&(a=!r||r&&!n.keyCodeMap[u].noBodyTarget)}),a}},{key:"downVolume",value:function(e){var r=this.player;if(!(r.volume<=0)){var n=parseFloat((r.volume-.1).toFixed(1)),a={volume:{from:r.volume,to:n}};this.emitUserAction(e,"change_volume",{props:a}),n>=0?r.volume=n:r.volume=0}}},{key:"upVolume",value:function(e){var r=this.player;if(!(r.volume>=1)){var n=parseFloat((r.volume+.1).toFixed(1)),a={volume:{from:r.volume,to:n}};this.emitUserAction(e,"change_volume",{props:a}),n<=1?r.volume=n:r.volume=1}}},{key:"seek",value:function(e){var r=this.player,n=r.currentTime,a=r.offsetCurrentTime,u=r.duration,l=r.offsetDuration,c=r.timeSegments,f=a>-1?a:n,h=l||u,d=e.repeat&&this.seekStep>=4?parseInt(this.seekStep/2,10):this.seekStep;f+d<=h?f=f+d:f=h;var v=g.getCurrentTimeByOffset(f,c),y={currentTime:{from:n,to:v}};this.emitUserAction(e,"seek",{props:y}),this.player.currentTime=v}},{key:"seekBack",value:function(e){var r=this.player,n=r.currentTime,a=r.offsetCurrentTime,u=r.timeSegments,l=e.repeat?parseInt(this.seekStep/2,10):this.seekStep,c=a>-1?a:n,f=c-l;f<0&&(f=0),f=g.getCurrentTimeByOffset(f,u);var h={currentTime:{from:n,to:f}};this.emitUserAction(e,"seek",{props:h}),this.player.currentTime=f}},{key:"changePlaybackRate",value:function(e){var r=this._keyState,n=this.config,a=this.player;r.playbackRate===0&&(r.playbackRate=a.playbackRate,a.playbackRate=n.playbackRate)}},{key:"playPause",value:function(e){var r=this.player;r&&(this.emitUserAction(e,"switch_play_pause"),r.paused?r.play():r.pause())}},{key:"exitFullscreen",value:function(e){var r=this.player,n=r.fullscreen,a=r.cssfullscreen;n&&(this.emitUserAction("keyup","switch_fullscreen",{prop:"fullscreen",from:n,to:!n}),r.exitFullscreen()),a&&(this.emitUserAction("keyup","switch_css_fullscreen",{prop:"cssfullscreen",from:a,to:!a}),r.exitCssFullscreen())}},{key:"handleKeyDown",value:function(e){var r=this._keyState;if(e.repeat){r.isPress=!0;var n=Date.now();if(n-r.tt<200)return;r.tt=n}this.handleKeyCode(e.keyCode,e,r.isPress)}},{key:"handleKeyUp",value:function(e){var r=this._keyState;r.playbackRate>0&&(this.player.playbackRate=r.playbackRate,r.playbackRate=0),r.isKeyDown=!1,r.isPress=!1,r.tt=0}},{key:"handleKeyCode",value:function(e,r,n){for(var a=Object.keys(this.keyCodeMap),u=0;u<a.length;u++){var l=this.keyCodeMap[a[u]],c=l.action,f=l.keyCode,h=l.disable,d=l.pressAction,v=l.disablePress;if(f===e){if(!h&&!(n&&v)){var y=n&&d||c;typeof y=="function"?c(r,this.player,n):typeof y=="string"&&typeof this[y]=="function"&&this[y](r,this.player,n),this.emit(ss,Ae({key:a[u],target:r.target,isPress:n},this.keyCodeMap[a[u]]))}Bu(r),r.stopPropagation();break}}}},{key:"destroy",value:function(){this.player.root.removeEventListener("keydown",this.onKeydown),document.removeEventListener("keydown",this.onBodyKeyDown),this.player.root.removeEventListener("keyup",this.onKeyup),document.removeEventListener("keyup",this.onBodyKeyUp)}},{key:"disable",value:function(){this.config.disable=!0}},{key:"enable",value:function(){this.config.disable=!1}}],[{key:"pluginName",get:function(){return"keyboard"}},{key:"defaultConfig",get:function(){return{seekStep:10,checkVisible:!1,disableBodyTrigger:!1,disableRootTrigger:!1,isGlobalTrigger:!0,keyCodeMap:{},disable:!1,playbackRate:2,isIgnoreUserActive:!0}}}]),i})(tt);function Uu(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="-5 -5 110 110">
  <path d="M100,50A50,50,0,1,1,50,0" stroke-width="5" stroke="#ddd" stroke-dasharray="236" fill="none"></path>
</svg>
`,"image/svg+xml").firstChild}var Hu=(function(s){J(i,s);var o=ee(i);function i(){return X(this,i),o.apply(this,arguments)}return q(i,[{key:"registerIcons",value:function(){return{loadingIcon:Uu}}},{key:"afterCreate",value:function(){this.appendChild("xg-loading-inner",this.icons.loadingIcon)}},{key:"render",value:function(){return`
    <xg-loading class="xgplayer-loading">
      <xg-loading-inner></xg-loading-inner>
    </xg-loading>`}}],[{key:"pluginName",get:function(){return"loading"}},{key:"defaultConfig",get:function(){return{position:Ee.ROOT}}}]),i})(pe),Vu=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"_onDurationChange",function(){t.updateSegments();var a=t.player,u=a.currentTime,l=a.timeSegments;if(t._checkIfEnabled(l)){var c=g.getIndexByTime(u,l),f=g.getOffsetCurrentTime(u,l,c);t.player.offsetCurrentTime=f,t.changeIndex(c,l)}}),I(P(t),"_onLoadedData",function(){var a=t.player.timeSegments;if(t._checkIfEnabled(a)){var u=g.getOffsetCurrentTime(0,a);t.player.offsetCurrentTime=u,t.changeIndex(0,a),t.curPos.start>0&&(t.player.currentTime=t.curPos.start)}}),I(P(t),"_onTimeupdate",function(){var a=t.player,u=a.currentTime,l=a.timeSegments;if(t._checkIfEnabled(l)){var c=l.length;t.lastCurrentTime=u;var f=g.getIndexByTime(u,l);f!==t.curIndex&&t.changeIndex(f,l);var h=g.getOffsetCurrentTime(u,l,f);if(t.player.offsetCurrentTime=h,!!t.curPos){var d=t.curPos,v=d.start,y=d.end;u<v?t.player.currentTime=v:u>y&&f>=c-1&&t.player.pause()}}}),I(P(t),"_onSeeking",function(){var a=t.player,u=a.currentTime,l=a.timeSegments;if(t._checkIfEnabled(l))if(u<l[0].start)t.player.currentTime=l[0].start;else if(u>l[l.length-1].end)t.player.currentTime=l[l.length-1].end;else{var c=g.getIndexByTime(u,l);if(c>=0){var f=t.getSeekTime(u,t.lastCurrentTime,c,l);f>=0&&(t.player.currentTime=f)}}}),I(P(t),"_onPlay",function(){var a=t.player,u=a.currentTime,l=a.timeSegments;t._checkIfEnabled(l)&&u>=l[l.length-1].end&&(t.player.currentTime=l[0].start)}),t}return q(i,[{key:"afterCreate",value:function(){this.curIndex=-1,this.curPos=null,this.lastCurrentTime=0,this.updateSegments(),this.on(Et,this._onDurationChange),this.on(bt,this._onLoadedData),this.on(qe,this._onTimeupdate),this.on(rr,this._onSeeking),this.on(Qe,this._onPlay)}},{key:"setConfig",value:function(e){var r=this;if(e){var n=Object.keys(e);n.length<1||(n.forEach(function(a){r.config[a]=e[a]}),this.updateSegments())}}},{key:"updateSegments",value:function(){var e=this.config,r=e.disable,n=e.segments,a=this.player;if(r||!n||n.length===0)a.timeSegments=[],a.offsetDuration=0,a.offsetCurrentTime=-1;else{var u=this.formatTimeSegments(n,a.duration);a.timeSegments=u,a.offsetDuration=u.length>0?u[u.length-1].duration:0}}},{key:"formatTimeSegments",value:function(e,r){var n=[];return e?(e.sort(function(a,u){return a.start-u.start}),e.forEach(function(a,u){var l={};if(l.start=a.start<0?0:a.start,l.end=r>0&&a.end>r?r:a.end,!(r>0&&l.start>r)){n.push(l);var c=l.end-l.start;if(u===0)l.offset=a.start,l.cTime=0,l.segDuration=c,l.duration=c;else{var f=n[u-1];l.offset=f.offset+(l.start-f.end),l.cTime=f.duration+f.cTime,l.segDuration=c,l.duration=f.duration+c}}}),n):[]}},{key:"getSeekTime",value:function(e,r,n,a){var u=-1,l=a[n],c=l.start,f=l.end;if(e>=c&&e<=f)return u;var h=e-r;if(h<0&&e<c){var d=r>c?r-c:0;return u=n-1>=0?a[n-1].end+h+d:0,u}return-1}},{key:"_checkIfEnabled",value:function(e){return!(!e||e.length<1)}},{key:"changeIndex",value:function(e,r){this.curIndex=e,e>=0&&r.length>0?this.curPos=r[e]:this.curPos=null}}],[{key:"pluginName",get:function(){return"TimeSegmentsControls"}},{key:"defaultConfig",get:function(){return{disable:!0,segments:[]}}}]),i})(tt);function Gu(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="-4 -6 40 40" fill="none">
  <g>
    <path transform="scale(1.5 1.5)" d="M11.6665 9.16663H4.1665C2.78579 9.16663 1.6665 10.2859 1.6665 11.6666V15.8333C1.6665 17.214 2.78579 18.3333 4.1665 18.3333H11.6665C13.0472 18.3333 14.1665 17.214 14.1665 15.8333V11.6666C14.1665 10.2859 13.0472 9.16663 11.6665 9.16663Z" fill="white"/>
    <path transform="scale(1.5 1.5)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88148 4.06298C3.75371 4.21005 3.67667 4.40231 3.67749 4.61242C3.67847 4.87253 3.79852 5.10435 3.98581 5.25646L6.99111 8.05895C7.32771 8.37283 7.85502 8.35443 8.16891 8.01782C8.48279 7.68122 8.46437 7.15391 8.12778 6.84003L6.62061 5.43457L9.8198 5.4224C9.82848 5.42239 9.8372 5.42221 9.84591 5.4219C10.9714 5.38233 12.0885 5.6285 13.0931 6.13744C14.0976 6.64635 14.957 7.40148 15.5908 8.33234C16.2246 9.2632 16.6122 10.3394 16.7177 11.4606C16.823 12.5819 16.6427 13.7115 16.1934 14.7442C16.0098 15.1661 16.203 15.6571 16.6251 15.8408C17.0471 16.0243 17.5381 15.8311 17.7216 15.4091C18.2833 14.1183 18.5087 12.7063 18.3771 11.3047C18.2453 9.90318 17.7607 8.55792 16.9684 7.39433C16.1761 6.23073 15.1021 5.28683 13.8463 4.65065C12.5946 4.01651 11.203 3.70872 9.80072 3.75583L6.43415 3.76862L7.96326 2.12885C8.27715 1.79225 8.25872 1.26494 7.92213 0.951061C7.58553 0.63718 7.05822 0.655585 6.74433 0.99219L3.90268 4.0395C3.89545 4.04724 3.88841 4.05509 3.88154 4.06303L3.88148 4.06298Z" fill="white"/>
  </g>
  <defs>
    <clipPath>
      <rect width="40" height="40" fill="white"/>
    </clipPath>
  </defs>
</svg>
`,"image/svg+xml").firstChild}var ju=(function(s){J(i,s);var o=ee(i);function i(t){var e;return X(this,i),e=o.call(this,t),e.rotateDeg=e.config.rotateDeg||0,e}return q(i,[{key:"afterCreate",value:function(){var e=this;if(!this.config.disable){se(re(i.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.rotate),this.onBtnClick=this.onBtnClick.bind(this),this.bind(".xgplayer-icon",["click","touchend"],this.onBtnClick),this.on(Dt,function(){e.rotateDeg&&e.config.innerRotate&&g.setTimeout(e,function(){e.updateRotateDeg(e.rotateDeg,e.config.innerRotate)},100)});var r=this.player.root;this.rootWidth=r.style.width||r.offsetWidth||r.clientWidth,this.rootHeight=r.style.height||r.offsetHeight||r.clientHeight,this.rotateDeg&&this.updateRotateDeg(this.rotateDeg,this.config.innerRotate)}}},{key:"destroy",value:function(){se(re(i.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",["click","touchend"],this.onBtnClick)}},{key:"onBtnClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"rotate"),this.rotate(this.config.clockwise,this.config.innerRotate,1)}},{key:"updateRotateDeg",value:function(e,r){if(e||(e=0),r){this.player.videoRotateDeg=e;return}var n=this.player,a=this.rootWidth,u=this.rootHeight,l=n.root,c=n.innerContainer,f=n.media,h=l.offsetWidth,d=c&&r?c.offsetHeight:l.offsetHeight,v=a,y=u,p=0,b=0;(e===.75||e===.25)&&(v="".concat(d,"px"),y="".concat(h,"px"),p=-(d-h)/2,b=-(h-d)/2);var k="translate(".concat(p,"px,").concat(b,"px) rotate(").concat(e,"turn)"),E={transformOrigin:"center center",transform:k,webKitTransform:k,height:y,width:v},w=r?f:l,T=r?n.getPlugin("poster"):null;Object.keys(E).map(function(L){w.style[L]=E[L],T&&T.root&&(T.root.style[L]=E[L])})}},{key:"rotate",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=this.player;this.rotateDeg||(this.rotateDeg=0);var u=e?1:-1;this.rotateDeg=(this.rotateDeg+1+u*.25*n)%1,this.updateRotateDeg(this.rotateDeg,r),a.emit(ns,this.rotateDeg*360)}},{key:"registerIcons",value:function(){return{rotate:Gu}}},{key:"render",value:function(){if(!this.config.disable)return`
    <xg-icon class="xgplayer-rotate">
      <div class="xgplayer-icon">
      </div>
      `.concat(Pt(this,"ROTATE_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"rotate"}},{key:"defaultConfig",get:function(){return{position:Ee.CONTROLS_RIGHT,index:6,innerRotate:!0,clockwise:!1,rotateDeg:0,disable:!1}}}]),i})(Kt);function zu(){return new DOMParser().parseFromString(`<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"
    fill="white" />
</svg>`,"image/svg+xml").firstChild}function Wu(){return new DOMParser().parseFromString(`<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd"
    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"
    fill="white" />
  <path fill-rule="evenodd" clip-rule="evenodd"
    d="M9.4998 7.7C9.77595 7.7 9.9998 7.47614 9.9998 7.2V6.5C9.9998 6.22386 9.77595 6 9.4998 6H5.5402L5.52754 6.00016H5.5C5.22386 6.00016 5 6.22401 5 6.50016V10.4598C5 10.7359 5.22386 10.9598 5.5 10.9598H6.2C6.47614 10.9598 6.7 10.7359 6.7 10.4598V8.83005L8.76983 10.9386C8.96327 11.1357 9.27984 11.1386 9.47691 10.9451L9.97645 10.4548C10.1735 10.2613 10.1764 9.94476 9.983 9.7477L7.97289 7.7H9.4998Z"
    fill="white" />
</svg>`,"image/svg+xml").firstChild}var qt={PIP:"picture-in-picture",INLINE:"inline",FULLSCREEN:"fullscreen"},$u=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"switchPIP",function(a){if(!t.isPIPAvailable())return!1;a.stopPropagation&&a.stopPropagation(),t.isPip?(t.exitPIP(),t.emitUserAction(a,"change_pip",{props:"pip",from:!0,to:!1}),t.setAttr("data-state","normal")):t.player.media.readyState===4&&(t.requestPIP(),t.emitUserAction(a,"change_pip",{props:"pip",from:!1,to:!0}),t.setAttr("data-state","pip"))}),t}return q(i,[{key:"beforeCreate",value:function(e){typeof e.player.config.pip=="boolean"&&(e.config.showIcon=e.player.config.pip)}},{key:"afterCreate",value:function(){var e=this;this.isPIPAvailable()&&(se(re(i.prototype),"afterCreate",this).call(this),this.pMode=qt.INLINE,this.initPipEvents(),this.config.showIcon&&this.initIcons(),this.once(nr,function(){e.config.showIcon&&(g.removeClass(e.find(".xgplayer-icon"),"xg-icon-disable"),e.bind("click",e.switchPIP))}))}},{key:"registerIcons",value:function(){return{pipIcon:{icon:zu,class:"xg-get-pip"},pipIconExit:{icon:Wu,class:"xg-exit-pip"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.pipIcon),this.appendChild(".xgplayer-icon",e.pipIconExit)}},{key:"initPipEvents",value:function(){var e=this,r=this.player;this.leavePIPCallback=function(){var n=r.paused;g.setTimeout(e,function(){!n&&r.mediaPlay()},0),!n&&r.mediaPlay(),e.setAttr("data-state","normal"),e.pipWindow=null,r.emit(Kr,!1)},this.enterPIPCallback=function(n){r.emit(Kr,!0),n!=null&&n.pictureInPictureWindow&&(e.pipWindow=n.pictureInPictureWindow),e.setAttr("data-state","pip")},this.onWebkitpresentationmodechanged=function(n){var a=r.media.webkitPresentationMode;e.pMode===qt.FULLSCREEN&&a!==qt.FULLSCREEN&&r.onFullscreenChange(null,!1),e.pMode=a,a===qt.PIP?e.enterPIPCallback(n):a===qt.INLINE&&e.leavePIPCallback(n)},r.media&&(r.media.addEventListener("enterpictureinpicture",this.enterPIPCallback),r.media.addEventListener("leavepictureinpicture",this.leavePIPCallback),i.checkWebkitSetPresentationMode(r.media)&&r.media.addEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged))}},{key:"copyStyleIntoPiPWindow",value:function(e){var r=nt(document.styleSheets).map(function(a){try{return nt(a.cssRules).map(function(l){return l.cssText}).join("")}catch{var u=document.createElement("link");u.rel="stylesheet",u.type=a.type,u.media=a.media,u.href=a.href,e.document.head.appendChild(u)}return""}).filter(Boolean).join(`
`),n=document.createElement("style");n.textContent=r,e.document.head.appendChild(n)}},{key:"requestPIP",value:function(){var e=this,r=this.player,n=this.playerConfig,a=this.config;if(!(!this.isPIPAvailable()||this.isPip))try{var u=n.poster;if(u&&(r.media.poster=g.typeOf(u)==="String"?u:u.poster),a.preferDocument&&this.isDocPIPAvailable()){var l={};if(a.width&&a.height)l.width=a.width,l.height=a.height;else{var c=r.root.getBoundingClientRect();l.width=c.width,l.height=c.height}documentPictureInPicture.requestWindow(l).then(function(f){var h=a.docPiPNode,d=a.docPiPStyle;e.enterPIPCallback();var v=h||r.root,y=v.parentElement,p=v.previousSibling,b=v.nextSibling;e.copyStyleIntoPiPWindow(f);var k=document.createElement("style");if(k.append("body{padding:0; margin:0;}"),d){var E="";typeof d=="string"?E=d:typeof d=="function"&&(E=d.call(a)),E&&k.append(E)}else v===r.root&&k.append(`
              .xgplayer{width: 100%!important; height: 100%!important;}
            `);f.document.head.append(k),f.document.body.append(v),f.addEventListener("pagehide",function(w){y&&(b?y.insertBefore(v,b):p?y.insertBefore(v,p.nextSibling):y.appendChild(v)),e.leavePIPCallback()},{once:!0})})}else i.checkWebkitSetPresentationMode(r.media)?r.media.webkitSetPresentationMode("picture-in-picture"):r.media.requestPictureInPicture();return!0}catch(f){return console.error("requestPiP",f),!1}}},{key:"exitPIP",value:function(){var e=this.player;try{if(this.isPIPAvailable()&&this.isPip){var r;this.isDocPIPAvailable()&&(r=documentPictureInPicture)!==null&&r!==void 0&&r.window?documentPictureInPicture.window.close():i.checkWebkitSetPresentationMode(e.media)?e.media.webkitSetPresentationMode("inline"):document.exitPictureInPicture()}return!0}catch(n){return console.error("exitPIP",n),!1}}},{key:"isPip",get:function(){var e,r=this.player;return!!(this.isDocPIPAvailable()&&(e=documentPictureInPicture)!==null&&e!==void 0&&e.window)||document.pictureInPictureElement&&document.pictureInPictureElement===r.media||r.media.webkitPresentationMode===qt.PIP}},{key:"isPIPAvailable",value:function(){var e=this.player.media,r=g.typeOf(document.pictureInPictureEnabled)==="Boolean"?document.pictureInPictureEnabled:!1;return r&&(g.typeOf(e.disablePictureInPicture)==="Boolean"&&!e.disablePictureInPicture||e.webkitSupportsPresentationMode&&g.typeOf(e.webkitSetPresentationMode)==="Function")||this.isDocPIPAvailable()}},{key:"isDocPIPAvailable",value:function(){return"documentPictureInPicture"in window&&/^(https|file)/.test(location.protocol)}},{key:"destroy",value:function(){se(re(i.prototype),"destroy",this).call(this);var e=this.player;e.media.removeEventListener("enterpictureinpicture",this.enterPIPCallback),e.media.removeEventListener("leavepictureinpicture",this.leavePIPCallback),i.checkWebkitSetPresentationMode(e.media)&&e.media.removeEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged),this.exitPIP(),this.unbind("click",this.btnClick)}},{key:"render",value:function(){if(!(!this.config.showIcon||!this.isPIPAvailable()))return`<xg-icon class="xgplayer-pip">
      <div class="xgplayer-icon xg-icon-disable">
      </div>
      `.concat(Pt(this,"PIP",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"pip"}},{key:"defaultConfig",get:function(){return{position:Ee.CONTROLS_RIGHT,index:6,showIcon:!1,preferDocument:!1,width:void 0,height:void 0,docPiPNode:void 0,docPiPStyle:void 0}}},{key:"checkWebkitSetPresentationMode",value:function(e){return typeof e.webkitSetPresentationMode=="function"}}]),i})(Kt);function Ku(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="40" viewBox="10 0 24 40">
  <path transform="scale(0.038 0.028)" d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z"></path>
</svg>
`,"image/svg+xml").firstChild}var Yu=(function(s){J(i,s);var o=ee(i);function i(t){var e;return X(this,i),e=o.call(this,t),I(P(e),"playNext",function(r){var n=P(e),a=n.player;r.preventDefault(),r.stopPropagation(),e.idx+1<e.config.urlList.length?(e.idx++,e.nextHandler(e.config.urlList[e.idx],e.idx),a.emit($i,e.idx+1)):(e.nextHandler(),a.emit($i))}),e.idx=-1,e}return q(i,[{key:"afterCreate",value:function(){!this.config.urlList||this.config.urlList.length===0||(this.appendChild(".xgplayer-icon",this.icons.playNext),this.initEvents())}},{key:"registerIcons",value:function(){return{playNext:Ku}}},{key:"initEvents",value:function(){this.nextHandler=this.hook("nextClick",this.changeSrc);var e=ue.device==="mobile"?"touchend":"click";this.bind(e,this.playNext),this.show()}},{key:"changeSrc",value:function(e){var r=this.player;e&&(r.pause(),r.currentTime=0,r.switchURL?r.switchURL(e):r.src=e,r.config.url=e,r.play())}},{key:"destroy",value:function(){this.unbind(["touchend","click"],this.playNext)}},{key:"render",value:function(){if(!(!this.config.urlList||this.config.urlList.length===0))return`
     <xg-icon class="xgplayer-playnext">
      <div class="xgplayer-icon">
      </div>
      `.concat(Pt(this,"PLAYNEXT_TIPS",this.playerConfig.isHideTips),`
     </xg-icon>
    `)}}],[{key:"pluginName",get:function(){return"playNext"}},{key:"defaultConfig",get:function(){return{position:Ee.CONTROLS_LEFT,index:1,url:null,urlList:[]}}}]),i})(pe),Hi={exports:{}},Xu=Hi.exports,ha;function qu(){return ha||(ha=1,(function(s,o){(function(i,t){s.exports=t()})(Xu,function(){return function i(t,e,r){var n=window,a="application/octet-stream",u=r||a,l=t,c=!e&&!r&&l,f=document.createElement("a"),h=function(O){return String(O)},d=n.Blob||n.MozBlob||n.WebKitBlob||h,v=e||"download",y,p;if(d=d.call?d.bind(n):Blob,String(this)==="true"&&(l=[l,u],u=l[0],l=l[1]),c&&c.length<2048&&(v=c.split("/").pop().split("?")[0],f.href=c,f.href.indexOf(c)!==-1)){var b=new XMLHttpRequest;return b.open("GET",c,!0),b.responseType="blob",b.onload=function(O){i(O.target.response,v,a)},setTimeout(function(){b.send()},0),b}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(l))if(l.length>1024*1024*1.999&&d!==h)l=T(l),u=l.type||a;else return navigator.msSaveBlob?navigator.msSaveBlob(T(l),v):L(l);else if(/([\x80-\xff])/.test(l)){var k=0,E=new Uint8Array(l.length),w=E.length;for(k;k<w;++k)E[k]=l.charCodeAt(k);l=new d([E],{type:u})}y=l instanceof d?l:new d([l],{type:u});function T(O){var B=O.split(/[:;,]/),x=B[1],U=B[2]=="base64"?atob:decodeURIComponent,W=U(B.pop()),m=W.length,_=0,S=new Uint8Array(m);for(_;_<m;++_)S[_]=W.charCodeAt(_);return new d([S],{type:x})}function L(O,B){if("download"in f)return f.href=O,f.setAttribute("download",v),f.className="download-js-link",f.innerHTML="downloading...",f.style.display="none",document.body.appendChild(f),setTimeout(function(){f.click(),document.body.removeChild(f),B===!0&&setTimeout(function(){n.URL.revokeObjectURL(f.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(O)&&(O="data:"+O.replace(/^data:([\w\/\-\+]+)/,a)),window.open(O)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=O),!0;var x=document.createElement("iframe");document.body.appendChild(x),!B&&/^data:/.test(O)&&(O="data:"+O.replace(/^data:([\w\/\-\+]+)/,a)),x.src=O,setTimeout(function(){document.body.removeChild(x)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(y,v);if(n.URL)L(n.URL.createObjectURL(y),!0);else{if(typeof y=="string"||y.constructor===h)try{return L("data:"+u+";base64,"+n.btoa(y))}catch{return L("data:"+u+","+encodeURIComponent(y))}p=new FileReader,p.onload=function(O){L(this.result)},p.readAsDataURL(y)}return!0}})})(Hi)),Hi.exports}var Qu=qu();const Zu=dn(Qu);function Ju(){return new DOMParser().parseFromString(`<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">
  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
    <g transform="translate(-488.000000, -340.000000)" fill="#FFFFFF">
      <g id="Group-2">
        <g id="volme_big-copy" transform="translate(488.000000, 340.000000)">
          <rect id="Rectangle-18" x="11" y="4" width="2" height="12" rx="1"></rect>
          <rect id="Rectangle-2" x="3" y="18" width="18" height="2" rx="1"></rect>
          <rect id="Rectangle-2" transform="translate(4.000000, 17.500000) rotate(90.000000) translate(-4.000000, -17.500000) " x="1.5" y="16.5" width="5" height="2" rx="1"></rect><rect id="Rectangle-2-Copy-3" transform="translate(20.000000, 17.500000) rotate(90.000000) translate(-20.000000, -17.500000) " x="17.5" y="16.5" width="5" height="2" rx="1"></rect>
          <path d="M9.48791171,8.26502656 L9.48791171,14.2650266 C9.48791171,14.8173113 9.04019646,15.2650266 8.48791171,15.2650266 C7.93562696,15.2650266 7.48791171,14.8173113 7.48791171,14.2650266 L7.48791171,7.26502656 C7.48791171,6.71274181 7.93562696,6.26502656 8.48791171,6.26502656 L15.4879117,6.26502656 C16.0401965,6.26502656 16.4879117,6.71274181 16.4879117,7.26502656 C16.4879117,7.81731131 16.0401965,8.26502656 15.4879117,8.26502656 L9.48791171,8.26502656 Z" id="Combined-Shape" transform="translate(11.987912, 10.765027) scale(1, -1) rotate(45.000000) translate(-11.987912, -10.765027) "></path>
        </g>
      </g>
    </g>
  </g>
</svg>
`,"image/svg+xml").firstChild}var el=(function(s){J(i,s);var o=ee(i);function i(t){var e;return X(this,i),e=o.call(this,t),I(P(e),"download",function(r){if(!e.isLock){e.emitUserAction(r,"download");var n=e.playerConfig.url,a="";g.typeOf(n)==="String"?a=n:g.typeOf(n)==="Array"&&n.length>0&&(a=n[0].src);var u=e.getAbsoluteURL(a);Zu(u),e.isLock=!0,e.timer=window.setTimeout(function(){e.isLock=!1,window.clearTimeout(e.timer),e.timer=null},300)}}),e.timer=null,e.isLock=!1,e}return q(i,[{key:"afterCreate",value:function(){se(re(i.prototype),"afterCreate",this).call(this),!this.config.disable&&(this.appendChild(".xgplayer-icon",this.icons.download),this._handler=this.hook("click",this.download,{pre:function(r){r.preventDefault(),r.stopPropagation()}}),this.bind(["click","touchend"],this._handler))}},{key:"registerIcons",value:function(){return{download:Ju}}},{key:"getAbsoluteURL",value:function(e){if(!e.match(/^https?:\/\//)){var r=document.createElement("div");r.innerHTML='<a href="'.concat(e,'">x</a>'),e=r.firstChild.href}return e}},{key:"destroy",value:function(){se(re(i.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.download),window.clearTimeout(this.timer),this.timer=null}},{key:"render",value:function(){if(!this.config.disable)return`<xg-icon class="xgplayer-download">
   <div class="xgplayer-icon">
   </div>
   `.concat(Pt(this,"DOWNLOAD_TIPS",this.playerConfig.isHideTips),`
    </xg-icon>`)}}],[{key:"pluginName",get:function(){return"download"}},{key:"defaultConfig",get:function(){return{position:Ee.CONTROLS_RIGHT,index:3,disable:!0}}}]),i})(Kt),tl=(function(s){J(i,s);var o=ee(i);function i(){return X(this,i),o.apply(this,arguments)}return q(i,[{key:"beforeCreate",value:function(e){typeof e.player.config.screenShot=="boolean"&&(e.config.disable=!e.player.config.screenShot)}},{key:"afterCreate",value:function(){se(re(i.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.screenshotIcon);var e=this.config;this.initSize=function(r){e.fitVideo&&(e.width=r.vWidth,e.height=r.vHeight)},this.once(Dt,this.initSize)}},{key:"onPluginsReady",value:function(){this.show(),this.onClickBtn=this.onClickBtn.bind(this),this.bind(["click","touchend"],this.onClickBtn)}},{key:"saveScreenShot",value:function(e,r){var n=document.createElement("a");n.href=e,n.download=r;var a;try{typeof MouseEvent<"u"?a=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}):(a=document.createEvent("MouseEvents"),a.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null))}catch(u){console.error("MouseEvent unsupported",u)}a&&n.dispatchEvent(a)}},{key:"createCanvas",value:function(e,r){var n=document.createElement("canvas"),a=n.getContext("2d");this.canvasCtx=a,this.canvas=n,n.width=e||this.config.width,n.height=r||this.config.height,a.imageSmoothingEnabled=!0,a.imageSmoothingEnabled&&(a.imageSmoothingQuality="high")}},{key:"onClickBtn",value:function(e){var r=this;e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"shot");var n=this.config;this.shot(n.width,n.height).then(function(a){r.emit(as,a),n.saveImg&&r.saveScreenShot(a,n.name+n.format)})}},{key:"shot",value:function(e,r){var n=this,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{quality:.92,type:"image/png"},u=this.config,l=this.player,c=a.quality||u.quality,f=a.type||u.type;return new Promise(function(h,d){var v=null,y;if(l.media.canvas)v=l.media.canvas;else{n.canvas?(n.canvas.width=e||u.width,n.canvas.height=r||u.height):n.createCanvas(e,r),v=n.canvas,y=n.canvasCtx;var p=l.media.videoWidth/l.media.videoHeight,b=v.width/v.height,k=0,E=0,w=l.media.videoWidth,T=l.media.videoHeight,L,O,B,x;p>b?(B=v.width,x=v.width/p,L=0,O=Math.round((v.height-x)/2)):p===b?(B=v.width,x=v.height,L=0,O=0):p<b&&(B=v.height*p,x=v.height,L=Math.round((v.width-B)/2),O=0),y.drawImage(l.media,k,E,w,T,L,O,B,x)}var U=v.toDataURL(f,c).replace(f,"image/octet-stream");U=U.replace(/^data:image\/[^;]+/,"data:application/octet-stream"),h(U)})}},{key:"registerIcons",value:function(){return{screenshotIcon:null}}},{key:"destroy",value:function(){se(re(i.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.onClickBtn),this.off(Dt,this.initSize)}},{key:"render",value:function(){if(!this.config.disable){var e=this.icons.screenshotIcon?"xgplayer-icon":"xgplayer-icon btn-text",r="SCREENSHOT";return`
      <xg-icon class="xgplayer-shot">
      <div class="`.concat(e,`">
      `).concat(this.icons.screenshotIcon?"":'<span lang-key="'.concat(this.i18nKeys[r],'">').concat(this.i18n[r],"</span>"),`
      </div>
    </xg-icon>`)}}}],[{key:"pluginName",get:function(){return"screenShot"}},{key:"defaultConfig",get:function(){return{position:Ee.CONTROLS_RIGHT,index:5,quality:.92,type:"image/png",format:".png",width:600,height:337,saveImg:!0,fitVideo:!0,disable:!1,name:"screenshot"}}}]),i})(Kt),il=(function(){function s(o){X(this,s),this.config=o.config,this.parent=o.root,this.root=g.createDom("ul","",{},"xg-options-list xg-list-slide-scroll ".concat(this.config.className)),o.root.appendChild(this.root);var i=this.config.maxHeight;i&&this.setStyle({maxHeight:i}),this.onItemClick=this.onItemClick.bind(this),this.renderItemList();var t=this.config.domEventType==="touch"?"touchend":"click";this._delegates=pe.delegate.call(this,this.root,"li",t,this.onItemClick)}return q(s,[{key:"renderItemList",value:function(i){var t=this,e=this.config,r=this.root;i?e.data=i:i=e.data,e.style&&Object.keys(e.style).map(function(n){r.style[n]=e[n]}),i.length>0&&(this.attrKeys=Object.keys(i[0])),this.root.innerHTML="",i.map(function(n,a){var u=n.selected?"option-item selected":"option-item";n["data-index"]=a,t.root.appendChild(g.createDom("li","<span>".concat(n.showText,"</span>"),n,u))})}},{key:"onItemClick",value:function(i){i.delegateTarget||(i.delegateTarget=i.target);var t=i.delegateTarget;if(t&&g.hasClass(t,"selected"))return!1;var e=typeof this.config.onItemClick=="function"?this.config.onItemClick:null,r=this.root.querySelector(".selected");g.addClass(t,"selected"),r&&g.removeClass(r,"selected"),e(i,{from:r?this.getAttrObj(r,this.attrKeys):null,to:this.getAttrObj(t,this.attrKeys)})}},{key:"getAttrObj",value:function(i,t){if(!i||!t)return{};var e={};t.map(function(n){e[n]=i.getAttribute(n)});var r=i.getAttribute("data-index");return r&&(e.index=Number(r)),e}},{key:"show",value:function(){g.removeClass(this.root,"hide"),g.addClass(this.root,"active")}},{key:"hide",value:function(){g.removeClass(this.root,"active"),g.addClass(this.root,"hide")}},{key:"setStyle",value:function(i){var t=this;Object.keys(i).forEach(function(e){t.root.style[e]=i[e]})}},{key:"destroy",value:function(){this._delegates&&(this._delegates.map(function(i){i.destroy&&i.destroy()}),this._delegates=null),this.root.innerHTML=null,this.parent.removeChild(this.root),this.root=null}}]),s})(),ot={SIDE:"side",MIDDLE:"middle",DEFAULT:"default"},Qt={CLICK:"click",HOVER:"hover"};function rl(s,o){return s===ot.SIDE?o===Ee.CONTROLS_LEFT?"xg-side-list xg-left-side":"xg-side-list xg-right-side":""}var Rt=ue.device==="mobile",Qi=(function(s){J(i,s);var o=ee(i);function i(t){var e;return X(this,i),e=o.call(this,t),I(P(e),"onEnter",function(r){r.stopPropagation(),e.emit("icon_mouseenter",{pluginName:e.pluginName}),e.switchActiveState(r)}),I(P(e),"switchActiveState",function(r){r.stopPropagation();var n=e.config.toggleMode;n===Qt.CLICK?e.toggle(!e.isActive):e.toggle(!0)}),I(P(e),"onLeave",function(r){r.stopPropagation(),e.emit("icon_mouseleave",{pluginName:e.pluginName}),e.config.listType!==ot.SIDE&&e.isActive&&e.toggle(!1)}),I(P(e),"onListEnter",function(r){e.enterType=2}),I(P(e),"onListLeave",function(r){e.enterType=0,e.isActive&&e.toggle(!1)}),e.isIcons=!1,e.isActive=!1,e.curValue=null,e.curIndex=0,e}return q(i,[{key:"updateLang",value:function(e){this.renderItemList(this.config.list,this.curIndex)}},{key:"afterCreate",value:function(){var e=this,r=this.config;this.initIcons(),Rt=Rt||this.domEventType==="touch",Rt&&ue.device==="mobile"&&r.listType===ot.DEFAULT&&(r.listType=ot.SIDE),r.hidePortrait&&g.addClass(this.root,"portrait"),this.on([Dt,pt],function(){e._resizeList()}),this.once(gt,function(){r.list&&r.list.length>0&&(e.renderItemList(r.list),e.show())}),Rt&&this.on(gn,function(){e.isActive&&(e.optionsList&&e.optionsList.hide(),e.isActive=!1)}),Rt?(r.toggleMode=Qt.CLICK,this.activeEvent="touchend"):this.activeEvent=r.toggleMode===Qt.CLICK?"click":"mouseenter",r.toggleMode===Qt.CLICK?this.bind(this.activeEvent,this.switchActiveState):(this.bind(this.activeEvent,this.onEnter),this.bind("mouseleave",this.onLeave)),this.isIcons&&this.bind("click",this.onIconClick)}},{key:"initIcons",value:function(){var e=this,r=this.icons,n=Object.keys(r),a=!1;n.length>0&&(n.forEach(function(u){e.appendChild(".xgplayer-icon",r[u]),!a&&(a=r[u])}),this.isIcons=a),!a&&(this.appendChild(".xgplayer-icon",g.createDom("span","",{},"icon-text")),g.addClass(this.find(".xgplayer-icon"),"btn-text"))}},{key:"show",value:function(e){!this.config.list||this.config.list.length<2||g.addClass(this.root,"show")}},{key:"hide",value:function(){g.removeClass(this.root,"show")}},{key:"getTextByLang",value:function(e,r,n){if(e===void 0)return"";var a=this.config.list;!n&&(n=this.player.lang),r=!r||g.isUndefined(e[r])?"text":r,typeof e=="number"&&(e=a[e]);try{return Ve(e[r])==="object"?e[r][n]||e[r].en:e[r]}catch(u){return console.warn(u),""}}},{key:"toggle",value:function(e){if(!(e===this.isActive||this.config.disable)){var r=this.player.controls,n=this.config.listType;e?(n===ot.SIDE?r.blur():r.focus(),this.optionsList&&this.optionsList.show()):(n===ot.SIDE?r.focus():r.focusAwhile(),this.optionsList&&this.optionsList.hide()),this.isActive=e}}},{key:"onItemClick",value:function(e,r){e.stopPropagation();var n=this.config,a=n.listType,u=n.list;this.curIndex=r.to.index,this.curItem=u[this.curIndex],this.changeCurrentText();var l=this.config.isItemClickHide;(l||Rt||a===ot.SIDE)&&this.toggle(!1)}},{key:"onIconClick",value:function(e){}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,r=this.curIndex<e.length?this.curIndex:0,n=e[r];n&&(this.find(".icon-text").innerHTML=this.getTextByLang(n,"iconText"))}}},{key:"renderItemList",value:function(e,r){var n=this,a=this.config,u=this.optionsList,l=this.player;if(typeof r=="number"&&(this.curIndex=r,this.curItem=a.list[r]),u){u.renderItemList(e),this.changeCurrentText();return}var c={config:{data:e||[],className:rl(a.listType,a.position),onItemClick:function(y,p){n.onItemClick(y,p)},domEventType:Rt?"touch":"mouse"},root:a.listType===ot.SIDE?l.innerContainer||l.root:this.root};if(this.config.isShowIcon){var f=this.player.root.getBoundingClientRect(),h=f.height,d=a.listType===ot.MIDDLE?h-50:h;d&&a.heightLimit&&(c.config.maxHeight="".concat(d,"px")),this.optionsList=new il(c),this.changeCurrentText(),this.show()}this._resizeList()}},{key:"_resizeList",value:function(){if(this.config.heightLimit){var e=this.player.root.getBoundingClientRect(),r=e.height,n=this.config.listType===ot.MIDDLE?r-50:r;this.optionsList&&this.optionsList.setStyle({maxHeight:"".concat(n,"px")})}}},{key:"destroy",value:function(){var e=this.config;e.toggleMode===Qt.CLICK?this.unbind(this.activeEvent,this.switchActiveState):(this.unbind(this.activeEvent,this.onEnter),this.unbind("mouseleave",this.onLeave)),this.isIcons&&this.unbind("click",this.onIconClick),this.optionsList&&(this.optionsList.destroy(),this.optionsList=null)}},{key:"render",value:function(){if(this.config.isShowIcon)return'<xg-icon class="xg-options-icon '.concat(this.config.className||"",`">
    <div class="xgplayer-icon">
    </div>
   </xg-icon>`)}}],[{key:"pluginName",get:function(){return"optionsIcon"}},{key:"defaultConfig",get:function(){return{position:Ee.CONTROLS_RIGHT,index:100,list:[],listType:"default",listStyle:{},hidePortrait:!0,isShowIcon:!1,isItemClickHide:!0,toggleMode:Qt.HOVER,heightLimit:!0}}}]),i})(pe),nl=(function(s){J(i,s);var o=ee(i);function i(t){var e;return X(this,i),e=o.call(this,t),e.curTime=0,e.isPaused=!0,e}return q(i,[{key:"beforeCreate",value:function(e){var r=e.config.list;Array.isArray(r)&&r.length>0&&(e.config.list=r.map(function(n){return!n.text&&n.name&&(n.text=n.name),n.text||(n.text=n.definition),n}))}},{key:"afterCreate",value:function(){var e=this;se(re(i.prototype),"afterCreate",this).call(this),this.on("resourceReady",function(r){e.changeDefinitionList(r)}),this.on(_n,function(r){e.renderItemList(e.config.list,r.to)}),this.player.definitionList.length<2&&this.hide()}},{key:"show",value:function(e){!this.config.list||this.config.list.length<2||g.addClass(this.root,"show")}},{key:"initDefinition",value:function(){var e=this.config,r=e.list,n=e.defaultDefinition;if(r.length>0){var a=null;r.map(function(u){u.definition===n&&(a=u)}),a||(a=r[0]),this.changeDefinition(a)}}},{key:"renderItemList",value:function(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.config.list||[],n=arguments.length>1?arguments[1]:void 0,a=n&&n.definition?n.definition:this.config.defaultDefinition;n&&r.forEach(function(c){c.selected=!1});var u=0,l=r.map(function(c,f){var h=Ae(Ae({},c),{},{showText:e.getTextByLang(c)||c.definition,selected:!1});return(c.selected||c.definition&&c.definition==a)&&(h.selected=!0,u=f),h});se(re(i.prototype),"renderItemList",this).call(this,l,u)}},{key:"changeDefinitionList",value:function(e){Array.isArray(e)&&(this.config.list=e.map(function(r){return!r.text&&r.name&&(r.text=r.name),r.text||(r.text=r.definition),r}),this.renderItemList(),this.config.list.length<2?this.hide():this.show())}},{key:"changeDefinition",value:function(e,r){this.player.changeDefinition(e,r)}},{key:"onItemClick",value:function(e,r){var n=this.player.definitionList;se(re(i.prototype),"onItemClick",this).apply(this,arguments),this.emitUserAction(e,"change_definition",{from:r.from,to:r.to});for(var a=0;a<n.length;a++)r.to&&n[a].definition===r.to.definition&&(r.to.url=n[a].url),r.from&&n[a].definition===r.from.definition&&(r.from.url=n[a].url);this.player.changeDefinition(r.to,r.from)}}],[{key:"pluginName",get:function(){return"definition"}},{key:"defaultConfig",get:function(){return Ae(Ae({},Qi.defaultConfig),{},{position:Ee.CONTROLS_RIGHT,index:3,list:[],defaultDefinition:"",disable:!1,hidePortrait:!1,className:"xgplayer-definition",isShowIcon:!0})}}]),i})(Qi),al=(function(s){J(i,s);var o=ee(i);function i(t){var e;return X(this,i),e=o.call(this,t),e.curRate=1,e}return q(i,[{key:"beforeCreate",value:function(e){var r=e.player.config.playbackRate,n=r?Array.isArray(r)?r:e.config.list:[];Array.isArray(n)&&(e.config.list=n.map(function(a){return typeof a=="number"?a={rate:a,text:"".concat(a,"x")}:!a.text&&a.rate&&(a.text="".concat(a.rate,"x")),a}))}},{key:"afterCreate",value:function(){var e=this;se(re(i.prototype),"afterCreate",this).call(this),this.on(Qa,function(){e.curValue!==e.player.playbackRate&&e.renderItemList()}),this.renderItemList()}},{key:"show",value:function(e){!this.config.list||this.config.list.length===0||se(re(i.prototype),"show",this).call(this)}},{key:"onItemClick",value:function(e,r){se(re(i.prototype),"onItemClick",this).call(this,e,r);var n=e.delegateTarget,a=Number(n.getAttribute("rate"));if(!a||a===this.curValue)return!1;var u={playbackRate:{from:this.player.playbackRate,to:a}};this.emitUserAction(e,"change_rate",{props:u}),this.curValue=a,this.player.playbackRate=a}},{key:"renderItemList",value:function(){var e=this,r=this.player.playbackRate||1;this.curValue=r;var n=-1,a=this.config.list.map(function(u,l){var c={rate:u.rate};return c.rate===r&&(c.selected=!0,n=l),c.showText=e.getTextByLang(u),c});se(re(i.prototype),"renderItemList",this).call(this,a,n)}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,r=this.curIndex<e.length?this.curIndex:0,n=e[r],a="";!n||this.curIndex<0?a="".concat(this.player.playbackRate,"x"):a=this.getTextByLang(n,"iconText"),this.find(".icon-text").innerHTML=a}}},{key:"destroy",value:function(){se(re(i.prototype),"destroy",this).call(this)}}],[{key:"pluginName",get:function(){return"playbackRate"}},{key:"defaultConfig",get:function(){return Ae(Ae({},Qi.defaultConfig),{},{position:Ee.CONTROLS_RIGHT,index:4,list:[2,1.5,1,.75,.5],className:"xgplayer-playbackrate",isShowIcon:!0,hidePortrait:!1})}}]),i})(Qi),sl=(function(s){J(i,s);var o=ee(i);function i(){return X(this,i),o.apply(this,arguments)}return q(i,[{key:"afterCreate",value:function(){var e=this;this.clickHandler=this.hook("errorRetry",this.errorRetry,{pre:function(n){n.preventDefault(),n.stopPropagation()}}),this.onError=this.hook("showError",this.handleError),this.bind(".xgplayer-error-refresh","click",this.clickHandler),this.on(Wt,function(r){e.onError(r)})}},{key:"errorRetry",value:function(e){this.emitUserAction(e,"error_retry",{}),this.player.retry()}},{key:"handleError",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=this.player,n=e.errorType,a=r.errorNote?this.i18n[r.errorNote]:"";if(!a)switch(n){case"decoder":a=this.i18n.MEDIA_ERR_DECODE;break;case"network":a=this.i18n.MEDIA_ERR_NETWORK;break;default:a=this.i18n.MEDIA_ERR_SRC_NOT_SUPPORTED}this.find(".xgplayer-error-text").innerHTML=a,this.find(".xgplayer-error-tips").innerHTML="".concat(this.i18n.REFRESH_TIPS,'<span class="xgplayer-error-refresh">').concat(this.i18n.REFRESH,"</span>")}},{key:"destroy",value:function(){this.unbind(".xgplayer-error-refresh","click",this.clickHandler)}},{key:"render",value:function(){return`<xg-error class="xgplayer-error">
      <div class="xgplayer-errornote">
       <span class="xgplayer-error-text"></span>
       <span class="xgplayer-error-tips"><em class="xgplayer-error-refresh"></em></span>
      </div>
    </xg-error>`}}],[{key:"pluginName",get:function(){return"error"}}]),i})(pe),ol=(function(s){J(i,s);var o=ee(i);function i(){return X(this,i),o.apply(this,arguments)}return q(i,[{key:"afterCreate",value:function(){var e=this;this.intervalId=0,this.customConfig=null,this.bind(".highlight",["click","touchend"],function(r){(e.config.onClick||e.customOnClick)&&(r.preventDefault(),r.stopPropagation(),e.customOnClick?e.customOnClick(r):e.config.onClick(r))}),this.player.showPrompt=function(){e.showPrompt.apply(e,arguments)},this.player.hidePrompt=function(){e.hide()}}},{key:"setStyle",value:function(e){var r=this;Object.keys(e).map(function(n){r.root.style[n]=e[n]})}},{key:"showPrompt",value:function(e){var r=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){};if(e){this.customOnClick=a;var u=this.config.interval;this.intervalId&&(clearTimeout(this.intervalId),this.intervalId=null),g.addClass(this.root,"show"),n.mode==="arrow"&&g.addClass(this.root,"arrow"),typeof e=="string"?this.find(".xgplayer-prompt-detail").innerHTML=e:this.find(".xgplayer-prompt-detail").innerHTML="".concat(e.text||"")+"".concat(e.highlight?'<i class="highlight">'.concat(e.highlight,"</i>"):""),n.style&&this.setStyle(n.style);var l=typeof n.autoHide=="boolean"?n.autoHide:this.config.autoHide;if(l){var c=n.interval||u;this.intervalId=setTimeout(function(){r.hide()},c)}}}},{key:"hide",value:function(){g.removeClass(this.root,"show"),g.removeClass(this.root,"arrow"),this.root.removeAttribute("style"),this.customOnClick=null}},{key:"render",value:function(){return'<xg-prompt class="xgplayer-prompt '.concat(H.CONTROLS_FOLLOW,`">
    <span class="xgplayer-prompt-detail"></span>
    </xg-prompt>`)}}],[{key:"pluginName",get:function(){return"prompt"}},{key:"defaultConfig",get:function(){return{interval:3e3,style:{},mode:"arrow",autoHide:!0,detail:{text:"",highlight:""},onClick:function(){}}}}]),i})(pe),da={time:0,text:"",id:1,duration:1,color:"#fff",style:{},width:6,height:6};function ws(s){Object.keys(da).map(function(o){s[o]===void 0&&(s[o]=da[o])})}var va={_updateDotDom:function(o,i){if(i){var t=this.calcuPosition(o.time,o.duration),e=o.style||{};e.left="".concat(t.left,"%"),e.width="".concat(t.width,"%"),i.setAttribute("data-text",o.text),i.setAttribute("data-time",o.time),t.isMini?g.addClass(i,"mini"):g.removeClass(i,"mini"),Object.keys(e).map(function(r){i.style[r]=e[r]})}},initDots:function(){var o=this;this._ispots.map(function(i){o.createDot(i,!1)}),this.ispotsInit=!0},createDot:function(o){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=this.player.plugins.progress;if(t&&(i&&(ws(o),this._ispots.push(o)),!(!this.ispotsInit&&i))){var e=this.calcuPosition(o.time,o.duration),r=o.style||{};r.left="".concat(e.left,"%"),r.width="".concat(e.width,"%");var n="xgspot_".concat(o.id," xgplayer-spot");e.isMini&&(n+=" mini");var a=o.template?'<div class="xgplayer-spot-pop">'.concat(o.template,"</div>"):"",u=g.createDom("xg-spot",a,{"data-text":o.text,"data-time":o.time,"data-id":o.id},n);Object.keys(r).map(function(l){u.style[l]=r[l]}),t.outer&&t.outer.appendChild(u),this.positionDot(u,o.id)}},findDot:function(o){if(this.player.plugins.progress){var i=this._ispots.filter(function(t,e){return t.id===o});return i.length>0?i[0]:null}},updateDot:function(o){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=this.player.plugins.progress;if(t){var e=this.findDot(o.id);if(e&&Object.keys(o).map(function(n){e[n]=o[n]}),!!this.ispotsInit){var r=t.find('xg-spot[data-id="'.concat(o.id,'"]'));r&&(this._updateDotDom(o,r),i&&this.showDot(o.id))}}},deleteDot:function(o){var i=this._ispots,t=this.player.plugins.progress;if(t){for(var e=[],r=0;r<i.length;r++)i[r].id===o&&e.push(r);for(var n=e.length,a=n-1;a>=0;a--)if(i.splice(e[a],1),this.ispotsInit){var u=t.find('xg-spot[data-id="'.concat(o,'"]'));u&&u.parentElement.removeChild(u)}}},deleteAllDots:function(){var o=this.player.plugins.progress;if(o){if(!this.ispotsInit){this._ispots=[];return}for(var i=o.root.getElementsByTagName("xg-spot"),t=i.length-1;t>=0;t--)o.outer.removeChild(i[t]);this._ispots=[]}},updateAllDots:function(){var o=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=this.player.plugins.progress;if(t){if(!this.ispotsInit){this._ispots=i;return}this._ispots=[];var e=t.root.getElementsByTagName("xg-spot"),r=e.length;if(r>i.length)for(var n=r-1;n>i.length-1;n--)t.outer.removeChild(e[n]);i.forEach(function(a,u){u<r?(e[u].setAttribute("data-id","".concat(a.id)),o._ispots.push(a),o.updateDot(a)):o.createDot(a)})}},positionDots:function(){var o=this,i=this._ispots,t=this.playerSize,e=this.player.sizeInfo,r=this.player.plugins.progress;!r||e.width===t.width||(t.width=e.width,t.left=e.left,i.forEach(function(n){var a=r.find('xg-spot[data-id="'.concat(n.id,'"]'));a&&o.positionDot(a,n.id)}))},positionDot:function(o,i){var t=g.findDom(o,".xgplayer-spot-pop");if(t){var e=this.playerSize,r=o.getBoundingClientRect(),n=t.getBoundingClientRect(),a=r.left-e.left,u=e.width-a-r.width/2;if(a<n.width/2||e.width<n.width){var l=n.width/2-a;t.style.left="".concat(l,"px")}else if(u<n.width/2){var c=u-n.width/2+r.width/2;t.style.left="".concat(c,"px")}else t.style.left="50%"}},updateDuration:function(){var o=this,i=this.player.plugins.progress;if(i){var t=this._ispots;t.forEach(function(e){var r=i.find('xg-spot[data-id="'.concat(e.id,'"]'));o._updateDotDom(e,r)})}},getAllDotsDom:function(){var o=this.player.plugins.progress;if(!o)return[];var i=o.root.getElementsByTagName("xg-spot");return i},getDotDom:function(o){var i=this.player.plugins.progress;if(i)return i.find('xg-spot[data-id="'.concat(o,'"]'))}};function ul(s){var o=s.config,i=s.player;Object.keys(va).map(function(e){s[e]=va[e].bind(s)});var t=i.config.progressDot||o.ispots||[];s._ispots=t.map(function(e){return ws(e),e}),s.ispotsInit=!1,s.playerSize={left:i.sizeInfo.left,width:i.sizeInfo.width},s.on(Et,function(){s.ispotsInit?s.updateDuration():s.initDots()}),s.on(Dt,function(){s.positionDots()})}var Zt={dragmove:"onProgressMove",dragstart:"onProgressDragStart",dragend:"onProgressDragEnd",click:"onProgressClick",mouseover:"onProgressMouseOver",mouseenter:"onProgressMouseOver"},ll=(function(s){J(i,s);var o=ee(i);function i(t){var e;return X(this,i),e=o.call(this,t),I(P(e),"onMousemove",function(r){if(!e.config.disable){if(g.hasClass(r.target,"xg-spot-content")&&e.config.isHideThumbnailHover){e.player.plugins.progress.onMouseLeave(r);return}(e._state.f||g.hasClass(r.target,"xg-spot-content"))&&(g.event(r),r.stopPropagation())}}),I(P(e),"onMousedown",function(r){e.config.disable||(e._state.f||g.hasClass(r.target,"xg-spot-content"))&&(g.event(r),r.stopPropagation())}),I(P(e),"onMouseup",function(r){if(e.isDrag){var n=e.player.plugins.progress;n&&n.pos&&(n.onMouseUp(r),!n.pos.isEnter&&n.onMouseLeave(r))}}),I(P(e),"onDotMouseLeave",function(r){if(!e.config.disable){e._curDot.removeEventListener("mouseleave",e.onDotMouseLeave),e.blurDot(r.target),e._curDot=null;var n=e.player.plugins.progress;n&&n.enableBlur(),e.show()}}),I(P(e),"onProgressMouseOver",function(r,n){if(!e.config.disable&&g.hasClass(n.target,"xgplayer-spot")&&!e._curDot){e._curDot=n.target,e.focusDot(n.target),e._curDot.children.length>0&&e.hide();var a=e.player.plugins.progress;a&&a.disableBlur(),e._curDot.addEventListener("mouseleave",e.onDotMouseLeave)}}),e._ispots=[],e.videoPreview=null,e.videothumbnail=null,e.thumbnail=null,e.timeStr="",e._state={now:0,f:!1},e}return q(i,[{key:"beforeCreate",value:function(e){var r=e.player.plugins.progress;r&&(e.root=r.root)}},{key:"afterCreate",value:function(){var e=this;this._curDot=null,this.handlerSpotClick=this.hook("spotClick",function(r,n){n.seekTime&&e.player.seek(n.seekTime)}),this.transformTimeHook=this.hook("transformTime",function(r){e.setTimeContent(g.format(r))}),ul(this),this.on(Et,function(){e.show()}),this.config.disable&&this.disable(),this.extTextRoot=this.find(".xg-spot-ext-text")}},{key:"setConfig",value:function(e){var r=this;e&&Object.keys(e).map(function(n){r.config[n]=e[n]})}},{key:"onPluginsReady",value:function(){var e=this.player;e.plugins.progress&&(this.previewLine=this.find(".xg-spot-line"),this.timePoint=this.find(".xgplayer-progress-point"),this.timeText=this.find(".xg-spot-time"),this.tipText=this.find(".spot-inner-text"),this._hasThumnail=!1,this.registerThumbnail(),this.bindEvents())}},{key:"bindEvents",value:function(){var e=this,r=this.player.plugins.progress;if(r&&(Object.keys(Zt).map(function(a){e[Zt[a]]=e[Zt[a]].bind(e),r.addCallBack(a,e[Zt[a]])}),ue.device!=="mobile")){this.bind(".xg-spot-info","mousemove",this.onMousemove),this.bind(".xg-spot-info","mousedown",this.onMousedown),this.bind(".xg-spot-info","mouseup",this.onMouseup);var n=this.hook("previewClick",function(){});this.handlerPreviewClick=function(a){a.stopPropagation(),n(parseInt(e._state.now*1e3,10)/1e3,a),r&&r.onMouseUp(a)},this.bind(".xg-spot-content","mouseup",this.handlerPreviewClick)}}},{key:"onProgressMove",value:function(e,r){this.config.disable||!this.player.duration||this.updatePosition(e.offset,e.width,e.currentTime,e.e)}},{key:"onProgressDragStart",value:function(e){this.config.disable||!this.player.duration||(this.isDrag=!0,this.videoPreview&&g.addClass(this.videoPreview,"show"))}},{key:"onProgressDragEnd",value:function(e){this.config.disable||!this.player.duration||(this.isDrag=!1,this.videoPreview&&g.removeClass(this.videoPreview,"show"))}},{key:"onProgressClick",value:function(e,r){this.config.disable||g.hasClass(r.target,"xgplayer-spot")&&(r.stopPropagation(),r.preventDefault(),["time","id","text"].map(function(n){e[n]=r.target.getAttribute("data-".concat(n))}),e.time&&(e.time=Number(e.time)),this.handlerSpotClick(r,e))}},{key:"updateLinePos",value:function(e,r){var n=this.root,a=this.previewLine,u=this.player,l=this.config,c=u.controls.mode,f=c==="flex",h=n.getBoundingClientRect().width;if(!(!h&&this._hasThumnail)){h=this._hasThumnail&&h<l.width?l.width:h;var d=e-h/2,v;d<0&&!f?(d=0,v=e-h/2):d>r-h&&!f?(v=d-(r-h),d=r-h):v=0,v!==void 0&&(a.style.transform="translateX(".concat(v.toFixed(2),"px)")),n.style.transform="translateX(".concat(d.toFixed(2),"px) translateZ(0)")}}},{key:"updateTimeText",value:function(e){var r=this.timeText,n=this.timePoint;r.innerHTML=e,!this.thumbnail&&(n.innerHTML=e)}},{key:"updatePosition",value:function(e,r,n,a){var u=this.root,l=this.config,c=this._state;if(u){c.now=n,this.transformTimeHook(n);var f=this.timeStr;a&&a.target&&g.hasClass(a.target,"xgplayer-spot")?(this.showTips(a.target.getAttribute("data-text"),!1,f),this.focusDot(a.target),c.f=!0,l.isFocusDots&&c.f&&(c.now=parseInt(a.target.getAttribute("data-time"),10))):l.defaultText?(c.f=!1,this.showTips(l.defaultText,!0,f)):(c.f=!1,this.hideTips("")),this.updateTimeText(f),this.updateThumbnails(c.now),this.updateLinePos(e,r)}}},{key:"setTimeContent",value:function(e){this.timeStr=e}},{key:"updateThumbnails",value:function(e){var r=this.player,n=this.videoPreview,a=this.config,u=r.plugins.thumbnail;if(u&&u.usable){this.thumbnail&&u.update(this.thumbnail,e,a.width,a.height);var l=n&&n.getBoundingClientRect();this.videothumbnail&&u.update(this.videothumbnail,e,l.width,l.height)}}},{key:"registerThumbnail",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ue.device!=="mobile"){var r=this.player,n=this.config,a=r.getPlugin("thumbnail");if(a&&a.setConfig(e),!a||!a.usable||!n.isShowThumbnail){g.addClass(this.root,"short-line no-thumbnail");return}else g.removeClass(this.root,"short-line no-thumbnail");n.mode==="short"&&g.addClass(this.root,"short-line"),this._hasThumnail=!0;var u=this.find(".xg-spot-thumbnail");this.thumbnail=a.createThumbnail(u,"progress-thumbnail"),n.isShowCoverPreview&&(this.videoPreview=g.createDom("xg-video-preview","",{},"xgvideo-preview"),r.root.appendChild(this.videoPreview),this.videothumbnail=a.createThumbnail(this.videoPreview,"xgvideo-thumbnail")),this.updateThumbnails(0)}}},{key:"calcuPosition",value:function(e,r){var n=this.player.plugins.progress,a=this.player,u=n.root.getBoundingClientRect().width,l=a.duration/u*6;return e+r>a.duration&&(r=a.duration-e),e/a.duration*100,r/a.duration,{left:e/a.duration*100,width:r/a.duration*100,isMini:r<l}}},{key:"showDot",value:function(e){var r=this.findDot(e);if(r){var n=this.root.getBoundingClientRect(),a=n.width,u=r.time/this.player.duration*a;this.updatePosition(u,a,r.time)}}},{key:"focusDot",value:function(e,r){e&&(r||(r=e.getAttribute("data-id")),g.addClass(e,"active"),this._activeDotId=r)}},{key:"blurDot",value:function(e){if(!e){var r=this._activeDotId;e=this.getDotDom(r)}e&&(g.removeClass(e,"active"),this._activeDotId=null)}},{key:"showTips",value:function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";g.addClass(this.root,"no-timepoint"),e&&(g.addClass(this.find(".xg-spot-content"),"show-text"),r&&this.config.mode==="production"?(g.addClass(this.root,"product"),this.tipText.textContent=e):(g.removeClass(this.root,"product"),this.tipText.textContent=this._hasThumnail?e:"".concat(n," ").concat(e)))}},{key:"hideTips",value:function(){g.removeClass(this.root,"no-timepoint"),this.tipText.textContent="",g.removeClass(this.find(".xg-spot-content"),"show-text"),g.removeClass(this.root,"product")}},{key:"hide",value:function(){g.addClass(this.root,"hide")}},{key:"show",value:function(e){g.removeClass(this.root,"hide")}},{key:"enable",value:function(){var e=this.config,r=this.playerConfig;this.config.disable=!1,this.show(),!this.thumbnail&&e.isShowThumbnail&&this.registerThumbnail(r.thumbnail||{})}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){var e=this,r=this.player.plugins.progress;r&&Object.keys(Zt).map(function(n){r.removeCallBack(n,e[Zt[n]])}),this.videothumbnail=null,this.thumbnail=null,this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.unbind(".xg-spot-info","mousemove",this.onMousemove),this.unbind(".xg-spot-info","mousedown",this.onMousedown),this.unbind(".xg-spot-info","mouseup",this.onMouseup),this.unbind(".xg-spot-content","mouseup",this.handlerPreviewClick)}},{key:"render",value:function(){return ue.device==="mobile"||this.playerConfig.isMobileSimulateMode==="mobile"?"":'<div class="xg-spot-info hide '.concat(this.config.mode==="short"?"short-line":"",`">
      <div class="xg-spot-content">
        <div class="xg-spot-thumbnail">
          <span class="xg-spot-time"></span>
        </div>
        <div class="xg-spot-text"><span class="spot-inner-text"></span></div>
      </div>
      <div class="xgplayer-progress-point">00:00</div>
      <div class="xg-spot-ext-text"></div>
      <div class="xg-spot-line"></div>
    </div>`)}}],[{key:"pluginName",get:function(){return"progresspreview"}},{key:"defaultConfig",get:function(){return{index:1,miniWidth:6,ispots:[],defaultText:"",isFocusDots:!0,isHideThumbnailHover:!0,isShowThumbnail:!0,isShowCoverPreview:!1,mode:"",disable:!1,width:160,height:90}}}]),i})(pe),cl=(function(s){J(i,s);var o=ee(i);function i(t){var e;return X(this,i),e=o.call(this,t),e.ratio=1,e.interval=null,e._preloadMark={},e}return q(i,[{key:"afterCreate",value:function(){var e=this;this.usable&&this.initThumbnail(),this.on([Et],function(){var r=e.config,n=r.pic_num,a=r.interval;e.usable&&(e.interval=a>0?a:Math.round(e.player.duration*1e3/n)/1e3)})}},{key:"setConfig",value:function(e){var r=this;if(e){var n=Object.keys(e);n.length<1||(n.forEach(function(a){r.config[a]=e[a]}),this.usable&&this.initThumbnail())}}},{key:"usable",get:function(){var e=this.config,r=e.urls,n=e.pic_num;return r&&r.length>0&&n>0}},{key:"initThumbnail",value:function(){var e=this.config,r=e.width,n=e.height,a=e.pic_num,u=e.interval;this.ratio=r/n*100,this.interval=u||Math.round(this.player.duration/a),this._preloadMark={}}},{key:"getUrlByIndex",value:function(e){return e>=0&&e<this.config.urls.length?this.config.urls[e]:""}},{key:"preload",value:function(e){var r=this;if(!this._preloadMark[e]){var n=this.config.urls,a=n.length,u=[];e>0&&u.push(e-1),u.push(e),e>0&&e<a-1&&u.push(e+1),u.map(function(l){!r._preloadMark[l]&&l>=0&&l<a&&(r._preloadMark[l]=1,g.preloadImg(n[l],function(){r._preloadMark[l]=2}))})}}},{key:"getPosition",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=this.config,u=a.pic_num,l=a.row,c=a.col,f=a.width,h=a.height;this.interval=Math.round(this.player.duration/u);var d=Math.ceil(e/this.interval);d=d>u?u:d;var v=d<l*c?0:Math.ceil(d/(l*c))-1,y=d-v*(c*l),p=y>0?Math.ceil(y/c)-1:0,b=y>0?y-p*c-1:0,k=0,E=0;if(r&&n){var w=r/n;w<f/h?(E=n,k=E*(f/h)):(k=r,E=k/(f/h))}else n?r||(E=n||h,k=E*(f/h)):(k=r||f,E=k/(f/h));var T=this.getUrlByIndex(v);return{urlIndex:v,rowIndex:p,colIndex:b,url:T,height:E,width:k,style:{backgroundImage:"url(".concat(T,")"),backgroundSize:"".concat(k*c,"px auto"),backgroundPosition:"-".concat(b*k,"px -").concat(p*E,"px"),width:"".concat(k,"px"),height:"".concat(E,"px")}}}},{key:"update",value:function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"",l=this.config,c=l.pic_num,f=l.urls;if(!(c<=0||!f||f.length===0)){var h=this.getPosition(r,n,a);this.preload(h.urlIndex),Object.keys(h.style).map(function(d){e.style[d]=h.style[d]}),Object.keys(u).map(function(d){e.style[d]=u[d]})}}},{key:"changeConfig",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.setConfig(e)}},{key:"createThumbnail",value:function(e,r){var n=g.createDom("xg-thumbnail","",{},"thumbnail ".concat(r));return e&&e.appendChild(n),n}}],[{key:"pluginName",get:function(){return"thumbnail"}},{key:"defaultConfig",get:function(){return{isShow:!1,urls:[],pic_num:0,col:0,row:0,height:90,width:160,scale:1,className:"",hidePortrait:!1}}}]),i})(pe);function Cr(s){return s?"background:".concat(s,";"):""}var fl=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"onTimeupdate",function(){var a=t.player.ended,u=P(t),l=u.offsetDuration,c=t.currentTime;c=g.adjustTimeByDuration(c,l,a),t.update({played:c},l)}),t}return q(i,[{key:"offsetDuration",get:function(){return this.playerConfig.customDuration||this.player.offsetDuration||this.player.duration}},{key:"currentTime",get:function(){var e=this.player,r=e.offsetCurrentTime,n=e.currentTime;return r>=0?r:n}},{key:"afterCreate",value:function(){var e=this;this.root&&(this.on(qe,this.onTimeupdate),this.on($t,function(){e.reset()}))}},{key:"reset",value:function(){this.update({played:0,cached:0},0)}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cached:0,played:0},r=arguments.length>1?arguments[1]:void 0;!r||!this.root||(e.cached&&(this.find("xg-mini-progress-cache").style.width="".concat(e.cached/r*100,"%")),e.played&&(this.find("xg-mini-progress-played").style.width="".concat(e.played/r*100,"%")))}},{key:"render",value:function(){var e=this.playerConfig,r=e.commonStyle,n=e.miniprogress;if(n){var a=this.config,u=a.mode,l=a.height,c={cached:Cr(r.cachedColor),played:Cr(r.playedColor),progress:Cr(r.progressColor),height:l>0&&l!==2?"height: ".concat(l,"px;"):""},f=u==="show"?"xg-mini-progress-show":"";return'<xg-mini-progress class="xg-mini-progress '.concat(f,'" style="').concat(c.progress," ").concat(c.height,`">
    <xg-mini-progress-cache class="xg-mini-progress-cache" style="`).concat(c.cached,`"></xg-mini-progress-cache>
    <xg-mini-progress-played class="xg-mini-progress-played" style="`).concat(c.played,`"></xg-mini-progress-played>
    </xg-mini-progress>`)}}}],[{key:"pluginName",get:function(){return"MiniProgress"}},{key:"defaultConfig",get:function(){return{mode:"auto",height:2}}}]),i})(pe),Jt={REAL_TIME:"realtime",FIRST_FRAME:"firstframe",POSTER:"poster"};function hl(){try{return parseInt(window.performance.now(),10)}catch{return new Date().getTime()}}function dl(){try{var s=document.createElement("canvas").getContext;return!!s}catch{return!1}}var Li=null,vl=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"onLoadedData",function(a){t.player&&(t._frameCount=t.config.startFrameCount,t.stop(),t.renderOnTimeupdate(a),t.off(qe,t.renderOnTimeupdate),t.on(qe,t.renderOnTimeupdate))}),I(P(t),"onVisibilitychange",function(a){document.visibilityState==="visible"?t._checkIfCanStart()&&t.start():document.visibilityState==="hidden"&&t.stop()}),I(P(t),"renderOnTimeupdate",function(a){if(t._frameCount>0)t.renderOnce(),t._frameCount--;else{t._isLoaded=!0,t.off(qe,t.renderOnTimeupdate);var u=t.config.startInterval;!t.player.paused&&t._checkIfCanStart()&&t.start(0,u)}}),I(P(t),"start",function(a,u){var l=t.player.video,c=hl(),f=t.checkVideoIsSupport(l);!f||!t.canvasCtx||(u||(u=t.interval),t.stop(),l.videoWidth&&l.videoHeight&&(t.videoPI=l.videoHeight>0?parseInt(l.videoWidth/l.videoHeight*100,10):0,(t.config.mode===Jt.REAL_TIME||c-t.preTime>=u)&&(l&&l.videoWidth&&t.update(f,t.videoPI),t.preTime=c)),t.frameId=t._loopType==="timer"?g.setTimeout(P(t),t.start,u):g.requestAnimationFrame(t.start))}),I(P(t),"stop",function(){t.frameId&&(t._loopType==="timer"?g.clearTimeout(P(t),t.frameId):g.cancelAnimationFrame(t.frameId),t.frameId=null)}),t}return q(i,[{key:"afterCreate",value:function(){var e=this;this.playerConfig.dynamicBg===!0&&(this.config.disable=!1),i.isSupport||(this.config.disable=!0);var r=this.config,n=r.disable,a=r.mode,u=r.frameRate;n||(this._pos={width:0,height:0,rwidth:0,rheight:0,x:0,y:0,pi:0},this.isStart=!1,this._isLoaded=!1,this.videoPI=0,this.preTime=0,this.interval=parseInt(1e3/u,10),this.canvas=null,this.canvasCtx=null,this._frameCount=0,this._loopType=this.config.mode!==Jt.REAL_TIME&&this.interval>=1e3?"timer":"animation",this.once(nr,function(){e.player&&(e.init(),e.renderByPoster(),e.player.paused||e.start())}),a!==Jt.POSTER&&(a!==Jt.FIRST_FRAME&&(this.on($t,function(){e.stop()}),this.on(Qe,function(){var l=e.config.startInterval;e._checkIfCanStart()&&e.start(0,l)}),this.on(ui,function(){e.stop()})),this.on(bt,this.onLoadedData),this.on(pn,function(){e._isLoaded=!1,e.stop()}),document.addEventListener("visibilitychange",this.onVisibilitychange)))}},{key:"setConfig",value:function(e){var r=this;Object.keys(e).forEach(function(n){n==="root"&&e[n]!==r.config[n]?r.reRender(e[n]):n==="frameRate"?r.interval=parseInt(1e3/e[n],10):n==="disable"&&e[n]&&r.stop(),r.config[n]=e[n]})}},{key:"init",value:function(e){var r=this.player,n=this.config;this.canvasFilter=i.supportCanvasFilter();try{var a=e||n.root;a||(a=n.isInnerRender&&r.innerContainer||r.root),a.insertAdjacentHTML("afterbegin",'<div class="xgplayer-dynamic-bg" data-index="'.concat(n.index,`"><canvas>
        </canvas><xgmask></xgmask></div>`)),this.root=a.children[0],this.canvas=this.find("canvas"),this.canvasFilter||(this.canvas.style.filter=n.filter,this.canvas.style.webkitFilter=n.filter),this.mask=this.find("xgmask"),n.addMask&&(this.mask.style.background=n.maskBg),this.canvasCtx=this.canvas.getContext("2d")}catch(u){he.logError("plugin:DynamicBg",u)}}},{key:"reRender",value:function(e){var r=this.config.disable;if(!(!r&&!this.root)){this.stop();var n=this.root?this.root.parentElement:null;if(n!==e&&n.removeChild(this.root),!e){this.root=null;return}this.init(e),this.renderOnce();var a=this.config.startInterval;this._checkIfCanStart()&&this.start(0,a)}}},{key:"checkVideoIsSupport",value:function(e){if(!e)return null;var r=e&&e instanceof window.HTMLVideoElement?e:e.canvas?e.canvas:e.flyVideo?e.flyVideo:null;if(r&&!(ue.browser==="safari"&&g.isMSE(r)))return r;var n=r?r.tagName.toLowerCase():"";return n==="canvas"||n==="img"?r:null}},{key:"renderByPoster",value:function(){var e=this.playerConfig.poster;if(e){var r=g.typeOf(e)==="String"?e:g.typeOf(e.poster)==="String"?e.poster:null;this.updateImg(r)}}},{key:"_checkIfCanStart",value:function(){var e=this.config.mode;return this._isLoaded&&!this.player.paused&&e!==Jt.FIRST_FRAME&&e!==Jt.POSTER}},{key:"renderOnce",value:function(){var e=this.player.video;if(!(!e.videoWidth||!e.videoHeight)){this.videoPI=parseInt(e.videoWidth/e.videoHeight*100,10);var r=this.checkVideoIsSupport(e);r&&this.update(r,this.videoPI)}}},{key:"updateImg",value:function(e){var r=this;if(e){var n=this.canvas.getBoundingClientRect(),a=n.width,u=n.height,l=new window.Image;l.onload=function(){if(!(!r.canvas||r.frameId||r.isStart)){r.canvas.height=u,r.canvas.width=a;var c=parseInt(a/u*100,10);r.update(l,c),l=null}},l.src=e}}},{key:"update",value:function(e,r){if(!(!this.canvas||!this.canvasCtx||!r))try{var n=this._pos,a=this.config,u=this.canvas.getBoundingClientRect(),l=u.width,c=u.height;if(l!==n.width||c!==n.height||n.pi!==r){var f=parseInt(l/c*100,10);n.pi=r,n.width!==l&&(n.width=this.canvas.width=l),n.height!==c&&(n.height=this.canvas.height=c);var h=c,d=l;f<r?d=parseInt(c*r/100,10):f>r&&(h=parseInt(l*100/r,10)),n.rwidth=d*a.multiple,n.rheight=h*a.multiple,n.x=(l-n.rwidth)/2,n.y=(c-n.rheight)/2}this.canvasFilter&&(this.canvasCtx.filter=a.filter),this.canvasCtx.drawImage(e,n.x,n.y,n.rwidth,n.rheight)}catch(v){he.logError("plugin:DynamicBg",v)}}},{key:"destroy",value:function(){this.stop(),document.removeEventListener("visibilitychange",this.onVisibilitychange),this.canvasCtx=null,this.canvas=null}},{key:"render",value:function(){return""}}],[{key:"pluginName",get:function(){return"dynamicBg"}},{key:"defaultConfig",get:function(){return{isInnerRender:!1,disable:!0,index:-1,mode:"framerate",frameRate:10,filter:"blur(50px)",startFrameCount:2,startInterval:0,addMask:!0,multiple:1.2,maskBg:"rgba(0,0,0,0.7)"}}},{key:"isSupport",get:function(){return typeof Li=="boolean"||(Li=dl()),Li}},{key:"supportCanvasFilter",value:function(){return!(ue.browser==="safari"||ue.browser==="firefox")}}]),i})(pe),pl={LANG:"zh-cn",TEXT:{ERROR_TYPES:{network:{code:1,msg:"视频下载错误"},mse:{code:2,msg:"流追加错误"},parse:{code:3,msg:"解析错误"},format:{code:4,msg:"格式错误"},decoder:{code:5,msg:"解码错误"},runtime:{code:6,msg:"语法错误"},timeout:{code:7,msg:"播放超时"},other:{code:8,msg:"其他错误"}},HAVE_NOTHING:"没有关于音频/视频是否就绪的信息",HAVE_METADATA:"音频/视频的元数据已就绪",HAVE_CURRENT_DATA:"关于当前播放位置的数据是可用的，但没有足够的数据来播放下一帧/毫秒",HAVE_FUTURE_DATA:"当前及至少下一帧的数据是可用的",HAVE_ENOUGH_DATA:"可用数据足以开始播放",NETWORK_EMPTY:"音频/视频尚未初始化",NETWORK_IDLE:"音频/视频是活动的且已选取资源，但并未使用网络",NETWORK_LOADING:"浏览器正在下载数据",NETWORK_NO_SOURCE:"未找到音频/视频来源",MEDIA_ERR_ABORTED:"取回过程被用户中止",MEDIA_ERR_NETWORK:"网络错误",MEDIA_ERR_DECODE:"解码错误",MEDIA_ERR_SRC_NOT_SUPPORTED:"不支持的音频/视频格式",REPLAY:"重播",ERROR:"网络连接似乎出现了问题",PLAY_TIPS:"播放",PAUSE_TIPS:"暂停",PLAYNEXT_TIPS:"下一集",DOWNLOAD_TIPS:"下载",ROTATE_TIPS:"旋转",RELOAD_TIPS:"重新载入",FULLSCREEN_TIPS:"进入全屏",EXITFULLSCREEN_TIPS:"退出全屏",CSSFULLSCREEN_TIPS:"进入样式全屏",EXITCSSFULLSCREEN_TIPS:"退出样式全屏",TEXTTRACK:"字幕",PIP:"画中画",SCREENSHOT:"截图",LIVE:"正在直播",OFF:"关闭",OPEN:"开启",MINI_DRAG:"点击按住可拖动视频",MINISCREEN:"小屏幕",REFRESH_TIPS:"请试试",REFRESH:"刷新",FORWARD:"快进中",LIVE_TIP:"直播"}},ci="info",Ar=hs,gl=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"_recordUserActions",function(a){var u=t._getTime(),l=Object.assign({},a,{msg:a.msg||a.action});t._stats[ci].push(Ae(Ae({type:"userAction"},u),{},{payload:l}))}),I(P(t),"_onReset",function(){t.reset()}),I(P(t),"_recordInfo",function(a){t.info(a)}),I(P(t),"_downloadStats",function(){var a=t.getStats(),u=new Blob([JSON.stringify(a)],{type:"application/json"}),l=window.URL.createObjectURL(u),c=document.createElement("a");c.style.display="none",c.href=l,c.download="player.txt",c.disabled=!1,c.click()}),t}return q(i,[{key:"_getTime",value:function(){return{timestamp:Date.now(),timeFormat:new Date().toISOString()}}},{key:"afterCreate",value:function(){this.reset(),this.on(Ki,this._recordUserActions),this.on(Ar.STATS_INFO,this._recordInfo),this.on(Ar.STATS_DOWNLOAD,this._downloadStats),this.on(Ar.STATS_RESET,this._onReset)}},{key:"destroy",value:function(){this.offAll()}},{key:"downloadStats",value:function(){this._downloadStats()}},{key:"info",value:function(e){e.profile?this._infoProfile(e):this._info(e)}},{key:"_info",value:function(e){var r=this._getTime();this._stats[ci].push(Ae(Ae({},r),{},{payload:e}))}},{key:"_infoProfile",value:function(e){if(e&&e.startMs){var r=Date.now(),n=r-e.startMs,a=Ae({cat:"function",dur:n,name:e.name||e.msg,ph:"X",pid:0,tid:0,ts:e.startMs,profile:!0},e);this._info(a)}else console.warn("infoProfile need object data, include startMs")}},{key:"reset",value:function(){var e;this._stats=(e={},I(e,ci,[]),I(e,"media",{}),e)}},{key:"getStats",value:function(){for(var e=this.player,r=e.media,n=[],a=0;a<r.buffered.length;a++)n.push({start:r.buffered.start(a),end:r.buffered.end(a)});var u={currentTime:r.currentTime,readyState:r.readyState,buffered:n,paused:r.paused,ended:r.ended};return this._stats.media=u,{raw:this._stats,timestat:this._getTimeStats(),profile:this._getProfile()}}},{key:"_getTimeStats",value:function(){var e=this._stats[ci],r=e.map(function(n){var a=n.payload.data,u="";try{a instanceof Error?u=a.msg:a!==void 0&&(u=JSON.stringify(a))}catch(l){console.log("err",l)}return"[".concat(n.timeFormat,"] : ").concat(n.payload.msg," ").concat(u," ")});return r}},{key:"_getProfile",value:function(){var e={traceEvents:[]},r=this._stats[ci];return r.forEach(function(n){n.payload.profile&&e.traceEvents.push(n.payload)}),e}}],[{key:"pluginName",get:function(){return"stats"}},{key:"defaultConfig",get:function(){return{}}}]),i})(tt),Cs=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"onGapJump",function(){var a=P(t),u=a.player,l=a.config;if(u.media.readyState!==HTMLMediaElement.HAVE_NOTHING){if(u.media.seeking){if(!t.seekingEventReceived)return}else t.seekingEventReceived=!1;if(!(u.media.paused&&u.media.currentTime!==0&&t.hasPlayed)){var c=u.media.buffered,f=l.smallGapLimit||.5,h=l.gapDetectionThreshold||.3,d=u.media.currentTime,v=t._getIndex(c,d,h);if(!(v===null||v===0)){console.log("GapJump  bufferRange ",c.start(v),c.end(v));var y=c.start(v)+.1,p=u.media.duration;if(!(y>p)){var b=y-d,k=b<=f;b<i.BROWSER_GAP_TOLERANCE||k&&(l.useGapJump!==!1&&(u.media.currentTime=t.isSafari?y+.1:y),t.player&&t.player.emit("detectGap"),console.log("gapJump gapIndex",v," isGapSamll:",k," currentTime:",u.media.currentTime," jumpSize:",d-u.media.currentTime),y!==.08&&u&&u.emit("log",{type:"oneevent",end_type:"gap",vid:u.config.vid,ext:{video_postion:Math.floor(y*1e3)}}))}}}}}),t}return q(i,[{key:"afterCreate",value:function(){var e=this,r=this.config.useGapJump;r!==!1&&(this.hasPlayed=!1,this.seekingEventReceived=!1,this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),this.on(Si,this.onGapJump),this.on(Qe,function(){e.hasPlayed=!0}),this.on(rr,function(){e.seekingEventReceived=!0}))}},{key:"_getIndex",value:function(e,r,n){if(!e||!e.length||e.length===1&&e.end(0)-e.start(0)<1e-6)return null;for(var a=this._getBuffered(e),u=null,l=0;l<a.length;l++){var c=a[l];if(c.start>r&&(l===0||a[l-1].end-r<=n)){u=l;break}}return u}},{key:"_getBuffered",value:function(e){if(!e)return[];for(var r=[],n=0;n<e.length;n++)r.push({start:e.start(n),end:e.end(n)});return r}}],[{key:"pluginName",get:function(){return"gapJump"}},{key:"defaultConfig",get:function(){return{useGapJump:!1,smallGapLimit:.5,gapDetectionThreshold:.3}}}]),i})(pe);Cs.BROWSER_GAP_TOLERANCE=.001;var ml=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"onWaiting",function(){var a=P(t),u=a.config;t.jumpCnt>u.jumpCntMax||t.timer||u.useWaitingTimeoutJump===!1||(t.timer=setTimeout(t.onJump,u.waitingTime*1e3))}),I(P(t),"onJump",function(){var a=P(t),u=a.player,l=a.config;if(clearTimeout(t.timer),t.timer=null,!(t.jumpCnt>l.jumpCntMax||l.useWaitingTimeoutJump===!1)&&!(u.media.paused&&u.media.currentTime!==0&&t.hasPlayed)){t.jumpSize=l.jumpSize*(t.jumpCnt+1),t.jumpCnt===l.jumpSize&&t.jumpSize<6&&(t.jumpSize=6);var c=u.currentTime+t.jumpSize,f=u.media.duration;c>f||(t.jumpCnt++,u.currentTime=c)}}),t}return q(i,[{key:"afterCreate",value:function(){var e=this,r=this.config,n=r.useWaitingTimeoutJump,a=r.jumpSize;n!==!1&&(this.hasPlayed=!1,this.jumpCnt=0,this.timer=null,this.jumpSize=a,this.on(Si,this.onWaiting),this.on([vn,gt],function(){clearTimeout(e.timer),e.timer=null,e.jumpSize=e.config.jumpSize}),this.on(Qe,function(){e.hasPlayed=!0}))}}],[{key:"pluginName",get:function(){return"waitingTimeoutJump"}},{key:"defaultConfig",get:function(){return{useWaitingTimeoutJump:!1,waitingTime:15,jumpSize:2,jumpCntMax:4}}}]),i})(pe),ei="cdn",Ii=["cdn"],yl=(function(s){J(i,s);var o=ee(i);function i(){var t;X(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),I(P(t),"getSpeed",function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ei;if(!t.speedListCache||!t.speedListCache[a]||t.speedListCache[a].length<=0)return 0;var u=0;return t.speedListCache[a].map(function(l){u+=l}),Math.floor(u/t.speedListCache[a].length)}),I(P(t),"startTimer",function(){g.isMSE(t.player.video)||(t.initSpeedList(),t.cnt=0,t.timer=setTimeout(t.testSpeed,t.config.testTimeStep))}),I(P(t),"initSpeedList",function(){t.speedListCache={},Ii.forEach(function(a){t.speedListCache[a]=[]})}),I(P(t),"_onRealSpeedChange",function(a){a.speed&&t.appendList(a.speed,a.type||ei)}),I(P(t),"testSpeed",function(){if(clearTimeout(t.timer),t.timer=null,!(!t.player||!t.config.openSpeed)){var a=t.config,u=a.url,l=a.loadSize,c=a.testCnt,f=a.testTimeStep,h=u+(u.indexOf("?")<0?"?testst=":"&testst=")+Date.now();if(!(t.cnt>=c)){t.cnt++;try{var d=new Date().getTime(),v=null,y=new XMLHttpRequest;t.xhr=y,y.open("GET",h);var p={},b=Math.floor(Math.random()*10);p.Range="bytes="+b+"-"+(l+b),p&&Object.keys(p).forEach(function(k){y.setRequestHeader(k,p[k])}),y.onreadystatechange=function(){if(y.readyState===4){t.xhr=null,v=new Date().getTime();var k=y.getResponseHeader("Content-Length")/1024*8,E=Math.round(k*1e3/(v-d));t.appendList(E),t.timer=setTimeout(t.testSpeed,f)}},y.send()}catch(k){console.error(k)}}}}),I(P(t),"appendList",function(a){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ei;if(!(!t.speedListCache||!t.speedListCache[u])){var l=t.config.saveSpeedMax;t.speedListCache[u].length>=l&&t.speedListCache[u].shift(),t.speedListCache[u].push(a);var c=P(t),f=c.player;f&&(u===ei?f.realTimeSpeed=a:f[t.getSpeedName("realTime",u)]=a),t.updateSpeed(u)}}),I(P(t),"updateSpeed",function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ei,u=t.getSpeed(a),l=P(t),c=l.player;if(c)if(a===ei)(!c.avgSpeed||u!==c.avgSpeed)&&(c.avgSpeed=u,c.emit(Wr,{speed:u,realTimeSpeed:c.realTimeSpeed}));else{var f=t.getSpeedName("avg",a);(!c[f]||u!==c[f])&&(c[f]=u,c.emit(Wr,{speed:u,realTimeSpeed:c.realTimeSpeed}))}}),t}return q(i,[{key:"afterCreate",value:function(){var e=this.config,r=e.openSpeed,n=e.addSpeedTypeList;(n==null?void 0:n.length)>0&&Ii.push.apply(Ii,nt(n)),this.initSpeedList(),this.on("real_time_speed",this._onRealSpeedChange),this.timer=null,this.cnt=0,this.xhr=null,r&&this.on([bt,ji],this.startTimer)}},{key:"getSpeedName",value:function(e,r){return e+"Speed"+r.toUpperCase()}},{key:"openSpeed",get:function(){return this.config.openSpeed},set:function(e){if(this.config.openSpeed=e,!e&&this.timer){clearTimeout(this.timer),this.timer=null;return}if(this.config.openSpeed){if(this.timer)return;this.timer=setTimeout(this.testSpeed,this.config.testTimeStep)}}},{key:"destroy",value:function(){var e=this;this.off("real_time_speed",this._onRealSpeedChange),this.off([bt,ji],this.startTimer),Ii.forEach(function(r){e.speedListCache&&e.speedListCache[r]&&(e.speedListCache[r]=[])}),this.speedListCache&&(this.speedListCache={}),clearTimeout(this.timer),this.timer=null,this.xhr&&this.xhr.readyState!==4&&(this.xhr.cancel&&this.xhr.cancel(),this.xhr=null)}}],[{key:"pluginName",get:function(){return"testspeed"}},{key:"defaultConfig",get:function(){return{openSpeed:!1,testCnt:3,loadSize:200*1024,testTimeStep:3e3,url:"",saveSpeedMax:5,addSpeedTypeList:[]}}}]),i})(pe),_l=(function(s){J(i,s);var o=ee(i);function i(){return X(this,i),o.apply(this,arguments)}return q(i,[{key:"afterCreate",value:function(){var e=this,r=this.player,n=this.config,a=r.media||r.video;if(this.timer=null,this._lastDecodedFrames=0,this._currentStuckCount=0,this._lastCheckPoint=null,this._payload=[],!n.disabled){var u=a.getVideoPlaybackQuality;u&&(this.on(Qe,function(){e._startTick()}),this.on(ui,function(){e._stopTick()}),this.on(zt,function(){e._stopTick()}),this.on($t,function(){e._stopTick()}))}}},{key:"_startTick",value:function(){var e=this;this._stopTick(),this._timer=setTimeout(function(){e._checkDecodeFPS(),e._startTick()},this.config.tick)}},{key:"_stopTick",value:function(){clearTimeout(this._timer),this._timer=null}},{key:"_checkBuffer",value:function(e,r){for(var n=!1,a=[],u=0;u<r.length;u++){var l=r.start(u),c=r.end(u);if(a.push({start:l,end:c}),l<=e&&e<=c-1){n=!0;break}}return{enoughBuffer:n,buffers:a}}},{key:"_checkStuck",value:function(e,r,n,a){var u=this.player.media||this.player.video,l=document.hidden,c=u.paused,f=u.readyState,h=u.currentTime,d=u.buffered;if(!(l||c||f<4)){var v=this._checkBuffer(h,d),y=v.enoughBuffer,p=v.buffers;y&&(e<=this.config.reportFrame?(this._currentStuckCount++,this._payload.push({currentTime:h,buffers:p,curDecodedFrames:e,totalVideoFrames:r,droppedVideoFrames:n,checkInterval:a}),this._currentStuckCount>=this.config.stuckCount&&(this.emit(ds,this._payload),this._reset())):this._reset())}}},{key:"_reset",value:function(){this._payload=[],this._currentStuckCount=0}},{key:"_checkDecodeFPS",value:function(){var e=this.player.media||this.player.video;if(e){var r=e.getVideoPlaybackQuality(),n=r.totalVideoFrames,a=r.droppedVideoFrames,u=performance.now();if(n&&this._lastCheckPoint){var l=n-this._lastDecodedFrames,c=u-this._lastCheckPoint;this._checkStuck(l,n,a,c)}this._lastDecodedFrames=n,this._lastCheckPoint=u}}},{key:"destroy",value:function(){this._stopTick()}}],[{key:"pluginName",get:function(){return"FpsDetect"}},{key:"defaultConfig",get:function(){return{disabled:!1,tick:1e3,stuckCount:3,reportFrame:0}}}]),i})(pe);ri.use(pl);var bl=q(function s(o,i){var t,e,r;X(this,s);var n=i&&i.isMobileSimulateMode==="mobile",a=i.isLive,u=a?[]:[Vu,Ss,fl,ll,Es],l=[].concat(u,[bs,_s,ju,Yu,nl,al,el,tl,ks,$u]),c=[ku,Tu,Cu,Hu,Au,sl,ol,cl,Iu];this.plugins=[gl,Su].concat(nt(l),c,[Cs,ml]);var f=n?"mobile":ue.device;switch(f){case"pc":(t=this.plugins).push.apply(t,[fa,Tr,Yr,yl,_l]);break;case"mobile":(e=this.plugins).push.apply(e,[Fu]);break;default:(r=this.plugins).push.apply(r,[fa,Tr,Yr])}(ue.os.isIpad||f==="pc")&&this.plugins.push(vl),ue.os.isIpad&&this.plugins.push(Tr),this.ignores=[],this.i18n=[]}),Me=(function(s){J(i,s);var o=ee(i);function i(){return X(this,i),o.apply(this,arguments)}return q(i)})(sr);I(Me,"defaultPreset",bl);I(Me,"Util",g);I(Me,"Sniffer",ue);I(Me,"Errors",si);I(Me,"Events",Go);I(Me,"Plugin",pe);I(Me,"BasePlugin",tt);I(Me,"I18N",ri);I(Me,"STATE_CLASS",H);I(Me,"InstManager",ys);I(Me,"PlayIcon",bs);I(Me,"TimeIcon",Es);I(Me,"Progress",Ss);I(Me,"FullscreenIcon",_s);I(Me,"CssFullscreenIcon",Yr);I(Me,"VolumeIcon",ks);function Sl(s,o){var i=s==null?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(i!=null){var t,e,r,n,a=[],u=!0,l=!1;try{if(r=(i=i.call(s)).next,o===0){if(Object(i)!==i)return;u=!1}else for(;!(u=(t=r.call(i)).done)&&(a.push(t.value),a.length!==o);u=!0);}catch(c){l=!0,e=c}finally{try{if(!u&&i.return!=null&&(n=i.return(),Object(n)!==n))return}finally{if(l)throw e}}return a}}function pa(s,o){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);o&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable})),i.push.apply(i,t)}return i}function de(s){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?arguments[o]:{};o%2?pa(Object(i),!0).forEach(function(t){A(s,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):pa(Object(i)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(i,t))})}return s}function z(){z=function(){return s};var s={},o=Object.prototype,i=o.hasOwnProperty,t=Object.defineProperty||function(m,_,S){m[_]=S.value},e=typeof Symbol=="function"?Symbol:{},r=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",a=e.toStringTag||"@@toStringTag";function u(m,_,S){return Object.defineProperty(m,_,{value:S,enumerable:!0,configurable:!0,writable:!0}),m[_]}try{u({},"")}catch{u=function(_,S,D){return _[S]=D}}function l(m,_,S,D){var C=_&&_.prototype instanceof h?_:h,R=Object.create(C.prototype),V=new x(D||[]);return t(R,"_invoke",{value:T(m,S,V)}),R}function c(m,_,S){try{return{type:"normal",arg:m.call(_,S)}}catch(D){return{type:"throw",arg:D}}}s.wrap=l;var f={};function h(){}function d(){}function v(){}var y={};u(y,r,function(){return this});var p=Object.getPrototypeOf,b=p&&p(p(U([])));b&&b!==o&&i.call(b,r)&&(y=b);var k=v.prototype=h.prototype=Object.create(y);function E(m){["next","throw","return"].forEach(function(_){u(m,_,function(S){return this._invoke(_,S)})})}function w(m,_){function S(C,R,V,K){var Y=c(m[C],m,R);if(Y.type!=="throw"){var G=Y.arg,ke=G.value;return ke&&typeof ke=="object"&&i.call(ke,"__await")?_.resolve(ke.__await).then(function(Z){S("next",Z,V,K)},function(Z){S("throw",Z,V,K)}):_.resolve(ke).then(function(Z){G.value=Z,V(G)},function(Z){return S("throw",Z,V,K)})}K(Y.arg)}var D;t(this,"_invoke",{value:function(C,R){function V(){return new _(function(K,Y){S(C,R,K,Y)})}return D=D?D.then(V,V):V()}})}function T(m,_,S){var D="suspendedStart";return function(C,R){if(D==="executing")throw new Error("Generator is already running");if(D==="completed"){if(C==="throw")throw R;return W()}for(S.method=C,S.arg=R;;){var V=S.delegate;if(V){var K=L(V,S);if(K){if(K===f)continue;return K}}if(S.method==="next")S.sent=S._sent=S.arg;else if(S.method==="throw"){if(D==="suspendedStart")throw D="completed",S.arg;S.dispatchException(S.arg)}else S.method==="return"&&S.abrupt("return",S.arg);D="executing";var Y=c(m,_,S);if(Y.type==="normal"){if(D=S.done?"completed":"suspendedYield",Y.arg===f)continue;return{value:Y.arg,done:S.done}}Y.type==="throw"&&(D="completed",S.method="throw",S.arg=Y.arg)}}}function L(m,_){var S=_.method,D=m.iterator[S];if(D===void 0)return _.delegate=null,S==="throw"&&m.iterator.return&&(_.method="return",_.arg=void 0,L(m,_),_.method==="throw")||S!=="return"&&(_.method="throw",_.arg=new TypeError("The iterator does not provide a '"+S+"' method")),f;var C=c(D,m.iterator,_.arg);if(C.type==="throw")return _.method="throw",_.arg=C.arg,_.delegate=null,f;var R=C.arg;return R?R.done?(_[m.resultName]=R.value,_.next=m.nextLoc,_.method!=="return"&&(_.method="next",_.arg=void 0),_.delegate=null,f):R:(_.method="throw",_.arg=new TypeError("iterator result is not an object"),_.delegate=null,f)}function O(m){var _={tryLoc:m[0]};1 in m&&(_.catchLoc=m[1]),2 in m&&(_.finallyLoc=m[2],_.afterLoc=m[3]),this.tryEntries.push(_)}function B(m){var _=m.completion||{};_.type="normal",delete _.arg,m.completion=_}function x(m){this.tryEntries=[{tryLoc:"root"}],m.forEach(O,this),this.reset(!0)}function U(m){if(m){var _=m[r];if(_)return _.call(m);if(typeof m.next=="function")return m;if(!isNaN(m.length)){var S=-1,D=function C(){for(;++S<m.length;)if(i.call(m,S))return C.value=m[S],C.done=!1,C;return C.value=void 0,C.done=!0,C};return D.next=D}}return{next:W}}function W(){return{value:void 0,done:!0}}return d.prototype=v,t(k,"constructor",{value:v,configurable:!0}),t(v,"constructor",{value:d,configurable:!0}),d.displayName=u(v,a,"GeneratorFunction"),s.isGeneratorFunction=function(m){var _=typeof m=="function"&&m.constructor;return!!_&&(_===d||(_.displayName||_.name)==="GeneratorFunction")},s.mark=function(m){return Object.setPrototypeOf?Object.setPrototypeOf(m,v):(m.__proto__=v,u(m,a,"GeneratorFunction")),m.prototype=Object.create(k),m},s.awrap=function(m){return{__await:m}},E(w.prototype),u(w.prototype,n,function(){return this}),s.AsyncIterator=w,s.async=function(m,_,S,D,C){C===void 0&&(C=Promise);var R=new w(l(m,_,S,D),C);return s.isGeneratorFunction(_)?R:R.next().then(function(V){return V.done?V.value:R.next()})},E(k),u(k,a,"Generator"),u(k,r,function(){return this}),u(k,"toString",function(){return"[object Generator]"}),s.keys=function(m){var _=Object(m),S=[];for(var D in _)S.push(D);return S.reverse(),function C(){for(;S.length;){var R=S.pop();if(R in _)return C.value=R,C.done=!1,C}return C.done=!0,C}},s.values=U,x.prototype={constructor:x,reset:function(m){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(B),!m)for(var _ in this)_.charAt(0)==="t"&&i.call(this,_)&&!isNaN(+_.slice(1))&&(this[_]=void 0)},stop:function(){this.done=!0;var m=this.tryEntries[0].completion;if(m.type==="throw")throw m.arg;return this.rval},dispatchException:function(m){if(this.done)throw m;var _=this;function S(Y,G){return R.type="throw",R.arg=m,_.next=Y,G&&(_.method="next",_.arg=void 0),!!G}for(var D=this.tryEntries.length-1;D>=0;--D){var C=this.tryEntries[D],R=C.completion;if(C.tryLoc==="root")return S("end");if(C.tryLoc<=this.prev){var V=i.call(C,"catchLoc"),K=i.call(C,"finallyLoc");if(V&&K){if(this.prev<C.catchLoc)return S(C.catchLoc,!0);if(this.prev<C.finallyLoc)return S(C.finallyLoc)}else if(V){if(this.prev<C.catchLoc)return S(C.catchLoc,!0)}else{if(!K)throw new Error("try statement without catch or finally");if(this.prev<C.finallyLoc)return S(C.finallyLoc)}}}},abrupt:function(m,_){for(var S=this.tryEntries.length-1;S>=0;--S){var D=this.tryEntries[S];if(D.tryLoc<=this.prev&&i.call(D,"finallyLoc")&&this.prev<D.finallyLoc){var C=D;break}}C&&(m==="break"||m==="continue")&&C.tryLoc<=_&&_<=C.finallyLoc&&(C=null);var R=C?C.completion:{};return R.type=m,R.arg=_,C?(this.method="next",this.next=C.finallyLoc,f):this.complete(R)},complete:function(m,_){if(m.type==="throw")throw m.arg;return m.type==="break"||m.type==="continue"?this.next=m.arg:m.type==="return"?(this.rval=this.arg=m.arg,this.method="return",this.next="end"):m.type==="normal"&&_&&(this.next=_),f},finish:function(m){for(var _=this.tryEntries.length-1;_>=0;--_){var S=this.tryEntries[_];if(S.finallyLoc===m)return this.complete(S.completion,S.afterLoc),B(S),f}},catch:function(m){for(var _=this.tryEntries.length-1;_>=0;--_){var S=this.tryEntries[_];if(S.tryLoc===m){var D=S.completion;if(D.type==="throw"){var C=D.arg;B(S)}return C}}throw new Error("illegal catch attempt")},delegateYield:function(m,_,S){return this.delegate={iterator:U(m),resultName:_,nextLoc:S},this.method==="next"&&(this.arg=void 0),f}},s}function gi(s){"@babel/helpers - typeof";return gi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},gi(s)}function ga(s,o,i,t,e,r,n){try{var a=s[r](n),u=a.value}catch(l){i(l);return}a.done?o(u):Promise.resolve(u).then(t,e)}function fe(s){return function(){var o=this,i=arguments;return new Promise(function(t,e){var r=s.apply(o,i);function n(u){ga(r,t,e,n,a,"next",u)}function a(u){ga(r,t,e,n,a,"throw",u)}n(void 0)})}}function De(s,o){if(!(s instanceof o))throw new TypeError("Cannot call a class as a function")}function ma(s,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,Ds(t.key),t)}}function Pe(s,o,i){return o&&ma(s.prototype,o),i&&ma(s,i),Object.defineProperty(s,"prototype",{writable:!1}),s}function A(s,o,i){return o=Ds(o),o in s?Object.defineProperty(s,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[o]=i,s}function or(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(o&&o.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),o&&Xr(s,o)}function Zi(s){return Zi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Zi(s)}function Xr(s,o){return Xr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Xr(s,o)}function El(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function kl(s,o){if(s==null)return{};var i={},t=Object.keys(s),e,r;for(r=0;r<t.length;r++)e=t[r],!(o.indexOf(e)>=0)&&(i[e]=s[e]);return i}function qr(s,o){if(s==null)return{};var i=kl(s,o),t,e;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);for(e=0;e<r.length;e++)t=r[e],!(o.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(s,t)&&(i[t]=s[t])}return i}function ae(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function Tl(s,o){if(o&&(typeof o=="object"||typeof o=="function"))return o;if(o!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ae(s)}function ur(s){var o=El();return function(){var t=Zi(s),e;if(o){var r=Zi(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Tl(this,e)}}function St(s,o){return Al(s)||Sl(s,o)||As(s,o)||Ll()}function wl(s){return Cl(s)||Dl(s)||As(s)||Pl()}function Cl(s){if(Array.isArray(s))return Qr(s)}function Al(s){if(Array.isArray(s))return s}function Dl(s){if(typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)}function As(s,o){if(s){if(typeof s=="string")return Qr(s,o);var i=Object.prototype.toString.call(s).slice(8,-1);if(i==="Object"&&s.constructor&&(i=s.constructor.name),i==="Map"||i==="Set")return Array.from(s);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Qr(s,o)}}function Qr(s,o){(o==null||o>s.length)&&(o=s.length);for(var i=0,t=new Array(o);i<o;i++)t[i]=s[i];return t}function Pl(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ll(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Il(s,o){if(typeof s!="object"||s===null)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var t=i.call(s,o);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}function Ds(s){var o=Il(s,"string");return typeof o=="symbol"?o:String(o)}function ya(s,o){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);o&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable})),i.push.apply(i,t)}return i}function mi(s){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?arguments[o]:{};o%2?ya(Object(i),!0).forEach(function(t){M(s,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):ya(Object(i)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(i,t))})}return s}function Le(){Le=function(){return s};var s={},o=Object.prototype,i=o.hasOwnProperty,t=Object.defineProperty||function(m,_,S){m[_]=S.value},e=typeof Symbol=="function"?Symbol:{},r=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",a=e.toStringTag||"@@toStringTag";function u(m,_,S){return Object.defineProperty(m,_,{value:S,enumerable:!0,configurable:!0,writable:!0}),m[_]}try{u({},"")}catch{u=function(_,S,D){return _[S]=D}}function l(m,_,S,D){var C=_&&_.prototype instanceof h?_:h,R=Object.create(C.prototype),V=new x(D||[]);return t(R,"_invoke",{value:T(m,S,V)}),R}function c(m,_,S){try{return{type:"normal",arg:m.call(_,S)}}catch(D){return{type:"throw",arg:D}}}s.wrap=l;var f={};function h(){}function d(){}function v(){}var y={};u(y,r,function(){return this});var p=Object.getPrototypeOf,b=p&&p(p(U([])));b&&b!==o&&i.call(b,r)&&(y=b);var k=v.prototype=h.prototype=Object.create(y);function E(m){["next","throw","return"].forEach(function(_){u(m,_,function(S){return this._invoke(_,S)})})}function w(m,_){function S(C,R,V,K){var Y=c(m[C],m,R);if(Y.type!=="throw"){var G=Y.arg,ke=G.value;return ke&&typeof ke=="object"&&i.call(ke,"__await")?_.resolve(ke.__await).then(function(Z){S("next",Z,V,K)},function(Z){S("throw",Z,V,K)}):_.resolve(ke).then(function(Z){G.value=Z,V(G)},function(Z){return S("throw",Z,V,K)})}K(Y.arg)}var D;t(this,"_invoke",{value:function(C,R){function V(){return new _(function(K,Y){S(C,R,K,Y)})}return D=D?D.then(V,V):V()}})}function T(m,_,S){var D="suspendedStart";return function(C,R){if(D==="executing")throw new Error("Generator is already running");if(D==="completed"){if(C==="throw")throw R;return W()}for(S.method=C,S.arg=R;;){var V=S.delegate;if(V){var K=L(V,S);if(K){if(K===f)continue;return K}}if(S.method==="next")S.sent=S._sent=S.arg;else if(S.method==="throw"){if(D==="suspendedStart")throw D="completed",S.arg;S.dispatchException(S.arg)}else S.method==="return"&&S.abrupt("return",S.arg);D="executing";var Y=c(m,_,S);if(Y.type==="normal"){if(D=S.done?"completed":"suspendedYield",Y.arg===f)continue;return{value:Y.arg,done:S.done}}Y.type==="throw"&&(D="completed",S.method="throw",S.arg=Y.arg)}}}function L(m,_){var S=_.method,D=m.iterator[S];if(D===void 0)return _.delegate=null,S==="throw"&&m.iterator.return&&(_.method="return",_.arg=void 0,L(m,_),_.method==="throw")||S!=="return"&&(_.method="throw",_.arg=new TypeError("The iterator does not provide a '"+S+"' method")),f;var C=c(D,m.iterator,_.arg);if(C.type==="throw")return _.method="throw",_.arg=C.arg,_.delegate=null,f;var R=C.arg;return R?R.done?(_[m.resultName]=R.value,_.next=m.nextLoc,_.method!=="return"&&(_.method="next",_.arg=void 0),_.delegate=null,f):R:(_.method="throw",_.arg=new TypeError("iterator result is not an object"),_.delegate=null,f)}function O(m){var _={tryLoc:m[0]};1 in m&&(_.catchLoc=m[1]),2 in m&&(_.finallyLoc=m[2],_.afterLoc=m[3]),this.tryEntries.push(_)}function B(m){var _=m.completion||{};_.type="normal",delete _.arg,m.completion=_}function x(m){this.tryEntries=[{tryLoc:"root"}],m.forEach(O,this),this.reset(!0)}function U(m){if(m){var _=m[r];if(_)return _.call(m);if(typeof m.next=="function")return m;if(!isNaN(m.length)){var S=-1,D=function C(){for(;++S<m.length;)if(i.call(m,S))return C.value=m[S],C.done=!1,C;return C.value=void 0,C.done=!0,C};return D.next=D}}return{next:W}}function W(){return{value:void 0,done:!0}}return d.prototype=v,t(k,"constructor",{value:v,configurable:!0}),t(v,"constructor",{value:d,configurable:!0}),d.displayName=u(v,a,"GeneratorFunction"),s.isGeneratorFunction=function(m){var _=typeof m=="function"&&m.constructor;return!!_&&(_===d||(_.displayName||_.name)==="GeneratorFunction")},s.mark=function(m){return Object.setPrototypeOf?Object.setPrototypeOf(m,v):(m.__proto__=v,u(m,a,"GeneratorFunction")),m.prototype=Object.create(k),m},s.awrap=function(m){return{__await:m}},E(w.prototype),u(w.prototype,n,function(){return this}),s.AsyncIterator=w,s.async=function(m,_,S,D,C){C===void 0&&(C=Promise);var R=new w(l(m,_,S,D),C);return s.isGeneratorFunction(_)?R:R.next().then(function(V){return V.done?V.value:R.next()})},E(k),u(k,a,"Generator"),u(k,r,function(){return this}),u(k,"toString",function(){return"[object Generator]"}),s.keys=function(m){var _=Object(m),S=[];for(var D in _)S.push(D);return S.reverse(),function C(){for(;S.length;){var R=S.pop();if(R in _)return C.value=R,C.done=!1,C}return C.done=!0,C}},s.values=U,x.prototype={constructor:x,reset:function(m){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(B),!m)for(var _ in this)_.charAt(0)==="t"&&i.call(this,_)&&!isNaN(+_.slice(1))&&(this[_]=void 0)},stop:function(){this.done=!0;var m=this.tryEntries[0].completion;if(m.type==="throw")throw m.arg;return this.rval},dispatchException:function(m){if(this.done)throw m;var _=this;function S(Y,G){return R.type="throw",R.arg=m,_.next=Y,G&&(_.method="next",_.arg=void 0),!!G}for(var D=this.tryEntries.length-1;D>=0;--D){var C=this.tryEntries[D],R=C.completion;if(C.tryLoc==="root")return S("end");if(C.tryLoc<=this.prev){var V=i.call(C,"catchLoc"),K=i.call(C,"finallyLoc");if(V&&K){if(this.prev<C.catchLoc)return S(C.catchLoc,!0);if(this.prev<C.finallyLoc)return S(C.finallyLoc)}else if(V){if(this.prev<C.catchLoc)return S(C.catchLoc,!0)}else{if(!K)throw new Error("try statement without catch or finally");if(this.prev<C.finallyLoc)return S(C.finallyLoc)}}}},abrupt:function(m,_){for(var S=this.tryEntries.length-1;S>=0;--S){var D=this.tryEntries[S];if(D.tryLoc<=this.prev&&i.call(D,"finallyLoc")&&this.prev<D.finallyLoc){var C=D;break}}C&&(m==="break"||m==="continue")&&C.tryLoc<=_&&_<=C.finallyLoc&&(C=null);var R=C?C.completion:{};return R.type=m,R.arg=_,C?(this.method="next",this.next=C.finallyLoc,f):this.complete(R)},complete:function(m,_){if(m.type==="throw")throw m.arg;return m.type==="break"||m.type==="continue"?this.next=m.arg:m.type==="return"?(this.rval=this.arg=m.arg,this.method="return",this.next="end"):m.type==="normal"&&_&&(this.next=_),f},finish:function(m){for(var _=this.tryEntries.length-1;_>=0;--_){var S=this.tryEntries[_];if(S.finallyLoc===m)return this.complete(S.completion,S.afterLoc),B(S),f}},catch:function(m){for(var _=this.tryEntries.length-1;_>=0;--_){var S=this.tryEntries[_];if(S.tryLoc===m){var D=S.completion;if(D.type==="throw"){var C=D.arg;B(S)}return C}}throw new Error("illegal catch attempt")},delegateYield:function(m,_,S){return this.delegate={iterator:U(m),resultName:_,nextLoc:S},this.method==="next"&&(this.arg=void 0),f}},s}function Ht(s){"@babel/helpers - typeof";return Ht=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Ht(s)}function _a(s,o,i,t,e,r,n){try{var a=s[r](n),u=a.value}catch(l){i(l);return}a.done?o(u):Promise.resolve(u).then(t,e)}function yt(s){return function(){var o=this,i=arguments;return new Promise(function(t,e){var r=s.apply(o,i);function n(u){_a(r,t,e,n,a,"next",u)}function a(u){_a(r,t,e,n,a,"throw",u)}n(void 0)})}}function Ke(s,o){if(!(s instanceof o))throw new TypeError("Cannot call a class as a function")}function ba(s,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,Ls(t.key),t)}}function Ye(s,o,i){return o&&ba(s.prototype,o),i&&ba(s,i),Object.defineProperty(s,"prototype",{writable:!1}),s}function M(s,o,i){return o=Ls(o),o in s?Object.defineProperty(s,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[o]=i,s}function ki(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(o&&o.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),o&&yi(s,o)}function Vt(s){return Vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Vt(s)}function yi(s,o){return yi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yi(s,o)}function Ps(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Vi(s,o,i){return Ps()?Vi=Reflect.construct.bind():Vi=function(e,r,n){var a=[null];a.push.apply(a,r);var u=Function.bind.apply(e,a),l=new u;return n&&yi(l,n.prototype),l},Vi.apply(null,arguments)}function xl(s){return Function.toString.call(s).indexOf("[native code]")!==-1}function Ji(s){var o=typeof Map=="function"?new Map:void 0;return Ji=function(t){if(t===null||!xl(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof o<"u"){if(o.has(t))return o.get(t);o.set(t,e)}function e(){return Vi(t,arguments,Vt(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),yi(e,t)},Ji(s)}function Ol(s,o){if(s==null)return{};var i={},t=Object.keys(s),e,r;for(r=0;r<t.length;r++)e=t[r],!(o.indexOf(e)>=0)&&(i[e]=s[e]);return i}function Rl(s,o){if(s==null)return{};var i=Ol(s,o),t,e;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);for(e=0;e<r.length;e++)t=r[e],!(o.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(s,t)&&(i[t]=s[t])}return i}function Q(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function Ml(s,o){if(o&&(typeof o=="object"||typeof o=="function"))return o;if(o!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Q(s)}function Ti(s){var o=Ps();return function(){var t=Vt(s),e;if(o){var r=Vt(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return Ml(this,e)}}function Nl(s,o){for(;!Object.prototype.hasOwnProperty.call(s,o)&&(s=Vt(s),s!==null););return s}function Gi(){return typeof Reflect<"u"&&Reflect.get?Gi=Reflect.get.bind():Gi=function(o,i,t){var e=Nl(o,i);if(e){var r=Object.getOwnPropertyDescriptor(e,i);return r.get?r.get.call(arguments.length<3?o:t):r.value}},Gi.apply(this,arguments)}function Fl(s,o){if(s){if(typeof s=="string")return Sa(s,o);var i=Object.prototype.toString.call(s).slice(8,-1);if(i==="Object"&&s.constructor&&(i=s.constructor.name),i==="Map"||i==="Set")return Array.from(s);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Sa(s,o)}}function Sa(s,o){(o==null||o>s.length)&&(o=s.length);for(var i=0,t=new Array(o);i<o;i++)t[i]=s[i];return t}function Bl(s,o){var i=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(!i){if(Array.isArray(s)||(i=Fl(s))||o){i&&(s=i);var t=0,e=function(){};return{s:e,n:function(){return t>=s.length?{done:!0}:{done:!1,value:s[t++]}},e:function(u){throw u},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r=!0,n=!1,a;return{s:function(){i=i.call(s)},n:function(){var u=i.next();return r=u.done,u},e:function(u){n=!0,a=u},f:function(){try{!r&&i.return!=null&&i.return()}finally{if(n)throw a}}}}function Ul(s,o){if(typeof s!="object"||s===null)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var t=i.call(s,o);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}function Ls(s){var o=Ul(s,"string");return typeof o=="symbol"?o:String(o)}var Ce=(function(){function s(){Ke(this,s)}return Ye(s,null,[{key:"start",value:function(i){return!i||!i.length||i.length===1&&i.end(0)-i.start(0)<1e-6||i.length===1&&i.start(0)<0?0:i.start(0)}},{key:"end",value:function(i){return!i||!i.length||i.length===1&&i.end(0)-i.start(0)<1e-6?0:i.end(i.length-1)}},{key:"get",value:function(i){if(i)try{return i.buffered}catch{}}},{key:"buffers",value:function(i,t){if(!i||!i.length)return[];for(var e=[],r=0,n=i.length;r<n;r++){var a=e.length;if(!a||!t)e.push([i.start(r),i.end(r)]);else{var u=e[a-1],l=u[1],c=i.start(r);if(c-l<=t){var f=i.end(r);f>l&&(u[1]=f)}else e.push([i.start(r),i.end(r)])}}return e}},{key:"totalLength",value:function(i){return!i||!i.length?0:i.reduce(function(t,e){return t+=e[1]-e[0]},0)}},{key:"info",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(!i||!i.length)return{start:0,end:0,buffers:[]};for(var r=0,n=0,a=0,u=0,l=0,c=0,f=0,h=s.buffers(i,e),d=0,v=h.length;d<v;d++){var y=h[d];if(t+e>=y[0]&&t<=y[1])r=y[0],n=y[1],a=d;else if(t+e<y[0]){u=y[0],l=y[1];break}else t+e>y[1]&&(c=y[0],f=y[1])}return{start:r,end:n,index:a,buffers:h,nextStart:u,nextEnd:l,prevStart:c,prevEnd:f,currentTime:t,behind:t-r,remaining:n?n-t:0,length:s.totalLength&&s.totalLength(h)}}},{key:"isBuffered",value:function(i,t){if(i){var e=s.get(i);if(e!=null&&e.length){for(var r=0;r<e.length;r++)if(t>=e.start(r)&&t<=e.end(r))return!0}}return!1}}]),s})(),Hl=typeof window<"u",Ge,ie={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",NETWORK_FORBIDDEN:"network_forbidden",NETWORK_NOTFOUND:"network_notfound",NETWROK_RANGE_NOT_SATISFIABLE:"network_range_not_satisfiable",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",RUNTIME:"runtime",SUB_TYPES:{FLV:"FLV",HLS:"HLS",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",MSE_CHANGE_TYPE:"MSE_CHANGE_TYPE",OPTION:"OPTION"}},Dr=(Ge={},M(Ge,ie.MANIFEST,{HLS:1100,DASH:1200}),M(Ge,ie.NETWORK,2100),M(Ge,ie.NETWORK_TIMEOUT,2101),M(Ge,ie.NETWORK_FORBIDDEN,2103),M(Ge,ie.NETWORK_NOTFOUND,2104),M(Ge,ie.NETWROK_RANGE_NOT_SATISFIABLE,2116),M(Ge,ie.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400,SIDX:3410}),M(Ge,ie.REMUX,{FMP4:4100,MP4:4200}),M(Ge,ie.MEDIA,{MEDIA_ERR_ABORTED:5101,MEDIA_ERR_NETWORK:5102,MEDIA_ERR_DECODE:5103,MEDIA_ERR_SRC_NOT_SUPPORTED:5104,MEDIA_ERR_CODEC_NOT_SUPPORTED:5105,MEDIA_ERR_URL_EMPTY:5106,MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203,MSE_HIJACK:5204,MSE_CHANGE_TYPE:5205,EME_HIJACK:5301}),M(Ge,ie.DRM,{LICENSE:7100,CUSTOM_LICENSE:7200}),M(Ge,ie.OTHER,8e3),M(Ge,ie.RUNTIME,{NO_CANPLAY_ERROR:9001,BUFFERBREAK_ERROR:9002,WAITING_TIMEOUT_ERROR:9003}),Ge),ye=(function(s){ki(i,s);var o=Ti(i);function i(t,e,r,n,a){var u;return Ke(this,i),u=o.call(this,a||(r==null?void 0:r.message)),u.errorType=t===ie.NETWORK_TIMEOUT?ie.NETWORK:t,u.originError=r,u.ext=n,u.errorCode=Dr[t][e]||Dr[t],u.errorMessage=u.message,u.errorCode||(u.errorType=ie.OTHER,u.errorCode=Dr[u.errorType]),u}return Ye(i,null,[{key:"create",value:function(e,r,n,a,u){return e instanceof i?e:(e instanceof Error&&(n=e,e=""),e||(e=ie.OTHER),new i(e,r,n,a,u))}},{key:"network",value:function(e){var r;return new i(e!=null&&e.isTimeout?ie.NETWORK_TIMEOUT:ie.NETWORK,null,e instanceof Error?e:null,{url:e==null?void 0:e.url,response:e==null?void 0:e.response,httpCode:e==null||(r=e.response)===null||r===void 0?void 0:r.status})}}]),i})(Ji(Error)),xi={DEBUG:1,LOG:2,WARN:3,ERROR:4},Vl=200*1024,Gl=["Boolean","Number","String","Undefined","Null","Date","Object"],$e=(function(){function s(o,i){Ke(this,s),this.name=o||"",this._prefix="[".concat(this.name,"]"),this.logCacheLevel=(i==null?void 0:i.logCacheLevel)||3,this.logMaxSize=(i==null?void 0:i.logMaxSize)||Vl,this.logSize=0,this.logTextArray=[]}return Ye(s,[{key:"debug",value:function(){for(var i,t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.logCache.apply(this,[xi.DEBUG].concat(e)),!s.disabled&&(i=console).debug.apply(i,["[".concat(fi(),"]"),this._prefix].concat(e))}},{key:"log",value:function(){for(var i,t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.logCache.apply(this,[xi.LOG].concat(e)),!s.disabled&&(i=console).log.apply(i,["[".concat(fi(),"]"),this._prefix].concat(e))}},{key:"warn",value:function(){for(var i,t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.logCache.apply(this,[xi.WARN].concat(e)),!s.disabled&&(i=console).warn.apply(i,["[".concat(fi(),"]"),this._prefix].concat(e))}},{key:"error",value:function(){for(var i,t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.logCache.apply(this,[xi.ERROR].concat(e)),!s.disabled&&(i=console).error.apply(i,["[".concat(fi(),"]"),this._prefix].concat(e))}},{key:"logCache",value:function(i){if(!(i<this.logCacheLevel)){var t="";try{for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];var a=r.map(function(l){return Is(l)});t="[".concat(fi(),"]")+this._prefix+JSON.stringify(a)}catch{return}if(i>=this.logCacheLevel&&(this.logSize+=t.length,this.logTextArray.push(t)),this.logSize>this.logMaxSize){var u=this.logTextArray.shift();this.logSize-=u.length}}}},{key:"getLogCache",value:function(){var i=this.logTextArray.join(`
`);return this.reset(),i}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var i;s.disabled||(console.group(this._prefix),(i=console).table.apply(i,arguments),console.groupEnd())}},{key:"setLogLevel",value:function(i){this.logCacheLevel=i}}],[{key:"enable",value:function(){s.disabled=!1}},{key:"disable",value:function(){s.disabled=!0}}]),s})();M($e,"disabled",!0);function fi(){return new Date().toLocaleString()}function jl(s){if(Ht(s)!=="object")return s;var o=Object.prototype.toString.call(s).slice(8,-1);switch(o){case"Array":case"Uint8Array":case"ArrayBuffer":return o+"["+s.length+"]";case"Object":return"{}";default:return o}}function Is(s,o,i){i||(i=1),o||(o=2);var t={};if(!s||Ht(s)!=="object")return s;var e=Object.prototype.toString.call(s).slice(8,-1);if(!Gl.includes(e))return e;if(!(i>o)){for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i===o?t[r]=jl(s[r]):Ht(s[r])==="object"?t[r]=Is(s[r],o,i+1):t[r]=s[r]);return t}}function ii(){var s,o,i=new Promise(function(t,e){s=t,o=e});return i.used=!1,i.resolve=function(){return i.used=!0,s.apply(void 0,arguments)},i.reject=function(){return i.used=!0,o.apply(void 0,arguments)},i}function ti(){try{return parseInt(performance.now(),10)}catch{return new Date().getTime()}}var zl={stringify:function(o){try{return JSON.stringify(o)}catch{return""}},parse:function(o){try{return JSON.parse(o)}catch{return}}};function Ea(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;try{return Hl?s&&typeof ManagedMediaSource<"u"?ManagedMediaSource:window.MediaSource:null}catch{}}function Pr(s){return/ManagedMediaSource/gi.test(Object.prototype.toString.call(s))}function Wl(s){var o=[];if(s instanceof TimeRanges)for(var i=0;i<s.length;i++)o.push({start:s.start(i),end:s.end(i)});return o}var Oi={APPEND:"appendBuffer",REMOVE:"removeBuffer",UPDATE_DURATION:"updateDuration"},Ie=(function(){function s(o,i){var t=this;Ke(this,s),M(this,"media",null),M(this,"mediaSource",null),M(this,"_openPromise",ii()),M(this,"_queue",Object.create(null)),M(this,"_sourceBuffer",Object.create(null)),M(this,"_mseFullFlag",{}),M(this,"_st",0),M(this,"_opst",0),M(this,"_logger",null),M(this,"_config",null),M(this,"_url",null),M(this,"_onStartStreaming",function(){t._logger.debug("startstreaming")}),M(this,"_onEndStreaming",function(){t._logger.debug("endstreaming")}),M(this,"_onSBUpdateEnd",function(e){var r=t._queue[e];if(r){var n=r[0];if((n==null?void 0:n.opName)!==Oi.UPDATE_DURATION&&r.shift(),n){var a,u,l=ti()-t._opst;t._logger.debug("UpdateEnd(".concat(e,"/").concat(n.opName,")"),zl.stringify(Wl((a=t._sourceBuffer[e])===null||a===void 0?void 0:a.buffered)),l,n.context),n.promise.resolve({name:n.opName,context:n.context,costtime:l});var c=(u=n.context)===null||u===void 0?void 0:u.callback;c&&typeof c=="function"&&c(n.context),t._startQueue(e)}}}),M(this,"_onSBUpdateError",function(e,r){var n=t._queue[e];if(n){var a=n[0];a&&(t._logger.error("UpdateError",e,a.opName,a.context),a.promise.reject(new ye(ie.MEDIA,ie.SUB_TYPES.MSE_APPEND_BUFFER,r)))}}),this._config=Object.assign(s.getDefaultConfig(),i),o&&this.bindMedia(o),this._logger=new $e("MSE"),this._config.openLog&&$e.enable()}return Ye(s,[{key:"isOpened",get:function(){var i;return((i=this.mediaSource)===null||i===void 0?void 0:i.readyState)==="open"}},{key:"hasOpTasks",get:function(){var i=this,t=!1;return Object.keys(this._queue).forEach(function(e){var r=i._queue[e];Array.isArray(r)&&(t||(t=r.length>0))}),t}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var i;return((i=this.mediaSource)===null||i===void 0?void 0:i.duration)||-1}},{key:"isEnded",get:function(){return this.mediaSource?this.mediaSource.readyState==="ended":!1}},{key:"streaming",get:function(){return Pr(this.mediaSource)?this.mediaSource.streaming:!0}},{key:"isFull",value:function(i){return i?this._mseFullFlag[i]:this._mseFullFlag[s.VIDEO]}},{key:"updateDuration",value:function(i){var t=this,e=this.mediaSource&&this.mediaSource.duration>i;if(this.mediaSource&&this.mediaSource.duration>i){var r=0;if(Object.keys(this._sourceBuffer).forEach(function(n){try{r=Math.max(t.bufferEnd(n)||0,r)}catch{}}),i<r)return Promise.resolve()}return this._enqueueBlockingOp(function(){if(t.isEnded){t._logger.debug("setDuration but ended");return}t.mediaSource&&(t.mediaSource.duration=i,t._logger.debug("setDuration",i))},Oi.UPDATE_DURATION,{isReduceDuration:e})}},{key:"open",value:function(){var i=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource,e=function r(){var n=ti()-i._st;i._logger.debug("sourceopen",n),t.removeEventListener("sourceopen",r),i._openPromise.resolve({costtime:n})};t.addEventListener("sourceopen",e),this._openPromise=ii()}return this._openPromise}},{key:"bindMedia",value:(function(){var o=yt(Le().mark(function t(e){var r=this,n,a,u,l;return Le().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(this.mediaSource||this.media)){f.next=3;break}return f.next=3,this.unbindMedia();case 3:if(n=Ea(this._config.preferMMS),!(!e||!n)){f.next=6;break}throw new Error("Param media or MediaSource does not exist");case 6:return this.media=e,a=this.mediaSource=new n,u=Pr(a),this._st=ti(),l=function h(){var d=ti()-r._st;r._logger.debug("sourceopen"),a.removeEventListener("sourceopen",h),URL.revokeObjectURL(e.src),r._openPromise.resolve({costtime:d})},a.addEventListener("sourceopen",l),u&&(a.addEventListener("startstreaming",this._onStartStreaming),a.addEventListener("endstreaming",this._onEndStreaming)),this._url=URL.createObjectURL(a),e.src=this._url,e.disableRemotePlayback=u,f.abrupt("return",this._openPromise);case 17:case"end":return f.stop()}},t,this)}));function i(t){return o.apply(this,arguments)}return i})()},{key:"unbindMedia",value:(function(){var o=yt(Le().mark(function t(){var e=this,r,n,a;return Le().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this._openPromise.used||this._openPromise.resolve(),r=this.mediaSource,r){if(Object.keys(this._queue).forEach(function(c){var f=e._queue[c];f&&f.forEach(function(h){var d,v;return(d=h.promise)===null||d===void 0||(v=d.resolve)===null||v===void 0?void 0:v.call(d)})}),n=!!this.media&&this.media.readyState>=1,a=r.readyState==="open",n&&a)try{r.endOfStream()}catch{}Object.keys(this._sourceBuffer).forEach(function(c){try{r.removeSourceBuffer(e._sourceBuffer[c])}catch{}}),Pr(r)&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming))}if(this.media){this.media.disableRemotePlayback=!1,this.media.removeAttribute("src");try{this.media.load()}catch{}this.media=null}this.mediaSource=null,this._openPromise=ii(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return l.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i})()},{key:"createSource",value:function(i,t){if(!(this._sourceBuffer[i]||!this.mediaSource)){var e;try{e=this._sourceBuffer[i]=this.mediaSource.addSourceBuffer(t)}catch(r){throw new ye(ie.MEDIA,ie.SUB_TYPES.MSE_ADD_SB,r)}e.mimeType=t,e.addEventListener("updateend",this._onSBUpdateEnd.bind(this,i)),e.addEventListener("error",this._onSBUpdateError.bind(this,i))}}},{key:"changeType",value:function(i,t){var e=this,r=this._sourceBuffer[i];return!this.mediaSource||!r||r.mimeType===t?Promise.resolve():typeof r.changeType!="function"?Promise.reject(new ye(ie.MEDIA,ie.SUB_TYPES.MSE_CHANGE_TYPE,new Error("changeType is not a function"))):this._enqueueOp(i,function(){try{r.changeType(t)}catch(n){throw new ye(ie.MEDIA,ie.SUB_TYPES.MSE_CHANGE_TYPE,n)}r.mimeType=t,e._onSBUpdateEnd(i)},"changeType",{mimeType:t})}},{key:"createOrChangeSource",value:function(i,t){return this.createSource(i,t),this.changeType(i,t)}},{key:"append",value:function(i,t,e){var r=this;return!t||!t.byteLength||!this._sourceBuffer[i]?Promise.resolve():this._enqueueOp(i,function(){var n;!r.mediaSource||r.media.error||(r._logger.debug("MSE APPEND START",e),r._opst=ti(),(n=r._sourceBuffer[i])===null||n===void 0||n.appendBuffer(t))},Oi.APPEND,e)}},{key:"remove",value:function(i,t,e,r){var n=this,a=!1;return this._mseFullFlag[i]&&(a=!0),this._enqueueOp(i,function(){if(!(!n.mediaSource||n.media.error)){var u=n._sourceBuffer[i];if(t>=e||!u){n._onSBUpdateEnd(i);return}n._opst=ti(),n._logger.debug("MSE REMOVE START",i,t,e,r),u.remove(t,e)}},Oi.REMOVE,r,a)}},{key:"clearBuffer",value:function(i,t){var e=this,r;return Object.keys(this._sourceBuffer).forEach(function(n){r=e.remove(n,i,t)}),r||Promise.resolve()}},{key:"clearAllBuffer",value:function(){var i=this,t;return Object.keys(this._sourceBuffer).forEach(function(e){var r=i._sourceBuffer[e];t=i.remove(e,0,Ce.end(Ce.get(r)))}),t}},{key:"clearOpQueues",value:function(i,t){var e;this._logger.debug("MSE clearOpQueue START");var r=this._queue[i];if(t&&r){this._queue[i]=[];return}if(!(!r||!r[i]||r.length<5)){var n=[];r.forEach(function(a){a.context&&a.context.isinit&&n.push(a)}),this._queue[i]=r.slice(0,2),n.length>0&&(e=this._queue[i]).push.apply(e,n)}}},{key:"endOfStream",value:function(i){var t=this;return!this.mediaSource||this.mediaSource.readyState!=="open"?Promise.resolve():this._enqueueBlockingOp(function(){var e=t.mediaSource;!e||e.readyState!=="open"||(t._logger.debug("MSE endOfStream START"),i?e.endOfStream(i):e.endOfStream())},"endOfStream")}},{key:"setLiveSeekableRange",value:function(i,t){var e=this.mediaSource;i<0||t<i||!(e!=null&&e.setLiveSeekableRange)||e.readyState!=="open"||e.setLiveSeekableRange(i,t)}},{key:"getSourceBuffer",value:function(i){return this._sourceBuffer[i]}},{key:"buffered",value:function(i){return Ce.get(this._sourceBuffer[i])}},{key:"bufferStart",value:function(i){return Ce.start(this.buffered(i))}},{key:"bufferEnd",value:function(i){return Ce.end(this.buffered(i))}},{key:"_enqueueOp",value:function(i,t,e,r,n){var a=this;if(!this.mediaSource)return Promise.resolve();var u=this._queue[i]=this._queue[i]||[],l={exec:t,promise:ii(),opName:e,context:r};return n?(u.splice(0,0,l),this._mseFullFlag[i]=!1,this._startQueue(i)):u.push(l),this.isOpened||this.isEnded?u.length===1&&this._startQueue(i):this._openPromise.then(function(){u.length===1&&a._startQueue(i)}),l.promise}},{key:"_enqueueBlockingOp",value:(function(){var o=yt(Le().mark(function t(e,r,n){var a=this,u,l;return Le().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.mediaSource){f.next=2;break}return f.abrupt("return",Promise.resolve());case 2:if(u=Object.keys(this._sourceBuffer),u.length){f.next=5;break}return f.abrupt("return",e());case 5:return l=[],u.forEach(function(h){var d=a._queue[h],v=ii();l.push(v),d.push({exec:function(){v.resolve()},promise:v,opName:r,context:n}),d.length===1&&a._startQueue(h)}),f.abrupt("return",Promise.all(l).then(function(){try{return e()}finally{u.forEach(function(h){var d=a._queue[h],v=a._sourceBuffer[h];d==null||d.shift(),(!v||!v.updating)&&a._startQueue(h)})}}));case 8:case"end":return f.stop()}},t,this)}));function i(t,e,r){return o.apply(this,arguments)}return i})()},{key:"_startQueue",value:function(i){var t=this._queue[i];if(t){var e=t[0];if(e&&!this._mseFullFlag[i])try{e.exec()}catch(a){if(a&&a.message&&a.message.indexOf("SourceBuffer is full")>=0){var r;this._mseFullFlag[i]=!0,e.context&&Ht(e.context)==="object"&&(e.context.isFull=!0),this._logger.error("[MSE error],  context,",e.context," ,name,",e.opName,",err,SourceBuffer is full"),e==null||(r=e.promise)===null||r===void 0||r.reject(new ye(ie.MEDIA,ie.SUB_TYPES.MSE_FULL,a))}else{var n;this._logger.error(a),e==null||(n=e.promise)===null||n===void 0||n.reject(a.constructor===ye?a:new ye(ie.MEDIA,ie.SUB_TYPES.MSE_OTHER,a)),t.shift(),this._startQueue(i)}}}}},{key:"setTimeoffset",value:function(i,t,e){var r=this;return this._enqueueOp(i,function(){t<0&&(t+=.001),r._sourceBuffer[i].timestampOffset=t,r._onSBUpdateEnd(i)},"setTimeoffset",e)}},{key:"abort",value:function(i,t){var e=this;return this.isOpened?this._enqueueOp(i,function(){e._sourceBuffer[i].abort(),e._onSBUpdateEnd(i)},"abort",t):Promise.resolve()}}],[{key:"isSupported",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"',t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,e=Ea(t);if(!e)return!1;try{return e.isTypeSupported(i)}catch(r){return this._logger.error(i,r),!1}}},{key:"isMMSOnly",value:function(){return typeof ManagedMediaSource<"u"&&typeof MediaSource>"u"}},{key:"getDefaultConfig",value:function(){return{openLog:!1,preferMMS:!1}}}]),s})();M(Ie,"VIDEO","video");M(Ie,"AUDIO","audio");var Ft={FETCH:"fetch",XHR:"xhr"},_i={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"},ht=(function(s){ki(i,s);var o=Ti(i);function i(t,e,r,n){var a;return Ke(this,i),a=o.call(this,n),M(Q(a),"retryCount",0),M(Q(a),"isTimeout",!1),M(Q(a),"loaderType",Ft.FETCH),M(Q(a),"startTime",0),M(Q(a),"endTime",0),M(Q(a),"options",{}),a.url=t,a.request=e,a.response=r,a}return Ye(i)})(Ji(Error)),xs=Object.prototype.toString;function $l(s){return s!==null&&Ht(s)==="object"}function ka(s){if(xs.call(s)!=="[object Object]")return!1;var o=Object.getPrototypeOf(s);return o===null||o===Object.prototype}function Kl(s){return xs.call(s)==="[object Date]"}function Os(s){if(!(!s||s[0]===null||s[0]===void 0||s[0]===0&&(s[1]===null||s[1]===void 0))){var o="bytes="+s[0]+"-";return s[1]&&(o+=s[1]),o}}function Ta(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Rs(s,o){if(s){if(!o)return s;var i,t=Object.keys(o).map(function(r){if(i=o[r],i!=null)return Array.isArray(i)?r=r+"[]":i=[i],i.map(function(n){return Kl(n)?n=n.toISOString():$l(n)&&(n=JSON.stringify(n)),"".concat(Ta(r),"=").concat(Ta(n))}).join("&")}).filter(Boolean).join("&");if(t){var e=s.indexOf("#");e!==-1&&(s=s.slice(0,e)),s+=(s.indexOf("?")===-1?"?":"&")+t}return s}}function Zr(s,o,i,t,e,r,n,a,u,l,c){e=e!=null?parseFloat(e):null,t=parseInt(t||"0",10),Number.isNaN(t)&&(t=0);var f={range:u,vid:l,index:a,contentLength:t,age:e,startTime:r,firstByteTime:n,endTime:Date.now(),priOptions:c};return{data:s,done:o,options:f,response:i}}function Jr(s,o){return Math.round(s*8*1e3/o/1024)}var F={ERROR:"error",TTFB:"core.ttfb",LOAD_START:"core.loadstart",LOAD_RESPONSE_HEADERS:"core.loadresponseheaders",LOAD_COMPLETE:"core.loadcomplete",LOAD_RETRY:"core.loadretry",SOURCEBUFFER_CREATED:"core.sourcebuffercreated",MEDIASOURCE_OPENED:"core.mediasourceopened",ANALYZE_DURATION_EXCEEDED:"core.analyzedurationexceeded",APPEND_BUFFER:"core.appendbuffer",REMOVE_BUFFER:"core.removebuffer",BUFFEREOS:"core.buffereos",KEYFRAME:"core.keyframe",CHASEFRAME:"core.chaseframe",METADATA_PARSED:"core.metadataparsed",SEI:"core.sei",SEI_IN_TIME:"core.seiintime",FLV_SCRIPT_DATA:"core.flvscriptdata",LOWDECODE:"core.lowdecode",SWITCH_URL_SUCCESS:"core.switchurlsuccess",SWITCH_URL_FAILED:"core.switchurlfailed",SPEED:"core.speed",HLS_MANIFEST_LOADED:"core.hlsmanifestloaded",HLS_LEVEL_LOADED:"core.hlslevelloaded",DEMUXED_TRACK:"core.demuxedtrack",STREAM_EXCEPTION:"core.streamexception",LARGE_AV_FIRST_FRAME_GAP_DETECT:"LARGE_AV_FIRST_FRAME_GAP_DETECT",LARGE_VIDEO_DTS_GAP_DETECT:"LARGE_VIDEO_DTS_GAP_DETECT",LARGE_AUDIO_DTS_GAP_DETECT:"LARGE_AUDIO_DTS_GAP_DETECT",AUDIO_GAP_DETECT:"AUDIO_GAP_DETECT",AUDIO_OVERLAP_DETECT:"AUDIO_OVERLAP_DETECT",MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT:"MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT",REAL_TIME_SPEED:"real_time_speed"},wa=2*1024*1024,en=(function(s){ki(i,s);var o=Ti(i);function i(){var t;return Ke(this,i),t=o.call(this),M(Q(t),"_abortController",null),M(Q(t),"_timeoutTimer",null),M(Q(t),"_reader",null),M(Q(t),"_response",null),M(Q(t),"_aborted",!1),M(Q(t),"_index",-1),M(Q(t),"_range",null),M(Q(t),"_receivedLength",0),M(Q(t),"_running",!1),M(Q(t),"_logger",null),M(Q(t),"_vid",""),M(Q(t),"_firtstByte",0),M(Q(t),"_onProcessMinLen",0),M(Q(t),"_onCancel",null),M(Q(t),"_priOptions",null),t}return Ye(i,[{key:"load",value:function(e){var r,n=this,a=e.url,u=e.vid,l=e.timeout,c=e.responseType,f=e.onProgress,h=e.index,d=e.onTimeout,v=e.onCancel,y=e.range,p=e.transformResponse,b=e.request,k=e.params,E=e.logger,w=e.method,T=e.headers,L=e.body,O=e.mode,B=e.credentials,x=e.cache,U=e.redirect,W=e.referrer,m=e.referrerPolicy,_=e.onProcessMinLen,S=e.priOptions,D=e.streamRes,C=e.firstMaxChunkSize;this._logger=E,this._aborted=!1,this._onProcessMinLen=_,this._onCancel=v,this._abortController=typeof AbortController<"u"&&new AbortController,this._running=!0,this._index=h,this._range=y||[0,0],this._vid=u||a,this._priOptions=S||{},this._firstMaxChunkSize=C;var R={method:w,headers:T,body:L,mode:O,credentials:B,cache:x,redirect:U,referrer:W,referrerPolicy:m,signal:(r=this._abortController)===null||r===void 0?void 0:r.signal},V=!1;clearTimeout(this._timeoutTimer),a=Rs(a,k);var K=Os(y);K&&(b?T=b.headers:T=R.headers=R.headers||(Headers?new Headers:{}),Headers&&T instanceof Headers?T.append("Range",K):T.Range=K),l&&(this._timeoutTimer=setTimeout(function(){if(V=!0,n.cancel(),d){var G=new ht(a,R,null,"timeout");G.isTimeout=!0,d(G,{index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions})}},l));var Y=Date.now();return this._logger.debug("[fetch load start], index,",h,",range,",y),new Promise(function(G,ke){var Z=D?new Promise(function(xe){xe(D)}):fetch(b||a,b?void 0:R);Z.then((function(){var xe=yt(Le().mark(function at(Oe){var Lt,Ze,It,Yt;return Le().wrap(function(we){for(;;)switch(we.prev=we.next){case 0:if(clearTimeout(n._timeoutTimer),n._response=Oe,!(n._aborted||!n._running)){we.next=4;break}return we.abrupt("return");case 4:if(p&&(Oe=p(Oe,a)||Oe),Oe.ok){we.next=7;break}throw new ht(a,R,Oe,"bad network response");case 7:if(Lt=Date.now(),c!==_i.TEXT){we.next=15;break}return we.next=11,Oe.text();case 11:Ze=we.sent,n._running=!1,we.next=37;break;case 15:if(c!==_i.JSON){we.next=22;break}return we.next=18,Oe.json();case 18:Ze=we.sent,n._running=!1,we.next=37;break;case 22:if(!f){we.next=29;break}return n.resolve=G,n.reject=ke,n._loadChunk(Oe,f,Y,Lt),we.abrupt("return");case 29:return we.next=31,Oe.arrayBuffer();case 31:Ze=we.sent,Ze=new Uint8Array(Ze),n._running=!1,It=Date.now()-Y,Yt=Jr(Ze.byteLength,It),n.emit(F.REAL_TIME_SPEED,{speed:Yt,len:Ze.byteLength,time:It,vid:n._vid,index:n._index,range:n._range,priOptions:n._priOptions});case 37:n._logger.debug("[fetch load end], index,",h,",range,",y),G(Zr(Ze,!0,Oe,Oe.headers.get("Content-Length"),Oe.headers.get("age"),Y,Lt,h,y,n._vid,n._priOptions));case 39:case"end":return we.stop()}},at)}));return function(at){return xe.apply(this,arguments)}})()).catch(function(xe){var at;clearTimeout(n._timeoutTimer),n._running=!1,!(n._aborted&&!V)&&(xe=xe instanceof ht?xe:new ht(a,R,null,(at=xe)===null||at===void 0?void 0:at.message),xe.startTime=Y,xe.endTime=Date.now(),xe.isTimeout=V,xe.options={index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions},ke(xe))})})}},{key:"cancel",value:(function(){var t=yt(Le().mark(function r(){return Le().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!this._aborted){a.next=2;break}return a.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){a.next=14;break}if(a.prev=5,!this._reader){a.next=9;break}return a.next=9,this._reader.cancel();case 9:a.next=13;break;case 11:a.prev=11,a.t0=a.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch{}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return a.stop()}},r,this,[[5,11]])}));function e(){return t.apply(this,arguments)}return e})()},{key:"_loadChunk",value:function(e,r,n,a){var u=this;if(!e.body||!e.body.getReader){this._running=!1;var l=new ht(e.url,"",e,"onProgress of bad response.body.getReader");l.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this.reject(l);return}this._onProcessMinLen>0&&(this._cache=new Uint8Array(wa),this._writeIdx=0);var c=this._reader=e.body.getReader(),f,h,d,v=(function(){var y=yt(Le().mark(function p(){var b,k,E,w,T,L,O,B,x,U;return Le().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return h=Date.now(),m.prev=1,m.next=4,c.read();case 4:f=m.sent,d=Date.now(),m.next=13;break;case 8:return m.prev=8,m.t0=m.catch(1),d=Date.now(),u._aborted||(u._running=!1,m.t0.options={index:u._index,range:u._range,vid:u._vid,priOptions:u._priOptions},u.reject(m.t0)),m.abrupt("return");case 13:if(k=((b=u._range)===null||b===void 0?void 0:b.length)>0?u._range[0]:0,E=k+u._receivedLength,!u._aborted){m.next=19;break}return u._running=!1,r(void 0,!1,{range:[E,E],vid:u._vid,index:u._index,startTime:h,endTime:d,st:n,firstByteTime:a,priOptions:u._priOptions},e),m.abrupt("return");case 19:w=f.value?f.value.byteLength:0,u._receivedLength+=w,u._logger.debug("【fetchLoader,onProgress call】,task,",u._range,", start,",E,", end,",k+u._receivedLength,", done,",f.done),u._onProcessMinLen>0?u._writeIdx+w>=u._onProcessMinLen||f.done?(T=new Uint8Array(u._writeIdx+w),T.set(u._cache.slice(0,u._writeIdx),0),w>0&&T.set(f.value,u._writeIdx),u._writeIdx=0,u._logger.debug("【fetchLoader,onProgress enough】,done,",f.done,",len,",T.byteLength,", writeIdx,",u._writeIdx)):w>0&&u._writeIdx+w<wa?(u._cache.set(f.value,u._writeIdx),u._writeIdx+=w,u._logger.debug("【fetchLoader,onProgress cache】,len,",w,", writeIdx,",u._writeIdx)):w>0&&(L=new Uint8Array(u._writeIdx+w+2048),u._logger.debug("【fetchLoader,onProgress extra start】,size,",u._writeIdx+w+2048,", datalen,",w,", writeIdx,",u._writeIdx),L.set(u._cache.slice(0,u._writeIdx),0),w>0&&L.set(f.value,u._writeIdx),u._writeIdx+=w,delete u._cache,u._cache=L,u._logger.debug("【fetchLoader,onProgress extra end】,len,",w,", writeIdx,",u._writeIdx)):T=f.value,(T&&T.byteLength>0||f.done)&&(u._firstMaxChunkSize&&(u._firtstByte?u._cacheData&&(B=new Uint8Array(u._cacheData.byteLength+T.byteLength),B.set(u._cacheData,0),B.set(T,u._cacheData.byteLength),T=B,u._cacheData=null):(u._firtstByte++,O=T.slice(0,u._firstMaxChunkSize),u._cacheData=T.slice(u._firstMaxChunkSize),T=O)),r(T,f.done,{range:[u._range[0]+u._receivedLength-(T?T.byteLength:0),u._range[0]+u._receivedLength],vid:u._vid,index:u._index,startTime:h,endTime:d,st:n,firstByteTime:a,priOptions:u._priOptions},e)),f.done?(x=Date.now()-n,U=Jr(u._receivedLength,x),u.emit(F.REAL_TIME_SPEED,{speed:U,len:u._receivedLength,time:x,vid:u._vid,index:u._index,range:u._range,priOptions:u._priOptions}),u._running=!1,u._logger.debug("[fetchLoader onProgress end],task,",u._range,",done,",f.done),u.resolve(Zr(f,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),n,a,u._index,u._range,u._vid,u._priOptions))):u._firstMaxChunkSize?setTimeout(function(){v()},0):v();case 25:case"end":return m.stop()}},p,null,[[1,8]])}));return function(){return y.apply(this,arguments)}})();v()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return typeof fetch<"u"}}]),i})(jt);function Yl(s){return mi({loaderType:Ft.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:_i.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},s)}var Xl=(function(s){ki(i,s);var o=Ti(i);function i(){var t;return Ke(this,i),t=o.call(this),M(Q(t),"_xhr",null),M(Q(t),"_aborted",!1),M(Q(t),"_timeoutTimer",null),M(Q(t),"_range",null),M(Q(t),"_receivedLength",0),M(Q(t),"_url",null),M(Q(t),"_onProgress",null),M(Q(t),"_index",-1),M(Q(t),"_headers",null),M(Q(t),"_currentChunkSizeKB",384),M(Q(t),"_timeout",null),M(Q(t),"_xhr",null),M(Q(t),"_withCredentials",null),M(Q(t),"_startTime",-1),M(Q(t),"_loadCompleteResolve",null),M(Q(t),"_loadCompleteReject",null),M(Q(t),"_runing",!1),M(Q(t),"_logger",!1),M(Q(t),"_vid",""),M(Q(t),"_responseType",void 0),M(Q(t),"_credentials",void 0),M(Q(t),"_method",void 0),M(Q(t),"_transformResponse",void 0),M(Q(t),"_firstRtt",void 0),M(Q(t),"_onCancel",null),M(Q(t),"_priOptions",null),t}return Ye(i,[{key:"load",value:function(e){var r=this;clearTimeout(this._timeoutTimer),this._logger=e.logger,this._range=e.range,this._onProgress=e.onProgress,this._index=e.index,this._headers=e.headers,this._withCredentials=e.credentials==="include"||e.credentials==="same-origin",this._body=e.body||null,e.method&&(this._method=e.method),this._timeout=e.timeout||null,this._runing=!0,this._vid=e.vid||e.url,this._responseType=e.responseType,this._firstRtt=-1,this._onTimeout=e.onTimeout,this._onCancel=e.onCancel,this._request=e.request,this._priOptions=e.priOptions||{},this._logger.debug("【xhrLoader task】, range",this._range),this._url=Rs(e.url,e.params);var n=Date.now();return new Promise(function(a,u){r._loadCompleteResolve=a,r._loadCompleteReject=u,r._startLoad()}).catch(function(a){if(clearTimeout(r._timeoutTimer),r._runing=!1,!r._aborted)throw a=a instanceof ht?a:new ht(r._url,r._request),a.startTime=n,a.endTime=Date.now(),a.options={index:r._index,vid:r._vid,priOptions:r._priOptions},a})}},{key:"_startLoad",value:function(){var e=null;if(this._responseType===_i.ARRAY_BUFFER&&this._range&&this._range.length>1)if(this._onProgress){this._firstRtt=-1;var r=this._currentChunkSizeKB*1024,n=this._range[0]+this._receivedLength,a=this._range[1];r<this._range[1]-n&&(a=n+r),e=[n,a],this._logger.debug("[xhr_loader->],tast :",this._range,", SubRange, ",e)}else e=this._range,this._logger.debug("[xhr_loader->],tast :",this._range,", allRange, ",e);this._internalOpen(e)}},{key:"_internalOpen",value:function(e){var r=this;try{this._startTime=Date.now();var n=this._xhr=new XMLHttpRequest;n.open(this._method||"GET",this._url,!0),n.responseType=this._responseType,this._timeout&&(n.timeout=this._timeout),n.withCredentials=this._withCredentials,n.onload=this._onLoad.bind(this),n.onreadystatechange=this._onReadyStatechange.bind(this),n.onerror=function(l){var c,f,h;r._running=!1;var d=new ht(r._url,r._request,l==null||(c=l.currentTarget)===null||c===void 0?void 0:c.response,"xhr.onerror.status:"+(l==null||(f=l.currentTarget)===null||f===void 0?void 0:f.status)+",statusText,"+(l==null||(h=l.currentTarget)===null||h===void 0?void 0:h.statusText));d.options={index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions},r._loadCompleteReject(d)},n.ontimeout=function(l){r.cancel();var c=new ht(r._url,r._request,{status:408},"timeout");r._onTimeout&&(c.isTimeout=!0,r._onTimeout(c,{index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions})),c.options={index:r._index,range:r._range,vid:r._vid,priOptions:r._priOptions},r._loadCompleteReject(c)};var a=this._headers||{},u=Os(e);u&&(a.Range=u),a&&Object.keys(a).forEach(function(l){n.setRequestHeader(l,a[l])}),this._logger.debug("[xhr.send->] tast,",this._range,",load sub range, ",e),n.send(this._body)}catch(l){l.options={index:this._index,range:e,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(l)}}},{key:"_onReadyStatechange",value:function(e){var r=e.target;r.readyState===2&&this._firstRtt<0&&(this._firstRtt=Date.now())}},{key:"_onLoad",value:function(e){var r,n=e.target.status;if(n<200||n>299){var a=new ht(this._url,null,mi(mi({},e.target.response),{},{status:n}),"bad response,status:"+n);return a.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this._loadCompleteReject(a)}var u=null,l=!1,c,f=((r=this._range)===null||r===void 0?void 0:r.length)>0?this._range[0]:0;if(this._responseType===_i.ARRAY_BUFFER){var h,d=new Uint8Array(e.target.response);if(c=f+this._receivedLength,d&&d.byteLength>0){this._receivedLength+=d.byteLength;var v=Date.now()-this._startTime,y=Jr(this._receivedLength,v);this.emit(F.REAL_TIME_SPEED,{speed:y,len:this._receivedLength,time:v,vid:this._vid,index:this._index,range:[c,f+this._receivedLength],priOptions:this._priOptions})}u=d,((h=this._range)===null||h===void 0?void 0:h.length)>1&&this._range[1]&&this._receivedLength<this._range[1]-this._range[0]?l=!1:l=!0,this._logger.debug("[xhr load done->], tast :",this._range,", start",c,"end ",f+this._receivedLength,",dataLen,",d?d.byteLength:0,",receivedLength",this._receivedLength,",index,",this._index,", done,",l)}else l=!0,u=e.target.response;var p={ok:n>=200&&n<300,status:n,statusText:this._xhr.statusText,url:this._xhr.responseURL,headers:this._getHeaders(this._xhr),body:this._xhr.response};this._transformResponse&&(p=this._transformResponse(p,this._url)||p),this._onProgress&&this._onProgress(u,l,{index:this._index,vid:this._vid,range:[c,f+this._receivedLength],startTime:this._startTime,endTime:Date.now(),priOptions:this._priOptions},p),l?(this._runing=!1,this._loadCompleteResolve&&this._loadCompleteResolve(Zr(this._onProgress?null:u,l,p,p.headers["content-length"],p.headers.age,this._startTime,this._firstRtt,this._index,this._range,this._vid,this._priOptions))):this._startLoad()}},{key:"cancel",value:function(){if(!this._aborted&&(this._aborted=!0,this._runing=!1,Gi(Vt(i.prototype),"removeAllListeners",this).call(this),this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions}),this._xhr))return this._xhr.abort()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}},{key:"_getHeaders",value:function(e){var r=e.getAllResponseHeaders().trim().split(`\r
`),n={},a=Bl(r),u;try{for(a.s();!(u=a.n()).done;){var l=u.value,c=l.split(": ");n[c[0].toLowerCase()]=c.slice(1).join(": ")}}catch(f){a.e(f)}finally{a.f()}return n}}],[{key:"isSupported",value:function(){return typeof XMLHttpRequest<"u"}}]),i})(jt),ql=["retry","retryDelay","onRetryError","transformError"],Ql=(function(){function s(o,i){Ke(this,s),this.promise=ii(),this.alive=!!i.onProgress,!i.logger&&(i.logger=new $e("Loader")),this._loaderType=o,this._loader=o===Ft.FETCH&&typeof fetch<"u"?new en:new Xl,this._config=i,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=i.retryCheckFunc,this._logger=i.logger}return Ye(s,[{key:"exec",value:function(){var i=this,t=this._config,e=t.retry,r=t.retryDelay,n=t.onRetryError,a=t.transformError,u=Rl(t,ql),l=(function(){var c=yt(Le().mark(function f(){var h,d,v;return Le().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.prev=0,p.next=3,i._loader.load(u);case 3:h=p.sent,i.promise.resolve(h),p.next=27;break;case 7:if(p.prev=7,p.t0=p.catch(0),i._loader.running=!1,i._logger.debug("[task request catch err]",p.t0),!i._canceled){p.next=13;break}return p.abrupt("return");case 13:if(p.t0.loaderType=i._loaderType,p.t0.retryCount=i._retryCount,d=p.t0,a&&(d=a(d)||d),n&&i._retryCount>0&&n(d,i._retryCount,{index:u.index,vid:u.vid,range:u.range,priOptions:u.priOptions}),i._retryCount++,v=!0,i._retryCheckFunc&&(v=i._retryCheckFunc(p.t0)),!(v&&i._retryCount<=e)){p.next=26;break}return clearTimeout(i._retryTimer),i._logger.debug("[task request setTimeout],retry",i._retryCount,",retry range,",u.range),i._retryTimer=setTimeout(l,r),p.abrupt("return");case 26:i.promise.reject(d);case 27:case"end":return p.stop()}},f,null,[[0,7]])}));return function(){return c.apply(this,arguments)}})();return l(),this.promise}},{key:"cancel",value:(function(){var o=yt(Le().mark(function t(){return Le().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,r.abrupt("return",this._loader.cancel());case 4:case"end":return r.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i})()},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),s})();function Ms(s){return s&&!s.paused&&!s.ended&&s.playbackRate!==0&&s.readyState!==0}function Ns(s){if(!s)return{};if(typeof s.getVideoPlaybackQuality=="function"){var o=s.getVideoPlaybackQuality();return{droppedVideoFrames:o.droppedVideoFrames||o.corruptedVideoFrames,totalVideoFrames:o.totalVideoFrames,creationTime:o.creationTime}}return{droppedVideoFrames:s.webkitDroppedFrameCount,totalVideoFrames:s.webkitDecodedFrameCount,creationTime:performance.now()}}function vi(){for(var s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];if(o=o.filter(Boolean),o.length<2)return o[0];var t=new Uint8Array(o.reduce(function(r,n){return r+n.byteLength},0)),e=0;return o.forEach(function(r){t.set(r,e),e+=r.byteLength}),t}function Zl(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return new Promise(function(o){return setTimeout(o,s)})}var Ut=(function(s){ki(i,s);var o=Ti(i);function i(t){var e;return Ke(this,i),e=o.call(this,t),M(Q(e),"type",Ft.FETCH),M(Q(e),"_queue",[]),M(Q(e),"_alive",[]),M(Q(e),"_currentTask",null),M(Q(e),"_finnalUrl",""),M(Q(e),"_config",void 0),e._config=Yl(t),(e._config.loaderType===Ft.XHR||!en.isSupported())&&(e.type=Ft.XHR),e.log=t.logger,e}return Ye(i,[{key:"isFetch",value:function(){return this.type===Ft.FETCH}},{key:"load",value:function(e){var r=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};typeof e=="string"||!e?n.url=e||n.url||this._config.url:n=e,n=Object.assign({},this._config,n),n.params&&(n.params=Object.assign({},n.params)),n.headers&&ka(n.headers)&&(n.headers=Object.assign({},n.headers)),n.body&&ka(n.body)&&(n.body=Object.assign({},n.body)),n.transformRequest&&(n=n.transformRequest(n)||n),n.logger=this.log;var a=new Ql(this.type,n);return a.loader.on(F.REAL_TIME_SPEED,function(u){r.emit(F.REAL_TIME_SPEED,u)}),this._queue.push(a),this._queue.length===1&&(!this._currentTask||!this._currentTask.running)&&this._processTask(),a.promise}},{key:"cancel",value:(function(){var t=yt(Le().mark(function r(){var n;return Le().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return n=this._queue.map(function(l){return l.cancel()}).concat(this._alive.map(function(l){return l.cancel()})),this._currentTask&&n.push(this._currentTask.cancel()),this._queue=[],this._alive=[],u.next=6,Promise.all(n);case 6:return u.next=8,Zl();case 8:case"end":return u.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e})()},{key:"_processTask",value:function(){var e=this;if(this._currentTask=this._queue.shift(),!!this._currentTask){this._currentTask.alive&&this._alive.push(this._currentTask);var r=this._currentTask.exec().catch(function(n){});r&&typeof r.finally=="function"&&r.finally(function(){var n,a;(n=e._currentTask)!==null&&n!==void 0&&n.alive&&((a=e._alive)===null||a===void 0?void 0:a.length)>0&&(e._alive=e._alive.filter(function(u){return u&&u!==e._currentTask})),e._processTask()})}}}],[{key:"isFetchSupport",value:function(){return en.isSupported()}}]),i})(jt),Fs=(function(){function s(){Ke(this,s),M(this,"_prevCurrentTime",0)}return Ye(s,[{key:"do",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3,e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;if(i){var n=i.currentTime,a=0;if(this._prevCurrentTime===n){var u=Ce.info(Ce.get(i),n);if(!u.buffers.length)return;e&&u.nextStart||u.nextStart&&u.nextStart-n<t?a=u.nextStart+.1:u.end&&u.end-n>r&&!i.seeking&&(a=n+.1)}this._prevCurrentTime=n,a&&n!==a&&(i.currentTime=a)}}}]),s})(),Bs=(function(){function s(o){var i=this;Ke(this,s),M(this,"_seiSet",new Set),this.emitter=o,o.on(F.SEI,function(t){t&&i._seiSet.add(t)})}return Ye(s,[{key:"throw",value:function(i,t){var e=this;if(!(i==null||!this._seiSet.size)){var r=i-.2,n=i+.2,a=[];this._seiSet.forEach(function(u){u.time>=r&&u.time<=n&&a.push(u)}),a.forEach(function(u){e._seiSet.delete(u),e.emitter.emit(F.SEI_IN_TIME,u)}),t&&this._seiSet.forEach(function(u){u.time<i-5&&e._seiSet.delete(u)})}}},{key:"reset",value:function(){this._seiSet.clear()}}]),s})(),Jl=1e3,ec=50,tc=3e3,Us=(function(){function s(o){Ke(this,s),M(this,"_chunkSpeed",0),M(this,"_chunkCache",[]),M(this,"_speeds",[]),M(this,"_totalSize",0),M(this,"_totalCost",0),this._opts=o||{}}return Ye(s,[{key:"addRecord",value:function(i,t){!i||!t||(this._speeds.push(8e3*i/t),this._speeds=this._speeds.slice(-3))}},{key:"addChunkRecord",value:function(i,t){var e,r;if(!(!i||!t||i<(((e=this._opts)===null||e===void 0?void 0:e.skipChunkSize)||Jl))){this._totalSize+=i,this._totalCost+=t,this._chunkSpeed=8e3*i/t,this._chunkCache.push({size:i,duration:t,timestamp:performance.now()});var n=((r=this._opts)===null||r===void 0?void 0:r.chunkCountForSpeed)||ec;this._chunkCache.length>n&&(this._chunkCache=this._chunkCache.slice(-n))}}},{key:"getAvgSpeed",value:function(){var i;if(!this._chunkCache.length&&!this._speeds.length)return 0;if(this._speeds.length)return this._speeds.reduce(function(a,u){return a+=u})/this._speeds.length;var t=this._chunkCache[this._chunkCache.length-1],e=performance.now()-t.timestamp;e>(((i=this._opts)===null||i===void 0?void 0:i.longtimeNoReceived)||tc)&&this._chunkCache.push({size:0,duration:e,timestamp:performance.now()});var r=this._chunkCache.reduce(function(a,u){return a+=u.size},0),n=this._chunkCache.reduce(function(a,u){return a+=u.duration},0);return 8e3*r/n}},{key:"getLatestSpeed",value:function(){return!this._chunkCache.length&&!this._speeds.length?0:this._speeds.length?this._speeds[this._speeds.length-1]:this._chunkSpeed}},{key:"getTotalSize",value:function(){return this._totalSize}},{key:"getTotalCost",value:function(){return this._totalCost}},{key:"reset",value:function(){this._chunkCache=[],this._speeds=[],this._totalSize=0,this._totalCost=0}}]),s})(),Ca=(function(){function s(o){Ke(this,s),M(this,"encodeType",""),M(this,"audioCodec",""),M(this,"videoCodec",""),M(this,"domain",""),M(this,"fps",0),M(this,"bitrate",0),M(this,"width",0),M(this,"height",0),M(this,"samplerate",0),M(this,"channelCount",0),M(this,"gop",0),M(this,"_bitsAccumulateSize",0),M(this,"_bitsAccumulateDuration",0),M(this,"_startGopId",-1),this._timescale=o}return Ye(s,[{key:"getStats",value:function(){return{encodeType:this.encodeType,audioCodec:this.audioCodec,videoCodec:this.videoCodec,domain:this.domain,fps:this.fps,bitrate:this.bitrate,width:this.width,height:this.height,samplerate:this.samplerate,channelCount:this.channelCount,gop:this.gop}}},{key:"setEncodeType",value:function(i){this.encodeType=i}},{key:"setFpsFromScriptData",value:function(i){var t,e=i.data,r=e==null||(t=e.onMetaData)===null||t===void 0?void 0:t.framerate;r&&r>0&&r<100&&(this.fps=r)}},{key:"setVideoMeta",value:function(i){if(this.width=i.width,this.height=i.height,this.videoCodec=i.codec,this.encodeType=i.codecType,i.fpsNum&&i.fpsDen){var t=i.fpsNum/i.fpsDen;t>0&&t<100&&(this.fps=t)}}},{key:"setAudioMeta",value:function(i){this.audioCodec=i.codec,this.samplerate=i.sampleRate,this.channelCount=i.channelCount}},{key:"setDomain",value:function(i){this.domain=i.split("/").slice(2,3)[0]}},{key:"updateBitrate",value:function(i){var t=this;if((!this.fps||this.fps>=100)&&i.length){var e=i.reduce(function(r,n){return r+=n.duration},0)/i.length;this.fps=Math.round(this._timescale/e)}i.forEach(function(r){t._startGopId===-1&&(t._startGopId=r.gopId),r.gopId===t._startGopId&&t.gop++,t._bitsAccumulateDuration+=r.duration/(t._timescale/1e3),t._bitsAccumulateSize+=r.units.reduce(function(n,a){return n+=a.length},0),t._bitsAccumulateDuration>=1e3&&(t.bitrate=t._bitsAccumulateSize*8,t._bitsAccumulateDuration=0,t._bitsAccumulateSize=0)})}}]),s})(),Hs=(function(){function s(o){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;Ke(this,s),M(this,"_core",null),M(this,"_samples",[]),this._core=o,this._timescale=i,this._stats=new Ca(i),this._bindEvents()}return Ye(s,[{key:"getStats",value:function(){var i,t,e,r,n,a,u,l,c,f,h,d=((i=this._core)===null||i===void 0?void 0:i.media)||{},v=d.currentTime,y=v===void 0?0:v,p=d.decodeFps,b=p===void 0?0:p;return mi(mi({},this._stats.getStats()),{},{downloadSpeed:((t=this._core)===null||t===void 0||(e=t.speedInfo)===null||e===void 0?void 0:e.call(t).speed)||0,avgSpeed:((r=this._core)===null||r===void 0||(n=r.speedInfo)===null||n===void 0?void 0:n.call(r).avgSpeed)||0,totalReceivedByte:((a=this._core)===null||a===void 0||(u=a.speedInfo)===null||u===void 0?void 0:u.call(a).totalSize)||0,totalReceivedCost:((l=this._core)===null||l===void 0||(c=l.speedInfo)===null||c===void 0?void 0:c.call(l).totalCost)||0,currentTime:y,bufferEnd:((f=this._core)===null||f===void 0||(h=f.bufferInfo())===null||h===void 0?void 0:h.remaining)||0,decodeFps:b})}},{key:"_bindEvents",value:function(){var i=this;this._core.on(F.DEMUXED_TRACK,function(t){var e=t.videoTrack;return i._stats.updateBitrate(e.samples)}),this._core.on(F.FLV_SCRIPT_DATA,function(t){i._stats.setFpsFromScriptData(t)}),this._core.on(F.METADATA_PARSED,function(t){t.type==="video"?i._stats.setVideoMeta(t.track):i._stats.setAudioMeta(t.track)}),this._core.on(F.TTFB,function(t){i._stats.setDomain(t.responseUrl)})}},{key:"reset",value:function(){this._samples=[],this._stats=new Ca(this._timescale)}}]),s})();function ic(s,o){var i=s==null?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(i!=null){var t,e,r,n,a=[],u=!0,l=!1;try{if(r=(i=i.call(s)).next,o!==0)for(;!(u=(t=r.call(i)).done)&&(a.push(t.value),a.length!==o);u=!0);}catch(c){l=!0,e=c}finally{try{if(!u&&i.return!=null&&(n=i.return(),Object(n)!==n))return}finally{if(l)throw e}}return a}}function ge(s,o){if(!(s instanceof o))throw new TypeError("Cannot call a class as a function")}function Aa(s,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,js(t.key),t)}}function me(s,o,i){return o&&Aa(s.prototype,o),i&&Aa(s,i),Object.defineProperty(s,"prototype",{writable:!1}),s}function N(s,o,i){return o=js(o),o in s?Object.defineProperty(s,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[o]=i,s}function Vs(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(o&&o.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),o&&tn(s,o)}function er(s){return er=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},er(s)}function tn(s,o){return tn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tn(s,o)}function rc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function nc(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function ac(s,o){if(o&&(typeof o=="object"||typeof o=="function"))return o;if(o!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nc(s)}function Gs(s){var o=rc();return function(){var t=er(s),e;if(o){var r=er(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return ac(this,e)}}function sc(s,o){return uc(s)||ic(s,o)||Tn(s,o)||fc()}function ze(s){return oc(s)||lc(s)||Tn(s)||cc()}function oc(s){if(Array.isArray(s))return rn(s)}function uc(s){if(Array.isArray(s))return s}function lc(s){if(typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)}function Tn(s,o){if(s){if(typeof s=="string")return rn(s,o);var i=Object.prototype.toString.call(s).slice(8,-1);if(i==="Object"&&s.constructor&&(i=s.constructor.name),i==="Map"||i==="Set")return Array.from(s);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return rn(s,o)}}function rn(s,o){(o==null||o>s.length)&&(o=s.length);for(var i=0,t=new Array(o);i<o;i++)t[i]=s[i];return t}function cc(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fc(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hc(s,o){var i=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(!i){if(Array.isArray(s)||(i=Tn(s))||o){i&&(s=i);var t=0,e=function(){};return{s:e,n:function(){return t>=s.length?{done:!0}:{done:!1,value:s[t++]}},e:function(u){throw u},f:e}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var r=!0,n=!1,a;return{s:function(){i=i.call(s)},n:function(){var u=i.next();return r=u.done,u},e:function(u){n=!0,a=u},f:function(){try{!r&&i.return!=null&&i.return()}finally{if(n)throw a}}}}function dc(s,o){if(typeof s!="object"||s===null)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var t=i.call(s,o);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}function js(s){var o=dc(s,"string");return typeof o=="symbol"?o:String(o)}var At={VIDEO:"video",AUDIO:"audio",METADATA:"metadata"},dt={AV1:"av1",AVC:"avc",HEVC:"hevc"},Se={AAC:"aac",G711PCMA:"g7110a",G711PCMU:"g7110m",OPUS:"opus",MP3:"mp3"},Te={LARGE_AV_SHIFT:"LARGE_AV_SHIFT",LARGE_VIDEO_GAP:"LARGE_VIDEO_GAP",LARGE_VIDEO_GAP_BETWEEN_CHUNK:"LARGE_VIDEO_GAP_BETWEEN_CHUNK",LARGE_AUDIO_GAP:"LARGE_AUDIO_GAP",AUDIO_FILLED:"AUDIO_FILLED",AUDIO_DROPPED:"AUDIO_DROPPED"},wn=(function(){function s(){ge(this,s),N(this,"id",1),N(this,"type",At.VIDEO),N(this,"codecType",dt.AVC),N(this,"pid",-1),N(this,"hvcC",void 0),N(this,"codec",""),N(this,"timescale",0),N(this,"formatTimescale",0),N(this,"sequenceNumber",0),N(this,"baseMediaDecodeTime",0),N(this,"baseDts",0),N(this,"duration",0),N(this,"warnings",[]),N(this,"samples",[]),N(this,"pps",[]),N(this,"sps",[]),N(this,"vps",[]),N(this,"fpsNum",0),N(this,"fpsDen",0),N(this,"sarRatio",[]),N(this,"width",0),N(this,"height",0),N(this,"nalUnitSize",4),N(this,"present",!1),N(this,"isVideoEncryption",!1),N(this,"isAudioEncryption",!1),N(this,"isVideo",!0),N(this,"lastKeyFrameDts",0),N(this,"kid",null),N(this,"pssh",null),N(this,"ext",void 0)}return me(s,[{key:"reset",value:function(){this.sequenceNumber=this.width=this.height=this.fpsDen=this.fpsNum=this.duration=this.baseMediaDecodeTime=this.timescale=0,this.codec="",this.present=!1,this.pid=-1,this.pps=[],this.sps=[],this.vps=[],this.sarRatio=[],this.samples=[],this.warnings=[],this.hvcC=null}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var i=this.samples[0],t=this.samples[this.samples.length-1];return t.dts-i.dts+t.duration}return 0}},{key:"exist",value:function(){return/av01/.test(this.codec)?!0:!!(this.pps.length&&this.sps.length&&this.codec)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isVideoEncryption}}]),s})(),Cn=(function(){function s(){ge(this,s),N(this,"id",2),N(this,"type",At.AUDIO),N(this,"codecType",Se.AAC),N(this,"pid",-1),N(this,"codec",""),N(this,"container",""),N(this,"sequenceNumber",0),N(this,"sampleDuration",0),N(this,"timescale",0),N(this,"formatTimescale",0),N(this,"baseMediaDecodeTime",0),N(this,"duration",0),N(this,"warnings",[]),N(this,"samples",[]),N(this,"baseDts",0),N(this,"sampleSize",16),N(this,"sampleRate",0),N(this,"channelCount",0),N(this,"objectType",0),N(this,"sampleRateIndex",0),N(this,"config",[]),N(this,"present",!1),N(this,"isVideoEncryption",!1),N(this,"isAudioEncryption",!1),N(this,"kid",null),N(this,"ext",void 0)}return me(s,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&(this.codec||this.container)&&(this.codecType===Se.AAC||this.codecType===Se.G711PCMA||this.codecType===Se.G711PCMU||this.codecType===Se.OPUS||this.codecType===Se.MP3))}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}},{key:"firstDts",get:function(){return this.samples.length?this.samples[0].dts:null}},{key:"firstPts",get:function(){return this.samples.length?this.samples[0].pts:null}},{key:"samplesDuration",get:function(){if(this.samples.length>0){var i=this.samples[0],t=this.samples[this.samples.length-1];return t.dts-i.dts+t.duration}return 0}}]),s})(),tr=(function(){function s(o,i,t){ge(this,s),N(this,"flag",{}),N(this,"keyframe",!1),N(this,"gopId",0),N(this,"duration",0),N(this,"size",0),N(this,"units",[]),N(this,"chromaFormat",420),this.originPts=this.pts=o,this.originDts=this.dts=i,t&&(this.units=t)}return me(s,[{key:"cts",get:function(){return this.pts-this.dts}},{key:"setToKeyframe",value:function(){this.keyframe=!0,this.flag.dependsOn=2,this.flag.isNonSyncSample=0}}]),s})(),_t=me(function s(o,i,t,e){ge(this,s),N(this,"duration",1024),N(this,"flag",{dependsOn:2,isNonSyncSample:0}),N(this,"keyframe",!0),this.originPts=this.pts=this.dts=o,this.data=i,this.size=i.byteLength,this.sampleOffset=e,t&&(this.duration=t)}),zs=me(function s(o,i){ge(this,s),N(this,"time",0),this.data=o,this.originPts=this.pts=i}),vc=(function(s){Vs(i,s);var o=Gs(i);function i(){return ge(this,i),o.apply(this,arguments)}return me(i)})(zs),Ws=(function(s){Vs(i,s);var o=Gs(i);function i(){return ge(this,i),o.apply(this,arguments)}return me(i)})(zs),An=(function(){function s(){ge(this,s),N(this,"id",3),N(this,"type",At.METADATA),N(this,"timescale",0),N(this,"flvScriptSamples",[]),N(this,"seiSamples",[])}return me(s,[{key:"exist",value:function(){return!!((this.flvScriptSamples.length||this.seiSamples.length)&&this.timescale)}},{key:"reset",value:function(){this.timescale=0,this.flvScriptSamples=[],this.seiSamples=[]}},{key:"hasSample",value:function(){return!!(this.flvScriptSamples.length||this.seiSamples.length)}}]),s})(),Gt=(function(){function s(o){ge(this,s),this.name=o||"",this._prefix="[".concat(this.name,"]")}return me(s,[{key:"warn",value:function(){var i;if(!s.disabled){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];(i=console).warn.apply(i,[this._prefix].concat(e))}}}],[{key:"enable",value:function(){s.disabled=!1}},{key:"disable",value:function(){s.disabled=!0}}]),s})();N(Gt,"disabled",!0);var lr=typeof window<"u",Dn=lr&&navigator.userAgent.toLocaleLowerCase(),$s=lr&&/^((?!chrome|android).)*safari/.test(Dn),Ks=lr&&Dn.includes("firefox"),pc=lr&&Dn.includes("android"),et=(function(){function s(){ge(this,s)}return me(s,null,[{key:"getRateIndexByRate",value:function(i){return s.FREQ.indexOf(i)}},{key:"parseADTS",value:function(i,t){for(var e=i.length,r=0;r+2<e&&!(i[r]===255&&(i[r+1]&246)===240);)r++;if(!(r>=e)){var n=r,a=[],u=(i[r+2]&60)>>>2,l=s.FREQ[u];if(!l)throw new Error("Invalid sampling index: ".concat(u));for(var c=((i[r+2]&192)>>>6)+1,f=(i[r+2]&1)<<2|(i[r+3]&192)>>>6,h=s._getConfig(u,f,c),d=h.config,v=h.codec,y,p,b=0,k=s.getFrameDuration(l);r+7<e;){if(i[r]!==255||(i[r+1]&246)!==240){r++;continue}if(p=(i[r+3]&3)<<11|i[r+4]<<3|(i[r+5]&224)>>5,!p||e-r<p)break;y=(~i[r+1]&1)*2,a.push({pts:t+b*k,data:i.subarray(r+7+y,r+p)}),b++,r+=p}return{skip:n,remaining:r>=e?void 0:i.subarray(r),frames:a,samplingFrequencyIndex:u,sampleRate:l,objectType:c,channelCount:f,codec:v,config:d,originCodec:"mp4a.40.".concat(c)}}}},{key:"parseAudioSpecificConfig",value:function(i){if(i.length){var t=i[0]>>>3,e=(i[0]&7)<<1|i[1]>>>7,r=(i[1]&120)>>>3,n=s.FREQ[e];if(n){var a=s._getConfig(e,r,t),u=a.config,l=a.codec;return{samplingFrequencyIndex:e,sampleRate:n,objectType:t,channelCount:r,config:u,codec:l,originCodec:"mp4a.40.".concat(t)}}}}},{key:"getFrameDuration",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4;return 1024*t/i}},{key:"_getConfig",value:function(i,t,e){var r=[],n,a;return Ks?i>=6?(n=5,a=i-3):(n=2,a=i):pc?(n=2,a=i):(n=5,a=i,i>=6?a=i-3:t===1&&(n=2,a=i)),r[0]=n<<3,r[0]|=(i&14)>>1,r[1]=(i&1)<<7,r[1]|=t<<3,n===5&&(r[1]|=(a&14)>>1,r[2]=(a&1)<<7,r[2]|=8,r[3]=0),{config:r,codec:"mp4a.40.".concat(n)}}},{key:"getSilentFrame",value:function(i,t){switch(i){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}]),s})();N(et,"FREQ",[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]);var nn=(function(){function s(){ge(this,s)}return me(s,null,[{key:"getFrameDuration",value:function(i){return 20}},{key:"parseHeaderPackets",value:function(i){if(i.length){for(var t=new DataView(i.buffer,i.byteOffset,i.byteLength),e="",r=0;r<8;r++)e+=String.fromCodePoint(i[r]);if(e!=="OpusHead")throw new Error("Invalid Opus MagicSignature");var n=i[9];console.log("Pre-skip",i[10],i[11]);var a=t.getUint32(12,!0),u=t.getInt16(16,!0);if(a){var l="opus",c="opus",f=new Uint8Array(i.buffer,i.byteOffset+8,i.byteLength-8);return{outputGain:u,sampleRate:a,channelCount:n,config:f,codec:l,originCodec:c}}}}}]),s})(),gc=500,Da=3,Lr=1e3,Ir=5e3,mc=1e3,yc=200,Pa=5e3,La=5,_c=(function(){function s(o,i,t){ge(this,s),this.videoTrack=o,this.audioTrack=i,this.metadataTrack=t,this._baseDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastVideoDuration=0,this._keyFrameInNextChunk=!1,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0}return me(s,[{key:"fix",value:function(){var i=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;t=Math.round(t*1e3);var n=this.videoTrack,a=this.audioTrack;(e||!r)&&(this._videoLastSample=null,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=0,this._videoTimestampBreak=0,this._lastAudioExceptionGapDot=-1/0,this._lastAudioExceptionOverlapDot=-1/0,this._lastAudioExceptionLargeGapDot=-1/0,this._lastVideoExceptionLargeGapDot=-1/0,this._lastVideoExceptionChunkFirstDtsDot=-1/0),e&&!r&&(this._baseDtsInited=!1),this._baseDtsInited||this._calculateBaseDts(a,n),!r&&t&&(this._audioNextPts=this._videoNextDts=t);var u=this._baseDtsInited&&(this._videoTimestampBreak||!this.videoTrack.exist())&&(this._audioTimestampBreak||!this.audioTrack.exist());if(u&&this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(a),this._keyFrameInNextChunk=!1,this._fixVideo(n),this.metadataTrack.exist()){var l=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach(function(c){c.pts=c.originPts-i._baseDts,c.time=Math.max(0,c.pts)/l}),this.metadataTrack.flvScriptSamples.forEach(function(c){c.pts=c.originPts-i._baseDts,c.time=Math.max(0,c.pts)/l})}n.samples.length&&(n.baseMediaDecodeTime=n.samples[0].dts),a.samples.length&&(a.baseMediaDecodeTime=a.samples[0].pts*a.timescale/1e3)}},{key:"_fixVideo",value:function(i){var t=this,e=i.samples;if(e.length){e.forEach(function(k){k.dts-=t._baseDts,k.pts-=t._baseDts,k.keyframe&&(t._keyFrameInNextChunk=!0)});var r;if(i.fpsNum&&i.fpsDen)r=i.timescale*(i.fpsDen/i.fpsNum);else if(i.length>1){var n=i.samples[0],a=i.samples[e.length-1];r=Math.floor((a.dts-n.dts)/(e.length-1))}else r=this._lastVideoDuration||40;var u=e.pop();if(this._videoLastSample&&e.unshift(this._videoLastSample),this._videoLastSample=u,!!e.length){if(this._videoNextDts===void 0){var l=e[0];this._videoNextDts=l.dts}var c=e.length,f=0,h=e[0],d=this._videoNextDts-h.dts;if(Math.abs(d)>yc){if(Math.abs(h.dts-this._lastVideoExceptionChunkFirstDtsDot)>Pa){var v;this._lastVideoExceptionChunkFirstDtsDot=h.dts,i.warnings.push({type:Te.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts,firstSampleDts:h.dts,nextSampleDts:(v=e[1])===null||v===void 0?void 0:v.dts,sampleDuration:d})}this._videoTimestampBreak>=La?(this._videoNextDts=h.dts,this._videoTimestampBreak=0):(h.dts+=d,h.pts+=d,this.audioTrack.exist()||(this._videoTimestampBreak=1))}for(var y=0;y<c;y++){var p=e[y].dts,b=e[y+1];y<c-1?f=b.dts-p:u?f=u.dts-p:f=r,(f>mc||f<0)&&(this._videoTimestampBreak++,Math.abs(p-this._lastVideoExceptionLargeGapDot)>Pa&&(this._lastVideoExceptionLargeGapDot=p,i.warnings.push({type:Te.LARGE_VIDEO_GAP,time:p/i.timescale,dts:p,originDts:e[y].originDts,nextDts:this._videoNextDts,sampleDuration:f,refSampleDuration:r})),f=r),e[y].duration=f,this._videoNextDts+=f,this._lastVideoDuration=f}}}}},{key:"_fixAudio",value:function(i){var t=this,e=i.samples;e.length&&(e.forEach(function(r){r.dts=r.pts-=t._baseDts}),this._doFixAudioInternal(i,e,1e3))}},{key:"_calculateBaseDts",value:function(i,t){var e=i.samples,r=t.samples;if(!e.length&&!r.length)return!1;var n=1/0,a=1/0;e.length&&(i.baseDts=n=e[0].pts),r.length&&(t.baseDts=a=r[0].dts),this._baseDts=Math.min(n,a);var u=a-n;return Number.isFinite(u)&&Math.abs(u)>gc&&t.warnings.push({type:Te.LARGE_AV_SHIFT,videoBaseDts:a,audioBasePts:n,baseDts:this._baseDts,delta:u}),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){var i=this._calculateBaseDts(this.audioTrack,this.videoTrack);i&&(this.audioTrack.exist()?this.videoTrack.exist()?this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts):this._baseDts-=this._audioNextPts:this._baseDts-=this._videoNextDts,this._videoTimestampBreak=0,this._audioTimestampBreak=0)}},{key:"_doFixAudioInternal",value:function(i,t,e){if(!i.sampleDuration)switch(i.codecType){case Se.AAC:{i.sampleDuration=et.getFrameDuration(i.timescale,e);break}case Se.OPUS:{i.sampleDuration=nn.getFrameDuration(i.samples,e);break}case Se.G711PCMA:case Se.G711PCMU:{i.sampleDuration=this._getG711Duration(i);break}default:console.error("can't fix audio codecType:",i.codecType);break}var r=i.sampleDuration,n=i.codecType===Se.OPUS?20:i.codecType===Se.AAC?1024:r*i.timescale/1e3;if(this._audioNextPts===void 0){var a=t[0];this._audioNextPts=a.pts}for(var u=0;u<t.length;u++){var l=this._audioNextPts,c=t[u],f=c.pts-l;if(u===0&&this._audioTimestampBreak>=La&&this._keyFrameInNextChunk&&(l=this._audioNextPts=c.dts,f=0,this._audioTimestampBreak=0),!this._audioTimestampBreak&&f>=Da*r&&f<=Lr&&!$s){var h=this._getSilentFrame(i)||t[0].data.subarray(),d=Math.floor(f/r);Math.abs(c.pts-this._lastAudioExceptionGapDot)>Ir&&(this._lastAudioExceptionGapDot=c.pts,i.warnings.push({type:Te.AUDIO_FILLED,pts:c.pts,originPts:c.originPts,count:d,nextPts:l,refSampleDuration:r}));for(var v=0;v<d;v++){var y=new _t(Math.floor(this._audioNextPts+r)-Math.floor(this._audioNextPts),h,n);y.originPts=Math.floor(this._baseDts+l),t.splice(u,0,y),this._audioNextPts+=r,u++}u--}else if(f<=-Da*r&&f>=-1*Lr)Math.abs(c.pts-this._lastAudioExceptionOverlapDot)>Ir&&(this._lastAudioExceptionOverlapDot=c.pts,i.warnings.push({type:Te.AUDIO_DROPPED,pts:c.pts,originPts:c.originPts,nextPts:l,refSampleDuration:r})),t.splice(u,1),u--;else{if(Math.abs(f)>Lr&&(this._audioTimestampBreak++,Math.abs(c.pts-this._lastAudioExceptionLargeGapDot)>Ir&&(this._lastAudioExceptionLargeGapDot=c.pts,i.warnings.push({type:Te.LARGE_AUDIO_GAP,time:c.pts/1e3,pts:c.pts,originPts:c.originPts,nextPts:l,sampleDuration:f,refSampleDuration:r}))),i.codecType===Se.OPUS){var p=t[t.length-1];p&&(p.duration=c.pts-p.pts)}else c.dts=c.pts=l,c.duration=n;this._audioNextPts+=r}}}},{key:"_getG711Duration",value:function(i){var t=i.sampleSize,e=i.channelCount,r=i.sampleRate,n=i.samples[0];if(n)return n.data.byteLength*2/e/(t/8)/r*1e3}},{key:"_getSilentFrame",value:function(i){return i.codecType===Se.AAC?et.getSilentFrame(i.codec,i.channelCount):new Uint8Array(8*i.sampleDuration*i.channelCount)}}]),s})();function We(){for(var s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];o=o.filter(Boolean);var t=new Uint8Array(o.reduce(function(r,n){return r+n.byteLength},0)),e=0;return o.forEach(function(r){t.set(r,e),e+=r.byteLength}),t}var bc=Math.pow(2,32);function be(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(s[o]<<8)+(s[o+1]||0)}function Sc(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(s[o]<<16)+(s[o+1]<<8)+(s[o+2]||0)}function j(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(s[o]<<24>>>0)+(s[o+1]<<16)+(s[o+2]<<8)+(s[o+3]||0)}function Mt(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return j(s,o)*bc+j(s,o+4)}function Ys(s){for(var o="avc1.",i,t=0;t<3;t++)i=s[t].toString(16),i.length<2&&(i="0".concat(i)),o+=i;return o}function Ia(s){if(!Array.isArray(s)){for(var o=[],i="",t=0;t<s.length;t++)t%2&&(i=s[t-1]+s[t],o.push(parseInt(i,16)),i="");return o}return s.map(function(e){return parseInt(e,16)})}function xr(s,o){return+(s+"."+o)}function Ec(s){if(s.length<5)return 0;var o=Math.hypot(s[0],s[3]),i=Math.hypot(s[1],s[4]);return o===0||i===0?0:180*Math.atan2(s[1]/i,s[0]/o)/Math.PI}var rt=(function(){function s(){ge(this,s)}return me(s,null,[{key:"parseAnnexB",value:function(i){var t=i.byteLength-1,e=0;do{if(i[t]===0)e++;else break;t--}while(t>0);e>=3&&(i=i.subarray(0,t+1));for(var r=i.length,n=2,a=0;i[n]!==null&&i[n]!==void 0&&i[n]!==1;)n++;if(n++,a=n+2,a>=r)return[];for(var u=[];a<r;)switch(i[a]){case 0:if(i[a-1]!==0){a+=2;break}else if(i[a-2]!==0){a++;break}else if(a<r-1&&i[a+1]!==1){a++;break}n!==a-2&&u.push(i.subarray(n,a-2));do a++;while(i[a]!==1&&a<r);n=a+1,a=n+2;break;case 1:if(i[a-1]!==0||i[a-2]!==0){a+=3;break}n!==a-2&&u.push(i.subarray(n,a-2)),n=a+1,a=n+2;break;default:a+=3;break}return n<r&&u.push(i.subarray(n)),u}},{key:"parseAvcC",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4;if(!(i.length<4)){for(var e=i.length,r=[],n=0,a;n+t<e;)if(a=j(i,n),t===3&&(a>>>=8),n+=t,!!a){if(n+a>e)break;r.push(i.subarray(n,n+a)),n+=a}return r}}},{key:"parseSEI",value:function(i,t){for(var e=i.length,r=t?2:1,n=0,a=0,u="";i[r]===255;)n+=255,r++;for(n+=i[r++];i[r]===255;)a+=255,r++;if(a+=i[r++],n===5&&e>r+16)for(var l=0;l<16;l++)u+=i[r].toString(16),r++;return{payload:i.subarray(r,r+a),type:n,size:a,uuid:u}}},{key:"removeEPB",value:function(i){for(var t=i.byteLength,e=[],r=1;r<t-2;)i[r]===0&&i[r+1]===0&&i[r+2]===3?(e.push(r+2),r+=2):r++;if(!e.length)return i;var n=t-e.length,a=new Uint8Array(n),u=0;for(r=0;r<n;u++,r++)u===e[0]&&(u++,e.shift()),a[r]=i[u];return a}}]),s})(),an=(function(){function s(o){if(ge(this,s),N(this,"_bytesAvailable",void 0),N(this,"_bitsAvailable",0),N(this,"_word",0),!o)throw new Error("ExpGolomb data params is required");this._data=o,this._bytesAvailable=o.byteLength,this._bytesAvailable&&this._loadWord()}return me(s,[{key:"bitsAvailable",get:function(){return this._bitsAvailable}},{key:"_loadWord",value:function(){var i=this._data.byteLength-this._bytesAvailable,t=Math.min(4,this._bytesAvailable);if(t===0)throw new Error("No bytes available");var e=new Uint8Array(4);e.set(this._data.subarray(i,i+t)),this._word=new DataView(e.buffer).getUint32(0),this._bitsAvailable=t*8,this._bytesAvailable-=t}},{key:"skipBits",value:function(i){if(this._bitsAvailable>i)this._word<<=i,this._bitsAvailable-=i;else{i-=this._bitsAvailable;var t=Math.floor(i/8);i-=t*8,this._bytesAvailable-=t,this._loadWord(),this._word<<=i,this._bitsAvailable-=i}}},{key:"readBits",value:function(i){if(i>32)throw new Error("Cannot read more than 32 bits");var t=Math.min(this._bitsAvailable,i),e=this._word>>>32-t;return this._bitsAvailable-=t,this._bitsAvailable>0?this._word<<=t:this._bytesAvailable>0&&this._loadWord(),t=i-t,t>0&&this._bitsAvailable?e<<t|this.readBits(t):e}},{key:"skipLZ",value:function(){var i;for(i=0;i<this._bitsAvailable;++i)if((this._word&2147483648>>>i)!==0)return this._word<<=i,this._bitsAvailable-=i,i;return this._loadWord(),i+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var i=this.skipLZ();return this.readBits(i+1)-1}},{key:"readEG",value:function(){var i=this.readUEG();return 1&i?1+i>>>1:-1*(i>>>1)}},{key:"readBool",value:function(){return this.readBits(1)===1}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(i){for(var t=8,e=8,r,n=0;n<i;n++)e!==0&&(r=this.readEG(),e=(t+r+256)%256),t=e===0?t:e}}]),s})(),Xs=(function(){function s(){ge(this,s)}return me(s,null,[{key:"parseAVCDecoderConfigurationRecord",value:function(i){if(!(i.length<7)){for(var t=(i[4]&3)+1,e,r=[],n=[],a=6,u=i[5]&31,l,c=0;c<u;c++)if(l=i[a]<<8|i[a+1],a+=2,!!l){var f=i.subarray(a,a+l);a+=l,r.push(f),e||(e=s.parseSPS(rt.removeEPB(f)))}var h=i[a];a++;for(var d,v=0;v<h;v++)d=i[a]<<8|i[a+1],a+=2,d&&(n.push(i.subarray(a,a+d)),a+=d);return{sps:e,spsArr:r,ppsArr:n,nalUnitSize:t}}}},{key:"parseSPS",value:function(i){var t=new an(i);t.readUByte();var e=t.readUByte(),r=t.readUByte(),n=t.readUByte();t.skipUEG();var a=420;if(e===100||e===110||e===122||e===244||e===44||e===83||e===86||e===118||e===128||e===138||e===144){var u=t.readUEG();if(u<=3&&(a=[0,420,422,444][u]),u===3&&t.skipBits(1),t.skipUEG(),t.skipUEG(),t.skipBits(1),t.readBool())for(var l=u!==3?8:12,c=0;c<l;c++)t.readBool()&&(c<6?t.skipScalingList(16):t.skipScalingList(64))}t.skipUEG();var f=t.readUEG();if(f===0)t.readUEG();else if(f===1){t.skipBits(1),t.skipUEG(),t.skipUEG();for(var h=t.readUEG(),d=0;d<h;d++)t.skipUEG()}t.skipUEG(),t.skipBits(1);var v=t.readUEG(),y=t.readUEG(),p=t.readBits(1);p===0&&t.skipBits(1),t.skipBits(1);var b=0,k=0,E=0,w=0;t.readBool()&&(b=t.readUEG(),k=t.readUEG(),E=t.readUEG(),w=t.readUEG());var T,L,O,B,x;if(t.readBool()){if(t.readBool()){var U=t.readUByte();switch(U){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:{T=[t.readUByte()<<8|t.readUByte(),t.readUByte()<<8|t.readUByte()];break}}}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var W=t.readBits(32),m=t.readBits(32);L=t.readBool(),O=m,B=W*2,x=O/B}}return{codec:Ys(i.subarray(1,4)),profileIdc:e,profileCompatibility:r,levelIdc:n,chromaFormat:a,width:Math.ceil((v+1)*16-2*(b+k)),height:(2-p)*(y+1)*16-(p?2:4)*(E+w),sarRatio:T,fpsNum:O,fpsDen:B,fps:x,fixedFrame:L}}}]),s})(),sn=(function(){function s(){ge(this,s)}return me(s,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!(i.length<23)){t=t||{};for(var e=(i[21]&3)+1,r,n,a=[],u=[],l=[],c=23,f=i[22],h,d,v,y=0;y<f;y++){h=i[c]&63,d=i[c+1]<<8|i[c+2],c+=3;for(var p=0;p<d;p++)if(v=i[c]<<8|i[c+1],c+=2,!!v){switch(h){case 32:{var b=i.subarray(c,c+v);r||(r=s.parseVPS(rt.removeEPB(b),t)),l.push(b)}break;case 33:{var k=i.subarray(c,c+v);n||(n=s.parseSPS(rt.removeEPB(k),t)),a.push(k)}break;case 34:u.push(i.subarray(c,c+v));break}c+=v}}return{hvcC:t,sps:n,spsArr:a,ppsArr:u,vpsArr:l,nalUnitSize:e}}}},{key:"parseVPS",value:function(i,t){t=t||{};var e=new an(i);e.readUByte(),e.readUByte(),e.readBits(12);var r=e.readBits(3);return t.numTemporalLayers=Math.max(t.numTemporalLayers||0,r+1),e.readBits(17),s._parseProfileTierLevel(e,r,t),t}},{key:"parseSPS",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=t||{};var e=new an(i);e.readUByte(),e.readUByte(),e.readBits(4);var r=e.readBits(3);t.numTemporalLayers=Math.max(r+1,t.numTemporalLayers||0),t.temporalIdNested=e.readBits(1),s._parseProfileTierLevel(e,r,t),e.readUEG();var n=t.chromaFormatIdc=e.readUEG(),a=420;n<=3&&(a=[0,420,422,444][n]);var u=0;n===3&&(u=e.readBits(1));var l=e.readUEG(),c=e.readUEG(),f=e.readBits(1),h,d,v,y;if(f===1&&(h=e.readUEG(),d=e.readUEG(),v=e.readUEG(),y=e.readUEG()),t.bitDepthLumaMinus8=e.readUEG(),t.bitDepthChromaMinus8=e.readUEG(),f===1){var p=(n===1||n===2)&&u===0?2:1,b=n===1&&u===0?2:1;l-=p*(d+h),c-=b*(y+v)}return{codec:"hev1.1.6.L93.B0",width:l,height:c,chromaFormat:a,hvcC:t}}},{key:"_parseProfileTierLevel",value:function(i,t,e){var r=e.generalTierFlag||0;e.generalProfileSpace=i.readBits(2),e.generalTierFlag=Math.max(i.readBits(1),r),e.generalProfileIdc=Math.max(i.readBits(5),e.generalProfileIdc||0),e.generalProfileCompatibilityFlags=i.readBits(32),e.generalConstraintIndicatorFlags=[i.readBits(8),i.readBits(8),i.readBits(8),i.readBits(8),i.readBits(8),i.readBits(8)];var n=i.readBits(8);r<e.generalTierFlag?e.generalLevelIdc=n:e.generalLevelIdc=Math.max(n,e.generalLevelIdc||0);var a=[],u=[];if(t>i.bitsAvailable)throw new Error("maxSubLayersMinus inavlid size ".concat(t));for(var l=0;l<t;l++)a[l]=i.readBits(1),u[l]=i.readBits(1);t>0&&i.readBits((8-t)*2);for(var c=0;c<t;c++)a[c]!==0&&(i.readBits(2),i.readBits(1),i.readBits(5),i.readBits(16),i.readBits(16),i.readBits(4),i.readBits(16),i.readBits(16),i.readBits(12)),u[c]!==0&&i.readBits(8)}}]),s})(),xa=(function(){function s(){ge(this,s)}return me(s,null,[{key:"decode",value:function(i){for(var t=[],e=i,r=0,n=i.length;r<n;){if(e[r]<128){t.push(String.fromCharCode(e[r])),++r;continue}else if(!(e[r]<192)){if(e[r]<224){if(s._checkContinuation(e,r,1)){var a=(e[r]&31)<<6|e[r+1]&63;if(a>=128){t.push(String.fromCharCode(a&65535)),r+=2;continue}}}else if(e[r]<240){if(s._checkContinuation(e,r,2)){var u=(e[r]&15)<<12|(e[r+1]&63)<<6|e[r+2]&63;if(u>=2048&&(u&63488)!==55296){t.push(String.fromCharCode(u&65535)),r+=3;continue}}}else if(e[r]<248&&s._checkContinuation(e,r,3)){var l=(e[r]&7)<<18|(e[r+1]&63)<<12|(e[r+2]&63)<<6|e[r+3]&63;if(l>65536&&l<1114112){l-=65536,t.push(String.fromCharCode(l>>>10|55296)),t.push(String.fromCharCode(l&1023|56320)),r+=4;continue}}}t.push("�"),++r}return t.join("")}},{key:"_checkContinuation",value:function(i,t,e){var r=i;if(t+e<r.length){for(;e--;)if((r[++t]&192)!==128)return!1;return!0}else return!1}}]),s})(),kc=(function(){function s(){ge(this,s)}return me(s,null,[{key:"parse",value:function(i){if(!(i.length<3)){var t={},e=s._parseValue(new DataView(i.buffer,i.byteOffset,i.byteLength)),r=s._parseValue(new DataView(i.buffer,i.byteOffset+e.size,i.byteLength-e.size));return t[e.data]=r.data,t}}},{key:"_parseValue",value:function(i){var t=i.byteLength,e=i.getUint8(0),r=1,n=!1,a;switch(e){case 0:a=i.getFloat64(1),r+=8;break;case 1:{a=!!i.getUint8(1),r+=1;break}case 2:{var u=s._parseString(new DataView(i.buffer,i.byteOffset+r,i.byteLength-r)),l=u.data,c=u.size;a=l,r+=c}break;case 3:{a={};var f=0;for((i.getUint32(t-4)&16777215)===9&&(f=3);r<t-4;){var h=s._parseObject(new DataView(i.buffer,i.byteOffset+r,i.byteLength-r-f)),d=h.size,v=h.data,y=h.isEnd;if(y)break;a[v.name]=v.value,r+=d}if(r<=t-3){var p=i.getUint32(r-1)&16777215;p===9&&(r+=3)}}break;case 8:{a={},r+=4;var b=0;for((i.getUint32(t-4)&16777215)===9&&(b=3);r<t-8;){var k=s._parseObject(new DataView(i.buffer,i.byteOffset+r,i.byteLength-r-b)),E=k.size,w=k.data,T=k.isEnd;if(T)break;a[w.name]=w.value,r+=E}if(r<=t-3){var L=i.getUint32(r-1)&16777215;L===9&&(r+=3)}}break;case 9:a=void 0,r=1,n=!0;break;case 10:{a=[];var O=i.getUint32(1);r+=4;for(var B=0;B<O;B++){var x=s._parseValue(new DataView(i.buffer,i.byteOffset+r,i.byteLength-r)),U=x.data,W=x.size;a.push(U),r+=W}}break;case 11:{var m=i.getFloat64(r)+i.getInt16(r+8)*6e4;a=new Date(m),r+=10}break;case 12:{var _=i.getUint32(1);r+=4,a="",_>0&&(a=xa.decode(new Uint8Array(i.buffer,i.byteOffset+r,_))),r+=_}break;default:r=t;break}return{data:a,size:r,isEnd:n}}},{key:"_parseString",value:function(i){var t=i.getUint16(0),e="";return t>0&&(e=xa.decode(new Uint8Array(i.buffer,i.byteOffset+2,t))),{data:e,size:2+t}}},{key:"_parseObject",value:function(i){if(!(i.byteLength<3)){var t=s._parseString(i),e=s._parseValue(new DataView(i.buffer,i.byteOffset+t.size,i.byteLength-t.size));return{data:{name:t.data,value:e.data},size:t.size+e.size,isEnd:e.isEnd}}}}]),s})(),st={G711A:7,G711M:8,AAC:10,OPUS:13},it=new Gt("FlvDemuxer"),qs=(function(){function s(o,i,t){ge(this,s),N(this,"_headerParsed",!1),N(this,"_remainingData",null),N(this,"_gopId",0),N(this,"_needAddMetaBeforeKeyFrameNal",!0),this.videoTrack=o||new wn,this.audioTrack=i||new Cn,this.metadataTrack=t||new An,this._fixer=new _c(this.videoTrack,this.audioTrack,this.metadataTrack)}return me(s,[{key:"demux",value:function(i){var t,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=arguments.length>3?arguments[3]:void 0,a=this.audioTrack,u=this.videoTrack,l=this.metadataTrack;if((e||!r)&&(this._remainingData=null),e&&(this._headerParsed=!1),e?(u.reset(),a.reset(),l.reset()):(u.samples=[],a.samples=[],l.seiSamples=[],l.flvScriptSamples=[],u.warnings=[],a.warnings=[],this._remainingData&&(i=We(this._remainingData,i),this._remainingData=null)),!i.length)return{videoTrack:u,audioTrack:a,metadataTrack:l};var c=0;if(!this._headerParsed){if(!s.probe(i))throw new Error("Invalid flv file");a.present=(i[4]&4)>>>2!==0,u.present=(i[4]&1)!==0,this._headerParsed=!0,c=j(i,5)+4}for(var f=i.length,h,d,v,y,p;c+15<f&&(h=i[c],d=i[c+1]<<16|i[c+2]<<8|i[c+3],!(c+15+d>f));)v=(i[c+7]<<24>>>0)+(i[c+4]<<16)+(i[c+5]<<8)+i[c+6],c+=11,y=i.subarray(c,c+d),h===8?this._parseAudio(y,v):h===9?(n&&(this.seamlessLoadingSwitching=!0),this._parseVideo(y,v)):h===18?this._parseScript(y,v):it.warn("Invalid tag type: ".concat(h)),c+=d,p=j(i,c),p!==11+d&&it.warn("Invalid PrevTagSize ".concat(p," (").concat(11+d,")")),c+=4;c<f&&(this._remainingData=i.subarray(c)),a.formatTimescale=u.formatTimescale=u.timescale=l.timescale=1e3,a.timescale=a.codecType===Se.OPUS?1e3:a.sampleRate||0,!a.exist()&&a.hasSample()&&a.reset(),!u.exist()&&u.hasSample()&&u.reset();var b=l.flvScriptSamples[l.flvScriptSamples.length-1],k=b==null||(t=b.data)===null||t===void 0?void 0:t.onMetaData;return k&&(u!=null&&u.exist()&&(k.hasOwnProperty("duration")&&(u.duration=k.duration*1e3),!u.width&&k.hasOwnProperty("width")&&(u.width=k.width),!u.height&&k.hasOwnProperty("height")&&(u.height=k.height)),a!=null&&a.exist()&&k.hasOwnProperty("duration")&&(a.duration=k.duration*1e3)),{videoTrack:u,audioTrack:a,metadataTrack:l}}},{key:"fix",value:function(i,t,e){return this._fixer.fix(i,t,e),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(i,t,e,r,n){return this.demux(i,t,e,n),this.fix(r,t,e)}},{key:"_parseAudio",value:function(i,t){if(i.length){var e=(i[0]&240)>>>4,r=this.audioTrack;if(e!==st.AAC&&e!==st.G711A&&e!==st.G711M&&e!==st.OPUS){it.warn("Unsupported sound format: ".concat(e)),r.reset();return}if(e!==st.AAC&&e!==st.OPUS){var n=(i[0]&12)>>2,a=(i[0]&2)>>1,u=i[0]&1;r.sampleRate=s.AUDIO_RATE[n],r.sampleSize=a?16:8,r.channelCount=u+1}switch(e){case st.G711A:case st.G711M:this._parseG711(i,t,e);break;case st.AAC:this._parseAac(i,t);break;case st.OPUS:this._parseOpus(i,t);break}}}},{key:"_parseOpus",value:function(i,t){var e=this.audioTrack,r=i[1];switch(e.codecType=Se.OPUS,r){case 0:{var n=nn.parseHeaderPackets(i.subarray(2));n?(e.codec=n.codec,e.channelCount=n.channelCount,e.sampleRate=n.sampleRate,e.config=n.config,e.sampleDuration=nn.getFrameDuration([],e.timescale)):(e.reset(),it.warn("Cannot parse AudioSpecificConfig",i));break}case 1:{if(t==null)return;var a=new _t(t,i.subarray(2),e.sampleDuration);e.samples.push(a);break}default:it.warn("Unknown OpusPacketType: ".concat(r))}}},{key:"_parseG711",value:function(i,t,e){var r=this.audioTrack,n=i.subarray(1);if(!(n.byteLength<1)){var a=new _t(t,n);r.codecType=e===7?Se.G711PCMA:Se.G711PCMU,r.sampleRate=8e3,r.codec=r.codecType,r.samples.push(a)}}},{key:"_parseAac",value:function(i,t){var e=this.audioTrack;if(e.codecType=Se.AAC,i[1]===0){var r=et.parseAudioSpecificConfig(i.subarray(2));r?(e.codec=r.codec,e.channelCount=r.channelCount,e.sampleRate=r.sampleRate,e.config=r.config,e.objectType=r.objectType,e.sampleRateIndex=r.samplingFrequencyIndex):(e.reset(),it.warn("Cannot parse AudioSpecificConfig",i))}else if(i[1]===1){if(t==null)return;e.samples.push(new _t(t,i.subarray(2)))}else it.warn("Unknown AACPacketType: ".concat(i[1]))}},{key:"_parseVideo",value:function(i,t){var e=this;if(!(i.length<6)){var r=(i[0]&240)>>>4,n=i[0]&15,a=this.videoTrack;if(n!==7&&n!==12){a.reset(),it.warn("Unsupported codecId: ".concat(n));return}var u=n===12;a.codecType=u?dt.HEVC:dt.AVC;var l=i[1],c=(i[2]<<16|i[3]<<8|i[4])<<8>>8;if(l===0){var f=i.subarray(5),h=u?sn.parseHEVCDecoderConfigurationRecord(f):Xs.parseAVCDecoderConfigurationRecord(f);if(h){var d=h.hvcC,v=h.sps,y=h.ppsArr,p=h.spsArr,b=h.vpsArr,k=h.nalUnitSize;d&&(a.hvcC=a.hvcC||d),v&&(a.codec=v.codec,a.width=v.width,a.height=v.height,a.sarRatio=v.sarRatio,a.fpsNum=v.fpsNum,a.fpsDen=v.fpsDen),p.length&&(a.sps=p),y.length&&(a.pps=y),b&&b.length&&(a.vps=b),k&&(a.nalUnitSize=k)}else it.warn("Cannot parse ".concat(u?"HEVC":"AVC","DecoderConfigurationRecord"),i)}else if(l===1){var E=rt.parseAvcC(i.subarray(5),a.nalUnitSize);if(E=this._checkAddMetaNalToUnits(u,E,a),E&&E.length){var w=new tr(t+c,t,E);if(this.seamlessLoadingSwitching&&t<a.lastKeyFrameDts)return;this.seamlessLoadingSwitching=!1,r===1&&(w.setToKeyframe(),a.lastKeyFrameDts=t),a.samples.push(w),E.forEach(function(T){var L=u?T[0]>>>1&63:T[0]&31;switch(L){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!u&&L!==5||u&&L===5)break;w.setToKeyframe();break;case 6:case 39:case 40:if(!u&&L!==6||u&&L===6)break;e.metadataTrack.seiSamples.push(new Ws(rt.parseSEI(rt.removeEPB(T),u),t+c));break}}),w.keyframe&&this._gopId++,w.gopId=this._gopId}else it.warn("Cannot parse NALUs",i)}else l===2||it.warn("Unknown AVCPacketType: ".concat(l))}}},{key:"_checkAddMetaNalToUnits",value:function(i,t,e){if(!i||!this._needAddMetaBeforeKeyFrameNal)return this._needAddMetaBeforeKeyFrameNal=!1,t;var r=t.map(function(n){return n[0]>>>1&63});return r.includes(32)?(this._needAddMetaBeforeKeyFrameNal=!1,t):(t.unshift(e.pps[0]),t.unshift(e.sps[0]),t.unshift(e.vps[0]),t.filter(Boolean))}},{key:"_parseScript",value:function(i,t){this.metadataTrack.flvScriptSamples.push(new vc(kc.parse(i),t))}}],[{key:"probe",value:function(i){return i[0]!==70||i[1]!==76||i[2]!==86||i[3]!==1?!1:j(i,5)>=9}}]),s})();N(qs,"AUDIO_RATE",[5500,11e3,22e3,44e3]);var Tc=9e4/2,Oa=3,Ri=9e4,Or=5*9e4,Rr=9e4,wc=9e4/2,Cc=9e4*5,Ac=(function(){function s(o,i,t,e){ge(this,s),this.videoTrack=o,this.audioTrack=i,this.metadataTrack=t,this._baseDts=-1,this._baseVideoDts=-1,this._baseAudioDts=-1,this._baseDtsInited=!1,this._audioNextPts=void 0,this._videoNextDts=void 0,this._audioTimestampBreak=!1,this._videoTimestampBreak=!1,this._lastAudioExceptionGapDot=0,this._lastAudioExceptionOverlapDot=0,this._lastAudioExceptionLargeGapDot=0,this._needForceFixLargeGap=e==null?void 0:e.forceFixLargeGap,this._largeGapThreshold=(e==null?void 0:e.largeGapThreshold)||Cc}return me(s,[{key:"fix",value:function(){var i=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;t=Math.round(t*9e4);var n=this.videoTrack,a=this.audioTrack,u=n.samples,l=a.samples;if(!(!u.length&&!l.length)){var c=u[0],f=l[0],h=0;if(u.length&&l.length&&(h=c.dts-f.pts),this._baseDtsInited||this._calculateBaseDts(this.audioTrack,this.videoTrack),e&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t,this._baseAudioDts-=t,this._baseVideoDts-=t),!r){this._videoNextDts=h>0?t+h:t,this._audioNextPts=h>0?t:t-h,this._needForceFixLargeGap&&(this._videoNextDts=0,this._audioNextPts=0);var d=c?c.dts-this._baseDts-this._videoNextDts:0,v=f?f.pts-this._baseDts-this._audioNextPts:0;Math.abs(d||v)>Rr&&(this._calculateBaseDts(this.audioTrack,this.videoTrack),this._baseDts-=t)}if(this._resetBaseDtsWhenStreamBreaked(),this._fixAudio(a),this._fixVideo(n),this.metadataTrack.exist()){var y=this.metadataTrack.timescale;this.metadataTrack.seiSamples.forEach(function(p){p.pts=p.originPts-i._baseDts,p.time=Math.max(0,p.pts)/y})}n.samples.length&&(n.baseMediaDecodeTime=n.samples[0].dts),a.samples.length&&(a.baseMediaDecodeTime=a.samples[0].pts*a.timescale/9e4)}}},{key:"_fixVideo",value:function(i){var t=this,e=i.samples;if(e.length){if(e.forEach(function(O){O.dts-=t._needForceFixLargeGap?t._baseVideoDts:t._baseDts,O.pts-=t._needForceFixLargeGap?t._baseVideoDts:t._baseDts}),this._videoNextDts===void 0){var r=e[0];this._videoNextDts=r.dts}var n=e.length,a=0,u=e[0],l=e[1],c=this._videoNextDts-u.dts;if(Math.abs(c)>wc){var f;if(i.warnings.push({type:Te.LARGE_VIDEO_GAP_BETWEEN_CHUNK,nextDts:this._videoNextDts/90,firstSampleDts:u.dts/90,nextSampleDts:(((f=e[1])===null||f===void 0?void 0:f.dts)||0)/90,sampleDuration:c/90}),u.dts+=c,u.pts+=c,l&&Math.abs(l.dts-u.dts)>Rr)this._videoTimestampBreak=!0,e.forEach(function(O,B){B!==0&&(O.dts+=c,O.pts+=c)});else for(var h=1;h<=n-1;h++){var d,v=(d=e[h])===null||d===void 0?void 0:d.dts,y=e[h-1].dts;v&&v-y<0&&(e[h].dts+=c,e[h].pts+=c)}}var p;if(i.fpsNum&&i.fpsDen&&(p=i.timescale*(i.fpsDen/i.fpsNum)),p<900&&(p=0),!p){var b=i.samples[0],k=i.samples[1];p=n===1?9e3:Math.floor(k.dts-b.dts)}for(var E=0;E<n;E++){var w=e[E].dts,T=e[E+1];if(E<n-1?a=T.dts-w:e[E-1]?a=Math.min(w-e[E-1].dts,p):a=p,a>Rr||a<0){this._videoTimestampBreak=!0,a=this._audioTimestampBreak?p:Math.max(a,2700);var L=this._audioNextPts||0;T&&T.dts>L&&(a=p),i.warnings.push({type:Te.LARGE_VIDEO_GAP,time:w/i.timescale,dts:w,originDts:e[E].originDts,nextDts:this._videoNextDts,sampleDuration:a,refSampleDuration:p})}e[E].duration=a,this._videoNextDts+=a}}}},{key:"_fixAudio",value:function(i){var t=this,e=i.samples;if(e.length){if(i.codecType===Se.MP3){this.lastAudioSample&&e.unshift(this.lastAudioSample);for(var r=0;r<e.length;r++){var n=e[r];if(e[r+1])n.duration=e[r+1].pts-n.pts;else break;n.pts-=this._baseDts,n.dts=n.pts}this.lastAudioSample=e.pop();return}e.forEach(function(a){a.pts-=t._needForceFixLargeGap?t._baseAudioDts:t._baseDts,a.dts=a.pts}),this._doFixAudioInternal(i,e,9e4)}}},{key:"_calculateBaseDts",value:function(i,t){var e=i.samples,r=t.samples;if(!e.length&&!r.length)return!1;var n=1/0,a=1/0;e.length&&(i.baseDts=n=e[0].pts,this._baseAudioDts=n),r.length&&(t.baseDts=a=r[0].dts,this._baseVideoDts=a),this._baseDts=Math.min(n,a);var u=a-n,l=!1;return Number.isFinite(u)&&Math.abs(u)>Tc&&t.warnings.push({type:Te.LARGE_AV_SHIFT,videoBaseDts:a,audioBasePts:n,baseDts:this._baseDts,delta:u}),Number.isFinite(u)&&Math.abs(u)>this._largeGapThreshold*Ri&&(l=!0),this._baseDtsInited||(l&&this._needForceFixLargeGap?this._needForceFixLargeGap=!0:this._needForceFixLargeGap=!1),this._baseDtsInited=!0,!0}},{key:"_resetBaseDtsWhenStreamBreaked",value:function(){if(this._baseDtsInited&&this._videoTimestampBreak&&this._audioTimestampBreak){var i=this._calculateBaseDts(this.audioTrack,this.videoTrack);if(!i)return;this._baseDts-=Math.min(this._audioNextPts,this._videoNextDts),this._audioLastSample=null,this._videoLastSample=null,this._videoTimestampBreak=!1,this._audioTimestampBreak=!1}}},{key:"_doFixAudioInternal",value:function(i,t,e){i.sampleDuration||(i.sampleDuration=et.getFrameDuration(i.timescale,e));var r=i.sampleDuration;if(this._audioNextPts===void 0){var n=t[0];this._audioNextPts=n.pts}for(var a=0;a<t.length;a++){var u=this._audioNextPts,l=t[a],c=l.pts-u;if(!this._audioTimestampBreak&&c>=Oa*r&&c<=Ri&&!$s){var f=et.getSilentFrame(i.codec,i.channelCount)||t[0].data.subarray(),h=Math.floor(c/r);Math.abs(l.pts-this._lastAudioExceptionGapDot)>Or&&(this._lastAudioExceptionGapDot=l.pts),i.warnings.push({type:Te.AUDIO_FILLED,pts:l.pts/90,originPts:l.originPts,count:h,nextPts:u/90,refSampleDuration:r});for(var d=0;d<h;d++){var v=new _t(Math.floor(u),f);v.originPts=Math.floor(this._baseDts+u),t.splice(a,0,v),this._audioNextPts+=r,a++}a--}else c<=-Oa*r&&c>=-1*Ri?(Math.abs(l.pts-this._lastAudioExceptionOverlapDot)>Or&&(this._lastAudioExceptionOverlapDot=l.pts,i.warnings.push({type:Te.AUDIO_DROPPED,pts:l.pts/90,originPts:l.originPts,nextPts:u/90,refSampleDuration:r})),t.splice(a,1),a--):(Math.abs(c)>=Ri&&(this._audioTimestampBreak=!0,Math.abs(l.pts-this._lastAudioExceptionLargeGapDot)>Or&&(this._lastAudioExceptionLargeGapDot=l.pts,i.warnings.push({type:Te.LARGE_AUDIO_GAP,time:l.pts/1e3,pts:l.pts/90,originPts:l.originPts,nextPts:u/90,sampleDuration:c,refSampleDuration:r}))),l.dts=l.pts=u,this._audioNextPts+=r)}}}]),s})(),Dc=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Pc=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Lc=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Ic=[0,1,1,4],Mi=null,Ra=(function(){function s(){ge(this,s)}return me(s,null,[{key:"isHeader",value:function(i,t){return t+1<i.length&&i[t]===255&&(i[t+1]&224)===224&&(i[t+1]&6)!==0}},{key:"appendFrame",value:function(i,t,e,r,n){if(!(e+24>t.length)){var a=s.parseHeader(t,e);if(a&&e+a.frameLength<=t.length){var u=a.samplesPerFrame*9e4/a.sampleRate,l=r+n*u,c={data:t.subarray(e,e+a.frameLength),pts:l,dts:l};return c.size=c.data.byteLength,i.config=[],i.channelCount=a.channelCount,i.sampleRate=a.sampleRate,Ks?i.codec="mp3":i.container="audio/mpeg",i.samples.push(c),{length:a.frameLength}}}}},{key:"parseHeader",value:function(i,t){var e=i[t+1]>>3&3,r=i[t+1]>>1&3,n=i[t+2]>>4&15,a=i[t+2]>>2&3;if(e!==1&&n!==0&&n!==15&&a!==3){var u=i[t+2]>>1&1,l=i[t+3]>>6,c=e===3?3-r:r===3?3:4,f=Dc[c*14+n-1]*1e3,h=e===3?0:e===2?1:2,d=Pc[h*3+a],v=l===3?1:2,y=Lc[e][r],p=Ic[r],b=y*8*p,k=Math.floor(y*f/d+u)*p;if(Mi===null){var E=navigator.userAgent||"",w=E.match(/Chrome\/(\d+)/i);Mi=w?parseInt(w[1]):0}var T=!!Mi&&Mi<=87;return T&&r===2&&f>=224e3&&l===0&&(i[t+3]=i[t+3]|128),{sampleRate:d,channelCount:v,frameLength:k,samplesPerFrame:b}}}}]),s})(),Je=new Gt("TsDemuxer"),Qs=(function(){function s(o,i,t){var e=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};ge(this,s),N(this,"_pmtId",-1),N(this,"_remainingPacketData",null),N(this,"_videoPesData",[]),N(this,"_audioPesData",[]),N(this,"_gopId",0),this.videoTrack=o||new wn,this.audioTrack=i||new Cn,this.metadataTrack=t||new An,this._fixer=new Ac(this.videoTrack,this.audioTrack,this.metadataTrack,e)}return me(s,[{key:"demux",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=this.audioTrack,n=this.videoTrack,a=this.metadataTrack;t&&(this._pmtId=-1,n.reset(),r.reset(),a.reset()),!e||t?(this._remainingPacketData=null,this._videoPesData=[],this._audioPesData=[]):(n.samples=[],r.samples=[],a.seiSamples=[],n.warnings=[],r.warnings=[],this._remainingPacketData&&(i=We(this._remainingPacketData,i),this._remainingPacketData=null));var u=i.length,l=u%188;l&&(this._remainingPacketData=i.subarray(u-l),u-=l);for(var c=n.pid,f=r.pid,h=0;h<u;h+=188){if(i[h]!==71)throw new Error("TS packet did not start with 0x47");var d=!!(i[h+1]&64),v=((i[h+1]&31)<<8)+i[h+2],y=(i[h+3]&48)>>4,p=void 0;if(y>1){if(p=h+5+i[h+4],p===h+188)continue}else p=h+4;switch(v){case 0:d&&(p+=i[p]+1),this._pmtId=(i[p+10]&31)<<8|i[p+11];break;case this._pmtId:{d&&(p+=i[p]+1);var b=p+3+((i[p+1]&15)<<8|i[p+2])-4,k=(i[p+10]&15)<<8|i[p+11];for(p+=12+k;p<b;){var E=(i[p+1]&31)<<8|i[p+2];switch(i[p]){case 15:r.pid=f=E;break;case 3:case 4:r.pid===-1&&(r.pid=f=E,r.codecType=Se.MP3);break;case 27:if(c!==-1)break;n.codecType=dt.AVC,n.pid=c=E;break;case 36:if(c!==-1)break;n.codecType=dt.HEVC,n.pid=c=E;break;default:Je.warn("Unsupported stream. type: ".concat(i[p],", pid: ").concat(E))}p+=((i[p+3]&15)<<8|i[p+4])+5}}break;case c:d&&this._videoPesData.length&&this._parseVideoData(),this._videoPesData.push(i.subarray(p,h+188));break;case f:d&&this._audioPesData.length&&this._parseAudioData(),this._audioPesData.push(i.subarray(p,h+188));break;case 17:case 8191:break;default:Je.warn("Unknown pid: ".concat(v))}}return this._parseVideoData(),this._parseAudioData(),r.formatTimescale=n.formatTimescale=n.timescale=a.timescale=9e4,r.timescale=r.sampleRate||0,{videoTrack:n,audioTrack:r,metadataTrack:a}}},{key:"fix",value:function(i,t,e){return this._fixer.fix(i,t,e),{videoTrack:this.videoTrack,audioTrack:this.audioTrack,metadataTrack:this.metadataTrack}}},{key:"demuxAndFix",value:function(i,t,e,r){return this.demux(i,t,e),this.fix(r,t,e)}},{key:"_parseVideoData",value:function(){if(this._videoPesData.length){var i=s._parsePES(We.apply(void 0,ze(this._videoPesData)));if(!i){Je.warn("Cannot parse video pes",this._videoPesData);return}var t=rt.parseAnnexB(i.data);t?this._createVideoSample(t,i.pts,i.dts):Je.warn("Cannot parse avc units",i),this._videoPesData=[]}}},{key:"_createVideoSample",value:function(i,t,e){var r=this;if(i.length){var n=this.videoTrack,a=n.codecType===dt.HEVC,u=new tr(t,e);i.forEach(function(l){var c=a?l[0]>>>1&63:l[0]&31;switch(c){case 5:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:if(!a&&c!==5||a&&c===5)break;u.setToKeyframe(),r._gopId++;break;case 6:case 39:case 40:if(!a&&c!==6||a&&c===6)break;r.metadataTrack.seiSamples.push(new Ws(rt.parseSEI(rt.removeEPB(l),a),t));return;case 32:if(!a)break;if(!n.vps.length){var f=sn.parseVPS(rt.removeEPB(l),n.hvcC);n.hvcC=n.hvcC||f,n.vps=[l]}break;case 7:case 33:if(!a&&c!==7||a&&c===7)break;if(!n.sps.length){var h=rt.removeEPB(l),d=a?sn.parseSPS(h,n.hvcC):Xs.parseSPS(h);n.sps=[l],n.hvcC=n.hvcC||d.hvcC,n.codec=d.codec,n.width=d.width,n.height=d.height,n.sarRatio=d.sarRatio,n.fpsNum=d.fpsNum,n.fpsDen=d.fpsDen}break;case 8:case 34:if(!a&&c!==8||a&&c===8)break;n.pps.length||(n.pps=[l]);break;case 9:case 35:break;case 38:if(a){for(var v=!1,y=2;y<l.byteLength;y++)if(l[y]===255){v=!0;break}if(!v)return}break}u.units.push(l)}),u.gopId=this._gopId,this._pushVideoSample(n,u)}}},{key:"_pushVideoSample",value:function(i,t){if(t.units.length)if(t.pts===null||t.pts===void 0){Je.warn("Video sample no pts",t);var e=i.samples[i.samples.length-1];e?(t.pts=e.pts,t.dts=e.dts):Je.warn("Drop video sample",t)}else i.samples.push(t)}},{key:"_parseAudioData",value:function(){if(this._audioPesData.length){var i=s._parsePES(We.apply(void 0,ze(this._audioPesData)));if(!i){Je.warn("Cannot parse audio pes",this._audioPesData);return}switch(this.audioTrack.codecType){case Se.AAC:this._parseAacData(i);break;case Se.MP3:this._parseMPEG(i);break}this._audioPesData=[]}}},{key:"_parseAacData",value:function(i){var t=this.audioTrack,e=i.pts;if(e==null){if(Je.warn("AAC pes not pts",t),!t.samples.length||!t.sampleRate)return;e=t.samples[t.samples.length-1].pts+et.getFrameDuration(t.sampleRate)}var r=et.parseADTS(i.data,e);if(r){var n;t.codec=r.codec,t.channelCount=r.channelCount,t.sampleRate=r.sampleRate,t.objectType=r.objectType,t.sampleRateIndex=r.samplingFrequencyIndex,t.config=r.config,(n=t.samples).push.apply(n,ze(r.frames.map(function(a){return new _t(a.pts,a.data)}))),r.skip&&Je.warn("Skip aac adts ".concat(r.skip," bits")),r.remaining&&Je.warn("Remaining aac adts ".concat(r.remaining," bits"))}else Je.warn("Cannot parse aac adts",i)}},{key:"_parseMPEG",value:function(i){var t=i.data,e=t.length,r=0,n=0,a=i.pts;if(a===void 0){Je.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;n<e;)if(Ra.isHeader(t,n)){var u=Ra.appendFrame(this.audioTrack,t,n,a,r);if(u)n+=u.length,r++;else break}else n++}}],[{key:"probe",value:function(i){return i.length?i[0]===71&&i[188]===71&&i[376]===71:!1}},{key:"_parsePES",value:function(i){var t=i[8];if(!(t==null||i.length<t+9)){var e=i[0]<<16|i[1]<<8|i[2];if(e===1){var r=(i[4]<<8)+i[5];if(!(r&&r>i.length-6)){var n,a,u=i[7];return u&192&&(n=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,u&64?(a=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,n-a>60*9e4&&(n=a)):a=n),{data:i.subarray(9+t),pts:n,dts:a}}}}}}]),s})(),Mr=(function(){function s(o,i,t){ge(this,s),this.dv=new DataView(o),this.start=this.offset=i||this.dv.byteOffset,this.end=t?this.start+t:this.start+this.dv.byteLength}return me(s,[{key:"buffer",get:function(){return this.dv.buffer}},{key:"unreadLength",get:function(){return Math.max(this.end-this.offset,0)}},{key:"size",get:function(){return this.end-this.start}},{key:"readFloat",value:function(i){var t=0;switch(i){case 4:t=this.dv.getFloat32(this.offset);break;case 8:t=this.dv.getFloat64(this.offset);break;default:throw new Error("read ".concat(i,"-byte float is not supported"))}return this.offset+=i,t}},{key:"back",value:function(i){this.offset-=i}},{key:"skip",value:function(i){this.offset+=i}},{key:"readInt",value:function(i){var t=this.offset;switch(this.offset+=i,i){case 1:return this.dv.getInt8(t);case 2:return this.dv.getInt16(t);case 4:return this.dv.getInt32(t);default:throw new Error("read ".concat(i,"-byte integers is not supported"))}}},{key:"read",value:function(i){var t=this.offset;switch(this.offset+=i,i){case 1:return this.dv.getUint8(t);case 2:return this.dv.getUint16(t);case 3:return(this.dv.getUint16(t)<<8)+this.dv.getUint8(t+2);case 4:return this.dv.getUint32(t);default:return this.back(i-4),this.read(i-4)+this.dv.getUint32(t)*Math.pow(256,i-4)}}},{key:"write",value:function(i,t){var e=this.offset;switch(this.offset+=i,i){case 1:return this.dv.setUint8(e,t);case 2:return this.dv.setUint16(e,t);case 3:return this.dv.setUint8(e,t>>>16),this.dv.setUint16(e+1,65535&t);case 4:return this.dv.setUint32(e,t);default:throw new Error("write ".concat(i,"-byte integers is not supported"))}}},{key:"readToBuffer",value:function(i){var t;return this.offset||i?t=this.dv.buffer.slice(this.offset,i?this.offset+i:this.end):t=this.dv.buffer,this.offset+=t.byteLength,t}},{key:"readToUint8",value:function(i){var t=new Uint8Array(this.dv.buffer,this.offset,i||this.unreadLength);return this.offset+=t.byteLength,t}},{key:"readString",value:function(i){for(var t=0,e="";t<i;t++)e+=String.fromCharCode(this.dv.getUint8(this.offset)),this.offset++;return e}}],[{key:"fromUint8",value:function(i){return new s(i.buffer,i.byteOffset,i.byteLength)}},{key:"concatUint8s",value:function(i){var t=new Uint8Array(i.reduce(function(r,n){return r+n.byteLength},0)),e=0;return i.forEach(function(r){t.set(r,e),e+=r.byteLength}),t}},{key:"concatUint8",value:function(){for(var i=arguments.length,t=new Array(i),e=0;e<i;e++)t[e]=arguments[e];return this.concatUint8s(t)}}]),s})(),xc=(function(){function s(o,i){ge(this,s),this.offset=0,this.val=o,this.size=i}return me(s,[{key:"skip",value:function(i){this.offset+=i}},{key:"read",value:function(i){var t=this.size-this.offset-i;if(t>=0){var e=0,r=0;if(this.offset+=i,this.size>31){for(;r<i;r++)e+=Math.pow(2,r);return this.val/Math.pow(2,t)&e}else{for(;r<i;r++)e+=1<<r;return this.val>>>t&e}}throw new Error("the number of the read operation exceeds the total length limit of bits")}}],[{key:"fromByte",value:function(i,t){return new s(i.read(t),t<<3)}}]),s})(),_e=(function(){function s(){ge(this,s)}return me(s,null,[{key:"findBox",value:function(i,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=[];if(!i)return r;for(var n=0,a="",u=0;i.length>7;){if(n=j(i),a=String.fromCharCode.apply(null,i.subarray(4,8)),u=8,n===1?(n=Mt(i,8),u+=8):n||(n=i.length),!t[0]||a===t[0]){var l=i.subarray(0,n);if(t.length<2)r.push({start:e,size:n,headerSize:u,type:a,data:l});else return s.findBox(l.subarray(u),t.slice(1),e+u)}e+=n,i=i.subarray(n)}return r}},{key:"tfhd",value:function(i){return te(i,!0,function(t,e){t.trackId=j(e);var r=4,n=t.flags&255&1,a=t.flags&255&2,u=t.flags&255&8,l=t.flags&255&16,c=t.flags&255&32;n&&(r+=4,t.baseDataOffset=j(e,r),r+=4),a&&(t.sampleDescriptionIndex=j(e,r),r+=4),u&&(t.defaultSampleDuration=j(e,r),r+=4),l&&(t.defaultSampleSize=j(e,r),r+=4),c&&(t.defaultSampleFlags=j(e,r))})}},{key:"sidx",value:function(i){return te(i,!0,function(t,e){var r=0;t.reference_ID=j(e,r),r+=4,t.timescale=j(e,r),r+=4,t.version===0?(t.earliest_presentation_time=j(e,r),r+=4,t.first_offset=j(e,r),r+=4):(t.earliest_presentation_time=Mt(e,r),r+=8,t.first_offset=Mt(e,r),r+=8),r+=2,t.references=[];var n=be(e,r);r+=2;for(var a=0;a<n;a++){var u={};t.references.push(u);var l=j(e,r);r+=4,u.reference_type=l>>31&1,u.referenced_size=l&2147483647,u.subsegment_duration=j(e,r),r+=4,l=j(e,r),r+=4,u.starts_with_SAP=l>>31&1,u.SAP_type=l>>28&7,u.SAP_delta_time=l&268435455}})}},{key:"moov",value:function(i){return te(i,!1,function(t,e,r){t.mvhd=s.mvhd(s.findBox(e,["mvhd"],r)[0]),t.trak=s.findBox(e,["trak"],r).map(function(n){return s.trak(n)}),t.pssh=s.pssh(s.findBox(e,["pssh"],r)[0])})}},{key:"mvhd",value:function(i){return te(i,!0,function(t,e){var r=0;t.version===1?(t.timescale=j(e,16),t.duration=Mt(e,20),r+=28):(t.timescale=j(e,8),t.duration=j(e,12),r+=16),t.nextTrackId=j(e,r+76)})}},{key:"trak",value:function(i){return te(i,!1,function(t,e,r){t.tkhd=s.tkhd(s.findBox(e,["tkhd"],r)[0]),t.mdia=s.mdia(s.findBox(e,["mdia"],r)[0])})}},{key:"tkhd",value:function(i){return te(i,!0,function(t,e){var r=Mr.fromUint8(e);t.version===1?(r.read(8),r.read(8),t.trackId=r.read(4),r.read(4),t.duration=r.read(8)):(r.read(4),r.read(4),t.trackId=r.read(4),r.read(4),t.duration=r.read(4)),r.skip(16),t.matrix=[];for(var n=0;n<36;n++)t.matrix.push(r.read(1));r.back(36);for(var a=[],u=0,l;u<3;u++)a.push(xr(r.readInt(2),r.readInt(2))),a.push(xr(r.readInt(2),r.readInt(2))),l=r.readInt(4),a.push(xr(l>>30,l&1073741823));t.rotation=Ec(a),t.width=r.read(4),t.height=r.read(4)})}},{key:"mdia",value:function(i){return te(i,!1,function(t,e,r){t.mdhd=s.mdhd(s.findBox(e,["mdhd"],r)[0]),t.hdlr=s.hdlr(s.findBox(e,["hdlr"],r)[0]),t.minf=s.minf(s.findBox(e,["minf"],r)[0])})}},{key:"mdhd",value:function(i){return te(i,!0,function(t,e){var r=0;t.version===1?(t.timescale=j(e,16),t.duration=Mt(e,20),r+=28):(t.timescale=j(e,8),t.duration=j(e,12),r+=16);var n=be(e,r);t.language=String.fromCharCode((n>>10&31)+96,(n>>5&31)+96,(n&31)+96)})}},{key:"hdlr",value:function(i){return te(i,!0,function(t,e){t.version===0&&(t.handlerType=String.fromCharCode.apply(null,e.subarray(4,8)))})}},{key:"minf",value:function(i){return te(i,!1,function(t,e,r){t.vmhd=s.vmhd(s.findBox(e,["vmhd"],r)[0]),t.smhd=s.smhd(s.findBox(e,["smhd"],r)[0]),t.stbl=s.stbl(s.findBox(e,["stbl"],r)[0])})}},{key:"vmhd",value:function(i){return te(i,!0,function(t,e){t.graphicsmode=be(e),t.opcolor=[be(e,2),be(e,4),be(e,6)]})}},{key:"smhd",value:function(i){return te(i,!0,function(t,e){t.balance=be(e)})}},{key:"stbl",value:function(i){return te(i,!1,function(t,e,r){var n,a,u;t.stsd=s.stsd(s.findBox(e,["stsd"],r)[0]),t.stts=s.stts(s.findBox(e,["stts"],r)[0]),t.ctts=s.ctts(s.findBox(e,["ctts"],r)[0]),t.stsc=s.stsc(s.findBox(e,["stsc"],r)[0]),t.stsz=s.stsz(s.findBox(e,["stsz"],r)[0]),t.stco=s.stco(s.findBox(e,["stco"],r)[0]),t.stco||(t.co64=s.co64(s.findBox(e,["co64"],r)[0]),t.stco=t.co64);var l=(n=t.stsd.entries[0])===null||n===void 0||(a=n.sinf)===null||a===void 0||(u=a.schi)===null||u===void 0?void 0:u.tenc.default_IV_size;t.stss=s.stss(s.findBox(e,["stss"],r)[0]),t.senc=s.senc(s.findBox(e,["senc"],r)[0],l)})}},{key:"senc",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;return te(i,!0,function(e,r){var n=0,a=j(r,n);n+=4,e.samples=[];for(var u=0;u<a;u++){var l={};l.InitializationVector=[];for(var c=0;c<t;c++)l.InitializationVector[c]=r[n+c];if(n+=t,e.flags&2){l.subsamples=[];var f=be(r,n);n+=2;for(var h=0;h<f;h++){var d={};d.BytesOfClearData=be(r,n),n+=2,d.BytesOfProtectedData=j(r,n),n+=4,l.subsamples.push(d)}}e.samples.push(l)}})}},{key:"pssh",value:function(i){return te(i,!0,function(t,e){for(var r=[],n=[],a=0,u=0;u<16;u++)n.push(Fr(e[a+u]));if(a+=16,t.version>0){var l=j(e,a);a+=4;for(var c=0;c<(""+l).length;c++)for(var f=0;f<16;f++){var h=e[a];a+=1,r.push(Fr(h))}}var d=j(e,a);t.data_size=d,a+=4,t.kid=r,t.system_id=n,t.buffer=e})}},{key:"stsd",value:function(i){return te(i,!0,function(t,e,r){t.entryCount=j(e),t.entries=s.findBox(e.subarray(4),[],r+4).map(function(n){switch(n.type){case"av01":return s.av01(n);case"avc1":case"avc2":case"avc3":case"avc4":return s.avc1(n);case"hvc1":case"hev1":return s.hvc1(n);case"mp4a":return s.mp4a(n);case"alaw":case"ulaw":return s.alaw(n);case"enca":return te(n,!1,function(a,u,l){a.channelCount=be(u,16),a.samplesize=be(u,18),a.sampleRate=j(u,24)/65536,u=u.subarray(28),a.sinf=s.sinf(s.findBox(u,["sinf"],l)[0]),a.esds=s.esds(s.findBox(u,["esds"],l)[0])});case"encv":return te(n,!1,function(a,u,l){a.width=be(u,24),a.height=be(u,26),a.horizresolution=j(u,28),a.vertresolution=j(u,32),u=u.subarray(78),a.sinf=s.sinf(s.findBox(u,["sinf"],l)[0]),a.avcC=s.avcC(s.findBox(u,["avcC"],l)[0]),a.hvcC=s.hvcC(s.findBox(u,["hvcC"],l)[0]),a.pasp=s.pasp(s.findBox(u,["pasp"],l)[0])})}}).filter(Boolean)})}},{key:"tenc",value:function(i){return te(i,!1,function(t,e){var r=6;t.default_IsEncrypted=e[r],r+=1,t.default_IV_size=e[r],r+=1,t.default_KID=[];for(var n=0;n<16;n++)t.default_KID.push(Fr(e[r])),r+=1})}},{key:"schi",value:function(i){return te(i,!1,function(t,e,r){t.tenc=s.tenc(s.findBox(e,["tenc"],r)[0])})}},{key:"sinf",value:function(i){return te(i,!1,function(t,e,r){t.schi=s.schi(s.findBox(e,["schi"],r)[0]),t.frma=s.frma(s.findBox(e,["frma"],r)[0])})}},{key:"frma",value:function(i){return te(i,!1,function(t,e){t.data_format="";for(var r=0;r<4;r++)t.data_format+=String.fromCharCode(e[r])})}},{key:"colr",value:function(i){return te(i,!1,function(t,e){var r=Mr.fromUint8(e);t.data=i.data,t.colorType=r.readString(4),t.colorType==="nclx"?(t.colorPrimaries=r.read(2),t.transferCharacteristics=r.read(2),t.matrixCoefficients=r.read(2),t.fullRangeFlag=r.read(1)>>7):(t.colorType==="rICC"||t.colorType==="prof")&&(t.iccProfile=e.readToUint8())})}},{key:"av01",value:function(i){return te(i,!1,function(t,e,r){var n=Nr(t,e),a=e.subarray(n);r+=n,t.av1C=s.av1C(s.findBox(a,["av1C"],r)[0]),t.colr=s.colr(s.findBox(a,["colr"],r)[0])})}},{key:"av1C",value:function(i){return te(i,!1,function(t,e){t.data=i.data;var r=Mr.fromUint8(e),n=xc.fromByte(r,4);t.marker=n.read(1),t.version=n.read(7),t.seqProfile=n.read(3),t.seqLevelIdx0=n.read(5),t.seqTier0=n.read(1),t.highBitdepth=n.read(1),t.twelveBit=n.read(1),t.monochrome=n.read(1),t.chromaSubsamplingX=n.read(1),t.chromaSubsamplingY=n.read(1),t.chromaSamplePosition=n.read(2),t.reserved=n.read(3),t.initialPresentationDelayPresent=n.read(1),t.initialPresentationDelayPresent?t.initialPresentationDelayMinusOne=n.read(4):t.initialPresentationDelayMinusOne=0,t.configOBUs=r.readToUint8();var a;t.seqLevelIdx0===2&&t.highBitdepth===1?a=t.twelveBit===1?"12":"10":t.seqProfile<=2&&(a=t.highBitdepth===1?"10":"08"),t.codec=["av01",t.seqProfile,(t.seqLevelIdx0<10?"0"+t.seqLevelIdx0:t.seqLevelIdx0)+(t.seqTier0?"H":"M"),a].join(".")})}},{key:"avc1",value:function(i){return te(i,!1,function(t,e,r){var n=Nr(t,e),a=e.subarray(n);r+=n,t.avcC=s.avcC(s.findBox(a,["avcC"],r)[0]),t.pasp=s.pasp(s.findBox(a,["pasp"],r)[0])})}},{key:"avcC",value:function(i){return te(i,!1,function(t,e){t.data=i.data,t.configurationVersion=e[0],t.AVCProfileIndication=e[1],t.profileCompatibility=e[2],t.AVCLevelIndication=e[3],t.codec=Ys([e[1],e[2],e[3]]),t.lengthSizeMinusOne=e[4]&3,t.spsLength=e[5]&31,t.sps=[];for(var r=6,n=0;n<t.spsLength;n++){var a=be(e,r);r+=2,t.sps.push(e.subarray(r,r+a)),r+=a}t.ppsLength=e[r],r+=1,t.pps=[];for(var u=0;u<t.ppsLength;u++){var l=be(e,r);r+=2,t.pps.push(e.subarray(r,r+=l)),r+=l}})}},{key:"hvc1",value:function(i){return te(i,!1,function(t,e,r){var n=Nr(t,e),a=e.subarray(n);r+=n,t.hvcC=s.hvcC(s.findBox(a,["hvcC"],r)[0]),t.pasp=s.pasp(s.findBox(a,["pasp"],r)[0])})}},{key:"hvcC",value:function(i){return te(i,!1,function(t,e){t.data=i.data,t.codec="hev1.1.6.L93.B0",t.configurationVersion=e[0];var r=e[1];t.generalProfileSpace=r>>6,t.generalTierFlag=(r&32)>>5,t.generalProfileIdc=r&31,t.generalProfileCompatibility=j(e,2),t.generalConstraintIndicatorFlags=e.subarray(6,12),t.generalLevelIdc=e[12],t.avgFrameRate=be(e,19),t.numOfArrays=e[22],t.vps=[],t.sps=[],t.pps=[];for(var n=23,a=0,u=0,l=0,c=0;c<t.numOfArrays;c++){a=e[n]&63,u=be(e,n+1),n+=3;for(var f=[],h=0;h<u;h++)l=be(e,n),n+=2,f.push(e.subarray(n,n+l)),n+=l;if(a===32){var d;(d=t.vps).push.apply(d,f)}else if(a===33){var v;(v=t.sps).push.apply(v,f)}else if(a===34){var y;(y=t.pps).push.apply(y,f)}}})}},{key:"pasp",value:function(i){return te(i,!1,function(t,e){t.hSpacing=j(e),t.vSpacing=j(e,4)})}},{key:"mp4a",value:function(i){return te(i,!1,function(t,e,r){var n=Na(t,e);t.esds=s.esds(s.findBox(e.subarray(n),["esds"],r+n)[0])})}},{key:"esds",value:function(i){return te(i,!0,function(t,e){t.codec="mp4a.";for(var r=0,n=0,a=0,u=0;e.length;){for(r=0,u=e[r],n=e[r+1],r+=2;n&128;)a=(n&127)<<7,n=e[r],r+=1;if(a+=n&127,u===3)e=e.subarray(r+3);else if(u===4)t.codec+=(e[r].toString(16)+".").padStart(3,"0"),e=e.subarray(r+13);else if(u===5){var l=t.config=e.subarray(r,r+a),c=(l[0]&248)>>3;c===31&&l.length>=2&&(c=32+((l[0]&7)<<3)+((l[1]&224)>>5)),t.objectType=c,t.codec+=c.toString(16),t.codec[t.codec.length-1]==="."&&(t.codec=t.codec.substring(0,t.codec.length-1));return}else{t.codec[t.codec.length-1]==="."&&(t.codec=t.codec.substring(0,t.codec.length-1));return}}})}},{key:"alaw",value:function(i){return te(i,!1,function(t,e){Na(t,e)})}},{key:"stts",value:function(i){return te(i,!0,function(t,e){for(var r=j(e),n=[],a=4,u=0;u<r;u++)n.push({count:j(e,a),delta:j(e,a+4)}),a+=8;t.entryCount=r,t.entries=n})}},{key:"ctts",value:function(i){return te(i,!0,function(t,e){var r=j(e),n=[],a=4;if(t.version===1)for(var u=0;u<r;u++)n.push({count:j(e,a),offset:j(e,a+4)}),a+=8;else for(var l=0;l<r;l++)n.push({count:j(e,a),offset:-(~j(e,a+4)+1)}),a+=8;t.entryCount=r,t.entries=n})}},{key:"stsc",value:function(i){return te(i,!0,function(t,e){for(var r=j(e),n=[],a=4,u=0;u<r;u++)n.push({firstChunk:j(e,a),samplesPerChunk:j(e,a+4),sampleDescriptionIndex:j(e,a+8)}),a+=12;t.entryCount=r,t.entries=n})}},{key:"stsz",value:function(i){return te(i,!0,function(t,e){var r=j(e),n=j(e,4),a=[];if(!r)for(var u=8,l=0;l<n;l++)a.push(j(e,u)),u+=4;t.sampleSize=r,t.sampleCount=n,t.entrySizes=a})}},{key:"stco",value:function(i){return te(i,!0,function(t,e){for(var r=j(e),n=[],a=4,u=0;u<r;u++)n.push(j(e,a)),a+=4;t.entryCount=r,t.entries=n})}},{key:"co64",value:function(i){return te(i,!0,function(t,e){for(var r=j(e),n=[],a=4,u=0;u<r;u++)n.push(Mt(e,a)),a+=8;t.entryCount=r,t.entries=n})}},{key:"stss",value:function(i){return te(i,!0,function(t,e){for(var r=j(e),n=[],a=4,u=0;u<r;u++)n.push(j(e,a)),a+=4;t.entryCount=r,t.entries=n})}},{key:"moof",value:function(i){return te(i,!1,function(t,e,r){t.mfhd=s.mfhd(s.findBox(e,["mfhd"],r)[0]),t.traf=s.findBox(e,["traf"],r).map(function(n){return s.traf(n)})})}},{key:"mfhd",value:function(i){return te(i,!0,function(t,e){t.sequenceNumber=j(e)})}},{key:"traf",value:function(i){return te(i,!1,function(t,e,r){t.tfhd=s.tfhd(s.findBox(e,["tfhd"],r)[0]),t.tfdt=s.tfdt(s.findBox(e,["tfdt"],r)[0]),t.trun=s.trun(s.findBox(e,["trun"],r)[0])})}},{key:"trun",value:function(i){return te(i,!0,function(t,e){var r=t.version,n=t.flags,a=e.length,u=t.sampleCount=j(e),l=4;if(a>l&&n&1&&(t.dataOffset=-(~j(e,l)+1),l+=4),a>l&&n&4&&(t.firstSampleFlags=j(e,l),l+=4),t.samples=[],a>l)for(var c,f=0;f<u;f++)c={},n&256&&(c.duration=j(e,l),l+=4),n&512&&(c.size=j(e,l),l+=4),n&1024&&(c.flags=j(e,l),l+=4),n&2048&&(r?c.cts=-(~j(e,l+4)+1):c.cts=j(e,l),l+=4),t.samples.push(c)})}},{key:"tfdt",value:function(i){return te(i,!0,function(t,e){t.version===1?t.baseMediaDecodeTime=Mt(e):t.baseMediaDecodeTime=j(e)})}},{key:"probe",value:function(i){return!!s.findBox(i,["ftyp"])}},{key:"parseSampleFlags",value:function(i){return{isLeading:(i[0]&12)>>>2,dependsOn:i[0]&3,isDependedOn:(i[1]&192)>>>6,hasRedundancy:(i[1]&48)>>>4,paddingValue:(i[1]&14)>>>1,isNonSyncSample:i[1]&1,degradationPriority:i[2]<<8|i[3]}}},{key:"moovToTrack",value:function(i,t,e){var r,n,a=i.trak;if(!(!a||!a.length)){var u=a.find(function(fr){var xt,Ot;return((xt=fr.mdia)===null||xt===void 0||(Ot=xt.hdlr)===null||Ot===void 0?void 0:Ot.handlerType)==="vide"}),l=a.find(function(fr){var xt,Ot;return((xt=fr.mdia)===null||xt===void 0||(Ot=xt.hdlr)===null||Ot===void 0?void 0:Ot.handlerType)==="soun"});if(u&&t){var c,f,h,d,v,y,p,b=t,k=(c=u.tkhd)===null||c===void 0?void 0:c.trackId;k!=null&&(b.id=u.tkhd.trackId),b.tkhdDuration=u.tkhd.duration,b.mvhdDurtion=i.mvhd.duration,b.mvhdTimecale=i.mvhd.timescale,b.timescale=b.formatTimescale=u.mdia.mdhd.timescale,b.duration=u.mdia.mdhd.duration||b.mvhdDurtion/b.mvhdTimecale*b.timescale,b.rotation=u.tkhd.rotation,b.matrix=u.tkhd.matrix;var E=u.mdia.minf.stbl.stsd.entries[0];if(b.width=E.width,b.height=E.height,E.pasp&&(b.sarRatio=[E.pasp.hSpacing,E.pasp.vSpacing]),E.av1C)b.codecType=dt.AV1,b.codec=E.av1C.codec,b.av1C=E.av1C.data,E.colr&&(b.colr=E.colr.data);else if(E.hvcC)b.codecType=dt.HEVC,b.codec=E.hvcC.codec,b.vps=E.hvcC.vps,b.sps=E.hvcC.sps,b.pps=E.hvcC.pps,b.hvcC=E.hvcC.data;else if(E.avcC)b.codec=E.avcC.codec,b.sps=E.avcC.sps,b.pps=E.avcC.pps;else throw new Error("unknown video stsd entry");if(b.present=!0,b.ext={},b.ext.stss=(f=u.mdia)===null||f===void 0||(h=f.minf)===null||h===void 0||(d=h.stbl)===null||d===void 0?void 0:d.stss,b.ext.ctts=(v=u.mdia)===null||v===void 0||(y=v.minf)===null||y===void 0||(p=y.stbl)===null||p===void 0?void 0:p.ctts,E&&E.type==="encv"){var w,T,L,O,B,x,U,W;b.isVideoEncryption=!0,E.default_KID=(w=E.sinf)===null||w===void 0||(T=w.schi)===null||T===void 0?void 0:T.tenc.default_KID,E.default_IsEncrypted=(L=E.sinf)===null||L===void 0||(O=L.schi)===null||O===void 0?void 0:O.tenc.default_IsEncrypted,E.default_IV_size=(B=E.sinf)===null||B===void 0||(x=B.schi)===null||x===void 0?void 0:x.tenc.default_IV_size,b.videoSenc=u.mdia.minf.stbl.senc&&u.mdia.minf.stbl.senc.samples,E.data_format=(U=E.sinf)===null||U===void 0||(W=U.frma)===null||W===void 0?void 0:W.data_format,b.useEME=i.useEME,b.kidValue=i.kidValue,b.pssh=i.pssh,b.encv=E}}if(l&&e){var m,_,S,D,C,R,V,K,Y,G=e,ke=(m=l.tkhd)===null||m===void 0?void 0:m.trackId;ke!=null&&(G.id=l.tkhd.trackId),G.tkhdDuration=l.tkhd.duration,G.mvhdDurtion=i.mvhd.duration,G.mvhdTimecale=i.mvhd.timescale,G.timescale=G.formatTimescale=l.mdia.mdhd.timescale,G.duration=l.mdia.mdhd.duration||G.mvhdDurtion/G.mvhdTimecale*G.timescale;var Z=l.mdia.minf.stbl.stsd.entries[0];switch(G.sampleSize=Z.sampleSize,G.sampleRate=Z.sampleRate,G.channelCount=Z.channelCount,G.present=!0,Z.type){case"alaw":G.codecType=G.codec=Se.G711PCMA,G.sampleRate=8e3;break;case"ulaw":G.codecType=G.codec=Se.G711PCMU,G.sampleRate=8e3;break;default:G.sampleDuration=et.getFrameDuration(G.sampleRate,G.timescale),G.sampleRateIndex=et.getRateIndexByRate(G.sampleRate),G.objectType=((r=Z.esds)===null||r===void 0?void 0:r.objectType)||2,Z.esds&&(G.config=Array.from(Z.esds.config)),G.codec=((n=Z.esds)===null||n===void 0?void 0:n.codec)||"mp4a.40.2";break}if(G.sampleDuration=et.getFrameDuration(G.sampleRate,G.timescale),G.objectType=((_=Z.esds)===null||_===void 0?void 0:_.objectType)||2,Z.esds&&(Z.esds.config?G.config=Array.from(Z.esds.config):console.warn("esds config is null")),G.codec=((S=Z.esds)===null||S===void 0?void 0:S.codec)||"mp4a.40.2",G.sampleRateIndex=et.getRateIndexByRate(G.sampleRate),G.ext={},G.ext.stss=(D=l.mdia)===null||D===void 0||(C=D.minf)===null||C===void 0||(R=C.stbl)===null||R===void 0?void 0:R.stss,G.ext.ctts=(V=l.mdia)===null||V===void 0||(K=V.minf)===null||K===void 0||(Y=K.stbl)===null||Y===void 0?void 0:Y.ctts,G.present=!0,Z&&Z.type==="enca"){var xe,at,Oe,Lt,Ze,It,Yt,Ai;G.isAudioEncryption=!0,Z.data_format=(xe=Z.sinf)===null||xe===void 0||(at=xe.frma)===null||at===void 0?void 0:at.data_format,Z.default_KID=(Oe=Z.sinf)===null||Oe===void 0||(Lt=Oe.schi)===null||Lt===void 0?void 0:Lt.tenc.default_KID,Z.default_IsEncrypted=(Ze=Z.sinf)===null||Ze===void 0||(It=Ze.schi)===null||It===void 0?void 0:It.tenc.default_IsEncrypted,Z.default_IV_size=(Yt=Z.sinf)===null||Yt===void 0||(Ai=Yt.schi)===null||Ai===void 0?void 0:Ai.tenc.default_IV_size,G.audioSenc=l.mdia.minf.stbl.senc&&l.mdia.minf.stbl.senc.samples,G.useEME=i.useEME,G.kidValue=i.kidValue,G.enca=Z}}if(e&&(e.isVideoEncryption=t?t.isVideoEncryption:!1),t&&(t.isAudioEncryption=e?e.isAudioEncryption:!1),t!=null&&t.encv||e!=null&&e.enca){var we,cr,In=t==null||(we=t.encv)===null||we===void 0?void 0:we.default_KID,xn=e==null||(cr=e.enca)===null||cr===void 0?void 0:cr.default_KID,On=In||xn?(In||xn).join(""):null;t&&(t.kid=On),e&&(e.kid=On)}return t&&(t.flags=3841),e&&(e.flags=1793),{videoTrack:t,audioTrack:e}}}},{key:"evaluateDefaultDuration",value:function(i,t,e){var r,n=t==null||(r=t.samples)===null||r===void 0?void 0:r.length;if(!n)return 1024;var a=1024*n/t.timescale;return a*i.timescale/e}},{key:"moofToSamples",value:function(i,t,e){var r={};return i.mfhd&&(t&&(t.sequenceNumber=i.mfhd.sequenceNumber),e&&(e.sequenceNumber=i.mfhd.sequenceNumber)),i.traf.forEach(function(n){var a=n.tfhd,u=n.tfdt,l=n.trun;if(!(!a||!l)){u&&(t&&t.id===a.trackId&&(t.baseMediaDecodeTime=u.baseMediaDecodeTime),e&&e.id===a.trackId&&(e.baseMediaDecodeTime=u.baseMediaDecodeTime));var c=a.defaultSampleSize||0,f=a.defaultSampleDuration||s.evaluateDefaultDuration(t,e,l.samples.length||l.sampleCount),h=l.dataOffset||0,d=0,v=-1;if(!l.samples.length&&l.sampleCount){r[a.trackId]=[];for(var y=0;y<l.sampleCount;y++)r[a.trackId].push({offset:h,dts:d,duration:f,size:c}),d+=f,h+=c}else r[a.trackId]=l.samples.map(function(p,b){return p={offset:h,dts:d,pts:d+(p.cts||0),duration:p.duration||f,size:p.size||c,gopId:v,keyframe:b===0||p.flags!==null&&p.flags!==void 0&&(p.flags&65536)>>>0!==65536},p.keyframe&&(v++,p.gopId=v),d+=p.duration,h+=p.size,p})}}),r}},{key:"moovToSamples",value:function(i){var t=i.trak;if(!(!t||!t.length)){var e=t.find(function(U){var W,m;return((W=U.mdia)===null||W===void 0||(m=W.hdlr)===null||m===void 0?void 0:m.handlerType)==="vide"}),r=t.find(function(U){var W,m;return((W=U.mdia)===null||W===void 0||(m=W.hdlr)===null||m===void 0?void 0:m.handlerType)==="soun"});if(!(!e&&!r)){var n,a;if(e){var u,l,c=(u=e.mdia)===null||u===void 0||(l=u.minf)===null||l===void 0?void 0:l.stbl;if(!c)return;var f=c.stts,h=c.stsc,d=c.stsz,v=c.stco,y=c.stss,p=c.ctts;if(!f||!h||!d||!v||!y)return;n=Ma(f,h,d,v,p,y)}if(r){var b,k,E,w=(b=r.mdia)===null||b===void 0||(k=b.minf)===null||k===void 0?void 0:k.stbl;if(!w)return;var T=(E=r.mdia.mdhd)===null||E===void 0?void 0:E.timescale,L=w.stts,O=w.stsc,B=w.stsz,x=w.stco;if(!T||!L||!O||!B||!x)return;a=Ma(L,O,B,x)}return{videoSamples:n,audioSamples:a}}}}}]),s})();function Ma(s,o,i,t,e,r){var n=[],a=e==null?void 0:e.entries,u=o.entries,l=t.entries,c=i.entrySizes,f=r==null?void 0:r.entries,h;f&&(h={},f.forEach(function(O){h[O-1]=!0}));var d;a&&(d=[],a.forEach(function(O){for(var B=O.count,x=O.offset,U=0;U<B;U++)d.push(x)}));var v,y=-1,p=0,b=0,k=0,E=0,w=0,T=u[0].samplesPerChunk,L=u[1]?u[1].firstChunk-1:1/0;return s.entries.forEach(function(O){for(var B=O.count,x=O.delta,U=0;U<B;U++)v={dts:p,duration:x,size:c[b]||i.sampleSize,offset:l[k]+w,index:b},f&&(v.keyframe=h[b],v.keyframe&&y++,v.gopId=y),d&&b<d.length&&(v.pts=v.dts+d[b]),n.push(v),p+=x,b++,b<T?w+=v.size:(k++,w=0,k>=L&&(E++,L=u[E+1]?u[E+1].firstChunk-1:1/0),T+=u[E].samplesPerChunk)}),n}function Nr(s,o){return s.dataReferenceIndex=be(o,6),s.width=be(o,24),s.height=be(o,26),s.horizresolution=j(o,28),s.vertresolution=j(o,32),s.frameCount=be(o,40),s.depth=be(o,74),78}function Na(s,o){return s.dataReferenceIndex=be(o,6),s.channelCount=be(o,16),s.sampleSize=be(o,18),s.sampleRate=j(o,24)/65536,28}function te(s,o,i){if(s){if(s.size!==s.data.length)throw new Error("box ".concat(s.type," size !== data.length"));var t={start:s.start,size:s.size,headerSize:s.headerSize,type:s.type};return o&&(t.version=s.data[s.headerSize],t.flags=Sc(s.data,s.headerSize+1),t.headerSize+=4),i(t,s.data.subarray(t.headerSize),t.start+t.headerSize),t}}var Oc=function(o,i,t){for(var e=String(t),r=i>>0,n=Math.ceil(r/e.length),a=[],u=String(o);n--;)a.push(e);return a.join("").substring(0,r-u.length)+u},Fr=function(){for(var o=[],i=arguments.length,t=new Array(i),e=0;e<i;e++)t[e]=arguments[e];return t.forEach(function(r){o.push(Oc(Number(r).toString(16),2,0))}),o[0]},Rc=(function(){function s(o,i,t){ge(this,s),N(this,"__loadedMoofWraps",[]),N(this,"__lastRemainData",null),N(this,"__lastRemainDataStart",0),N(this,"__nextMoofStart",-1),this.videoTrack=o||new wn,this.audioTrack=i||new Cn,this.metadataTrack=t||new An}return me(s,[{key:"demuxPart",value:function(i,t,e){var r=this,n=this.videoTrack,a=this.audioTrack,u=n.exist(),l=a.exist(),c=/av01/.test(n.codec);n.samples=[],a.samples=[];var f=i,h=t;if(this.__lastRemainData){var d=this.__lastRemainDataStart+this.__lastRemainData.byteLength,v=t<=d&&t>this.__lastRemainDataStart&&t+i.byteLength>d;if(v){var y=i.subarray(this.__lastRemainData.byteLength+this.__lastRemainDataStart-t);f=We(this.__lastRemainData,y),h=this.__lastRemainDataStart,this.__lastRemainData=null}else this.__lastRemainData=null,this.__lastRemainDataStart=0,this.__nextMoofStart=-1}if(!e){var p=_e.findBox(f,["moov"])[0];if(!p)throw new Error("cannot found moov box");e=_e.moov(p)}if(f){var b=h+f.byteLength;!u&&!l&&_e.moovToTrack(e,n,a);var k=[];this.__nextMoofStart<0?_e.findBox(f,["moof"],h).forEach(function(O){return k.push(O)}):this.__nextMoofStart>=h&&this.__nextMoofStart<=b-8&&_e.findBox(f.subarray(this.__nextMoofStart-h),["moof"],this.__nextMoofStart).forEach(function(O){return k.push(O)}),k.filter(function(O){return O.size<=O.data.length}).forEach(function(O){var B=_e.moof(O);r.__nextMoofStart=B.start+Math.max.apply(Math,ze(B.traf.map(function(x){return x.trun.samples.reduce(function(U,W){return U+W.size},x.trun.dataOffset||0)}))),r.__loadedMoofWraps.push({start:B.start,nextMoofStart:r.__nextMoofStart,moof:B}),r.__loadedMoofWraps.sort(function(x,U){return x.start-U.start})});var E=hc(this.__loadedMoofWraps),w;try{var T=function(){var B=w.value;if(B.start>b||B.nextMoofStart<h)return"continue";var x=B.start,U=_e.moofToSamples(B.moof,n,a),W=n.baseMediaDecodeTime,m=a.baseMediaDecodeTime,_;Object.keys(U).forEach(function(S){n.id==S?U[S].some(function(D){var C=D.offset+=x;if(!(C<h)){if(C+D.size>b)return!0;var R=new tr((D.pts||D.dts)+W,D.dts+W);R.duration=D.duration,R.gopId=D.gopId,D.keyframe&&R.setToKeyframe();var V=f.subarray(C-h,C-h+D.size);if(R.data=V,!c)for(var K=0,Y=V.length-1;K<Y;)_=j(V,K),K+=4,R.units.push(V.subarray(K,K+_)),K+=_;r.__lastRemainDataStart=C+D.size,n.samples.push(R)}}):a.id==S&&U[S].some(function(D){var C=D.offset+x;if(!(C<h)){if(C+D.size>b)return!0;var R=f.subarray(C-h,C-h+D.size);a.samples.push(new _t(D.dts+m,R,D.duration)),r.__lastRemainDataStart=C+D.size}})})};for(E.s();!(w=E.n()).done;)var L=T()}catch(O){E.e(O)}finally{E.f()}}return this.__lastRemainDataStart>h&&this.__lastRemainDataStart<f.byteLength+h?this.__lastRemainData=f.subarray(this.__lastRemainDataStart-h):(this.__lastRemainData=f,this.__lastRemainDataStart=h),n.samples.length&&(n.baseMediaDecodeTime=n.samples[0].pts),a.samples.length&&(a.baseMediaDecodeTime=a.samples[0].pts),{videoTrack:n,audioTrack:a,metadataTrack:this.metadataTrack}}},{key:"demux",value:function(i,t){var e=this.videoTrack,r=this.audioTrack,n=e.exist(),a=r.exist();if(e.samples=[],r.samples=[],t){if(!a){var u=_e.findBox(t,["moov"])[0];if(!u)throw new Error("cannot found moov box");_e.moovToTrack(_e.moov(u),null,r)}var l=_e.findBox(t,["moof"])[0];if(l){var c=_e.moofToSamples(_e.moof(l),null,r)[r.id],f=r.baseMediaDecodeTime;if(c){var h=l.start;c.map(function(w){w.offset+=h;var T=t.subarray(w.offset,w.offset+w.size);r.samples.push(new _t(w.dts+f,T,w.duration))})}}}if(i){if(!n&&!a){var d=_e.findBox(i,["moov"])[0];if(!d)throw new Error("cannot found moov box");_e.moovToTrack(_e.moov(d),e,r)}var v=_e.findBox(i,["moof"])[0];if(v){var y=_e.moofToSamples(_e.moof(v),e,r),p=e.baseMediaDecodeTime,b=r.baseMediaDecodeTime,k=v.start,E;Object.keys(y).forEach(function(w){e.id==w?y[w].map(function(T){T.offset+=k;var L=new tr((T.pts||T.dts)+p,T.dts+p);L.duration=T.duration,L.gopId=T.gopId,T.keyframe&&L.setToKeyframe();var O=i.subarray(T.offset,T.offset+T.size);L.data=O;for(var B=0,x=O.length-1;B<x;)E=j(O,B),B+=4,L.units.push(O.subarray(B,B+E)),B+=E;e.samples.push(L)}):r.id==w&&y[w].map(function(T){T.offset+=k;var L=i.subarray(T.offset,T.offset+T.size);r.samples.push(new _t(T.dts+b,L,T.duration))})})}}return{videoTrack:e,audioTrack:r,metadataTrack:this.metadataTrack}}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset(),this.metadataTrack.reset()}}],[{key:"probe",value:function(i){return _e.probe(i)}}]),s})();function Mc(s){for(var o=0,i=arguments.length,t=new Array(i>1?i-1:0),e=1;e<i;e++)t[e-1]=arguments[e];t.forEach(function(a){o+=a.length});var r=new s(o),n=0;return t.forEach(function(a){r.set(a,n),n+=a.length}),r}var Fe=(function(){function s(){ge(this,s),this.buffer=new Uint8Array(0)}return me(s,[{key:"write",value:function(){for(var i=this,t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];e.forEach(function(n){n?i.buffer=Mc(Uint8Array,i.buffer,n):window.console.warn(n)})}}],[{key:"writeUint16",value:function(i){return new Uint8Array([i>>8&255,i&255])}},{key:"writeUint32",value:function(i){return new Uint8Array([i>>24,i>>16&255,i>>8&255,i&255])}}]),s})(),Fa=Math.pow(2,32)-1,oe=(function(){function s(){ge(this,s)}return me(s,null,[{key:"box",value:function(i){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];e=e.filter(Boolean);var n=8+e.reduce(function(l,c){return l+c.byteLength},0),a=new Uint8Array(n);a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=n&255,a.set(i,4);var u=8;return e.forEach(function(l){a.set(l,u),u+=l.byteLength}),a}},{key:"ftyp",value:function(i){var t=i.find(function(e){return e.type===At.VIDEO&&e.codecType===dt.HEVC});return t?s.FTYPHEV1:s.FTYPAVC1}},{key:"initSegment",value:function(i){var t=s.ftyp(i),e=We(t,s.moov(i));return e}},{key:"pssh",value:function(i){var t=new Uint8Array([1,0,0,0].concat([16,119,239,236,192,178,77,2,172,227,60,30,82,226,251,75],[0,0,0,1],Ia(i.kid),[0,0,0,0]));return s.box(s.types.pssh,t)}},{key:"moov",value:function(i){if(i[0].useEME&&(i[0].encv||i[0].enca)){i[0].pssh||(i[0].pssh={kid:i[0].kid});var t=this.pssh(i[0].pssh);return s.box.apply(s,[s.types.moov,s.mvhd(i[0].mvhdDurtion||i[0].duration,i[0].mvhdTimecale||i[0].timescale),s.mvex(i)].concat(ze(i.map(function(e){return s.trak(e)})),[t]))}else return s.box.apply(s,[s.types.moov,s.mvhd(i[0].mvhdDurtion||i[0].duration,i[0].mvhdTimecale||i[0].timescale)].concat(ze(i.map(function(e){return s.trak(e)})),[s.mvex(i)]))}},{key:"mvhd",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,e=s.box(s.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24&255,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]));return e}},{key:"trak",value:function(i){var t=s.box(s.types.trak,s.tkhd(i.id,i.tkhdDuration||0,i.width,i.height),s.mdia(i));return t}},{key:"tkhd",value:function(i,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,n=s.box(s.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>24&255,i>>16&255,i>>8&255,i&255,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,e&255,0,0,r>>8&255,r&255,0,0]));return n}},{key:"mdia",value:function(i){var t=s.box(s.types.mdia,s.mdhd(i.duration,i.timescale),s.hdlr(i.type),s.minf(i));return t}},{key:"mdhd",value:function(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:9e4,e=s.box(s.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24&255,i>>16&255,i>>8&255,i&255,85,196,0,0]));return e}},{key:"hdlr",value:function(i){var t=s.box(s.types.hdlr,s.HDLR_TYPES[i]);return t}},{key:"minf",value:function(i){var t=s.box(s.types.minf,i.type===At.VIDEO?s.VMHD:s.SMHD,s.DINF,s.stbl(i));return t}},{key:"stbl",value:function(i){var t=[];i&&i.ext&&i.ext.stss&&t.push(s.stss(i.ext.stss.entries));var e=s.box(s.types.stbl,s.stsd(i),s.STTS,t[0],s.STSC,s.STSZ,s.STCO);return e}},{key:"stsd",value:function(i){var t;i.type==="audio"?i.useEME&&i.enca?t=s.enca(i):i.codecType===Se.OPUS?t=s.opus(i):t=s.mp4a(i):i.useEME&&i.encv?t=s.encv(i):i.av1C?t=s.av01(i):t=s.avc1hev1(i);var e=s.box(s.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),t);return e}},{key:"enca",value:function(i){var t=i.enca.channelCount,e=i.enca.sampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t,0,16,0,0,0,0,e>>8&255,e&255,0,0]),n=s.esds(i.config),a=s.sinf(i.enca);return s.box(s.types.enca,r,n,a)}},{key:"encv",value:function(i){var t,e,r=i.sps.length>0?i.sps[0]:[],n=i.pps.length>0?i.pps[0]:[],a=i.width,u=i.height,l=i.sarRatio[0],c=i.sarRatio[1],f=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,a>>8&255,a&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h=new Uint8Array((t=(e=[1,r[1],r[2],r[3],255,225,r.length>>>8&255,r.length&255]).concat.apply(e,ze(r)).concat([1,n.length>>>8&255,n.length&255])).concat.apply(t,ze(n))),d=new Uint8Array([0,0,88,57,0,15,200,192,0,4,86,72]),v=s.sinf(i.encv),y=new Uint8Array([l>>24,l>>16&255,l>>8&255,l&255,c>>24,c>>16&255,c>>8&255,c&255]);return s.box(s.types.encv,f,s.box(s.types.avcC,h),s.box(s.types.btrt,d),v,s.box(s.types.pasp,y))}},{key:"schi",value:function(i){var t=new Uint8Array([]),e=s.tenc(i);return s.box(s.types.schi,t,e)}},{key:"tenc",value:function(i){var t=new Uint8Array([0,0,0,0,0,0,i.default_IsEncrypted&255,i.default_IV_size&255].concat(Ia(i.default_KID)));return s.box(s.types.tenc,t)}},{key:"sinf",value:function(i){var t=new Uint8Array([]),e=new Uint8Array([i.data_format.charCodeAt(0),i.data_format.charCodeAt(1),i.data_format.charCodeAt(2),i.data_format.charCodeAt(3)]),r=new Uint8Array([0,0,0,0,99,101,110,99,0,1,0,0]),n=s.schi(i);return s.box(s.types.sinf,t,s.box(s.types.frma,e),s.box(s.types.schm,r),n)}},{key:"av01",value:function(i){return s.box(s.types.av01,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i.width>>8&255,i.width&255,i.height>>8&255,i.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i.av1C,i.colr)}},{key:"avc1hev1",value:function(i){var t=i.codecType===dt.HEVC,e=t?s.types.hvc1:s.types.avc1,r=t?s.hvcC(i):s.avcC(i),n=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i.width>>8&255,i.width&255,i.height>>8&255,i.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),r];return t?n.push(s.box(s.types.fiel,new Uint8Array([1,0]))):i.sarRatio&&i.sarRatio.length>1&&n.push(s.pasp(i.sarRatio)),s.box.apply(s,[e].concat(n))}},{key:"avcC",value:function(i){var t,e,r=[],n=[],a;return i.sps.forEach(function(u){a=u.byteLength,r.push(a>>>8&255),r.push(a&255),r.push.apply(r,ze(u))}),i.pps.forEach(function(u){a=u.byteLength,n.push(a>>>8&255),n.push(a&255),n.push.apply(n,ze(u))}),s.box(s.types.avcC,new Uint8Array((t=(e=[1,r[3],r[4],r[5],255,224|i.sps.length]).concat.apply(e,r).concat([i.pps.length])).concat.apply(t,n)))}},{key:"hvcC",value:function(i){var t=i.hvcC;if(t instanceof ArrayBuffer||t instanceof Uint8Array)return t;var e=i.vps,r=i.sps,n=i.pps,a;if(t){var u=t.generalProfileCompatibilityFlags,l=t.generalConstraintIndicatorFlags,c=(e.length&&1)+(r.length&&1)+(n.length&&1);a=[1,t.generalProfileSpace<<6|t.generalTierFlag<<5|t.generalProfileIdc,u>>>24,u>>>16,u>>>8,u,l[0],l[1],l[2],l[3],l[4],l[5],t.generalLevelIdc,240,0,252,t.chromaFormatIdc|252,t.bitDepthLumaMinus8|248,t.bitDepthChromaMinus8|248,0,0,t.numTemporalLayers<<3|t.temporalIdNested<<2|3,c];var f=function(d){var v;a.push(d.length>>8,d.length),(v=a).push.apply(v,ze(d))};e.length&&(a.push(160,0,e.length),e.forEach(f)),r.length&&(a.push(161,0,r.length),r.forEach(f)),n.length&&(a.push(162,0,n.length),n.forEach(f))}else a=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return s.box(s.types.hvcC,new Uint8Array(a))}},{key:"pasp",value:function(i){var t=sc(i,2),e=t[0],r=t[1];return s.box(s.types.pasp,new Uint8Array([e>>24,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255]))}},{key:"mp4a",value:function(i){return s.box(s.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i.channelCount,0,16,0,0,0,0,i.sampleRate>>8&255,i.sampleRate&255,0,0]),i.config.length?s.esds(i.config):void 0)}},{key:"esds",value:function(i){var t=i.length,e=s.box(s.types.esds,new Uint8Array([0,0,0,0,3,23+t,0,0,0,4,15+t,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([t]).concat(i).concat([6,1,2])));return e}},{key:"opus",value:function(i){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i.channelCount,0,16,0,0,0,0,i.sampleRate>>8&255,i.sampleRate&255,0,0]),e=i.config.length?s.dOps(i):[];return s.box(s.types.Opus,t,e)}},{key:"dOps",value:function(i){if(i.config)return i.config[4]=i.sampleRate>>>24&255,i.config[5]=i.sampleRate>>>16&255,i.config[6]=i.sampleRate>>>8&255,i.config[7]=i.sampleRate&255,s.box(s.types.dOps,i.config)}},{key:"mvex",value:function(i){var t=s.box.apply(s,[s.types.mvex].concat(ze(i.map(function(e){return s.trex(e.id)}))));return t}},{key:"trex",value:function(i){var t=s.box(s.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]));return t}},{key:"trex1",value:function(i){var t=s.box(s.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]));return t}},{key:"trex2",value:function(i){var t=s.box(s.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]));return t}},{key:"moof",value:function(i){var t=s.box.apply(s,[s.types.moof,s.mfhd(i[0].samples?i[0].samples[0].gopId:0)].concat(ze(i.map(function(e){return s.traf(e)}))));return t}},{key:"mfhd",value:function(i){var t=s.box(s.types.mfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255]));return t}},{key:"traf",value:function(i){var t=s.tfhd(i.id),e=s.tfdt(i,i.baseMediaDecodeTime),r=0,n;if(i.isVideo&&i.videoSenc&&(n=i.videoSenc,n.forEach(function(_){r=r+8,_.subsamples&&_.subsamples.length&&(r=r+2,r=r+_.subsamples.length*6)})),i.videoSencLength=r,!i.useEME||!i.isVideoEncryption&&!i.isAudioEncryption){var a=s.sdtp(i),u=76;return s.box(s.types.traf,t,e,a,s.trun(i.samples,a.byteLength+u))}else if(i.isVideoEncryption)if(i.isVideo){var l=s.saiz(i),c=s.saio(i),f=s.trun1(i),h=s.senc(i),d=s.box(s.types.traf,t,e,l,c,f,h);return d}else if(i.isAudioEncryption){var p=s.sbgp(),b=s.saiz(i),k=s.saio(i),E=s.senc(i),w=s.trun1(i),T=s.box(s.types.traf,t,e,p,b,k,E,w);return T}else{var v=s.sbgp(),y=s.trun1(i);return s.box(s.types.traf,t,e,v,y)}else if(i.isVideo){var L=s.trun1(i);return s.box(s.types.traf,t,e,L)}else{var O=s.sbgp(),B=s.saiz(i),x=s.saio(i),U=s.senc(i),W=s.trun1(i),m=s.box(s.types.traf,t,e,O,B,x,U,W);return m}}},{key:"sdtp",value:function(i){var t=new Fe;return i.samples.forEach(function(e){t.write(new Uint8Array(i.isVideo?[e.keyframe?32:16]:[16]))}),s.box(s.types.sdtp,this.extension(0,0),t.buffer)}},{key:"trun1",value:function(i){var t=new Fe,e=Fe.writeUint32(i.samples.length),r=null;if(i.isVideo){var n=i.videoSencLength;r=Fe.writeUint32(i.samples.length*16+n+149),!i.isVideoEncryption&&i.isAudioEncryption&&(r=Fe.writeUint32(i.samples.length*16+92))}else{var a=i.samples.length*12+124;i.isAudioEncryption&&(a=i.samples.length*12+8*i.audioSenc.length+177),r=Fe.writeUint32(a)}return i.samples.forEach(function(u){t.write(Fe.writeUint32(u.duration)),t.write(Fe.writeUint32(u.size)),t.write(Fe.writeUint32(u.keyframe?33554432:65536)),i.isVideo&&t.write(Fe.writeUint32(u.cts?u.cts:0))}),s.box(s.types.trun,this.extension(0,i.flags),e,r,t.buffer)}},{key:"senc",value:function(i){var t=new Fe,e=i.samples.length,r=i.isVideo?16:8,n=i.isVideo?2:0,a=[],u=0;return i.isVideo?(a=i.videoSenc,u=i.videoSencLength):a=i.audioSenc,u=u||r*e,t.write(Fe.writeUint32(16+u),s.types.senc,this.extension(0,n)),t.write(Fe.writeUint32(e)),a.forEach(function(l){for(var c=0;c<l.InitializationVector.length;c++)t.write(new Uint8Array([l.InitializationVector[c]]));l.subsamples&&l.subsamples.length&&(t.write(Fe.writeUint16(l.subsamples.length)),l.subsamples.forEach(function(f){t.write(Fe.writeUint16(f.BytesOfClearData)),t.write(Fe.writeUint32(f.BytesOfProtectedData))}))}),t.buffer}},{key:"saio",value:function(i){var t=i.samples.length*12+141;!i.isVideo&&i.isAudioEncryption&&(t=149);var e=new Uint8Array([1,0,0,0,0,0,0,1,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,t&255]);return s.box(s.types.saio,e)}},{key:"saiz",value:function(i){var t=i.samples.length,e=new Uint8Array([0,0,0,0,16,t>>24&255,t>>16&255,t>>8&255,t&255]);return s.box(s.types.saiz,e)}},{key:"sbgp",value:function(){var i=new Uint8Array([114,111,108,108,0,0,0,1,0,0,1,25,0,0,0,1]);return s.box(s.types.sbgp,this.extension(0,0),i)}},{key:"extension",value:function(i,t){return new Uint8Array([i,t>>16&255,t>>8&255,t&255])}},{key:"tfhd",value:function(i){return s.box(s.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255]))}},{key:"tfdt",value:function(i,t){var e=Math.floor(t/(Fa+1)),r=Math.floor(t%(Fa+1));return i.useEME&&(i.isVideoEncryption||i.isAudioEncryption)?s.box(s.types.tfdt,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])):s.box(s.types.tfdt,new Uint8Array([1,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255]))}},{key:"trun",value:function(i,t){var e=i.length,r=12+16*e;t+=8+r;var n=new Uint8Array(r);n.set([0,0,15,1,e>>>24&255,e>>>16&255,e>>>8&255,e&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0);for(var a=0;a<e;a++){var u=i[a],l=u.duration,c=u.size,f=u.flag,h=f===void 0?{}:f,d=u.cts,v=d===void 0?0:d;n.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,h.isLeading<<2|(h.dependsOn===null||h.dependsOn===void 0?1:h.dependsOn),h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|(h.isNonSyncSample===null||h.isNonSyncSample===void 0?1:h.isNonSyncSample),h.degradationPriority&61440,h.degradationPriority&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*a)}return s.box(s.types.trun,n)}},{key:"moovMP4",value:function(i){return s.box.apply(s,[s.types.moov,s.mvhd(i[0].duration,i[0].timescale)].concat(ze(i.map(function(t){return s.trackMP4(t)}))))}},{key:"trackMP4",value:function(i){return s.box(s.types.trak,s.tkhd(i.id,i.duration,i.width,i.height),s.mdiaMP4(i))}},{key:"mdiaMP4",value:function(i){return s.box(s.types.mdia,s.mdhd(i.duration,i.timescale),s.hdlr(i.type),s.minfMP4(i))}},{key:"minfMP4",value:function(i){return s.box(s.types.minf,i.type===At.VIDEO?s.VMHD:s.SMHD,s.DINF,s.stblMP4(i))}},{key:"stblMP4",value:function(i){var t=i.ext,e=[s.stsd(i),s.stts(t.stts),s.stsc(t.stsc),s.stsz(t.stsz),s.stco(t.stco)];return t.stss.length&&e.push(s.stss(t.stss)),t.ctts.length&&e.push(s.ctts(t.ctts)),s.box.apply(s,[s.types.stbl].concat(e))}},{key:"stts",value:function(i){var t=i.length,e=new Uint8Array(8*t),r=0;return i.forEach(function(n){var a=n.value,u=n.count;e.set([u>>24,u>>16&255,u>>8&255,u&255,a>>24,a>>16&255,a>>8&255,a&255],r),r+=8}),s.box(s.types.stts,We(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stsc",value:function(i){var t=i.length,e=new Uint8Array(12*t),r=0;return i.forEach(function(n){var a=n.firstChunk,u=n.samplesPerChunk,l=n.sampleDescIndex;e.set([a>>24,a>>16&255,a>>8&255,a&255,u>>24,u>>16&255,u>>8&255,u&255,l>>24,l>>16&255,l>>8&255,l&255],r),r+=12}),s.box(s.types.stsc,We(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stsz",value:function(i){var t=i.length,e=new Uint8Array(4*t),r=0;return i.forEach(function(n){e.set([n>>24,n>>16&255,n>>8&255,n&255],r),r+=4}),s.box(s.types.stsz,We(new Uint8Array([0,0,0,0,0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stco",value:function(i){var t=i.length,e=new Uint8Array(4*t),r=0;return i.forEach(function(n){e.set([n>>24,n>>16&255,n>>8&255,n&255],r),r+=4}),s.box(s.types.stco,We(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"stss",value:function(i){var t=i.length,e=new Uint8Array(4*t),r=0;return i.forEach(function(n){e.set([n>>24,n>>16&255,n>>8&255,n&255],r),r+=4}),s.box(s.types.stss,We(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"ctts",value:function(i){var t=i.length,e=new Uint8Array(8*t),r=0;return i.forEach(function(n){var a=n.value,u=n.count;e.set([u>>24,u>>16&255,u>>8&255,u&255,a>>24,a>>16&255,a>>8&255,a&255],r),r+=8}),s.box(s.types.ctts,We(new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]),e))}},{key:"styp",value:function(){return s.box(s.types.styp,new Uint8Array([109,115,100,104,0,0,0,0,109,115,100,104,109,115,105,120]))}},{key:"sidx",value:function(i){var t=i.timescale,e=i.samples[0].duration,r=e*i.samples.length,n=i.samples[0].sampleOffset*e,a=8;i.samples.forEach(function(h){a+=h.size});var u=0;if(i.isVideo){var l=0,c;i.videoSenc&&(c=i.videoSenc),i.isVideo&&c.forEach(function(h){l=l+8,h.subsamples&&h.subsamples.length&&(l=l+2,l=l+h.subsamples.length*6)}),i.videoSencLength=l,u=a+141+i.samples.length*16+l,i.useEME&&i.isAudioEncryption&&!i.isVideoEncryption&&(u=a+i.samples.length*16+84)}else u=a+116+i.samples.length*12,i.useEME&&i.isAudioEncryption&&(u=a+169+i.samples.length*12+8*i.audioSenc.length);var f=new Uint8Array([0,0,0,0,0,0,0,i.id&255,t>>24&255,t>>16&255,t>>8&255,t&255,n>>24&255,n>>16&255,n>>8&255,n&255,0,0,0,0,0,0,0,1,0,u>>16&255,u>>8&255,u&255,r>>24&255,r>>16&255,r>>8&255,r&255,144,0,0,0]);return s.box(s.types.sidx,f)}},{key:"mdat",value:function(i){var t=s.box(s.types.mdat,i);return t}}]),s})();N(oe,"types",["Opus","dOps","av01","av1C","avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trex","tkhd","vmhd","smhd","ctts","stss","styp","pssh","sidx","sbgp","saiz","saio","senc","trun","encv","enca","sinf","btrt","frma","tenc","schm","schi","mehd","fiel","sdtp"].reduce(function(s,o){return s[o]=[o.charCodeAt(0),o.charCodeAt(1),o.charCodeAt(2),o.charCodeAt(3)],s},Object.create(null)));N(oe,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])});N(oe,"FTYPAVC1",oe.box(oe.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49])));N(oe,"FTYPHEV1",oe.box(oe.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49])));N(oe,"DINF",oe.box(oe.types.dinf,oe.box(oe.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]))));N(oe,"VMHD",oe.box(oe.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])));N(oe,"SMHD",oe.box(oe.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0])));N(oe,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0]));N(oe,"STTS",oe.box(oe.types.stts,oe.StblTable));N(oe,"STSC",oe.box(oe.types.stsc,oe.StblTable));N(oe,"STSZ",oe.box(oe.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0])));N(oe,"STCO",oe.box(oe.types.stco,oe.StblTable));var Zs=(function(){function s(o,i){ge(this,s),this.name=o||"",this._prefix="[".concat(this.name,"]"),s.disabled=i}return me(s,[{key:"debug",value:function(){var i;if(!s.disabled){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];(i=console).debug.apply(i,[this._prefix].concat(e))}}},{key:"log",value:function(){var i;if(!s.disabled){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];(i=console).log.apply(i,[this._prefix].concat(e))}}},{key:"warn",value:function(){var i;if(!s.disabled){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];(i=console).warn.apply(i,[this._prefix].concat(e))}}},{key:"error",value:function(){var i;if(!s.disabled){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];(i=console).error.apply(i,[this._prefix].concat(e))}}},{key:"table",value:function(){var i;s.disabled||(console.group(this._prefix),(i=console).table.apply(i,arguments),console.groupEnd())}}],[{key:"enable",value:function(){s.disabled=!1}},{key:"disable",value:function(){s.disabled=!0}}]),s})();N(Zs,"disabled",!0);var Js=(function(){function s(o,i,t){ge(this,s),this.videoTrack=o,this.audioTrack=i;var e=/Chrome\/([^.]+)/.exec(navigator.userAgent);this.forceFirstIDR=e&&Number(e[1])<50,this.log=new Zs("FMP4Remuxer",t&&t.openLog?!t.openLog:!0)}return me(s,[{key:"remux",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=this.videoTrack,r=this.audioTrack,n=e.exist(),a=r.exist(),u,l,c,f=[];i&&(t&&t.initMerge?(n&&f.push(this.videoTrack),a&&f.push(this.audioTrack),c=oe.initSegment(f)):(n&&(u=oe.initSegment([this.videoTrack])),a&&(l=oe.initSegment([this.audioTrack]))));var h,d;return n&&e.hasSample()&&(h=this._remuxVideo()),a&&r.hasSample()&&(d=this._remuxAudio()),e.samples=[],r.samples=[],{initSegment:c,videoInitSegment:u,audioInitSegment:l,videoSegment:h,audioSegment:d}}},{key:"_remuxVideo",value:function(){var i=this.videoTrack;this.forceFirstIDR&&(i.samples[0].flag={dependsOn:2,isNonSyncSample:0});var t=i.samples,e=/av01/.test(i.codec),r=0;e?t.forEach(function(E){r+=E.data.byteLength}):t.forEach(function(E){r+=E.units.reduce(function(w,T){return w+T.byteLength},0),r+=E.units.length*4});var n=new Uint8Array(r);if(e)for(var a=0,u=t.length,l=0,c;a<u;a++)c=t[a],n.set(c.data,l),c.size=c.data.byteLength,l+=c.size;else for(var f=new DataView(n.buffer),h=function(w,T){T=t[d];var L=0;T.units.forEach(function(O){f.setUint32(w,O.byteLength),w+=4,n.set(O,w),w+=O.byteLength,L+=4+O.byteLength}),T.size=L,y=w,p=T},d=0,v=t.length,y=0,p;d<v;d++)h(y,p);var b=oe.mdat(n),k=oe.moof([i]);return We(k,b)}},{key:"_remuxAudio",value:function(){var i=this.audioTrack,t=new Uint8Array(i.samples.reduce(function(n,a){return n+a.size},0));i.samples.reduce(function(n,a){return t.set(a.data,n),n+a.size},0);var e=oe.mdat(t),r=oe.moof([i]);return We(r,e)}},{key:"reset",value:function(){this.videoTrack.reset(),this.audioTrack.reset()}}]),s})(),Nc=(function(){function s(){De(this,s);var o=window.crypto||window.msCrypto;this.subtle=o&&(o.subtle||o.webkitSubtle),this.externalDecryptor=null}return Pe(s,[{key:"destroy",value:function(){var i;(i=this.externalDecryptor)!==null&&i!==void 0&&i.destroy&&this.externalDecryptor.destroy()}},{key:"decrypt",value:function(i,t){if(!(!i&&!t)){var e=[];return i&&(e[0]=this._decryptSegment(i)),t&&(e[1]=this._decryptSegment(t)),Promise.all(e)}}},{key:"_decryptSegment",value:(function(){var o=fe(z().mark(function t(e){var r;return z().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(r=e.data,!e.key){a.next=5;break}return a.next=4,this._decryptData(e.data,e.key,e.keyIv);case 4:r=a.sent;case 5:if(e.map){a.next=7;break}return a.abrupt("return",r);case 7:return a.abrupt("return",vi(e.map,r));case 8:case"end":return a.stop()}},t,this)}));function i(t){return o.apply(this,arguments)}return i})()},{key:"_decryptData",value:(function(){var o=fe(z().mark(function t(e,r,n){var a;return z().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!this.externalDecryptor){l.next=6;break}return l.next=3,this.externalDecryptor.decrypt(e,r,n);case 3:return l.abrupt("return",l.sent);case 6:if(this.subtle){l.next=8;break}throw new Error("crypto is not defined");case 8:return l.next=10,this.subtle.importKey("raw",r,{name:"AES-CBC"},!1,["encrypt","decrypt"]);case 10:return a=l.sent,l.t0=Uint8Array,l.next=14,this.subtle.decrypt({name:"AES-CBC",iv:n},a,e);case 14:return l.t1=l.sent,l.abrupt("return",new l.t0(l.t1));case 16:case"end":return l.stop()}},t,this)}));function i(t,e,r){return o.apply(this,arguments)}return i})()}]),s})(),le=de(de({},F),{},{STREAM_PARSED:"core.streamparsed",NO_AUDIO_TRACK:"core.noaudiotrack",SUBTITLE_SEGMENTS:"core.subtitlesegments",SUBTITLE_PLAYLIST:"core.subtitleplaylist",SEI_PAYLOAD_TIME:"core.seipayloadtime",APPEND_COST:"core.appendcost"}),Br=new $e("Transmuxer"),Ba=(function(){function s(o,i,t,e){De(this,s),A(this,"_initSegmentId",""),this.hls=o,this._demuxer=i?new Rc:new Qs(null,null,null,e),this._isMP4=i,t&&(this._remuxer=new Js(this._demuxer.videoTrack,this._demuxer.audioTrack))}return Pe(s,[{key:"transmux",value:function(i,t,e,r,n,a){var u=this._demuxer;try{this._isMP4?u.demux(i,t):u.demuxAndFix(vi(i,t),e,r,n)}catch(L){throw new ye(ie.DEMUX,ie.SUB_TYPES.HLS,L)}var l=u.videoTrack,c=u.audioTrack,f=u.metadataTrack,h={codec:l.codec,timescale:l.timescale,firstDts:l.firstDts/l.timescale,firstPts:l.firstPts/l.timescale,duration:l.samplesDuration/l.timescale},d={codec:c.codec,timescale:c.timescale,firstDts:c.firstDts/l.timescale,firstPts:c.firstPts/l.timescale,duration:c.samplesDuration/l.timescale,container:c.container},v="".concat(l.codec,"/").concat(l.width,"/").concat(l.height,"/").concat(c.codec,"/").concat(c.config);if(v!==this._initSegmentId&&(this._initSegmentId=v,a=!0),this._fireEvents(l,c,f,e||a),this.hls.emit(le.DEMUXED_TRACK,{videoTrack:l,audioTrack:c}),this._remuxer){a&&this.hls.isLive&&!this.hls.config.mseLowLatency&&(l.duration=this.hls.totalDuration*l.timescale,c.duration=this.hls.totalDuration*c.timescale);try{var y=this._remuxer.remux(a),p=y.videoInitSegment,b=y.videoSegment,k=y.audioInitSegment,E=y.audioSegment,w=vi(p,b),T=vi(k,E);return[w?de(de({},h),{},{data:w}):void 0,T?de(de({},d),{},{data:T}):void 0]}catch(L){throw new ye(ie.REMUX,ie.SUB_TYPES.FMP4,L)}}else return[l,c]}},{key:"_fireEvents",value:function(i,t,e,r){var n=this,a=[i,t],u="discontinuity: ".concat(r);a.forEach(function(l){var c;(c=l.samples)!==null&&c!==void 0&&c.length&&(u+="; ".concat(l.samples.length," ").concat(l.type===At.VIDEO?"video":"audio"," samples, firstDts/firstPts/duration: ").concat((l.firstDts/l.timescale).toFixed(3),"/").concat((l.firstPts/l.timescale).toFixed(3),"/").concat((l.samplesDuration/l.timescale).toFixed(3))),r&&l.exist()&&n.hls.emit(le.METADATA_PARSED,{type:l.type,track:l,meta:de({codec:l.codec,timescale:l.timescale,baseDts:l.baseDts},l.type===At.VIDEO?{width:l.width,height:l.height,sarRatio:l.sarRatio}:{codec:l.codec,channelCount:l.channelCount,sampleRate:l.sampleRate})})}),Br.debug(u),i.warnings.forEach(function(l){var c;switch(l.type){case Te.LARGE_AV_SHIFT:c=le.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case Te.LARGE_VIDEO_GAP:c=le.LARGE_VIDEO_DTS_GAP_DETECT;break;case Te.LARGE_VIDEO_GAP_BETWEEN_CHUNK:c=le.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT;break}c&&n.hls.emit(le.STREAM_EXCEPTION,de(de({},l),{},{type:c})),Br.warn("video exception",l)}),t.warnings.forEach(function(l){var c;switch(l.type){case Te.LARGE_AUDIO_GAP:c=le.LARGE_AUDIO_DTS_GAP_DETECT;break;case Te.AUDIO_FILLED:c=le.AUDIO_GAP_DETECT;break;case Te.AUDIO_DROPPED:c=le.AUDIO_OVERLAP_DETECT;break}c&&n.hls.emit(le.STREAM_EXCEPTION,de(de({},l),{},{type:c})),Br.warn("audio exception",l)}),i.samples.forEach(function(l){l.keyframe&&n.hls.emit(le.KEYFRAME,{pts:l.pts})}),e.seiSamples.forEach(function(l){n.hls.emit(le.SEI,de(de({},l),{},{originPts:l.originPts/90,sei:{code:l.data.type,content:l.data.payload,dts:l.pts}}))})}}]),s})(),Fc=["data"],Bc=["data"],Ua=new $e("BufferService"),Uc=(function(){function s(o){var i=this;De(this,s),A(this,"_decryptor",new Nc),A(this,"_transmuxer",null),A(this,"_mse",null),A(this,"_softVideo",null),A(this,"_sourceCreated",!1),A(this,"_needInitSegment",!0),A(this,"_directAppend",!1),this.hls=o,o.config.softDecode?this._softVideo=o.media:(this._mse=new Ie(null,{preferMMS:o.config.preferMMS}),o.config.url&&this._mse.bindMedia(o.media).then(function(t){i.hls.emit(F.MEDIASOURCE_OPENED,t)})),o.config.decryptor&&(this._decryptor.externalDecryptor=o.config.decryptor)}return Pe(s,[{key:"baseDts",get:function(){var i,t,e;return(i=this._transmuxer)===null||i===void 0||(t=i._demuxer)===null||t===void 0||(e=t._fixer)===null||e===void 0?void 0:e._baseDts}},{key:"nbSb",get:function(){var i;return(i=this._mse)!==null&&i!==void 0&&i._sourceBuffer?Object.keys(this._mse._sourceBuffer).length:0}},{key:"msIsOpened",get:function(){var i;return(i=this._mse)===null||i===void 0?void 0:i.isOpened}},{key:"msHasOpTasks",get:function(){var i;return(i=this._mse)===null||i===void 0?void 0:i.hasOpTasks}},{key:"msStreaming",get:function(){var i;return(i=this._mse)===null||i===void 0?void 0:i.streaming}},{key:"updateDuration",value:(function(){var o=fe(z().mark(function t(e){return z().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(Ua.debug("update duration",e),!this._mse){n.next=9;break}if(this._mse.isOpened){n.next=5;break}return n.next=5,this._mse.open();case 5:return n.next=7,this._mse.updateDuration(e);case 7:n.next=10;break;case 9:this._softVideo&&(this._softVideo.duration=e);case 10:case"end":return n.stop()}},t,this)}));function i(t){return o.apply(this,arguments)}return i})()},{key:"createSource",value:function(i,t,e,r){if(!this._sourceCreated){var n=i||t;if(n){if(Qs.probe(n))this._transmuxer||(this._transmuxer=new Ba(this.hls,!1,!this._softVideo,this.hls.config.fixerConfig));else if(_e.probe(n))if(this._softVideo)this._transmuxer||(this._transmuxer=new Ba(this.hls,!0,null,this.hls.config.fixerConfig));else{this._directAppend=!0;var a=!1;i&&!e&&_e.findBox(i,["moov","trak"]).forEach(function(u){var l=_e.findBox(u.data,["trak","mdia","minf","stbl","stsd"])[0];if(l){var c=_e.stsd(l).entries[0];if(c){if(c.hvcC)e=c.hvcC.codec||"hev1.1.6.L93.B0";else if(c.avcC)e=c.avcC.codec;else if(c.sampleRate||c.esds){var f;r=((f=c.esds)===null||f===void 0?void 0:f.codec)||"mp4a.40.2",a=!0}}}}),t&&!r&&_e.findBox(t,["moov","trak","mdia","minf","stbl","stsd"]).forEach(function(u){var l=_e.stsd(u).entries[0];l&&l.esds&&(r=l.esds.codec)}),i&&!e&&(e="avc1.42e01e"),t&&!r&&(r="mp4a.40.2"),a&&(e+=", ".concat(r),r=""),this._createMseSource(e,r)}else throw new ye(ie.OTHER,null,null,null,"unsupported stream");this._softVideo&&(this._sourceCreated=!0)}}}},{key:"appendBuffer",value:(function(){var o=fe(z().mark(function t(e,r,n,a,u,l,c){var f=this,h,d,v,y,p,b,k,E,w,T,L,O,B,x,U;return z().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(!(n!=null&&n.length)&&!(a!=null&&a.length))){m.next=2;break}return m.abrupt("return");case 2:if(h=function(){var S;if((S=f.hls)!==null&&S!==void 0&&S.emit){var D;(D=f.hls)===null||D===void 0||D.emit(F.APPEND_BUFFER,{start:e.start,end:e.end})}},!this._directAppend){m.next=8;break}return d=[],n&&d.push(this._mse.append(Ie.VIDEO,n)),a&&d.push(this._mse.append(Ie.AUDIO,a)),m.abrupt("return",Promise.all(d).then(h));case 8:if(v=this._needInitSegment||u,y=this._transmuxer.transmux(n,a,v,l,c,this._needInitSegment||u),p=St(y,2),b=p[0],k=p[1],a&&r&&(r==null||r.setTrackExist(!1,!0)),a&&e&&(e==null||e.setTrackExist(!0,!1)),r||e==null||e.setTrackExist(!!b,!!k),b&&!k&&this.hls.emit(le.NO_AUDIO_TRACK),!this._softVideo){m.next=20;break}this._softVideo.appendBuffer(b,k),this._needInitSegment=!1,h(),m.next=32;break;case 20:if(!this._mse){m.next=32;break}return E=!this._sourceCreated,E&&this._createMseSource(b==null?void 0:b.codec,k==null?void 0:k.codec,k==null?void 0:k.container),this._needInitSegment=!1,w=this._mse,T=[],v&&!E&&this._handleCodecChange(b,k).forEach(function(_){return T.push(_)}),b&&(L=b.data,O=qr(b,Fc),T.push(w.append(Ie.VIDEO,L,O))),k&&(B=k.data,x=qr(k,Bc),T.push(w.append(Ie.AUDIO,B,x))),U=Promise.all(T),U.then(h),m.abrupt("return",U);case 32:case"end":return m.stop()}},t,this)}));function i(t,e,r,n,a,u,l){return o.apply(this,arguments)}return i})()},{key:"removeBuffer",value:(function(){var o=fe(z().mark(function t(){var e=this,r,n,a,u=arguments;return z().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(r=u.length>0&&u[0]!==void 0?u[0]:0,n=u.length>1&&u[1]!==void 0?u[1]:1/0,a=this.hls.media,!(!this._mse||!a||r<0||n<r||r>=this._mse.duration)){c.next=5;break}return c.abrupt("return");case 5:return c.abrupt("return",this._mse.clearBuffer(r,n).then(function(){return e.hls.emit(F.REMOVE_BUFFER,{start:r,end:n,removeEnd:n})}));case 6:case"end":return c.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i})()},{key:"evictBuffer",value:(function(){var o=fe(z().mark(function t(e){var r,n,a,u;return z().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(r=this.hls.media,!(!this._mse||!r||!e||e<0)){c.next=3;break}return c.abrupt("return");case 3:if(n=r.currentTime,a=n-e,!(a<=0)){c.next=7;break}return c.abrupt("return");case 7:if(u=Ce.start(Ce.get(r)),!(u+1>=a)){c.next=10;break}return c.abrupt("return");case 10:return c.abrupt("return",this.removeBuffer(0,a));case 11:case"end":return c.stop()}},t,this)}));function i(t){return o.apply(this,arguments)}return i})()},{key:"clearAllBuffer",value:(function(){var o=fe(z().mark(function t(){return z().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!this._mse){r.next=2;break}return r.abrupt("return",this._mse.clearAllBuffer());case 2:case"end":return r.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i})()},{key:"decryptBuffer",value:function(i,t){return this._decryptor.decrypt(i,t)}},{key:"reset",value:(function(){var o=fe(z().mark(function t(){var e,r=arguments;return z().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e=r.length>0&&r[0]!==void 0?r[0]:!1,!(this._mse&&!e)){a.next=8;break}return this._transmuxer=null,this._sourceCreated=!1,a.next=6,this._mse.unbindMedia();case 6:return a.next=8,this._mse.bindMedia(this.hls.media);case 8:this._needInitSegment=!0,this._directAppend=!1;case 10:case"end":return a.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i})()},{key:"endOfStream",value:(function(){var o=fe(z().mark(function t(){return z().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!this._mse){r.next=5;break}if(!this._sourceCreated){r.next=5;break}return r.next=4,this._mse.endOfStream();case 4:this.hls.emit(F.BUFFEREOS);case 5:this._softVideo&&this._softVideo.endOfStream();case 6:case"end":return r.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i})()},{key:"setLiveSeekableRange",value:(function(){var o=fe(z().mark(function t(e,r){return z().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:this._mse&&this._mse.setLiveSeekableRange(e,r);case 1:case"end":return a.stop()}},t,this)}));function i(t,e){return o.apply(this,arguments)}return i})()},{key:"detachMedia",value:(function(){var o=fe(z().mark(function t(){return z().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!this._mse){r.next=3;break}return r.next=3,this._mse.unbindMedia();case 3:case"end":return r.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i})()},{key:"destroy",value:(function(){var o=fe(z().mark(function t(){var e;return z().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(e=this._decryptor)===null||e===void 0||e.destroy(),n.next=3,this.detachMedia();case 3:this._decryptor=null,this._mse=null,this._softVideo=null;case 6:case"end":return n.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i})()},{key:"_createMseSource",value:function(i,t,e){Ua.debug("create mse source, videoCodec=".concat(i,", audioCodec=").concat(t));var r=this._mse;r&&(i&&(r.createSource(Ie.VIDEO,"video/mp4;codecs=".concat(i)),this._sourceCreated=!0),t?(r.createSource(Ie.AUDIO,"audio/mp4;codecs=".concat(t)),this._sourceCreated=!0):e&&(r.createSource(Ie.AUDIO,"".concat(e,';codecs=""')),this._sourceCreated=!0),this.hls.emit(F.SOURCEBUFFER_CREATED))}},{key:"_handleCodecChange",value:function(i,t){var e=[],r=this._mse,n=[{type:Ie.VIDEO,codecs:i==null?void 0:i.codec},{type:Ie.AUDIO,codecs:t==null?void 0:t.codec}];return n.filter(function(a){return!!a.codecs}).forEach(function(a){var u=a.type,l=a.codecs,c=r.getSourceBuffer(u);if(c){var f=l.split(",")[0];new RegExp(f,"ig").test(c.mimeType)||e.push(r.changeType(u,"".concat(u,"/mp4;codecs=").concat(l)))}}),e}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0}},{key:"isFull",value:function(){var i,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ie.VIDEO;return(i=this._mse)===null||i===void 0?void 0:i.isFull(t)}}]),s})();function Hc(s){var o=(s==null?void 0:s.media)||document.createElement("video");return de(de({maxPlaylistSize:50,retryCount:3,retryDelay:1e3,pollRetryCount:2,loadTimeout:1e4,manifestLoadTimeout:1e4,preloadTime:30,softDecode:!1,bufferBehind:10,maxJumpDistance:3,startTime:0,useLowLatency:!0,targetLatency:10,maxLatency:20,allowedStreamTrackChange:!0,seiInTime:!1,manifestList:[],minSegmentsStartPlay:3,preferMMS:!1,preferMMSStreaming:!1,mseLowLatency:!0,fixerConfig:{forceFixLargeGap:!1,largeGapThreshold:5}},s),{},{media:o})}var Vc=Pe(function s(){De(this,s),A(this,"version",0),A(this,"streams",[]),A(this,"isMaster",!0)}),eo={Audio:"AUDIO",SubTitle:"SUBTITLE"},Ni={CLEAR_KEY:"org.w3.clearkey",FAIRPLAY:["urn:uuid:94ce86fb-07ff-4f43-adb8-93d2fa968ca2","com.apple.streamingkeydelivery"],WIDEVINE:["urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine.alpha","com.widevine"],PLAYREADY:["urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95","com.microsoft.playready"]};function to(s){for(var o=[],i=0;i<s.length;i++)Array.isArray(s[i])?o=o.concat(to(s[i])):o.push(s[i]);return o}var Pn=Pe(function s(){De(this,s),A(this,"id",0),A(this,"url",""),A(this,"default",!1),A(this,"autoSelect",!1),A(this,"forced",!1),A(this,"group",""),A(this,"name",""),A(this,"lang",""),A(this,"segments",[]),A(this,"endSN",0)}),Gc=(function(s){or(i,s);var o=ur(i);function i(){var t;De(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),A(ae(t),"mediaType",eo.Audio),A(ae(t),"channels",0),t}return Pe(i)})(Pn),jc=(function(s){or(i,s);var o=ur(i);function i(){var t;De(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),A(ae(t),"mediaType",eo.SubTitle),t}return Pe(i)})(Pn),zc=Pe(function s(){De(this,s),A(this,"id",0),A(this,"bitrate",0),A(this,"width",0),A(this,"height",0),A(this,"name",""),A(this,"url",""),A(this,"audioCodec",""),A(this,"videoCodec",""),A(this,"textCodec",""),A(this,"audioGroup",""),A(this,"audioStreams",[]),A(this,"subtitleStreams",[]),A(this,"closedCaptionsStream",[])}),Wc=Pe(function s(){De(this,s),A(this,"version",0),A(this,"url",""),A(this,"type",""),A(this,"startCC",0),A(this,"endCC",0),A(this,"startSN",0),A(this,"endSN",0),A(this,"totalDuration",0),A(this,"targetDuration",0),A(this,"partTargetDuration",0),A(this,"canSkipUntil",0),A(this,"canSkipDateRanges",!1),A(this,"skippedSegments",0),A(this,"canBlockReload",!1),A(this,"partHoldBack",0),A(this,"live",!0),A(this,"lowLatency",!1),A(this,"endPartIndex",0),A(this,"segments",[]),A(this,"dateRanges",{}),A(this,"skippedSegments",0)}),Fi=(function(){function s(o){De(this,s),A(this,"sn",0),A(this,"cc",0),A(this,"url",""),A(this,"parentUrl",""),A(this,"title",""),A(this,"start",0),A(this,"duration",0),A(this,"dataTime",""),A(this,"key",null),A(this,"byteRange",null),A(this,"isInitSegment",!1),A(this,"initSegment",null),A(this,"isLast",!1),A(this,"hasAudio",!1),A(this,"hasVideo",!1),A(this,"independent",!1),A(this,"partIndex",0),this.parentUrl=o}return Pe(s,[{key:"end",get:function(){return this.start+this.duration}},{key:"setTrackExist",value:function(i,t){this.hasVideo=i,this.hasAudio=t}},{key:"setByteRange",value:function(i,t){this.byteRange=[0];var e=i.split("@");e.length===1&&t&&t.byteRange?(this.byteRange[0]=t.byteRange[1]||0,this.byteRange[0]&&(this.byteRange[0]+=1)):this.byteRange[0]=parseInt(e[1]),this.byteRange[1]=this.byteRange[0]+parseInt(e[0])-1}}]),s})(),$c=(function(){function s(o){De(this,s),A(this,"method",""),A(this,"url",""),A(this,"iv",null),A(this,"keyFormat",""),A(this,"keyFormatVersions",""),o instanceof s&&(this.method=o.method,this.url=o.url,this.keyFormat=o.keyFormat,this.keyFormatVersions=o.keyFormatVersions,o.iv&&(this.iv=new Uint8Array(o.iv)))}return Pe(s,[{key:"clone",value:function(i){var t=new s(this);return i!=null&&t.setIVFromSN(i),t}},{key:"setIVFromSN",value:function(i){if(!this.iv&&this.method==="AES-128"&&typeof i=="number"&&this.url){this.iv=new Uint8Array(16);for(var t=12;t<16;t++)this.iv[t]=i>>8*(15-t)&255}}},{key:"isSegmentEncrypted",value:function(){var i=this.method;return i==="AES-128"}},{key:"isValidKeySystem",value:function(){var i=to([Ni.CLEAR_KEY,Ni.FAIRPLAY,Ni.WIDEVINE,Ni.PLAYREADY]).indexOf(this.keyFormat)>-1;if(!i)return!1;var t=["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)>-1;return!!t}},{key:"isSupported",value:function(){return this.method?this.isSegmentEncrypted()?!0:!!this.isValidKeySystem():!1}}]),s})(),Kc=(function(){function s(o,i,t){De(this,s),this.msn=o,this.part=i,this.skip=t}return Pe(s,[{key:"addDirectives",value:function(i){var t=new self.URL(i);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}]),s})(),Yc=/^#(EXT[^:]*)(?::(.*))?$/,Ha=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g,Xc=/^(?:[a-zA-Z0-9+\-.]+:)?\/\//,qc=/^((?:[a-zA-Z0-9+\-.]+:)?\/\/[^/?#]*)?([^?#]*\/)?/;function Qc(s){return s.split(/[\r\n]/).map(function(o){return o.trim()}).filter(Boolean)}function io(s){var o=s.match(Yc);if(!(!o||!o[1]))return[o[1].replace("EXT-X-",""),o[2]]}function lt(s){for(var o={},i=Ha.exec(s);i;)o[i[1]]=i[2]||i[3],i=Ha.exec(s);return o}function ni(s,o){if(!o||!s||Xc.test(s))return s;var i=qc.exec(o);return i?s[0]==="/"?i[1]+s:i[1]+i[2]+s:s}var Zc={audio:[/^mp4a/,/^vorbis$/,/^opus$/,/^flac$/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function Ur(s,o){var i=Zc[s];if(!(!i||!o||!o.length)){for(var t=0;t<i.length;t++)for(var e=0;e<o.length;e++)if(i[t].test(o[e]))return o[e]}}function Jc(s,o){var i;if(o){for(var t in o)if(Object.prototype.hasOwnProperty.call(o,t)&&s[t]!==o[t]){i=t;break}}var e=null;s.DURATION&&(e=parseFloat(s.DURATION),Number.isFinite(e)?s._endDate&&(e=(s._endDate.getTime()-s._startDate.getTime())/1e3):e=null);var r=ef(s.CUE||s["X-CUE"],{pre:!1,post:!1,once:!1});return!!s.ID&&!i&&Number.isFinite(s._startDate.getTime())&&(e===null||e>=0)&&(s.END_ON_NEXT!=="YES"||!!s.CLASS)&&(!s.CUE||!r.pre&&!r.post||r.pre!==r.post)&&(s.CLASS!=="com.apple.hls.interstitial"||"X-ASSET-URI"in s||"X-ASSET-LIST"in s)}function ef(s,o){return(s?s.split(/[ ,]+/):[]).reduce(function(i,t){return i[t.toLowerCase()]=!0,i},o)}function tf(s,o){for(var i=new Vc,t=0,e,r=[],n=[];e=s[t++];){var a=io(e);if(a){var u=St(a,2),l=u[0],c=u[1];if(l==="VERSION")i.version=parseInt(c);else if(l==="MEDIA"&&c){var f=lt(c),h=void 0;switch(f.TYPE){case"AUDIO":h=new Gc;break;case"SUBTITLES":h=new jc;break;default:h=new Pn}h.url=ni(f.URI,o),h.default=f.DEFAULT==="YES",h.autoSelect=f.AUTOSELECT==="YES",h.group=f["GROUP-ID"],h.name=f.NAME,h.lang=f.LANGUAGE,f.CHANNELS&&(h.channels=Number(f.CHANNELS.split("/")[0]),Number.isNaN(h.channels)&&(h.channels=0)),f.TYPE==="AUDIO"&&f.URI&&r.push(h),f.TYPE==="SUBTITLES"&&n.push(h)}else if(l==="STREAM-INF"&&c){var d=new zc,v=lt(c);if(d.bitrate=parseInt(v["AVERAGE-BANDWIDTH"]||v.BANDWIDTH),d.name=v.NAME,d.url=ni(s[t++],o),v.RESOLUTION){var y=v.RESOLUTION.split("x"),p=St(y,2),b=p[0],k=p[1];d.width=parseInt(b),d.height=parseInt(k)}if(v.CODECS){var E=v.CODECS.split(/[ ,]+/).filter(Boolean);d.videoCodec=Ur("video",E),d.audioCodec=Ur("audio",E),d.textCodec=Ur("text",E)}d.audioGroup=v.AUDIO,d.subtitleGroup=v.SUBTITLES,i.streams.push(d)}}}return i.streams.forEach(function(w,T){w.id=T}),r.length&&(r.forEach(function(w,T){w.id=T}),i.streams.forEach(function(w){w.audioGroup&&(w.audioStreams=r.filter(function(T){return T.group===w.audioGroup}))})),n.length&&(n.forEach(function(w,T){w.id=T}),i.streams.forEach(function(w){w.subtitleGroup&&(w.subtitleStreams=n.filter(function(T){return T.group===w.subtitleGroup}))})),i}function rf(s,o,i){var t=new Wc;t.url=o;for(var e=new Fi(o),r=null,n=null,a=0,u=0,l=0,c=0,f,h=!1,d=0;f=s[c++];){if(f[0]!=="#"){if(t.lowLatency){u++;continue}e.sn=u,e.cc=l,e.url=ni(f,o),n&&(e.key=n.clone(u)),r&&(e.initSegment=r),t.segments.push(e),e=new Fi(o),u++;continue}var v=io(f);if(v){var y=St(v,2),p=y[0],b=y[1];switch(p){case"VERSION":t.version=parseInt(b);break;case"PLAYLIST-TYPE":t.type=b==null?void 0:b.toUpperCase();break;case"TARGETDURATION":t.targetDuration=parseFloat(b);break;case"PART-INF":{i&&(t.lowLatency=!0);var k=lt(b);k["PART-TARGET"]&&(t.partTargetDuration=parseFloat(k["PART-TARGET"]))}break;case"SERVER-CONTROL":{var E=lt(b);t.canBlockReload=E["CAN-BLOCK-RELOAD"]==="YES",t.partHoldBack=parseFloat(E["PART-HOLD-BACK"]||0),t.canSkipUntil=parseFloat(E["CAN-SKIP-UNTIL"]||0),t.canSkipDateRanges=t.canSkipUntil>0&&E["CAN-SKIP-DATERANGES"]==="YES"}break;case"ENDLIST":h=!0;break;case"MEDIA-SEQUENCE":u=t.startSN=parseInt(b);break;case"DISCONTINUITY-SEQUENCE":l=t.startCC=parseInt(b);break;case"DISCONTINUITY":l++;break;case"BYTERANGE":e.setByteRange(b,t.segments[t.segments.length-1]);break;case"PART":{if(!t.lowLatency)break;var w=lt(b);e.duration=parseFloat(w.DURATION),e.independent=w.INDEPENDENT==="YES",e.sn=u,e.cc=l,e.partIndex=d,e.start=a,e.duration=parseFloat(w.DURATION),a+=e.duration,e.url=ni(w.URI,o),n&&(e.key=n.clone(u)),r&&(e.initSegment=r),t.segments.push(e),e=new Fi(o),d++}break;case"PRELOAD-HINT":{var T=lt(b);if(t.preloadHint=T,T.TYPE==="PART"&&T.URI){var L=T.URI.split(".ts")[0].split("-");t.nextSN=L[3],t.nextIndex=L[L.length-1]}}break;case"PROGRAM-DATE-TIME":e.dataTime=b;break;case"EXTINF":{if(t.lowLatency){d=0;break}var O=b.split(","),B=St(O,2),x=B[0],U=B[1];e.start=a,e.duration=parseFloat(x),a+=e.duration,e.title=U}break;case"KEY":{var W=lt(b);if(W.METHOD==="NONE"){n=null;break}if(n=new $c,n.method=W.METHOD,n.url=/^blob:/.test(W.URI)?W.URI:ni(W.URI,o),n.keyFormat=W.KEYFORMAT||"identity",n.keyFormatVersions=W.KEYFORMATVERSIONS,!n.isSupported())throw new Error("encrypt ".concat(W.METHOD,"/").concat(W.KEYFORMAT," is not supported"));if(W.IV){var m=W.IV.slice(2);m=(m.length&1?"0":"")+m,n.iv=new Uint8Array(m.length/2);for(var _=0,S=m.length/2;_<S;_++)n.iv[_]=parseInt(m.slice(_*2,_*2+2),16)}}break;case"MAP":{var D=lt(b);e.url=ni(D.URI,o),D.BYTERANGE&&e.setByteRange(D.BYTERANGE),e.isInitSegment=!0,e.sn=0,n&&(e.key=n.clone(0)),r=e,e=new Fi(o)}break;case"SKIP":{var C=lt(b),R=parseInt(C["SKIPPED-SEGMENTS"],10);R<=Number.MAX_SAFE_INTEGER&&(t.skippedSegments+=R,u+=R)}break;case"DATERANGE":{var V=lt(b),K=t.dateRanges[V.ID];V._startDate=K?K._startDate:new Date(V["START-DATE"]);var Y=(K==null?void 0:K._endDate)||new Date(V.END_DATE);Number.isFinite(Y)&&(V._endDate=Y),(Jc(V,K)||t.skippedSegments)&&(t.dateRanges[V.ID]=V)}break}}}t.segments=t.segments.filter(function(ke){return ke.duration!==0});var G=t.segments[t.segments.length-1];return G&&(h&&(G.isLast=!0),t.endSN=G.sn,t.endPartIndex=G.partIndex),h&&(t.live=!1),t.totalDuration=a,t.endCC=l,t}var Bi=(function(){function s(){De(this,s)}return Pe(s,null,[{key:"parse",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;if(!i.includes("#EXTM3U"))throw new Error("Invalid m3u8 file");var r=Qc(i);return s.isMediaPlaylist(i)?rf(r,t,e):tf(r,t)}},{key:"isMediaPlaylist",value:function(i){return i.includes("#EXTINF:")||i.includes("#EXT-X-TARGETDURATION:")}}]),s})(),nf=(function(){function s(o){var i=this;De(this,s),A(this,"_emitOnLoaded",function(u,l){var c=u.response,f=u.options,h=f||{},d=h.firstByteTime,v=h.startTime,y=h.endTime,p=h.contentLength,b=y-v;i.hls.emit(F.SPEED,{time:b,byteLength:p,url:l}),i.hls.emit(F.LOAD_COMPLETE,{url:l,elapsed:b||0}),i.hls.emit(F.TTFB,{url:l,responseUrl:c.url,elapsed:d-v}),i.hls.emit(F.LOAD_RESPONSE_HEADERS,{headers:c.headers,url:l})}),A(this,"_onLoaderRetry",function(u,l){i.hls.emit(le.LOAD_RETRY,{error:ye.network(u),retryTime:l})}),this.hls=o,this._timer=null,this._useLowLatency=o.config.useLowLatency;var t=this.hls.config,e=t.retryCount,r=t.retryDelay,n=t.manifestLoadTimeout,a=t.fetchOptions;this._loader=new Ut(de(de({},a),{},{responseType:"text",retry:e,retryDelay:r,timeout:n,onRetryError:this._onLoaderRetry})),this._audioLoader=new Ut(de(de({},a),{},{responseType:"text",retry:e,retryDelay:r,timeout:n,onRetryError:this._onLoaderRetry})),this._subtitleLoader=new Ut(de(de({},a),{},{responseType:"text",retry:e,retryDelay:r,timeout:n,onRetryError:this._onLoaderRetry}))}return Pe(s,[{key:"load",value:(function(){var o=fe(z().mark(function t(e,r,n){var a,u,l,c,f,h,d,v,y,p,b,k,E,w,T,L,O,B,x,U;return z().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return a=[this._loader.load(e)],r&&a.push(this._audioLoader.load(r)),n&&a.push(this._subtitleLoader.load(n)),m.prev=3,m.next=6,Promise.all(a);case 6:if(v=m.sent,y=St(v,3),p=y[0],b=y[1],k=y[2],p){m.next=13;break}return m.abrupt("return",[]);case 13:this._emitOnLoaded(p,e),u=p.data,f=p.response.url||e,r?(l=b==null?void 0:b.data,c=k==null?void 0:k.data,h=(b==null||(E=b.response)===null||E===void 0?void 0:E.url)||r,d=(k==null||(w=k.response)===null||w===void 0?void 0:w.url)||n,l&&this._emitOnLoaded(b,r),c&&this._emitOnLoaded(k,n)):(c=b==null?void 0:b.data,d=(b==null||(T=b.response)===null||T===void 0?void 0:T.url)||n,c&&this._emitOnLoaded(b,n)),m.next=22;break;case 19:throw m.prev=19,m.t0=m.catch(3),ye.network(m.t0);case 22:if(L=this.hls.config.onPreM3U8Parse,m.prev=23,L&&(u=L(u)||u,l&&(l=L(l,!0)||l),c&&(c=L(c,!0)||c)),O=Bi.parse(u,f,this._useLowLatency),!(((U=O)===null||U===void 0?void 0:U.live)===!1&&O.segments&&!O.segments.length)){m.next=28;break}throw new Error("empty segments list");case 28:l&&(B=Bi.parse(l,h,this._useLowLatency)),c&&(x=Bi.parse(c,d,this._useLowLatency)),m.next=35;break;case 32:throw m.prev=32,m.t1=m.catch(23),new ye(ie.MANIFEST,ie.SUB_TYPES.HLS,m.t1);case 35:return O&&(O.isMaster?this.hls.emit(le.HLS_MANIFEST_LOADED,{playlist:O}):(this._useLowLatency&&(O.canBlockReload?this.deliveryDirectives=new Kc(O.nextSN,O.nextIndex,""):this.deliveryDirectives=null),this.hls.emit(le.HLS_LEVEL_LOADED,{playlist:O}))),m.abrupt("return",[O,B,x]);case 37:case"end":return m.stop()}},t,this,[[3,19],[23,32]])}));function i(t,e,r){return o.apply(this,arguments)}return i})()},{key:"parseText",value:function(i,t){var e=this.hls.config.onPreM3U8Parse,r;try{var n;if(e&&(i=e(i)||i),r=Bi.parse(i,t,this._useLowLatency),((n=r)===null||n===void 0?void 0:n.live)===!1&&r.segments&&!r.segments.length)throw new Error("empty segments list")}catch(a){throw new ye(ie.MANIFEST,ie.SUB_TYPES.HLS,a)}return r&&(r.isMaster?this.hls.emit(le.HLS_MANIFEST_LOADED,{playlist:r}):this.hls.emit(le.HLS_LEVEL_LOADED,{playlist:r})),[r]}},{key:"poll",value:function(i,t,e,r,n,a){var u=this;clearTimeout(this._timer),a=a||3e3;var l=this.hls.config.pollRetryCount,c=(function(){var f=fe(z().mark(function h(){var d,v;return z().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return clearTimeout(u._timer),d=i,p.prev=2,u.deliveryDirectives&&(d=u.deliveryDirectives.addDirectives(i)),p.next=6,u.load(d,t,e);case 6:if(v=p.sent,v[0]){p.next=9;break}return p.abrupt("return");case 9:l=u.hls.config.pollRetryCount,r(v[0],v[1],v[2]),p.next=17;break;case 13:p.prev=13,p.t0=p.catch(2),l--,l<=0&&n(p.t0);case 17:u._timer=setTimeout(c,a);case 18:case"end":return p.stop()}},h,null,[[2,13]])}));return function(){return f.apply(this,arguments)}})();this._timer=setTimeout(c,a)}},{key:"stopPoll",value:function(){return clearTimeout(this._timer),this.cancel()}},{key:"cancel",value:function(){return Promise.all([this._loader.cancel(),this._audioLoader.cancel()])}}]),s})();function ro(s,o,i){return o>i&&(i=o),Math.min(Math.max(s,o),i)}var Hr=new $e("playlist"),Va=(function(){function s(o,i,t){De(this,s),A(this,"live",void 0),A(this,"id",0),A(this,"bitrate",0),A(this,"width",0),A(this,"height",0),A(this,"name",""),A(this,"url",""),A(this,"audioCodec",""),A(this,"videoCodec",""),A(this,"textCodec",""),A(this,"startCC",0),A(this,"endCC",0),A(this,"startSN",0),A(this,"endSN",-1),A(this,"totalDuration",0),A(this,"targetDuration",0),A(this,"partTargetDuration",0),A(this,"canSkipUntil",0),A(this,"canSkipDateRanges",!1),A(this,"skippedSegments",0),A(this,"canBlockReload",!1),A(this,"partHoldBack",0),A(this,"lowLatency",!1),A(this,"endPartIndex",0),A(this,"snDiff",null),A(this,"segments",[]),A(this,"audioStreams",[]),A(this,"subtitleStreams",[]),A(this,"closedCaptions",[]),A(this,"currentAudioStream",null),A(this,"currentSubtitleStream",null),this.update(this._setLLPlaybackPoint(o),i,t)}return Pe(s,[{key:"lastSegment",get:function(){return this.segments.length?this.segments[this.segments.length-1]:null}},{key:"segmentDuration",get:function(){var i;return this.targetDuration||((i=this.segments[0])===null||i===void 0?void 0:i.duration)||0}},{key:"liveEdge",get:function(){return this.endTime},set:function(i){this.endTime=i}},{key:"endTime",get:function(){var i;return((i=this.lastSegment)===null||i===void 0?void 0:i.end)||0},set:function(i){var t=this.lastSegment;t&&(t.duration=i-t.start)}},{key:"currentSubtitleEndSn",get:function(){var i;return((i=this.currentSubtitleStream)===null||i===void 0?void 0:i.endSN)||0}},{key:"clearOldSegment",value:function(i,t){return this.currentAudioStream&&this._clearSegments(i,t),this._clearSegments(i,t)}},{key:"getAudioSegment",value:function(i){if(!(!i||!this.currentAudioStream)){var t=i.sn-this.snDiff;return this.currentAudioStream.segments.find(function(e){return e.sn===t})}}},{key:"update",value:function(i,t){this.url=i.url,Array.isArray(i.segments)?((this.live===null||this.live===void 0)&&(this.live=i.live),this._updateSegments(i,this),this.startCC=i.startCC,this.endCC=i.endCC,this.startSN=i.startSN,this.endSN=i.endSN||-1,this.totalDuration=i.totalDuration,this.targetDuration=i.targetDuration,this.live=i.live,this.lowLatency=i.lowLatency,this.canBlockReload=i.canBlockReload,this.canSkipDateRanges=i.canSkipDateRanges,this.canSkipUntil=i.canSkipUntil,this.partHoldBack=i.partHoldBack,this.partTargetDuration=i.partTargetDuration,this.skippedSegments=i.skippedSegments,this.endPartIndex=i.endPartIndex,t&&this.currentAudioStream&&Array.isArray(t.segments)&&(this._updateSegments(t,this.currentAudioStream),(this.snDiff===null||this.snDiff===void 0)&&i.segments.length&&t.segments.length&&(this.snDiff=i.segments[0].sn-t.segments[0].sn))):(this.id=i.id,this.bitrate=i.bitrate,this.width=i.width,this.height=i.height,this.name=i.name,this.audioCodec=i.audioCodec,this.videoCodec=i.videoCodec,this.textCodec=i.textCodec,this.audioStreams=i.audioStreams,this.subtitleStreams=i.subtitleStreams,!this.currentAudioStream&&this.audioStreams.length&&(this.currentAudioStream=this.audioStreams.find(function(e){return e.default})||this.audioStreams[0]),!this.currentSubtitleStream&&this.subtitleStreams.length&&(this.currentSubtitleStream=this.subtitleStreams.find(function(e){return e.default})||this.subtitleStreams[0]))}},{key:"updateSubtitle",value:function(i){var t=this;if(i&&this.currentSubtitleStream&&Array.isArray(i.segments)){var e=this._updateSegments(i,this.currentSubtitleStream),r=this.currentSubtitleStream.segments;if(r.length>100&&(this.currentSubtitleStream.segments=r.slice(100)),!!e)return e.map(function(n){return{sn:n.sn,url:n.url,duration:n.duration,start:n.start,end:n.end,lang:t.currentSubtitleStream.lang}})}}},{key:"switchSubtitle",value:function(i){var t=this.subtitleStreams.find(function(r){return r.lang===i}),e=this.currentSubtitleStream;t&&(this.currentSubtitleStream=t,e.segments=[])}},{key:"_setLLPlaybackPoint",value:function(i){if(!i.lowLatency||!i.segments.length)return i;for(var t=i.totalDuration-i.partHoldBack,e=i.segments,r=0,n=0,a=e.length;n<a;n++)e[n].start<=t&&e[n].independent&&(r=n);var u=e.slice(r),l=0;return u.forEach(function(c){c.start=l,l=c.end}),i.segments=u,i.totalDuration=l,i.startSN=u[0].sn,i.startCC=u[0].cc,Hr.log("set ll-hls playback point: SN=".concat(i.startSN," partIndex=").concat(u[0].partIndex,", duration=").concat(l)),i}},{key:"_clearSegments",value:function(i,t){for(var e=0,r=this.segments,n=0,a=r.length;n<a;n++)if(r[n].end>=i){e=n;break}return e>t&&(e=t),e&&(this.segments=this.segments.slice(e),this.currentAudioStream&&(this.currentAudioStream.segments=this.currentAudioStream.segments.slice(e))),t-e}},{key:"_updateSegments",value:function(i,t){var e=t.segments;if(this.live){var r,n=i.lowLatency,a=e[e.length-1],u=(r=a==null?void 0:a.sn)!==null&&r!==void 0?r:-1,l=(a==null?void 0:a.partIndex)||0,c=u<i.endSN&&i.segments.length;if(n&&(c=c||l<i.endPartIndex),c){Hr.log("update segments: endSN:".concat(u,", partIndex:").concat(l," --> endSN:").concat(i.endSN,", partIndex:").concat(i.endPartIndex));var f=i.segments.findIndex(function(p){return p.sn===u&&p.partIndex===l}),h=f<0?i.segments:i.segments.slice(f+1);if(e.length&&h.length){var d=a.end,v=d;h.forEach(function(p){p.start=d,d=p.end}),Hr.log("liveEdge: ".concat(v," -> ").concat(d));var y=(a==null?void 0:a.cc)||-1;y>h[0].cc&&h.forEach(function(p){return p.cc+=y})}return t.endSN=i.endSN,t.segments=e.concat(h),h}}else t.segments=i.segments}}]),s})(),af=(function(){function s(o){De(this,s),A(this,"streams",[]),A(this,"currentStream",null),A(this,"dvrWindow",0),A(this,"_segmentPointer",-1),this.hls=o}return Pe(s,[{key:"lowLatency",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.lowLatency}},{key:"lastSegment",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.lastSegment}},{key:"currentSegment",get:function(){var i;return(i=this.currentSegments)===null||i===void 0?void 0:i[this._segmentPointer]}},{key:"nextSegment",get:function(){var i;return(i=this.currentSegments)===null||i===void 0?void 0:i[this._segmentPointer+1]}},{key:"currentSegments",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.segments}},{key:"currentSubtitleEndSn",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.currentSubtitleEndSn}},{key:"liveEdge",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.liveEdge},set:function(i){this.currentStream&&(this.currentStream.liveEdge=i)}},{key:"totalDuration",get:function(){var i;return((i=this.currentStream)===null||i===void 0?void 0:i.totalDuration)||0}},{key:"seekRange",get:function(){var i=this.currentSegments;if(!(!i||!i.length))return[i[0].start,i[i.length-1].end]}},{key:"nbSegments",get:function(){var i;return((i=this.currentSegments)===null||i===void 0?void 0:i.length)||0}},{key:"isEmpty",get:function(){var i;return!((i=this.currentSegments)!==null&&i!==void 0&&i.length)}},{key:"isLive",get:function(){var i;return(i=this.currentStream)===null||i===void 0?void 0:i.live}},{key:"hadSegmentLoaded",get:function(){return this._segmentPointer!==-1}},{key:"hasSubtitle",get:function(){var i;return!!((i=this.currentStream)!==null&&i!==void 0&&i.currentSubtitleStream)}},{key:"getAudioSegment",value:function(i){var t;return(t=this.currentStream)===null||t===void 0?void 0:t.getAudioSegment(i)}},{key:"moveSegmentPointer",value:function(i){var t;i==null&&(i=this._segmentPointer+1),this._segmentPointer=ro(i,-1,(t=this.currentSegments)===null||t===void 0?void 0:t.length)}},{key:"reset",value:function(){this.streams=[],this.currentStream=null,this.dvrWindow=0,this._segmentPointer=-1}},{key:"getSegmentByIndex",value:function(i){var t;return(t=this.currentSegments)===null||t===void 0?void 0:t[i]}},{key:"setNextSegmentByIndex",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this._segmentPointer=i-1}},{key:"setNextSegmentBySN",value:function(){var i,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=(i=this.currentSegments)===null||i===void 0?void 0:i.findIndex(function(r){return r.sn===t});return e!==-1&&this.setNextSegmentByIndex(e+1),e}},{key:"findSegmentIndexByTime",value:function(i){var t=this.currentSegments;if(t){for(var e=0,r=t.length,n;e<r;e++)if(n=t[e],i>=n.start&&i<n.end)return e;var a=t[t.length-1];if(Math.abs(i-(a==null?void 0:a.end))<.2)return t.length-1}}},{key:"upsertPlaylist",value:function(i,t,e){var r=this;if(i){if(i.isMaster)this.streams.length=i.streams.length,i.streams.filter(function(l){return l.url}).forEach(function(l,c){r.streams[c]?r.streams[c].update(l):r.streams[c]=new Va(l)}),this.currentStream=this.streams[0];else if(Array.isArray(i.segments)){var n=this.currentStream;if(n){n.update(i,t,e);var a=n.updateSubtitle(e);a&&this.hls.emit(le.SUBTITLE_SEGMENTS,{list:a})}else this.reset(),this.currentStream=this.streams[0]=new Va(i,t,e)}var u=this.currentStream;u&&this.hls.isLive&&!this.dvrWindow&&(this.dvrWindow=this.currentSegments.reduce(function(l,c){return l+=c.duration,l},0))}}},{key:"updateSegmentsRanges",value:function(i,t){var e,r=(e=this.currentSegments)===null||e===void 0?void 0:e.filter(function(n){return n.sn>=i});r.forEach(function(n){n.start=t,t=n.end})}},{key:"switchSubtitle",value:function(i){var t;(t=this.currentStream)===null||t===void 0||t.switchSubtitle(i)}},{key:"clearOldSegment",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.hls.config.maxPlaylistSize||50,t=this.currentStream;if(!(!this.dvrWindow||!t)){var e=t.endTime-this.dvrWindow;if(!(e<=0)){var r=t.segments;r.length<=i||(this._segmentPointer=t.clearOldSegment(e,this._segmentPointer))}}}},{key:"checkSegmentTrackChange",value:function(i,t){var e=this.findSegmentIndexByTime(i),r=this.getSegmentByIndex(e);if(r&&!(!r.hasAudio&&!r.hasVideo)){if(t!==2&&r.hasAudio&&r.hasVideo)return r;if(!(r.end-i>.3)){var n=this.getSegmentByIndex(e+1);if(n&&!(!n.hasAudio&&!n.hasVideo)&&(n.hasAudio!==r.hasAudio||n.hasVideo!==r.hasVideo))return n}}}},{key:"feedbackLiveEdge",value:function(i,t){var e,r=this.currentSegments;if(r){var n=((e=this.lastSegment)===null||e===void 0?void 0:e.sn)===i.sn;if(n){this.liveEdge=t;return}this.updateSegmentsRanges(i.sn+1,t)}}}]),s})(),sf=(function(){function s(o){var i=this;De(this,s),A(this,"error",null),A(this,"_emitOnLoaded",function(u,l){var c=u.data,f=u.response,h=u.options,d=h||{},v=d.firstByteTime,y=d.startTime,p=d.endTime,b=d.contentLength,k=p-y;i._bandwidthService.addRecord(b||c.byteLength,k),i.hls.emit(F.SPEED,{time:k,byteLength:b,url:l}),i.hls.emit(F.LOAD_COMPLETE,{url:l,elapsed:k||0}),i.hls.emit(F.TTFB,{url:l,responseUrl:f.url,elapsed:v-y}),i.hls.emit(F.LOAD_RESPONSE_HEADERS,{headers:f.headers,url:l})}),A(this,"_onLoaderRetry",function(u,l){i.hls.emit(F.LOAD_RETRY,{error:ye.network(u),retryTime:l})}),this.hls=o,this._bandwidthService=new Us,this._mapCache={},this._keyCache={};var t=this.hls.config,e=t.retryCount,r=t.retryDelay,n=t.loadTimeout,a=t.fetchOptions;this._segmentLoader=new Ut(de(de({},a),{},{responseType:"arraybuffer",retry:e,retryDelay:r,timeout:n,onRetryError:this._onLoaderRetry})),this._audioSegmentLoader=new Ut(de(de({},a),{},{responseType:"arraybuffer",retry:e,retryDelay:r,timeout:n,onRetryError:this._onLoaderRetry})),this._keyLoader=new Ut(de(de({},a),{},{responseType:"arraybuffer",retry:e,retryDelay:r,timeout:n,onRetryError:this._onLoaderRetry}))}return Pe(s,[{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed()}}},{key:"load",value:function(i,t,e){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:e,n=[];return i&&(n[0]=this.loadVideoSegment(i,e)),t&&(n[1]=this.loadAudioSegment(t,r)),Promise.all(n)}},{key:"loadVideoSegment",value:function(i,t){return this._loadSegment(this._segmentLoader,i,t)}},{key:"loadAudioSegment",value:function(i,t){return this._loadSegment(this._audioSegmentLoader,i,t)}},{key:"_loadSegment",value:(function(){var o=fe(z().mark(function t(e,r,n){var a=this,u,l,c,f,h,d,v,y,p,b,k,E,w,T,L;return z().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return v=[],this.hls.emit(F.LOAD_START,{url:r.url}),v[0]=e.load(r.url),n&&r.initSegment&&(p=r.initSegment.url,l=this._mapCache[p],l||(this.hls.emit(F.LOAD_START,{url:p}),v[1]=e.load(p).then(function(x){if(x){var U=Object.keys(a._mapCache);U>30&&(a._mapCache={}),l=a._mapCache[p]=x.data,a._emitOnLoaded(x,p)}})),b=(y=r.initSegment.key)===null||y===void 0?void 0:y.url,b&&(d=r.initSegment.key.iv,h=this._keyCache[b],h||(this.hls.emit(F.LOAD_START,{url:b}),v[2]=this._keyLoader.load(b).then(function(x){x&&(h=a._keyCache[b]=x.data,a._emitOnLoaded(x,b))})))),k=(u=r.key)===null||u===void 0?void 0:u.url,k&&r.key.isSegmentEncrypted()&&(f=r.key.iv,c=this._keyCache[k],c||(this.hls.emit(F.LOAD_START,{url:k}),v[3]=this._keyLoader.load(k).then(function(x){x&&(c=a._keyCache[k]=x.data,a._emitOnLoaded(x,k))}))),B.next=8,Promise.all(v);case 8:if(E=B.sent,w=St(E,1),T=w[0],T){B.next=13;break}return B.abrupt("return");case 13:return L=T.data,this._emitOnLoaded(T,r.url),B.abrupt("return",{data:L,map:l,key:c,mapKey:h,keyIv:f,mapKeyIv:d});case 16:case"end":return B.stop()}},t,this)}));function i(t,e,r){return o.apply(this,arguments)}return i})()},{key:"reset",value:function(){this.error=null,this._mapCache={},this._keyCache={},this._bandwidthService.reset()}},{key:"cancel",value:(function(){var o=fe(z().mark(function t(){return z().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Promise.all([this._keyLoader.cancel(),this._segmentLoader.cancel(),this._audioSegmentLoader.cancel()]);case 2:case"end":return r.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i})()}]),s})(),Be=new $e("hls"),oi=(function(s){or(i,s);var o=ur(i);function i(t){var e;return De(this,i),e=o.call(this),A(ae(e),"version",i.version),A(ae(e),"media",null),A(ae(e),"config",null),A(ae(e),"_manifestLoader",null),A(ae(e),"_segmentLoader",null),A(ae(e),"_playlist",null),A(ae(e),"_bufferService",null),A(ae(e),"_gapService",null),A(ae(e),"_seiService",null),A(ae(e),"_stats",null),A(ae(e),"_prevSegSn",null),A(ae(e),"_prevSegCc",null),A(ae(e),"_tickTimer",null),A(ae(e),"_tickInterval",500),A(ae(e),"_segmentProcessing",!1),A(ae(e),"_reloadOnPlay",!1),A(ae(e),"_switchUrlOpts",null),A(ae(e),"_isProcessQuotaExceeded",!1),A(ae(e),"_loadSegment",fe(z().mark(function r(){var n,a,u,l,c,f,h,d,v;return z().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!(e._segmentProcessing||!e.media)){p.next=2;break}return p.abrupt("return");case 2:if(n=e._playlist,a=n.nextSegment,u=n.lastSegment,l=ae(e),c=l.config,f=.016,h=Math.min(Math.max((u==null?void 0:u.duration)-f/2||0,f),.1),a){p.next=8;break}return p.abrupt("return");case 8:if(e.isLive){p.next=18;break}if(d=e.bufferInfo(),e.media.paused&&!e.media.currentTime&&(d=e.bufferInfo(d.nextStart||.5)),v=Math.abs(d.end-e.media.duration)<h,!(d.remaining>=c.preloadTime||v)){p.next=15;break}return e._tryEos(),p.abrupt("return");case 15:if(!(c.preferMMSStreaming&&!e._bufferService.msStreaming)){p.next=17;break}return p.abrupt("return");case 17:!e._urlSwitching&&e._prevSegSn!==a.sn-1&&d.end&&Math.abs(a.start-d.end)>1&&e._playlist.setNextSegmentByIndex(e._playlist.findSegmentIndexByTime(d.end+.1));case 18:return p.abrupt("return",e._loadSegmentDirect());case 19:case"end":return p.stop()}},r)}))),A(ae(e),"_onLoadeddata",function(){e.isLive&&!e.config.mseLowLatency&&e.media.duration!==1/0&&e._bufferService.updateDuration(1/0).catch(function(r){})}),A(ae(e),"_onPlay",fe(z().mark(function r(){return z().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!(e.media.seeking&&e.media.currentTime===0)){a.next=3;break}return Be.debug("replay currentTime 0, return"),a.abrupt("return");case 3:if(clearTimeout(e._disconnectTimer),!e._reloadOnPlay){a.next=9;break}e._reloadOnPlay=!1,e.replay(!0),a.next=12;break;case 9:return a.next=11,e._loadSegment();case 11:e._startTick();case 12:case"end":return a.stop()}},r)}))),A(ae(e),"_onPause",function(){if(e.isLive){if(!e._reloadOnPlay){var r=e.config.disconnectTime;if(r==null&&(r=e._playlist.dvrWindow),!Number.isFinite(r))return;clearTimeout(e._disconnectTimer),e._disconnectTimer=setTimeout(function(){e._reloadOnPlay=!0,e._clear()},r||0)}}else e._stopTick()}),A(ae(e),"_onSeeking",fe(z().mark(function r(){var n,a,u,l,c,f,h;return z().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(e.media){v.next=2;break}return v.abrupt("return");case 2:if(e._onCheckQuotaExceeded(),n=e.media.currentTime,a=e._playlist.seekRange,!a){v.next=10;break}if(u=ro(n,a[0],e.isLive?a[1]:e.media.duration),!(u>=0&&Math.abs(n-u)>=.1)){v.next=10;break}return e.media.currentTime=u,v.abrupt("return");case 10:if(l=e._playlist.currentSegment,c=Ce.info(Ce.get(e.media),n,.1),!l){v.next=17;break}if(!(c.end&&Math.abs(c.end-l.end)<.2)){v.next=15;break}return v.abrupt("return");case 15:if(!(e.isLive&&c.end)){v.next=17;break}return v.abrupt("return");case 17:if(f=e._playlist.findSegmentIndexByTime(n),h=e._playlist.getSegmentByIndex(f),!(f==null||!h||e._segmentProcessing&&h===e._playlist.nextSegment)){v.next=21;break}return v.abrupt("return");case 21:return Be.debug("seek to",n,h),e._playlist.setNextSegmentByIndex(f),e._stopTick(),v.next=26,e._segmentLoader.cancel();case 26:if(e._segmentProcessing=!1,!(!c.end||e.isLive)){v.next=30;break}return v.next=30,e._loadSegmentDirect(!0);case 30:e._startTick();case 31:case"end":return v.stop()}},r)}))),A(ae(e),"_onTimeupdate",function(){if(e.media){var r=e.config;if(r.isLive&&r.maxLatency&&r.targetLatency){var n=e._playlist.liveEdge;if(!n)return;var a=n-e.media.currentTime;a>=r.maxLatency&&(Be.debug("latency jump, currentTime:".concat(e.media.currentTime,", liveEdge:").concat(n,",  latency=").concat(a)),e.media.currentTime=n-r.targetLatency)}if(r.seiInTime){var u;(u=e._seiService)===null||u===void 0||u.throw(e.media.currentTime)}r.allowedStreamTrackChange&&!r.softDecode&&e.media.readyState&&e._checkStreamTrackChange(e.media.currentTime)}}),A(ae(e),"_tick",function(){if(e.media){e._startTick();var r=e.media,n=e._segmentLoader.error;if(e._onCheckQuotaExceeded(),e._isProcessQuotaExceeded&&(e._bufferService.isFull()||(e._isProcessQuotaExceeded=!1,e._segmentProcessing=!1)),n){var a=.5;(!r.readyState||e.bufferInfo(a).remaining<1)&&(n.fatal=!0,e._emitError(ye.network(n)));return}r.readyState&&(Ms(r)?(e._loadSegment(),e._gapService&&e._gapService.do(r,e.config.maxJumpDistance,e.isLive)):r.readyState<2&&e._gapService&&e._gapService.do(r,e.config.maxJumpDistance,r.currentTime?e.isLive:!0)),e.isLive||e._tryEos()}}),e.config=t=Hc(t),e.media=e.config.media,e._manifestLoader=new nf(ae(e)),e._segmentLoader=new sf(ae(e)),e._playlist=new af(ae(e)),e._bufferService=new Uc(ae(e)),t.seiInTime&&(e._seiService=new Bs(ae(e))),t.softDecode||(e._gapService=new Fs),e._stats=new Hs(ae(e),9e4),e.media.addEventListener("loadeddata",e._onLoadeddata),e.media.addEventListener("play",e._onPlay),e.media.addEventListener("pause",e._onPause),e.media.addEventListener("seeking",e._onSeeking),e.media.addEventListener("timeupdate",e._onTimeupdate),e}return Pe(i,[{key:"isLive",get:function(){return this._playlist.isLive}},{key:"streams",get:function(){return this._playlist.streams}},{key:"currentStream",get:function(){return this._playlist.currentStream}},{key:"hasSubtitle",get:function(){return this._playlist.hasSubtitle}},{key:"totalDuration",get:function(){return this._playlist.totalDuration}},{key:"baseDts",get:function(){var e;return(e=this._bufferService)===null||e===void 0?void 0:e.baseDts}},{key:"abrSwitchPoint",get:function(){var e=this._urlSwitching?this._playlist.currentSegment:this._playlist.nextSegment;return e?e.start+e.duration/2:null}},{key:"speedInfo",value:function(){return this._segmentLoader.speedInfo()}},{key:"bufferInfo",value:function(){var e,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:.1;return Ce.info(Ce.get(this.media),(e=this.media)===null||e===void 0?void 0:e.currentTime,r)}},{key:"getStats",value:function(){return this._stats.getStats()}},{key:"playbackQuality",value:function(){return Ns(this.media)}},{key:"load",value:(function(){var t=fe(z().mark(function r(){var n,a,u,l=arguments;return z().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return n=l.length>0&&l[0]!==void 0?l[0]:"",a=l.length>1&&l[1]!==void 0?l[1]:{},u=typeof a=="boolean"?a:!!(a!=null&&a.reuseMse),gi(a)==="object"&&a!==null&&a!==void 0&&a.clearSwitchStatus&&(this._urlSwitching=!1,this._switchUrlOpts=null,this.config.startTime=void 0),n&&(this.config.url=n),n=this.config.url,f.next=8,this._reset(u);case 8:return f.next=10,this._loadData(n);case 10:this._startTick();case 11:case"end":return f.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e})()},{key:"_loadData",value:(function(){var t=fe(z().mark(function r(n){var a,u,l,c,f,h,d,v,y,p,b,k,E;return z().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:try{n&&(n=n.trim())}catch{}if(n){T.next=3;break}throw this._emitError(new ye(ie.OTHER,ie.SUB_TYPES.OPTION,null,null,"m3u8 url is missing"));case 3:return T.next=5,this._loadM3U8(n);case 5:if(a=T.sent,u=this._playlist.currentStream,!this._urlSwitching){T.next=23;break}if(!this.isLive){T.next=14;break}l=this._playlist.setNextSegmentBySN(this._prevSegSn),Be.log("segment nb=".concat(this._prevSegSn," index of ").concat(l," in the new playlist")),l===-1&&(this._prevSegCc=null,this._prevSegSn=null),T.next=23;break;case 14:if(u.bitrate===0&&(c=this._switchUrlOpts)!==null&&c!==void 0&&c.bitrate&&(u.bitrate=(d=this._switchUrlOpts)===null||d===void 0?void 0:d.bitrate),v=typeof((f=this._switchUrlOpts)===null||f===void 0?void 0:f.startTime)=="number"?(h=this._switchUrlOpts)===null||h===void 0?void 0:h.startTime:this._getSeamlessSwitchPoint(),this.config.startTime=v,y=this._playlist.findSegmentIndexByTime(v),p=this._playlist.getSegmentByIndex(y+1),!p){T.next=23;break}return b=p.start,T.next=23,this._bufferService.removeBuffer(b);case 23:if(a){T.next=25;break}return T.abrupt("return");case 25:if(!this.isLive){T.next=36;break}if(this._bufferService.setLiveSeekableRange(0,4294967295),Be.log("totalDuration first time got:",this._playlist.totalDuration),Be.log("nb segments got:",this._playlist.nbSegments),this.config.targetLatency<this._playlist.totalDuration&&(this.config.targetLatency=this._playlist.totalDuration,this.config.maxLatency=1.5*this.config.targetLatency),a.isMaster||this._pollM3U8(n),!(this._playlist.nbSegments<this.config.minSegmentsStartPlay)){T.next=33;break}return T.abrupt("return");case 33:return T.next=35,this._loadSegment();case 35:return T.abrupt("return");case 36:return T.next=38,this._bufferService.updateDuration(u.totalDuration);case 38:return k=this.config.startTime,k&&((E=this._switchUrlOpts)!==null&&E!==void 0&&E.seamless||(this.media.currentTime=k),this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(k)||0)),T.next=42,this._loadSegment();case 42:case"end":return T.stop()}},r,this)}));function e(r){return t.apply(this,arguments)}return e})()},{key:"replay",value:(function(){var t=fe(z().mark(function r(n){return z().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.config.startTime=0,this._urlSwitching=!1,this._switchUrlOpts=null,u.next=5,this.load();case 5:return this._reloadOnPlay=!1,u.abrupt("return",this.media.play(!n));case 7:case"end":return u.stop()}},r,this)}));function e(r){return t.apply(this,arguments)}return e})()},{key:"switchURL",value:(function(){var t=fe(z().mark(function r(n){var a,u,l,c,f,h,d,v=arguments;return z().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:a=v.length>1&&v[1]!==void 0?v[1]:{},u={seamless:!1,startTime:0,bitrate:0},p.t0=gi(a),p.next=p.t0==="number"?5:p.t0==="boolean"?7:p.t0==="object"?9:11;break;case 5:return a={startTime:a},p.abrupt("break",12);case 7:return a={seamless:a},p.abrupt("break",12);case 9:for(l in a)(a[l]===void 0||a[l]===null)&&delete a[l];return p.abrupt("break",12);case 11:throw"unsupported switchURL args: ".concat(a);case 12:if(a=Object.assign({},u,a),c=a,f=c.seamless,h=c.startTime,this.config.url=n,this.config.startTime=h,this._switchUrlOpts=a,f){p.next=38;break}if(p.prev=18,!this.config.softDecode){p.next=23;break}p.t1=this.load(n),p.next=26;break;case 23:return p.next=25,this.load(n);case 25:p.t1=p.sent;case 26:d=p.t1,p.next=33;break;case 29:throw p.prev=29,p.t2=p.catch(18),this.emit(le.SWITCH_URL_FAILED,p.t2),p.t2;case 33:return this._reloadOnPlay=!1,d&&this.emit(le.SWITCH_URL_SUCCESS,{url:n}),p.abrupt("return",this.media.play(!0));case 38:return this._urlSwitching=!0,this.isLive||(this._prevSegSn=null,this._prevSegCc=null),this._playlist.reset(),this._bufferService.seamlessSwitch(),p.next=44,this._clear();case 44:return p.next=46,this._loadData(n);case 46:this._startTick();case 47:this._switchUrlOpts=null;case 48:case"end":return p.stop()}},r,this,[[18,29]])}));function e(r){return t.apply(this,arguments)}return e})()},{key:"switchStream",value:(function(){var t=fe(z().mark(function r(n){var a,u,l,c,f,h=arguments;return z().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(a=h.length>1&&h[1]!==void 0?h[1]:!0,u=this.currentStream,l=this.streams,!(!u||u.id===n||!l||l.length<2)){v.next=5;break}return v.abrupt("return");case 5:if(c=l.find(function(y){return y.id===n}),c){v.next=8;break}return v.abrupt("return");case 8:return v.prev=8,v.next=11,this._clear();case 11:if(!a){v.next=14;break}return v.next=14,this._bufferService.clearAllBuffer();case 14:v.next=19;break;case 16:throw v.prev=16,v.t0=v.catch(8),this._emitError(ye.create(v.t0));case 19:if(u.currentAudioStream&&c.audioStreams.length>2&&(f=u.currentAudioStream.id,c.currentAudioStream=c.audioStreams.find(function(y){return y.id===f})||c.currentAudioStream),this._playlist.currentStream=c,v.prev=21,!(this.isLive||!c.segments.length)){v.next=25;break}return v.next=25,this._refreshM3U8();case 25:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,v.next=29,this._loadSegmentDirect();case 29:v.next=35;break;case 31:throw v.prev=31,v.t1=v.catch(21),this._playlist.currentStream=u,v.t1;case 35:return this._startTick(),v.abrupt("return",c);case 37:case"end":return v.stop()}},r,this,[[8,16],[21,31]])}));function e(r){return t.apply(this,arguments)}return e})()},{key:"switchAudioStream",value:(function(){var t=fe(z().mark(function r(n){var a,u,l,c,f=arguments;return z().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(a=f.length>1&&f[1]!==void 0?f[1]:!0,u=this.currentStream,u){d.next=4;break}return d.abrupt("return");case 4:if(l=u.currentAudioStream,!(!l||l.id===n||u.audioStreams.length<2)){d.next=7;break}return d.abrupt("return");case 7:if(c=u.audioStreams.find(function(v){return v.id===n}),c){d.next=10;break}return d.abrupt("return");case 10:return d.prev=10,d.next=13,this._clear();case 13:if(!a){d.next=16;break}return d.next=16,this._bufferService.clearAllBuffer();case 16:d.next=21;break;case 18:throw d.prev=18,d.t0=d.catch(10),this._emitError(ye.create(d.t0));case 21:if(u.currentAudioStream=c,d.prev=22,!(this.isLive||!c.segments.length)){d.next=26;break}return d.next=26,this._refreshM3U8();case 26:return this._playlist.setNextSegmentByIndex(this._playlist.findSegmentIndexByTime(this.media.currentTime)||0),this._prevSegCc=null,d.next=30,this._loadSegmentDirect();case 30:d.next=36;break;case 32:throw d.prev=32,d.t1=d.catch(22),u.currentAudioStream=l,d.t1;case 36:return this._startTick(),d.abrupt("return",c);case 38:case"end":return d.stop()}},r,this,[[10,18],[22,32]])}));function e(r){return t.apply(this,arguments)}return e})()},{key:"switchSubtitleStream",value:(function(){var t=fe(z().mark(function r(n){return z().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this._playlist.switchSubtitle(n),u.next=3,this._manifestLoader.stopPoll();case 3:return u.next=5,this._refreshM3U8();case 5:case"end":return u.stop()}},r,this)}));function e(r){return t.apply(this,arguments)}return e})()},{key:"detachMedia",value:(function(){var t=fe(z().mark(function r(){return z().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!this._bufferService){a.next=3;break}return a.next=3,this._bufferService.detachMedia();case 3:case"end":return a.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e})()},{key:"destroy",value:(function(){var t=fe(z().mark(function r(){var n;return z().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.media){u.next=2;break}return u.abrupt("return");case 2:return this.removeAllListeners(),this._playlist.reset(),this._segmentLoader.reset(),(n=this._seiService)===null||n===void 0||n.reset(),this.media.removeEventListener("loadeddata",this._onLoadeddata),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("pause",this._onPause),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),u.next=13,Promise.all([this._clear(),this._bufferService.destroy()]);case 13:this.media=null;case 14:case"end":return u.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e})()},{key:"_loadM3U8",value:(function(){var t=fe(z().mark(function r(n){var a,u,l,c,f,h,d;return z().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(y.prev=0,c=(u=this.config.manifestList)===null||u===void 0||(l=u.filter(function(p){return p.url===n})[0])===null||l===void 0?void 0:l.manifest,!c){y.next=6;break}y.t0=this._manifestLoader.parseText(c,n),y.next=9;break;case 6:return y.next=8,this._manifestLoader.load(n);case 8:y.t0=y.sent;case 9:f=y.t0,h=St(f,1),a=h[0],y.next=17;break;case 14:throw y.prev=14,y.t1=y.catch(0),this._emitError(ye.create(y.t1));case 17:if(a){y.next=19;break}return y.abrupt("return");case 19:if(this._playlist.upsertPlaylist(a),!a.isMaster){y.next=24;break}return(d=this._playlist.currentStream.subtitleStreams)!==null&&d!==void 0&&d.length&&this.emit(le.SUBTITLE_PLAYLIST,{list:this._playlist.currentStream.subtitleStreams}),y.next=24,this._refreshM3U8();case 24:return this.emit(le.STREAM_PARSED),y.abrupt("return",a);case 26:case"end":return y.stop()}},r,this,[[0,14]])}));function e(r){return t.apply(this,arguments)}return e})()},{key:"_refreshM3U8",value:function(){var e,r,n=this,a=this._playlist.currentStream;if(!a||!a.url)throw this._emitError(ye.create(null,null,new Error("m3u8 url is not defined")));var u=a.url,l=(e=a.currentAudioStream)===null||e===void 0?void 0:e.url,c=(r=a.currentSubtitleStream)===null||r===void 0?void 0:r.url;return this._manifestLoader.load(u,l,c).then(function(f){var h=St(f,3),d=h[0],v=h[1],y=h[2];d&&(n._playlist.upsertPlaylist(d,v,y),n.isLive&&n._pollM3U8(u,l,c))}).catch(function(f){throw n._emitError(ye.create(f))})}},{key:"_pollM3U8",value:function(e,r,n){var a=this,u=this._playlist.isEmpty,l;if(this._playlist.lowLatency)l=(this._playlist.currentStream.partTargetDuration||0)*1e3;else{var c;l=(((c=this._playlist.lastSegment)===null||c===void 0?void 0:c.duration)||0)*1e3}this._manifestLoader.poll(e,r,n,function(f,h,d){a._playlist.upsertPlaylist(f,h,d),a._playlist.clearOldSegment();var v=f&&u&&!a._playlist.isEmpty;(v||!a._playlist.hadSegmentLoaded&&a._playlist.nbSegments>=a.config.minSegmentsStartPlay)&&a._loadSegment(),u&&(u=a._playlist.isEmpty)},function(f){a._emitError(ye.create(f))},l)}},{key:"_loadSegmentDirect",value:(function(){var t=fe(z().mark(function r(n){var a,u,l,c,f,h;return z().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(a=this._playlist.nextSegment,a){v.next=3;break}return v.abrupt("return");case 3:return u=!1,l=null,v.prev=5,this._segmentProcessing=!0,Be.log("load segment, sn:".concat(a.sn,", [").concat(a.start,", ").concat(a.end,"], partIndex:").concat(a.partIndex)),v.next=10,this._reqAndBufferSegment(a,this._playlist.getAudioSegment(a));case 10:u=v.sent,v.next=16;break;case 13:v.prev=13,v.t0=v.catch(5),l=v.t0;case 16:return v.prev=16,this._segmentProcessing=!1,v.finish(16);case 19:if(!l){v.next=26;break}if(!this._bufferService.isFull()){v.next=25;break}return Be.log("load segment, sn:".concat(a.sn,", partIndex:").concat(a.partIndex)),this._segmentProcessing=!0,this._isProcessQuotaExceeded=!0,v.abrupt("return",!1);case 25:return v.abrupt("return",this._emitError(ye.create(l)));case 26:return u&&(f=this.bufferInfo().end,this.isLive&&!this.media.seeking&&f&&Math.abs(a.end-f)>1&&(Be.warn("segment: ".concat(a.sn," expected end=").concat(a.end,", real end=").concat(f)),this._playlist.feedbackLiveEdge(a,f)),h=((c=this._playlist.currentStream)===null||c===void 0?void 0:c.url)===a.parentUrl,this._urlSwitching&&!h&&(Be.warn("pre playlist segment appended!"),this._bufferService.seamlessSwitch()),this.isLive&&this._urlSwitching&&h&&(this._urlSwitching=!1,this.emit(le.SWITCH_URL_SUCCESS,{url:this.config.url})),this._playlist.moveSegmentPointer(),a.isLast?this._end():n||this._loadSegment()),v.abrupt("return",u);case 28:case"end":return v.stop()}},r,this,[[5,13,16,19]])}));function e(r){return t.apply(this,arguments)}return e})()},{key:"_reqAndBufferSegment",value:(function(){var t=fe(z().mark(function r(n,a){var u,l,c,f,h,d,v,y,p,b,k;return z().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return l=n?n.cc:a.cc,c=this._prevSegCc!==l,f=[],w.prev=3,w.next=6,this._segmentLoader.load(n,a,c);case 6:f=w.sent,w.next=14;break;case 9:throw w.prev=9,w.t0=w.catch(3),w.t0.fatal=!1,this._segmentLoader.error=w.t0,w.t0;case 14:if(f[0]){w.next=16;break}return w.abrupt("return");case 16:return w.next=18,(u=this._bufferService).decryptBuffer.apply(u,wl(f));case 18:if(h=w.sent,h){w.next=21;break}return w.abrupt("return");case 21:return d=n?n.sn:a.sn,v=n?n.start:a.start,y=this._playlist.currentStream,this._bufferService.createSource(h[0],h[1],y==null?void 0:y.videoCodec,y==null?void 0:y.audioCodec),p=Date.now(),b=this._prevSegSn===d-1,this.isLive&&this._urlSwitching&&(k=this.bufferInfo().end,this._playlist.updateSegmentsRanges(d,k),Be.warn("update the new playlist liveEdge, segment id=".concat(d,", buffer start=").concat(k,", liveEdge=").concat(this._playlist.liveEdge)),v=k),w.next=30,this._bufferService.appendBuffer(n,a,h[0],h[1],c,b,v);case 30:return this.emit(le.APPEND_COST,{elapsed:Date.now()-p,url:n.url}),w.next=33,this._bufferService.evictBuffer(this.config.bufferBehind);case 33:return this._prevSegCc=l,this._prevSegSn=d,w.abrupt("return",!0);case 36:case"end":return w.stop()}},r,this,[[3,9]])}));function e(r,n){return t.apply(this,arguments)}return e})()},{key:"_onCheckQuotaExceeded",value:(function(){var t=fe(z().mark(function r(){var n,a,u,l,c,f;return z().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:n=this.media.currentTime,a=this.media.buffered,u=!1,l=0;case 4:if(!(l<a.length)){d.next=11;break}if(!(a.start(0)>=n&&n<a.end(l))){d.next=8;break}return u=!0,d.abrupt("break",11);case 8:l++,d.next=4;break;case 11:if(!this._bufferService.isFull()){d.next=17;break}if(c=u?this.config.bufferBehind:5,f=this.media.currentTime,!(f-c>0)){d.next=17;break}return d.next=17,this._bufferService.removeBuffer(0,f-c);case 17:case"end":return d.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e})()},{key:"_checkStreamTrackChange",value:function(e){var r=this._playlist.checkSegmentTrackChange(e,this._bufferService.nbSb);r&&this.switchURL(this.config.url,r.start+.2)}},{key:"_clear",value:(function(){var t=fe(z().mark(function r(){return z().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return clearTimeout(this._disconnectTimer),this._stopTick(),a.next=4,Promise.all([this._segmentLoader.cancel(),this._manifestLoader.stopPoll()]);case 4:this._segmentProcessing=!1;case 5:case"end":return a.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e})()},{key:"_reset",value:(function(){var t=fe(z().mark(function r(){var n,a,u=arguments;return z().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=u.length>0&&u[0]!==void 0?u[0]:!1,this._reloadOnPlay=!1,this._prevSegSn=null,this._prevSegCc=null,this._switchUrlOpts=null,this._playlist.reset(),this._segmentLoader.reset(),(n=this._seiService)===null||n===void 0||n.reset(),this._stats.reset(),c.next=11,this._clear();case 11:return c.abrupt("return",this._bufferService.reset(a));case 12:case"end":return c.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e})()},{key:"_end",value:function(){this._clear(),this._bufferService.endOfStream(),(this.media.readyState<=2||this.media.buffered.length>1)&&this._startTick()}},{key:"_stopTick",value:function(){this._tickTimer&&clearTimeout(this._tickTimer),this._tickTimer=null}},{key:"_startTick",value:function(){this._stopTick(),this._tickTimer=setTimeout(this._tick,this._tickInterval)}},{key:"_emitError",value:function(e){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(((r=e.originError)===null||r===void 0?void 0:r.fatal)===!1)Be.warn(e);else{var a,u,l;Be.table(e),Be.error(e),Be.error((a=this.media)===null||a===void 0?void 0:a.error),(u=this.media)!==null&&u!==void 0&&u.readyState&&this.media.pause(),this._stopTick(),this._urlSwitching&&(this._urlSwitching=!1,this.emit(le.SWITCH_URL_FAILED,e)),this.emit(le.ERROR,e),n&&this._end(),(l=this._seiService)===null||l===void 0||l.reset()}return e}},{key:"_getSeamlessSwitchPoint",value:function(){var e=this.media,r=e.currentTime;if(!e.paused){var n,a=this._playlist.findSegmentIndexByTime(e.currentTime),u=this._playlist.getSegmentByIndex(a),l=(n=this._stats)===null||n===void 0?void 0:n.getStats().downloadSpeed;if(l&&u){var c=u.duration*this._playlist.currentStream.bitrate/l+1;r+=c}else r+=5}return r}},{key:"_tryEos",value:function(){var e,r,n=this.media,a=this._playlist,u=a.nextSegment,l=a.lastSegment,c=(!u||l&&Ce.isBuffered(n,l.start+l.duration/2))&&n.readyState&&n.duration>0&&((e=this._bufferService)===null||e===void 0?void 0:e.msIsOpened)&&!((r=this._bufferService)!==null&&r!==void 0&&r.msHasOpTasks);if(c){var f=this.bufferInfo();n.paused&&!n.currentTime&&(f=this.bufferInfo(f.nextStart||.5));var h=Math.abs(f.end-n.duration)<.1||!this.isLive&&l&&f.end>=l.start+l.duration;h&&this._bufferService.endOfStream()}}}],[{key:"isSupported",value:function(e){return!e||e==="video"||e==="audio"?Ie.isSupported():typeof WebAssembly<"u"}},{key:"enableLogger",value:function(){$e.enable(),Gt.enable()}},{key:"disableLogger",value:function(){$e.disable(),Gt.disable()}}]),i})(jt);A(oi,"version","3.0.23");try{localStorage.getItem("xgd")?oi.enableLogger():oi.disableLogger()}catch{}var of=(function(){function s(o,i){var t=this;De(this,s),A(this,"_opts",null),A(this,"_plugin",null),A(this,"_onLowDecode",function(){var e,r,n,a,u=t._opts,l=u.media,c=u.innerDegrade;(e=t._plugin)===null||e===void 0||(r=e.player)===null||r===void 0||r.emit("lowdecode",l.degradeInfo),(n=t._plugin)===null||n===void 0||(a=n.player)===null||a===void 0||a.emit("core_event",de(de({},l.degradeInfo),{},{eventName:le.LOWDECODE})),c===1&&t._degrade(l.src)}),A(this,"_degrade",function(e){var r=t._plugin.player,n=r.video;if(!(n&&n.TAG!=="MVideo")){var a=r.video.degradeVideo;r.video=a,n.degrade(e),e&&(r.config.url=e);var u=r.root.firstChild;u.TAG==="MVideo"&&r.root.replaceChild(a,u);var l=t._plugin.constructor.pluginName.toLowerCase();r.unRegisterPlugin(l),r.once("canplay",function(){r.play()})}}),A(this,"forceDegradeToVideo",function(e){var r=t._opts.innerDegrade;r===1&&t._degrade(e)}),this._opts=o,this._plugin=i,this._init()}return Pe(s,[{key:"_init",value:function(){var i=this._opts,t=i.media,e=i.preloadTime,r=i.innerDegrade,n=i.isLive;if(t){if(!n&&t.setPlayMode){t.setPlayMode("VOD");return}r&&t.setAttribute("innerdegrade",r),e&&t.setAttribute("preloadtime",e),this._bindEvents()}}},{key:"_bindEvents",value:function(){var i=this._opts.media;i.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var i,t;(i=this._opts)===null||i===void 0||(t=i.media)===null||t===void 0||t.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),s})(),uf=["currentTime"];function lf(s,o){var i=o.player,t=i.currentTime,e={startTime:t};switch(gi(s)){case"boolean":e.seamless=s;break;case"object":{var r=s.currentTime,n=qr(s,uf);Object.assign(e,n),typeof r=="number"&&(e.startTime=r);break}}return e}var Ln=(function(s){or(i,s);var o=ur(i);function i(){var t;De(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),A(ae(t),"logger",Be),A(ae(t),"hls",null),A(ae(t),"pluginExtension",null),A(ae(t),"getStats",function(){var a;return(a=t.hls)===null||a===void 0?void 0:a.getStats()}),A(ae(t),"_onSwitchSubtitle",function(a){var u,l=a.lang;(u=t.hls)===null||u===void 0||u.switchSubtitleStream(l)}),A(ae(t),"_keepPauseStatus",function(){var a=t.player.paused;a&&t.player.once("canplay",function(){t.player.pause()})}),t}return Pe(i,[{key:"core",get:function(){return this.hls}},{key:"version",get:function(){var e;return(e=this.hls)===null||e===void 0?void 0:e.version}},{key:"softDecode",get:function(){var e,r,n=(e=this.player)===null||e===void 0||(r=e.config)===null||r===void 0?void 0:r.mediaType;return!!n&&n!=="video"&&n!=="audio"&&n!=="offscreen-video"}},{key:"beforePlayerInit",value:function(){var e=this,r=this.player.config,n=this.player.media||this.player.video,a=r.hls||{};if(!(!r.url&&!r.__allowHlsEmptyUrl__||!this.softDecode&&!a.preferMMS&&Ie.isMMSOnly())){this.hls&&this.hls.destroy();var u=Object.getOwnPropertyDescriptor(this.player,"switchURL");(!u||u.writable)&&(this.player.switchURL=function(f,h){return new Promise(function(d,v){var y=e.player,p=e.hls;if(p){var b,k,E=lf(h,e);y.config.url=f,p.switchURL(f,E).then(function(){return d(!0)}).catch(v),!E.seamless&&(b=e.player.config)!==null&&b!==void 0&&(k=b.hls)!==null&&k!==void 0&&k.keepStatusAfterSwitch&&e._keepPauseStatus()}else v()})});var l=this.player.switchURL;if(this.player.handleSource=!1,a.innerDegrade=a.innerDegrade||r.innerDegrade,(a.disconnectTime===null||a.disconnectTime===void 0)&&(a.disconnectTime=0),this.hls=new oi(de({softDecode:this.softDecode,isLive:r.isLive,media:n,startTime:r.startTime,url:r.url},a)),this.softDecode||tt.defineGetterOrSetter(this.player,{url:{get:function(){var h,d;return(h=e.hls)===null||h===void 0||(d=h.media)===null||d===void 0?void 0:d.src},configurable:!0}}),this.softDecode&&(this.pluginExtension=new of(de({isLive:r.isLive,media:n},a),this),this.player.forceDegradeToVideo=function(){for(var f,h=arguments.length,d=new Array(h),v=0;v<h;v++)d[v]=arguments[v];return(f=e.pluginExtension)===null||f===void 0?void 0:f.forceDegradeToVideo.apply(f,d)}),r.isLive){var c;(c=this.player)===null||c===void 0||c.useHooks("replay",function(){var f;return(f=e.hls)===null||f===void 0?void 0:f.replay()})}this.on(li,l),this.on(cs,this._onSwitchSubtitle),this.on(Ei,this.destroy.bind(this)),this._transError(),this._transCoreEvent(F.TTFB),this._transCoreEvent(F.LOAD_START),this._transCoreEvent(F.LOAD_RESPONSE_HEADERS),this._transCoreEvent(F.LOAD_COMPLETE),this._transCoreEvent(F.LOAD_RETRY),this._transCoreEvent(F.SOURCEBUFFER_CREATED),this._transCoreEvent(F.MEDIASOURCE_OPENED),this._transCoreEvent(F.APPEND_BUFFER),this._transCoreEvent(F.REMOVE_BUFFER),this._transCoreEvent(F.BUFFEREOS),this._transCoreEvent(F.KEYFRAME),this._transCoreEvent(F.METADATA_PARSED),this._transCoreEvent(F.DEMUXED_TRACK),this._transCoreEvent(F.SEI),this._transCoreEvent(F.SEI_IN_TIME),this._transCoreEvent(F.SPEED),this._transCoreEvent(F.HLS_MANIFEST_LOADED),this._transCoreEvent(F.HLS_LEVEL_LOADED),this._transCoreEvent(F.STREAM_EXCEPTION),this._transCoreEvent(F.SWITCH_URL_SUCCESS),this._transCoreEvent(F.SWITCH_URL_FAILED),this._transCoreEvent(le.NO_AUDIO_TRACK),this._transCoreEvent(le.STREAM_PARSED),this._transCoreEvent(le.SUBTITLE_SEGMENTS),this._transCoreEvent(le.SUBTITLE_PLAYLIST),this._transCoreEvent(le.APPEND_COST),r.url&&this.hls.load(r.url,{reuseMse:!0}).catch(function(f){})}}},{key:"destroy",value:function(){var e;this.hls&&(this.hls.destroy(),this.hls=null),(e=this.pluginExtension)===null||e===void 0||e.destroy(),this.pluginExtension=null}},{key:"_transError",value:function(){var e=this;this.hls.on(le.ERROR,function(r){e.player&&e.player.emit(Wt,new si(e.player,r))})}},{key:"_transCoreEvent",value:function(e){var r=this;this.hls.on(e,function(n){r.player&&(r.player.emit("core_event",de(de({},n),{},{eventName:e})),e===F.SEI_IN_TIME&&r.hls.hasSubtitle&&r._emitSeiPaylodTime(n))})}},{key:"_emitSeiPaylodTime",value:function(e){try{var r=JSON.parse(Array.from(e.data.payload).map(function(n){return String.fromCharCode(n)}).join("").slice(0,-1));if(!r.rtmp_dts)return;this.player.emit("core_event",{eventName:le.SEI_PAYLOAD_TIME,time:r.rtmp_dts})}catch{}}}],[{key:"pluginName",get:function(){return"hls"}},{key:"isSupported",value:function(e,r){return oi.isSupported(e,r)}}]),i})(tt);A(Ln,"Hls",oi);A(Ln,"EVENT",le);function Ga(s,o){var i=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);o&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(s,e).enumerable})),i.push.apply(i,t)}return i}function He(s){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?arguments[o]:{};o%2?Ga(Object(i),!0).forEach(function(t){$(s,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(i)):Ga(Object(i)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(i,t))})}return s}function ce(){ce=function(){return s};var s={},o=Object.prototype,i=o.hasOwnProperty,t=Object.defineProperty||function(m,_,S){m[_]=S.value},e=typeof Symbol=="function"?Symbol:{},r=e.iterator||"@@iterator",n=e.asyncIterator||"@@asyncIterator",a=e.toStringTag||"@@toStringTag";function u(m,_,S){return Object.defineProperty(m,_,{value:S,enumerable:!0,configurable:!0,writable:!0}),m[_]}try{u({},"")}catch{u=function(_,S,D){return _[S]=D}}function l(m,_,S,D){var C=_&&_.prototype instanceof h?_:h,R=Object.create(C.prototype),V=new x(D||[]);return t(R,"_invoke",{value:T(m,S,V)}),R}function c(m,_,S){try{return{type:"normal",arg:m.call(_,S)}}catch(D){return{type:"throw",arg:D}}}s.wrap=l;var f={};function h(){}function d(){}function v(){}var y={};u(y,r,function(){return this});var p=Object.getPrototypeOf,b=p&&p(p(U([])));b&&b!==o&&i.call(b,r)&&(y=b);var k=v.prototype=h.prototype=Object.create(y);function E(m){["next","throw","return"].forEach(function(_){u(m,_,function(S){return this._invoke(_,S)})})}function w(m,_){function S(C,R,V,K){var Y=c(m[C],m,R);if(Y.type!=="throw"){var G=Y.arg,ke=G.value;return ke&&typeof ke=="object"&&i.call(ke,"__await")?_.resolve(ke.__await).then(function(Z){S("next",Z,V,K)},function(Z){S("throw",Z,V,K)}):_.resolve(ke).then(function(Z){G.value=Z,V(G)},function(Z){return S("throw",Z,V,K)})}K(Y.arg)}var D;t(this,"_invoke",{value:function(C,R){function V(){return new _(function(K,Y){S(C,R,K,Y)})}return D=D?D.then(V,V):V()}})}function T(m,_,S){var D="suspendedStart";return function(C,R){if(D==="executing")throw new Error("Generator is already running");if(D==="completed"){if(C==="throw")throw R;return W()}for(S.method=C,S.arg=R;;){var V=S.delegate;if(V){var K=L(V,S);if(K){if(K===f)continue;return K}}if(S.method==="next")S.sent=S._sent=S.arg;else if(S.method==="throw"){if(D==="suspendedStart")throw D="completed",S.arg;S.dispatchException(S.arg)}else S.method==="return"&&S.abrupt("return",S.arg);D="executing";var Y=c(m,_,S);if(Y.type==="normal"){if(D=S.done?"completed":"suspendedYield",Y.arg===f)continue;return{value:Y.arg,done:S.done}}Y.type==="throw"&&(D="completed",S.method="throw",S.arg=Y.arg)}}}function L(m,_){var S=_.method,D=m.iterator[S];if(D===void 0)return _.delegate=null,S==="throw"&&m.iterator.return&&(_.method="return",_.arg=void 0,L(m,_),_.method==="throw")||S!=="return"&&(_.method="throw",_.arg=new TypeError("The iterator does not provide a '"+S+"' method")),f;var C=c(D,m.iterator,_.arg);if(C.type==="throw")return _.method="throw",_.arg=C.arg,_.delegate=null,f;var R=C.arg;return R?R.done?(_[m.resultName]=R.value,_.next=m.nextLoc,_.method!=="return"&&(_.method="next",_.arg=void 0),_.delegate=null,f):R:(_.method="throw",_.arg=new TypeError("iterator result is not an object"),_.delegate=null,f)}function O(m){var _={tryLoc:m[0]};1 in m&&(_.catchLoc=m[1]),2 in m&&(_.finallyLoc=m[2],_.afterLoc=m[3]),this.tryEntries.push(_)}function B(m){var _=m.completion||{};_.type="normal",delete _.arg,m.completion=_}function x(m){this.tryEntries=[{tryLoc:"root"}],m.forEach(O,this),this.reset(!0)}function U(m){if(m){var _=m[r];if(_)return _.call(m);if(typeof m.next=="function")return m;if(!isNaN(m.length)){var S=-1,D=function C(){for(;++S<m.length;)if(i.call(m,S))return C.value=m[S],C.done=!1,C;return C.value=void 0,C.done=!0,C};return D.next=D}}return{next:W}}function W(){return{value:void 0,done:!0}}return d.prototype=v,t(k,"constructor",{value:v,configurable:!0}),t(v,"constructor",{value:d,configurable:!0}),d.displayName=u(v,a,"GeneratorFunction"),s.isGeneratorFunction=function(m){var _=typeof m=="function"&&m.constructor;return!!_&&(_===d||(_.displayName||_.name)==="GeneratorFunction")},s.mark=function(m){return Object.setPrototypeOf?Object.setPrototypeOf(m,v):(m.__proto__=v,u(m,a,"GeneratorFunction")),m.prototype=Object.create(k),m},s.awrap=function(m){return{__await:m}},E(w.prototype),u(w.prototype,n,function(){return this}),s.AsyncIterator=w,s.async=function(m,_,S,D,C){C===void 0&&(C=Promise);var R=new w(l(m,_,S,D),C);return s.isGeneratorFunction(_)?R:R.next().then(function(V){return V.done?V.value:R.next()})},E(k),u(k,a,"Generator"),u(k,r,function(){return this}),u(k,"toString",function(){return"[object Generator]"}),s.keys=function(m){var _=Object(m),S=[];for(var D in _)S.push(D);return S.reverse(),function C(){for(;S.length;){var R=S.pop();if(R in _)return C.value=R,C.done=!1,C}return C.done=!0,C}},s.values=U,x.prototype={constructor:x,reset:function(m){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(B),!m)for(var _ in this)_.charAt(0)==="t"&&i.call(this,_)&&!isNaN(+_.slice(1))&&(this[_]=void 0)},stop:function(){this.done=!0;var m=this.tryEntries[0].completion;if(m.type==="throw")throw m.arg;return this.rval},dispatchException:function(m){if(this.done)throw m;var _=this;function S(Y,G){return R.type="throw",R.arg=m,_.next=Y,G&&(_.method="next",_.arg=void 0),!!G}for(var D=this.tryEntries.length-1;D>=0;--D){var C=this.tryEntries[D],R=C.completion;if(C.tryLoc==="root")return S("end");if(C.tryLoc<=this.prev){var V=i.call(C,"catchLoc"),K=i.call(C,"finallyLoc");if(V&&K){if(this.prev<C.catchLoc)return S(C.catchLoc,!0);if(this.prev<C.finallyLoc)return S(C.finallyLoc)}else if(V){if(this.prev<C.catchLoc)return S(C.catchLoc,!0)}else{if(!K)throw new Error("try statement without catch or finally");if(this.prev<C.finallyLoc)return S(C.finallyLoc)}}}},abrupt:function(m,_){for(var S=this.tryEntries.length-1;S>=0;--S){var D=this.tryEntries[S];if(D.tryLoc<=this.prev&&i.call(D,"finallyLoc")&&this.prev<D.finallyLoc){var C=D;break}}C&&(m==="break"||m==="continue")&&C.tryLoc<=_&&_<=C.finallyLoc&&(C=null);var R=C?C.completion:{};return R.type=m,R.arg=_,C?(this.method="next",this.next=C.finallyLoc,f):this.complete(R)},complete:function(m,_){if(m.type==="throw")throw m.arg;return m.type==="break"||m.type==="continue"?this.next=m.arg:m.type==="return"?(this.rval=this.arg=m.arg,this.method="return",this.next="end"):m.type==="normal"&&_&&(this.next=_),f},finish:function(m){for(var _=this.tryEntries.length-1;_>=0;--_){var S=this.tryEntries[_];if(S.finallyLoc===m)return this.complete(S.completion,S.afterLoc),B(S),f}},catch:function(m){for(var _=this.tryEntries.length-1;_>=0;--_){var S=this.tryEntries[_];if(S.tryLoc===m){var D=S.completion;if(D.type==="throw"){var C=D.arg;B(S)}return C}}throw new Error("illegal catch attempt")},delegateYield:function(m,_,S){return this.delegate={iterator:U(m),resultName:_,nextLoc:S},this.method==="next"&&(this.arg=void 0),f}},s}function on(s){"@babel/helpers - typeof";return on=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},on(s)}function ja(s,o,i,t,e,r,n){try{var a=s[r](n),u=a.value}catch(l){i(l);return}a.done?o(u):Promise.resolve(u).then(t,e)}function Re(s){return function(){var o=this,i=arguments;return new Promise(function(t,e){var r=s.apply(o,i);function n(u){ja(r,t,e,n,a,"next",u)}function a(u){ja(r,t,e,n,a,"throw",u)}n(void 0)})}}function wi(s,o){if(!(s instanceof o))throw new TypeError("Cannot call a class as a function")}function za(s,o){for(var i=0;i<o.length;i++){var t=o[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,so(t.key),t)}}function Ci(s,o,i){return o&&za(s.prototype,o),i&&za(s,i),Object.defineProperty(s,"prototype",{writable:!1}),s}function $(s,o,i){return o=so(o),o in s?Object.defineProperty(s,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):s[o]=i,s}function no(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(o&&o.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),o&&un(s,o)}function ir(s){return ir=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},ir(s)}function un(s,o){return un=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},un(s,o)}function cf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function ne(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function ff(s,o){if(o&&(typeof o=="object"||typeof o=="function"))return o;if(o!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ne(s)}function ao(s){var o=cf();return function(){var t=ir(s),e;if(o){var r=ir(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return ff(this,e)}}function hf(s,o){if(typeof s!="object"||s===null)return s;var i=s[Symbol.toPrimitive];if(i!==void 0){var t=i.call(s,o);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}function so(s){var o=hf(s,"string");return typeof o=="symbol"?o:String(o)}var df=(function(){function s(){wi(this,s),$(this,"_ttfb",0),$(this,"_demuxStart",0),$(this,"_demuxEnd",0),$(this,"_demuxCost",0),$(this,"_remuxStart",0),$(this,"_remuxEnd",0),$(this,"_remuxCost",0),$(this,"_appendStart",0),$(this,"_appendEnd",0),$(this,"_appendCost",0)}return Ci(s,[{key:"set",value:function(i,t){this["_".concat(i)]=t}},{key:"start",value:function(i){this["_".concat(i,"Start")]=Date.now()}},{key:"end",value:function(i){this["_".concat(i,"End")]=Date.now(),this["_".concat(i,"Cost")]=this["_".concat(i,"Cost")]+(this["_".concat(i,"End")]-this["_".concat(i,"Start")])}},{key:"transferCost",get:function(){return{ttfbCost:this._ttfb,demuxCost:this._demuxCost,remuxCost:this._remuxCost,appendCost:this._appendCost}}}]),s})(),Nt={TTFB:"ttfb",DEMUX:"demux",REMUX:"remux",APPEND:"append"},vt=new $e("BufferService"),vf=(function(){function s(o,i){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};wi(this,s),$(this,"flv",null),$(this,"_demuxer",new qs),$(this,"_remuxer",null),$(this,"_mse",null),$(this,"_softVideo",null),$(this,"_sourceCreated",!1),$(this,"_needInitSegment",!0),$(this,"_discontinuity",!0),$(this,"_contiguous",!1),$(this,"_initSegmentId",""),$(this,"_cachedBuffer",null),$(this,"_demuxStartTime",0),$(this,"_opts",null),this.flv=o,this._opts=t,i?this._softVideo=i:(this._remuxer=new Js(this._demuxer.videoTrack,this._demuxer.audioTrack),this._mse=new Ie(null,{preferMMS:typeof t.preferMMS=="boolean"?t.preferMMS:!!t.perferMMS}),this._mse.bindMedia(o.media))}return Ci(s,[{key:"baseDts",get:function(){var i,t;return(i=this._demuxer)===null||i===void 0||(t=i._fixer)===null||t===void 0?void 0:t._baseDts}},{key:"blobUrl",get:function(){var i;return(i=this._mse)===null||i===void 0?void 0:i.url}},{key:"isFull",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ie.VIDEO;return this._mse.isFull(i)}},{key:"seamlessSwitch",value:function(){this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!0,this._initSegmentId=""}},{key:"unContiguous",value:function(i){this._contiguous=!1,this._demuxStartTime=i}},{key:"reset",value:(function(){var o=Re(ce().mark(function t(){var e,r=arguments;return ce().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e=r.length>0&&r[0]!==void 0?r[0]:!1,!(this._mse&&!e)){a.next=6;break}return a.next=4,this._mse.unbindMedia();case 4:return a.next=6,this._mse.bindMedia(this.flv.media);case 6:this._needInitSegment=!0,this._discontinuity=!0,this._contiguous=!1,this._sourceCreated=!1,this._initSegmentId="",this.resetSeamlessSwitchStats();case 12:case"end":return a.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i})()},{key:"resetSeamlessSwitchStats",value:function(){this.seamlessLoadingSwitch=null,this.seamlessLoadingSwitching=!1,this._demuxer&&(this._demuxer.seamlessLoadingSwitching=!1)}},{key:"endOfStream",value:(function(){var o=Re(ce().mark(function t(){return ce().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!this._mse){r.next=7;break}if(!this._sourceCreated){r.next=5;break}return r.next=4,this._mse.endOfStream();case 4:this.flv.emit(F.BUFFEREOS);case 5:r.next=8;break;case 7:this._softVideo&&this._softVideo.endOfStream();case 8:case"end":return r.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i})()},{key:"updateDuration",value:(function(){var o=Re(ce().mark(function t(e){return ce().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._mse){n.next=7;break}if(this._mse.isOpened){n.next=4;break}return n.next=4,this._mse.open();case 4:return vt.debug("update duration",e),n.next=7,this._mse.updateDuration(e);case 7:case"end":return n.stop()}},t,this)}));function i(t){return o.apply(this,arguments)}return i})()},{key:"destroy",value:(function(){var o=Re(ce().mark(function t(){return ce().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!this._mse){r.next=3;break}return r.next=3,this._mse.unbindMedia();case 3:this._mse=null,this._softVideo=null,this._demuxer=null,this._remuxer=null;case 7:case"end":return r.stop()}},t,this)}));function i(){return o.apply(this,arguments)}return i})()},{key:"appendBuffer",value:(function(){var o=Re(ce().mark(function t(e){var r=this,n,a,u,l,c,f,h,d,v,y,p,b,k,E,w,T,L,O;return ce().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(n=!1,this._cachedBuffer&&(e=vi(this._cachedBuffer,e),this._cachedBuffer=null),a=this._demuxer,!(!e||!e.length||!a)){x.next=5;break}return x.abrupt("return");case 5:x.prev=5,this.flv._transferCost.start(Nt.DEMUX),a.demuxAndFix(e,this.seamlessLoadingSwitching||this._discontinuity,this._contiguous,this._demuxStartTime,this.seamlessLoadingSwitching),this.seamlessLoadingSwitching=!1,this.flv._transferCost.end(Nt.DEMUX),x.next=15;break;case 12:throw x.prev=12,x.t0=x.catch(5),new ye(ie.DEMUX,ie.SUB_TYPES.FLV,x.t0);case 15:if(u=a.videoTrack,l=a.audioTrack,c=a.metadataTrack,!this.seamlessLoadingSwitch){x.next=25;break}if(f=u.samples.findIndex(function(U){return U.originDts===u.lastKeyFrameDts}),!(f>=0)){x.next=25;break}return u.samples.splice(f),x.next=22,this.seamlessLoadingSwitch();case 22:this.seamlessLoadingSwitch=null,e=null,n=!0;case 25:if(h=u.exist(),d=l.exist(),this._opts.onlyAudio&&(h=!1,u.present=!1),this._opts.onlyVideo&&(d=!1,l.present=!1),!(!h&&u.present||!d&&l.present)){x.next=42;break}if(v=0,y=h?u:d?l:void 0,y&&y.samples.length&&(v=(y.samples[y.samples.length-1].originPts-y.samples[0].originPts)/y.timescale*1e3),!(v>this._opts.analyzeDuration)){x.next=40;break}vt.warn("analyze duration exceeded, ".concat(v,"ms"),y),u.present=h,l.present=d,this.flv.emit(F.ANALYZE_DURATION_EXCEEDED,{duration:v}),x.next=42;break;case 40:return this._cachedBuffer=e,x.abrupt("return");case 42:if(p=u.type,b=l.type,this._fireEvents(u,l,c),n||(this._discontinuity=!1,this._contiguous=!0,this._demuxStartTime=0),k=this._mse,E=function(){var W;if((W=r.flv)!==null&&W!==void 0&&W.emit){var m;(m=r.flv)===null||m===void 0||m.emit(F.APPEND_BUFFER,{})}},this.flv.emit(F.DEMUXED_TRACK,{videoTrack:u}),w="".concat(u.codec,"/").concat(u.width,"/").concat(u.height,"/").concat(l.codec,"/").concat(l.config),w!==this._initSegmentId&&(this._needInitSegment=!0,this._initSegmentId=w,this._emitMetaParsedEvent(u,l)),!k){x.next=83;break}if(this._sourceCreated){x.next=59;break}return x.next=55,k.open();case 55:h&&(vt.log("codec: video/mp4;codecs=".concat(u.codec)),k.createSource(p,"video/mp4;codecs=".concat(u.codec))),d&&(vt.log("codec: audio/mp4;codecs=".concat(l.codec)),k.createSource(b,"audio/mp4;codecs=".concat(l.codec))),this._sourceCreated=!0,this.flv.emit(F.SOURCEBUFFER_CREATED);case 59:x.prev=59,this._needInitSegment&&!this._opts.mseLowLatency&&(u.duration=this._opts.durationForMSELowLatencyOff*u.timescale,l.duration=this._opts.durationForMSELowLatencyOff*d.timescale),this.flv._transferCost.start(Nt.REMUX),T=this._remuxer.remux(this._needInitSegment),this.flv._transferCost.end(Nt.REMUX),x.next=69;break;case 66:throw x.prev=66,x.t1=x.catch(59),new ye(ie.REMUX,ie.SUB_TYPES.FMP4,x.t1);case 69:if(!(this._needInitSegment&&!T.videoInitSegment&&!T.audioInitSegment)){x.next=71;break}return x.abrupt("return");case 71:return this._needInitSegment=!1,L=[],T.videoInitSegment&&L.push(k.append(p,T.videoInitSegment)),T.audioInitSegment&&L.push(k.append(b,T.audioInitSegment)),T.videoSegment&&L.push(k.append(p,T.videoSegment)),T.audioSegment&&L.push(k.append(b,T.audioSegment)),this.flv._transferCost.start(Nt.APPEND),O=Promise.all(L),O.then(E).then(function(){r.flv._transferCost.end(Nt.APPEND),E()}),x.abrupt("return",O);case 83:this._softVideo&&(this._softVideo.appendBuffer(u,l),E());case 84:case"end":return x.stop()}},t,this,[[5,12],[59,66]])}));function i(t){return o.apply(this,arguments)}return i})()},{key:"evictBuffer",value:(function(){var o=Re(ce().mark(function t(e){var r=this,n,a,u,l;return ce().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(n=this.flv.media,!(!this._mse||!this._demuxer||!n||!e||e<0)){f.next=3;break}return f.abrupt("return");case 3:if(a=n.currentTime,u=a-e,!(u<=0)){f.next=7;break}return f.abrupt("return");case 7:if(l=Ce.start(Ce.get(n)),!(l+1>=u)){f.next=10;break}return f.abrupt("return");case 10:return f.abrupt("return",this._mse.clearBuffer(0,u).then(function(){return r.flv.emit(F.REMOVE_BUFFER,{removeEnd:u})}));case 11:case"end":return f.stop()}},t,this)}));function i(t){return o.apply(this,arguments)}return i})()},{key:"_emitMetaParsedEvent",value:function(i,t){i.exist()&&this.flv.emit(F.METADATA_PARSED,{type:"video",track:i,meta:{codec:i.codec,timescale:i.timescale,width:i.width,height:i.height,sarRatio:i.sarRatio,baseDts:i.baseDts}}),t.exist()&&this.flv.emit(F.METADATA_PARSED,{type:"audio",track:t,meta:{codec:t.codec,channelCount:t.channelCount,sampleRate:t.sampleRate,timescale:t.timescale,baseDts:t.baseDts}}),vt.debug("track parsed",i,t)}},{key:"_fireEvents",value:function(i,t,e){var r=this;vt.debug("videoTrack samples count: ".concat(i.samples.length,", audioTrack samples count: ").concat(t.samples.length)),e.flvScriptSamples.forEach(function(n){r.flv.emit(F.FLV_SCRIPT_DATA,n),vt.debug("flvScriptData",n)}),i.samples.forEach(function(n){n.keyframe&&r.flv.emit(F.KEYFRAME,{pts:n.originPts})}),i.warnings.forEach(function(n){var a;switch(n.type){case Te.LARGE_AV_SHIFT:a=F.LARGE_AV_FIRST_FRAME_GAP_DETECT;break;case Te.LARGE_VIDEO_GAP:a=F.LARGE_VIDEO_DTS_GAP_DETECT;break;case Te.LARGE_VIDEO_GAP_BETWEEN_CHUNK:a=F.MAX_DTS_DELTA_WITH_NEXT_SEGMENT_DETECT;break}a&&r.flv.emit(F.STREAM_EXCEPTION,He(He({},n),{},{type:a})),vt.warn("video exception",n)}),t.warnings.forEach(function(n){var a;switch(n.type){case Te.LARGE_AUDIO_GAP:a=F.LARGE_AUDIO_DTS_GAP_DETECT;break;case Te.AUDIO_FILLED:a=F.AUDIO_GAP_DETECT;break;case Te.AUDIO_DROPPED:a=F.AUDIO_OVERLAP_DETECT;break}a&&r.flv.emit(F.STREAM_EXCEPTION,He(He({},n),{},{type:a})),vt.warn("audio exception",n)}),e.seiSamples.forEach(function(n){r.flv.emit(F.SEI,He(He({},n),{},{sei:{code:n.data.type,content:n.data.payload,dts:n.pts}}))})}}]),s})();function pf(s){var o=He({retryCount:3,retryDelay:1e3,disconnectRetryCount:0,loadTimeout:1e4,maxReaderInterval:5e3,preloadTime:5,defaultVodLoadSize:1e7,isLive:!1,softDecode:!1,bufferBehind:10,maxJumpDistance:3,analyzeDuration:2e4,seamlesslyReload:!1,keepStatusAfterSwitch:!0,onlyVideo:!1,onlyAudio:!1,preferMMS:!1,mseLowLatency:!0,durationForMSELowLatencyOff:6,chunkCountForSpeed:50,skipChunkSize:1e3,longtimeNoReceived:3e3,enableStartGapJump:!0},s);return o.isLive&&o.preloadTime&&(o.maxLatency||(o.maxLatency=o.preloadTime*2),o.targetLatency||(o.targetLatency=o.preloadTime),(o.disconnectTime===null||o.disconnectTime===void 0)&&(o.disconnectTime=o.maxLatency)),o}function Wa(s,o){var i=0,t=s.length-1,e=0,r=0,n=t;for(o<s[0]&&(i=0,r=n+1);r<=n;)if(e=r+Math.floor((n-r)/2),e===t||o>=s[e]&&o<s[e+1]){i=e;break}else s[e]<o?r=e+1:n=e-1;return i}var ut=new $e("flv"),Ui=.1,gf=.3,bi=(function(s){no(i,s);var o=ao(i);function i(t){var e;return wi(this,i),e=o.call(this),$(ne(e),"media",null),$(ne(e),"_loading",!1),$(ne(e),"_opts",null),$(ne(e),"_bufferService",null),$(ne(e),"_gapService",null),$(ne(e),"_stats",null),$(ne(e),"_mediaLoader",null),$(ne(e),"_maxChunkWaitTimer",null),$(ne(e),"_tickTimer",null),$(ne(e),"_tickInterval",500),$(ne(e),"_urlSwitching",!1),$(ne(e),"_seamlessSwitching",!1),$(ne(e),"_disconnectRetryCount",0),$(ne(e),"_preLoadEndPoint",0),$(ne(e),"_keyframes",null),$(ne(e),"_acceptRanges",!0),$(ne(e),"_onProgress",(function(){var r=Re(ce().mark(function n(a,u,l,c){var f,h,d,v,y,p,b,k,E,w;return ce().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(f=l.startTime,h=l.endTime,d=l.st,v=l.firstByteTime,e._loading=!u,e._firstProgressEmit){L.next=13;break}if(e.media){L.next=6;break}return(y=e._mediaLoader)===null||y===void 0||y.cancel(),L.abrupt("return");case 6:p=c.headers,b=d?v-d:h-f,e.emit(F.TTFB,{url:e._opts.url,responseUrl:c.url,elapsed:b}),e.emit(F.LOAD_RESPONSE_HEADERS,{headers:p}),e._transferCost.set(Nt.TTFB,b),e._acceptRanges=!!(p!=null&&p.get("Accept-Ranges"))||!!(p!=null&&p.get("Content-Range")),e._firstProgressEmit=!0;case 13:if(e._bufferService){L.next=15;break}return L.abrupt("return");case 15:return clearTimeout(e._maxChunkWaitTimer),e._bandwidthService.addChunkRecord(a==null?void 0:a.byteLength,h-f),L.prev=17,L.next=20,e._bufferService.appendBuffer(a);case 20:(k=e._bufferService)===null||k===void 0||k.evictBuffer(e._opts.bufferBehind),L.next=33;break;case 23:if(L.prev=23,L.t0=L.catch(17),!(!e.isLive&&e._bufferService.isFull())){L.next=32;break}return L.next=28,e._mediaLoader.cancel();case 28:return e._loading=!1,E=e.bufferInfo().remaining,e._opts.preloadTime=parseInt(E)/2,L.abrupt("return");case 32:return L.abrupt("return",e._emitError(ye.create(L.t0)));case 33:if(e._urlSwitching&&(e._urlSwitching=!1,e.emit(F.SWITCH_URL_SUCCESS,{url:e._opts.url})),e._seamlessSwitching&&(e._seamlessSwitching=!1,e._tick()),!(u&&!e.media.seeking)){L.next=40;break}return e.emit(F.LOAD_COMPLETE),ut.debug("load done"),e.isLive&&e._disconnectRetryCount<=0&&e._end(),L.abrupt("return");case 40:if(e.isLive){L.next=42;break}return L.abrupt("return");case 42:w=e._opts.maxReaderInterval,w&&e._firstProgressEmit&&(clearTimeout(e._maxChunkWaitTimer),e._maxChunkWaitTimer=setTimeout(function(){if(e._disconnectRetryCount){e._disconnectRetryCount--,e.load();return}ut.debug("onMaxChunkWait",w),e._end()},w));case 44:case"end":return L.stop()}},n,null,[[17,23]])}));return function(n,a,u,l){return r.apply(this,arguments)}})()),$(ne(e),"_onRetryError",function(r,n){ut.debug("load retry",r,n),e.emit(F.LOAD_RETRY,{error:ye.network(r),retryTime:n})}),$(ne(e),"_end",function(){e._clear(),e._bufferService&&e._bufferService.endOfStream(),ut.debug("end stream")}),$(ne(e),"_resetDisconnectCount",function(){e._disconnectRetryCount=e._opts.disconnectRetryCount}),$(ne(e),"_tick",function(){clearTimeout(e._tickTimer);var r=ne(e),n=r.media;if(n){e._tickTimer=setTimeout(e._tick,e._tickInterval);var a=Ce.end(Ce.get(n));if(!(a<Ui||!n.readyState)){var u=e._opts;if(Ms(n)&&n.currentTime)e._gapService&&e._gapService.do(n,u.maxJumpDistance,e.isLive,3);else{if(!n.currentTime&&e._gapService&&u.enableStartGapJump){var l=e._opts.mseLowLatency||e._opts.mseLowLatency===!1&&e.bufferInfo(gf).nextStart;l&&e._gapService.do(n,u.maxJumpDistance,e.isLive,3);return}u.isLive&&n.readyState===4&&a-n.currentTime>u.disconnectTime&&e.disconnect()}}}}),$(ne(e),"_onPlay",function(){var r,n,a=e._opts.softDecode||((r=e.media)===null||r===void 0||(n=r.buffered)===null||n===void 0?void 0:n.length);if(e.isLive){!e._loading&&a&&e.replay(void 0,!0);return}var u=e.bufferInfo();(u.start||u.nextStart)>Ui&&e._tick()}),$(ne(e),"_onLoadeddata",function(){e.isLive&&!e._opts.mseLowLatency&&e.media.duration!==1/0&&e._bufferService.updateDuration(1/0).catch(function(r){})}),$(ne(e),"_onSeeking",Re(ce().mark(function r(){return ce().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:!e.isLive&&e.seekable&&(e._preLoadEndPoint=-1,e._checkPreload());case 1:case"end":return a.stop()}},r)}))),$(ne(e),"_onTimeupdate",function(){if(e.media){var r=e._opts,n=e.media.currentTime;if(r.isLive&&r.maxLatency&&r.targetLatency){var a=Ce.end(Ce.get(e.media)),u=a-n;u>=r.maxLatency&&(e.media.currentTime=a-r.targetLatency,e.emit(F.CHASEFRAME,{currentTime:e.media.currentTime,latency:r.targetLatency}))}e._seiService.throw(n,!0),!(r.isLive||!e.seekable||e._loading)&&e._checkPreload()}}),$(ne(e),"_onWaiting",function(){e.isLive&&!e._loading&&e._disconnectRetryCount&&(e._disconnectRetryCount--,e.load())}),$(ne(e),"_onBufferUpdate",function(){if(!e._opts.isLive){var r=e.bufferInfo(),n=r.end,a=r.nextEnd;Math.abs((n||a)-e.media.duration)<1&&(e._end(),e.media.readyState<=2&&e._tick())}}),$(ne(e),"_checkPreload",Re(ce().mark(function r(){var n,a,u,l,c,f,h,d,v,y;return ce().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(n=e.bufferInfo(),a=n.remaining,u=a===void 0?0:a,l=e._opts,c=e._keyframes.filepositions,f=e._keyframes.times,h=e.media.currentTime,!(u<l.preloadTime)){b.next=19;break}if(d=Wa(e._keyframes.times,h+u+Ui),v=Wa(e._keyframes.times,h+u+e._opts.preloadTime),v===d&&(v=d+1),e._preLoadEndPoint!==v){b.next=11;break}return b.abrupt("return");case 11:if(y=c[d],y!=null){b.next=14;break}return b.abrupt("return");case 14:return b.next=16,e._mediaLoader.cancel();case 16:e._loadData(null,[y,c[v]]),e._preLoadEndPoint=v,e._bufferService.unContiguous(f[d]);case 19:case"end":return b.stop()}},r)}))),$(ne(e),"_onFlvScriptData",function(r){var n,a,u,l,c=(n=r.data)===null||n===void 0||(a=n.onMetaData)===null||a===void 0?void 0:a.keyframes,f=(u=r.data)===null||u===void 0||(l=u.onMetaData)===null||l===void 0?void 0:l.duration;c&&(e._keyframes=c),!e._opts.isLive&&f&&e._bufferService.updateDuration(f)}),e._opts=pf(t),e.media=e._opts.media||document.createElement("video"),e._opts.media=null,e._firstProgressEmit=!1,e._mediaLoader=new Ut(He(He({},e._opts.fetchOptions),{},{retry:e._opts.retryCount,retryDelay:e._opts.retryDelay,timeout:e._opts.loadTimeout,onRetryError:e._onRetryError,onProgress:e._onProgress,responseType:"arraybuffer"})),e._disconnectRetryCount=e._opts.disconnectRetryCount,e._transferCost=new df,e._bufferService=new vf(ne(e),e._opts.softDecode?e.media:void 0,e._opts),e._seiService=new Bs(ne(e)),e._bandwidthService=new Us({chunkCountForSpeed:e._opts.chunkCountForSpeed,skipChunkSize:e._opts.skipChunkSize,longtimeNoReceived:e._opts.longtimeNoReceived}),e._stats=new Hs(ne(e)),e._opts.softDecode||(e._gapService=new Fs),e.media.addEventListener("play",e._onPlay),e.media.addEventListener("loadeddata",e._onLoadeddata),e.media.addEventListener("seeking",e._onSeeking),e.media.addEventListener("timeupdate",e._onTimeupdate),e.media.addEventListener("progress",e._onBufferUpdate),e.media.addEventListener("waiting",e._onWaiting),e.on(F.FLV_SCRIPT_DATA,e._onFlvScriptData),e}return Ci(i,[{key:"version",get:function(){return"3.0.23"}},{key:"isLive",get:function(){return this._opts.isLive}},{key:"baseDts",get:function(){var e;return(e=this._bufferService)===null||e===void 0?void 0:e.baseDts}},{key:"seekable",get:function(){return!!this._keyframes&&this._acceptRanges}},{key:"loader",get:function(){return this._mediaLoader}},{key:"blobUrl",get:function(){var e;return(e=this._bufferService)===null||e===void 0?void 0:e.blobUrl}},{key:"speedInfo",value:function(){return{speed:this._bandwidthService.getLatestSpeed(),avgSpeed:this._bandwidthService.getAvgSpeed(),totalSize:this._bandwidthService.getTotalSize(),totalCost:this._bandwidthService.getTotalCost()}}},{key:"getStats",value:function(){return this._stats.getStats()}},{key:"bufferInfo",value:function(){var e,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ui;return Ce.info(Ce.get(this.media),(e=this.media)===null||e===void 0?void 0:e.currentTime,r)}},{key:"playbackQuality",value:function(){return Ns(this.media)}},{key:"load",value:(function(){var t=Re(ce().mark(function r(n){var a,u,l=arguments;return ce().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(a=l.length>1&&l[1]!==void 0?l[1]:!1,u=l.length>2?l[2]:void 0,this._bufferService){f.next=4;break}return f.abrupt("return");case 4:return f.next=6,this._reset(a);case 6:this._loadData(n,this._opts.isLive?[]:[0,this._opts.defaultVodLoadSize],u),clearTimeout(this._tickTimer),this._tickTimer=setTimeout(this._tick,this._tickInterval);case 9:case"end":return f.stop()}},r,this)}));function e(r){return t.apply(this,arguments)}return e})()},{key:"replay",value:(function(){var t=Re(ce().mark(function r(){var n=this,a,u,l=arguments;return ce().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(a=l.length>0&&l[0]!==void 0?l[0]:this._opts.seamlesslyReload,u=l.length>1?l[1]:void 0,this.media){f.next=4;break}return f.abrupt("return");case 4:if(this._resetDisconnectCount(),!a){f.next=11;break}return f.next=8,this._clear();case 8:setTimeout(function(){n._seamlessSwitching=!0,n._loadData(n._opts.url),n._bufferService.seamlessSwitch()}),f.next=13;break;case 11:return f.next=13,this.load();case 13:return f.abrupt("return",this.media.play(!u).catch(function(){}));case 14:case"end":return f.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e})()},{key:"disconnect",value:function(){var e;return ut.debug("disconnect!"),(e=this._bufferService)===null||e===void 0||e.resetSeamlessSwitchStats(),this._clear()}},{key:"switchURL",value:(function(){var t=Re(ce().mark(function r(n,a){var u=this;return ce().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this._bufferService){c.next=2;break}return c.abrupt("return");case 2:if(this._resetDisconnectCount(),!(this._loading&&a)){c.next=6;break}return this._bufferService.seamlessLoadingSwitch=(function(){var f=Re(ce().mark(function h(d){return ce().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,u._clear();case 2:u._bufferService.seamlessLoadingSwitching=!0,u._urlSwitching=!0,u._seamlessSwitching=!0,u._bufferService.seamlessSwitch(),u._loadData(n);case 7:case"end":return y.stop()}},h)}));return function(h){return f.apply(this,arguments)}})(),c.abrupt("return");case 6:if(!(!a||!this._opts.isLive)){c.next=11;break}return c.next=9,this.load(n);case 9:return this._urlSwitching=!0,c.abrupt("return",this.media.play(!0).catch(function(){}));case 11:return c.next=13,this._clear();case 13:setTimeout(function(){u._urlSwitching=!0,u._seamlessSwitching=!0,u._loadData(n),u._bufferService.seamlessSwitch()});case 14:case"end":return c.stop()}},r,this)}));function e(r,n){return t.apply(this,arguments)}return e})()},{key:"destroy",value:(function(){var t=Re(ce().mark(function r(){return ce().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this.media){a.next=2;break}return a.abrupt("return");case 2:return this.removeAllListeners(),this._seiService.reset(),this.media.removeEventListener("play",this._onPlay),this.media.removeEventListener("loadeddata",this._onLoadeddata),this.media.removeEventListener("seeking",this._onSeeking),this.media.removeEventListener("timeupdate",this._onTimeupdate),this.media.removeEventListener("waiting",this._onWaiting),this.media.removeEventListener("progress",this._onBufferUpdate),a.next=12,Promise.all([this._clear(),this._bufferService.destroy()]);case 12:this.media=null,this._bufferService=null;case 14:case"end":return a.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e})()},{key:"_emitError",value:function(e){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;ut.table(e),ut.error(e),ut.error((r=this.media)===null||r===void 0?void 0:r.error),this._urlSwitching&&(this._urlSwitching=!1,this._seamlessSwitching=!1,this.emit(F.SWITCH_URL_FAILED,e)),this.emit(F.ERROR,e),n&&(this._seiService.reset(),this._end())}},{key:"_reset",value:(function(){var t=Re(ce().mark(function r(){var n,a=arguments;return ce().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return n=a.length>0&&a[0]!==void 0?a[0]:!1,this._seiService.reset(),this._bandwidthService.reset(),this._stats.reset(),l.next=6,this._clear();case 6:return l.next=8,this._bufferService.reset(n);case 8:case"end":return l.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e})()},{key:"_loadData",value:(function(){var t=Re(ce().mark(function r(n,a,u){var l;return ce().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(n&&(this._opts.url=n),l=n=this._opts.url,n){f.next=4;break}throw new Error("Source url is missing");case 4:if(this._opts.preProcessUrl&&(l=this._opts.preProcessUrl(n).url),this._mediaLoader.finnalUrl=l,this.emit(F.LOAD_START,{url:l,seamlessSwitching:this._seamlessSwitching}),ut.debug("load data, loading:",this._loading,l),!this._loading){f.next=11;break}return f.next=11,this._mediaLoader.cancel();case 11:return this._loading=!0,f.prev=12,f.next=15,this._mediaLoader.load({url:l,range:a,streamRes:u,firstMaxChunkSize:this._opts.firstMaxChunkSize});case 15:f.next=21;break;case 17:return f.prev=17,f.t0=f.catch(12),this._loading=!1,f.abrupt("return",this._emitError(ye.network(f.t0),!1));case 21:case"end":return f.stop()}},r,this,[[12,17]])}));function e(r,n,a){return t.apply(this,arguments)}return e})()},{key:"_clear",value:(function(){var t=Re(ce().mark(function r(){return ce().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!this._mediaLoader){a.next=3;break}return a.next=3,this._mediaLoader.cancel();case 3:clearTimeout(this._maxChunkWaitTimer),clearTimeout(this._tickTimer),this._loading=!1,this._firstProgressEmit=!1;case 7:case"end":return a.stop()}},r,this)}));function e(){return t.apply(this,arguments)}return e})()}],[{key:"isSupported",value:function(e){return!e||e==="video"||e==="audio"?Ie.isSupported():typeof WebAssembly<"u"}},{key:"enableLogger",value:function(){$e.enable(),Gt.enable()}},{key:"disableLogger",value:function(){$e.disable(),Gt.disable()}}]),i})(jt);try{localStorage.getItem("xgd")?bi.enableLogger():bi.disableLogger()}catch{}var mf=(function(){function s(o,i){var t=this;wi(this,s),$(this,"_onLowDecode",function(){var e,r,n,a,u=t._opts,l=u.media,c=u.innerDegrade,f=u.backupURL;(e=t._plugin)===null||e===void 0||(r=e.player)===null||r===void 0||r.emit("lowdecode",l.degradeInfo),(n=t._plugin)===null||n===void 0||(a=n.player)===null||a===void 0||a.emit("core_event",He(He({},l.degradeInfo),{},{eventName:F.LOWDECODE})),(c===1||c===3)&&f&&t._degrade(f)}),$(this,"_degrade",function(e){var r=t._plugin.player,n=r.video;if((n==null?void 0:n.TAG)==="MVideo"){var a=r.video.degradeVideo;r.video=a,n.degrade(e),e&&(r.config.url=e);var u=r.root.firstChild;u.TAG==="MVideo"&&r.root.replaceChild(a,u);var l=t._plugin.constructor.pluginName.toLowerCase();r.unRegisterPlugin(l),r.once("canplay",function(){r.play()})}}),$(this,"forceDegradeToVideo",function(e){var r=t._opts.innerDegrade;(r===1||r===3)&&t._degrade(e)}),this._opts=o,this._plugin=i,this._init()}return Ci(s,[{key:"_init",value:function(){var i=this._opts,t=i.media,e=i.isLive,r=i.preloadTime,n=i.innerDegrade,a=i.decodeMode;if(t){if(!e&&t.setPlayMode){t.setPlayMode("VOD");return}n&&t.setAttribute("innerdegrade",n),r&&t.setAttribute("preloadtime",r),t.setDecodeMode&&t.setDecodeMode(a),this._bindEvents()}}},{key:"_bindEvents",value:function(){var i=this._opts.media;i.addEventListener("lowdecode",this._onLowDecode)}},{key:"destroy",value:function(){var i,t;(i=this._opts)===null||i===void 0||(t=i.media)===null||t===void 0||t.removeEventListener("lowdecode",this._onLowDecode),this._plugin=null}}]),s})(),oo=(function(s){no(i,s);var o=ao(i);function i(){var t;wi(this,i);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t=o.call.apply(o,[this].concat(r)),$(ne(t),"logger",ut),$(ne(t),"flv",null),$(ne(t),"pluginExtension",null),$(ne(t),"getStats",function(){var a;return(a=t.flv)===null||a===void 0?void 0:a.getStats()}),$(ne(t),"loadSource",function(){var a;arguments.length>0&&arguments[0]!==void 0?arguments[0]:t.player.config.url;var u=arguments.length>1?arguments[1]:void 0;(a=t.flv)===null||a===void 0||a.load(t.player.config.url,!0,u)}),$(ne(t),"destroy",function(){var a;t.flv&&(t.flv.destroy(),t.flv=null),(a=t.pluginExtension)===null||a===void 0||a.destroy(),t.pluginExtension=null}),$(ne(t),"_onSwitchURL",function(a,u){if(t.flv){var l,c;t.player.config.url=a,on(u)==="object"&&(u=u.seamless),t.flv.switchURL(a,u),!u&&(l=t.player.config)!==null&&l!==void 0&&(c=l.flv)!==null&&c!==void 0&&c.keepStatusAfterSwitch&&t._keepPauseStatus()}}),$(ne(t),"_keepPauseStatus",function(){var a=t.player.paused;a&&t.player.once("canplay",function(){t.player.pause()})}),$(ne(t),"_onDefinitionChange",function(a){var u=a.to;t.flv&&t.flv.switchURL(u)}),t}return Ci(i,[{key:"core",get:function(){return this.flv}},{key:"version",get:function(){var e;return(e=this.flv)===null||e===void 0?void 0:e.version}},{key:"softDecode",get:function(){var e,r,n=(e=this.player)===null||e===void 0||(r=e.config)===null||r===void 0?void 0:r.mediaType;return!!n&&n!=="video"&&n!=="audio"&&n!=="offscreen-video"}},{key:"loader",get:function(){var e;return(e=this.flv)===null||e===void 0?void 0:e.loader}},{key:"transferCost",get:function(){return this.flv._transferCost.transferCost}},{key:"beforePlayerInit",value:function(){var e=this,r=this.player.config,n=this.player.media||this.player.video;if(r.url){this.flv&&this.flv.destroy(),this.player.switchURL=this._onSwitchURL;var a=r.flv||{};if((a.disconnectTime===null||a.disconnectTime===void 0)&&(a.disconnectTime=0),this.flv=new bi(He({softDecode:this.softDecode,isLive:r.isLive,media:n,preProcessUrl:function(c,f){var h,d;return((h=e.player)===null||h===void 0||(d=h.preProcessUrl)===null||d===void 0?void 0:d.call(h,c,f))||{url:c,ext:f}}},a)),this.softDecode||tt.defineGetterOrSetter(this.player,{url:{get:function(){var c;return(c=e.flv)===null||c===void 0?void 0:c.blobUrl},configurable:!0}}),this.softDecode&&(this.pluginExtension=new mf(He({media:this.player.video,isLive:r.isLive},r.flv),this),this.player.forceDegradeToVideo=function(){for(var l,c=arguments.length,f=new Array(c),h=0;h<c;h++)f[h]=arguments[h];return(l=e.pluginExtension)===null||l===void 0?void 0:l.forceDegradeToVideo.apply(l,f)}),r.isLive){var u;(u=this.player)===null||u===void 0||u.useHooks("replay",function(){var l;return(l=e.flv)===null||l===void 0?void 0:l.replay()})}this.on(li,this._onSwitchURL),this.on(Ei,this.destroy),this._transError(),this._transCoreEvent(F.TTFB),this._transCoreEvent(F.LOAD_START),this._transCoreEvent(F.LOAD_RESPONSE_HEADERS),this._transCoreEvent(F.LOAD_COMPLETE),this._transCoreEvent(F.LOAD_RETRY),this._transCoreEvent(F.SOURCEBUFFER_CREATED),this._transCoreEvent(F.ANALYZE_DURATION_EXCEEDED),this._transCoreEvent(F.APPEND_BUFFER),this._transCoreEvent(F.REMOVE_BUFFER),this._transCoreEvent(F.BUFFEREOS),this._transCoreEvent(F.KEYFRAME),this._transCoreEvent(F.CHASEFRAME),this._transCoreEvent(F.METADATA_PARSED),this._transCoreEvent(F.SEI),this._transCoreEvent(F.SEI_IN_TIME),this._transCoreEvent(F.FLV_SCRIPT_DATA),this._transCoreEvent(F.STREAM_EXCEPTION),this._transCoreEvent(F.SWITCH_URL_SUCCESS),this._transCoreEvent(F.SWITCH_URL_FAILED),a.manualLoad||this.loadSource(r.url,a.streamRes)}}},{key:"_transError",value:function(){var e=this;this.flv.on(F.ERROR,function(r){e.player&&e.player.emit(Wt,new si(e.player,r))})}},{key:"_transCoreEvent",value:function(e){var r=this;this.flv.on(e,function(n){r.player&&r.player.emit("core_event",He(He({},n),{},{eventName:e}))})}}],[{key:"pluginName",get:function(){return"flv"}},{key:"isSupported",value:function(e,r){return bi.isSupported(e,r)}},{key:"isSupportedMMS",value:function(){return typeof ManagedMediaSource<"u"}}]),i})(tt);$(oo,"Flv",bi);const yf={props:{url:{type:String,default:""},poster:{type:String,default:""},autoplay:{type:Boolean,default:!0},live:{type:Boolean,default:!0},loop:{type:Boolean,default:!0},fullevent:{type:Boolean,default:!1}},emits:["full","ready"],setup(s,{emit:o}){const i=di(uo()),{url:t,live:e,loop:r,fullevent:n,autoplay:a,poster:u}=$a(s),l=lo(()=>/\.flv/.test(t.value)?"flv":/\.mp4/.test(t.value)?"mp4":/m3u8/.test(t.value)?"hls":""),c=di(null);let f=null,h="";const d=di(!1);let v=!1;const y=()=>{f&&!f.paused&&f.pause()},p=()=>{f&&f.paused&&f.play()},b=()=>{if(v=!1,t.value)if(f)h==l.value?(f.switchURL(t.value),p()):(f.destroy(),f=null,setTimeout(()=>{b()},15));else{const E={el:c.value,url:t.value,isLive:e.value,loop:r.value,lang:"zh-cn",playsinline:!1,videoFillMode:"fill",cssFullscreen:!1,playbackRate:!1,plugins:null};u.value&&(E.poster=u.value),a.value?(E.autoplay=!0,E.autoplayMuted=!0):E.autoplay=!1,l.value=="hls"?E.plugins=[Ln]:l.value=="flv"&&(E.plugins=[oo]),f=new Me(E),h=l.value,n.value&&f.usePluginHooks("fullscreen","fullscreenChange",()=>(console.log("fullevent.value full...."),o("full"),!1)),f.on("error",w=>{console.log("player error....",w)}),f.on("canplay",()=>{v||(o("ready"),v=!0)})}},k=()=>{var E;return(E=c==null?void 0:c.value)==null?void 0:E.querySelector("video")};return co(t,E=>{E?b():f&&(console.log("销毁之...."),f.destroy(),f=null)}),fo(()=>{t.value?b():setTimeout(()=>{b()},800)}),ho(()=>{f&&(f.destroy(),f=null)}),{videoEl:c,isPaused:d,doStartPlay:b,pause:y,rePlay:p,getVideoElement:k,playerId:i}}},_f={class:"_video-player"},bf=["id"],Sf={class:"_no-video-url"};function Ef(s,o,i,t,e,r){return fn(),cn("div",_f,[Vr(ai("div",{ref:"videoEl",id:"player-"+t.playerId,class:"_container"},null,8,bf),[[Rn,i.url]]),Vr(ai("div",Sf,[...o[0]||(o[0]=[ai("span",null,"输入播放地址...",-1)])],512),[[Rn,!i.url]])])}const kf=ln(yf,[["render",Ef]]),Tf={props:{value:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},setup(s,{emit:o}){const{value:i,disabled:t}=$a(s);return{doSwitch:()=>{if(!t.value){const r=!i.value;o("update:value",r),o("change",r)}}}}},wf=["disabled"];function Cf(s,o,i,t,e,r){return fn(),cn("div",{class:vo(["_switch-button",{active:i.value}]),onClick:o[0]||(o[0]=n=>t.doSwitch()),disabled:i.disabled},null,10,wf)}const Af=ln(Tf,[["render",Cf]]),Df={components:{XgPlayer:kf,SwitchButton:Af},setup(){const s=di(""),o=di("");return{url:s,live:o}}},Pf={class:"tools-video-player-page _page"},Lf={class:"top-info-wrap"};function If(s,o,i,t,e,r){const n=Nn("SwitchButton"),a=Nn("XgPlayer");return fn(),cn("div",Pf,[ai("div",Lf,[o[2]||(o[2]=ai("span",null,"是否直播",-1)),Mn(n,{value:t.live,"onUpdate:value":o[0]||(o[0]=u=>t.live=u)},null,8,["value"]),Vr(ai("input",{type:"text",placeholder:"输入播放地址","onUpdate:modelValue":o[1]||(o[1]=u=>t.url=u)},null,512),[[po,t.url,void 0,{trim:!0}]])]),Mn(a,{live:t.live,url:t.url},null,8,["live","url"])])}const Of=ln(Df,[["render",If]]);export{Of as default};
