(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fed6d926"],{"08db":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page transport-trajectory-page"},[a("Map"),a("Info"),a("Search")],1)},r=[],i=a("f2de"),o=a("eb57"),c=a("0706"),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"map-wrap"})},l=[],u=(a("b4c2"),a("de57")),d=a("1a1e"),p=c["a"].TRANSPORT_TRAJECTORY,v=Object(i["a"])(p).mapState,f=Math.PI,h=25,m={name:"TransportTrajectoryMap",computed:Object(u["a"])({},v(["pathArr","truckDatas","currActiveTruckIndex"])),data:function(){return{map:null,mapReady:!1,markers:[],startPointCanvas:null,endPointCanvas:null,startPointRadius:0,endPointRadius:0,startPoint:{x:0,y:0},endPoint:{x:0,y:0}}},created:function(){var t=this;t.$store.commit(p+"/"+o["a"].SWITCH_ACTIVE_TRUCK,0)},mounted:function(){var t=this;t.$nextTick(function(){var e=new AMap.Map(t.$el,{zoom:d["a"].transportTrajectoryMap.zoom,center:d["a"].transportTrajectoryMap.center,mapStyle:d["a"].mapStyle,resizeEnable:!0});new AMap.Polyline({map:e,path:t.pathArr,showDir:!1,strokeColor:"#4f92e8",strokeOpacity:.7,strokeWeight:8}),new AMap.Polyline({map:e,path:t.pathArr,showDir:!1,strokeColor:"#fff",strokeOpacity:.7,strokeWeight:1});e.on("complete",function(){t.mapReady=!0,t.map=e,e.setFitView(),t.addLayer(),t.addMarkers(),t.updateMarkerIndex()}),e.on("zoomchange",function(){t.doZoomMap()}),e.on("mapmove",function(){t.doZoomMap()}),e.on("dragging",function(){t.doZoomMap()})})},methods:{addMarkers:function(){var t=this,e=t.map;e&&(t.markers=t.truckDatas.map(function(e){return t.createMarker(e)}),e.add(t.markers))},updateMarkerIndex:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1200;setTimeout(function(){var t=document.querySelector("div.amap-layers>div.amap-markers");t&&(t.style.zIndex=122)},t)},createMarker:function(t){var e=this,a=t.carNumber,n=t.driver,r=t.lng,i=t.lat,o=t.index,c=new AMap.LngLat(r,i),s=o==e.currActiveTruckIndex?d["a"].truckImgUrl.active:d["a"].truckImgUrl.normal,l=new AMap.Marker({position:c,offset:new AMap.Pixel(-22,-22),icon:s,title:n+"-"+a,zoom:13});return l.self=t,l.on("click",function(t){e.doHandlerClickMarker(t.target.self,t.target)}),l},doHandlerClickMarker:function(t,e){var a=this,n=a.map;if(t.index!=a.currActiveTruckIndex){for(var r=null,i=a.currActiveTruckIndex,c=0;c<a.markers.length;)r=a.markers[c],r.self.index==a.currActiveTruckIndex||r.self.index==t.index?(n.remove(r),a.markers.splice(c,1)):c++;a.$store.commit(p+"/"+o["a"].SWITCH_ACTIVE_TRUCK,t.index);var s=a.createMarker(t);n.add(s),a.markers.push(s);var l=a.createMarker(a.truckDatas[i]);n.add(l),a.markers.push(l),a.updateMarkerIndex(300)}},drawCircle:function(t){var e=this,a="START"==t?e.startPointCanvas:e.endPointCanvas,n="START"==t?e.startPointRadius:e.endPointRadius,r="START"==t?e.startPoint:e.endPoint,i=a.getContext("2d");i.beginPath(),i.arc(r.x,r.y,n,0,2*f),i.closePath(),i.lineWidth=2,i.strokeStyle="START"==t?"#3C9A35":"#f84067",i.stroke(),n+=.5,n>h&&(n=0),"START"==t?e.startPointRadius=n:e.endPointRadius=n},renderCanvas:function(t){var e=this,a="START"==t?e.startPointCanvas:e.endPointCanvas,n=a.getContext("2d"),r=n.globalCompositeOperation;n.globalCompositeOperation="destination-in",n.globalAlpha=.95,n.fillRect(0,0,a.width,a.height),n.globalCompositeOperation=r,e.drawCircle(t)},animDraw:function(){var t=this;AMap.Util.requestAnimFrame(t.animDraw),t.renderCanvas("START"),t.renderCanvas("END")},setCanvasSize:function(){var t=this,e=AMap.Browser.retina,a=t.map,n=a.getSize(),r=n.width,i=n.height;t.startPointCanvas&&t.endPointCanvas&&(t.startPointCanvas.style.width=r+"px",t.startPointCanvas.style.height=i+"px",t.endPointCanvas.style.width=r+"px",t.endPointCanvas.style.height=i+"px",e&&(r*=2,i*=2),t.startPointCanvas.width=r,t.startPointCanvas.height=i,t.endPointCanvas.width=r,t.endPointCanvas.height=i)},doZoomMap:function(){var t=this,e=t.map,a=t.pathArr[0],n=t.pathArr[t.pathArr.length-1];t.startPoint=e.lngLatToContainer(a),t.endPoint=e.lngLatToContainer(n),t.setCanvasSize(),t.updateMarkerIndex(300)},addLayer:function(){var t=this,e=t.map;AMap.plugin("AMap.CustomLayer",function(){var a=document.createElement("canvas"),n=document.createElement("canvas"),r=new AMap.CustomLayer(a,{zooms:[3,18],alwaysRender:!0,zIndex:120}),i=new AMap.CustomLayer(n,{zooms:[3,18],alwaysRender:!0,zIndex:121});t.startPointCanvas=a,t.endPointCanvas=n;var o=t.pathArr[0],c=t.pathArr[t.pathArr.length-1];t.startPoint=e.lngLatToContainer(o),t.endPoint=e.lngLatToContainer(c),t.setCanvasSize(),r.render=function(){t.renderCanvas("START")},i.render=function(){t.renderCanvas("END")},r.setMap(e),i.setMap(e),t.animDraw()})}}},C=m,A=a("25c1"),T=Object(A["a"])(C,s,l,!1,null,null,null);T.options.__file="Map.vue";var g=T.exports,b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"info-wrap"},[a("h3",[t._v("当前运输记录")]),t._m(0),a("div",{staticClass:"transport-chart"},[a("div",{style:{left:t.currActiveTruck.progress}}),a("PointWave",{attrs:{color:"#3C9A35",w:44,h:44}}),a("PointWave",{attrs:{color:"#f84067",w:44,h:44}})],1),a("div",{staticClass:"plane-wrap plane"},[a("div",[a("label",[t._v("运输人员：")]),t._v(t._s(t.currActiveTruck.driver))]),a("div",[a("label",[t._v("运输车号：")]),t._v(t._s(t.currActiveTruck.carNumber))])]),a("div",{staticClass:"plane-wrap plane"},[a("div",[a("label",[t._v("运输预计耗时：")]),t._v(t._s(t.currActiveTruck.expectedTimeConsuming))]),a("div",[a("label",[t._v("运输实际耗时：")]),t._v(t._s(t.currActiveTruck.actualTimeConsuming))]),a("div",[a("label",[t._v("运输开始时间：")]),t._v(t._s(t.currActiveTruck.startTime))]),a("div",[a("label",[t._v("运输结束时间：")]),t._v(t._s(t.currActiveTruck.endTime))]),a("div",[a("label",[t._v("当前距离终点：")]),t._v(t._s(t.currActiveTruck.distance))])])])},k=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"transport-name"},[a("div",[t._v("配送中心")]),a("div"),a("div",[t._v("南康中学")])])}],P=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("canvas",{staticClass:"point-wave",attrs:{width:t.w,height:t.h}})},_=[],x=(a("4f70"),a("6636"),Math.PI),w=9,y={name:"PointWave",props:{w:{type:Number,default:60},h:{type:Number,default:60},color:{type:String,default:"rgba(250,250,50,1)"}},computed:{center:function(){return{x:this.w/2,y:this.h/2}}},data:function(){return{radius:w,ctx:null,backCanvas:null}},mounted:function(){var t=this;t.$nextTick(function(){var e=t.$el,a=t.ctx=e.getContext("2d");a.fillStyle=t.color,a.strokeStyle=t.color,a.lineWidth=1,a.globalAlpha=.7;var n=t.backCanvas=document.createElement("canvas");t.backCanvasCtx=t.backCanvas.getContext("2d"),n.width=e.width,n.height=e.height,t.backCanvasCtx.globalCompositeOperation="copy",t.paint(),t.draw()})},methods:{draw:function(){var t=this;requestAnimationFrame(t.draw),t.render()},render:function(){var t=this,e=t.ctx,a=t.backCanvas.getContext("2d");a.drawImage(t.$el,0,0,t.w,t.h),e.clearRect(0,0,t.w,t.h),t.paint(),e.drawImage(t.backCanvas,0,0,t.w,t.h)},paint:function(){var t=this,e=t.ctx;e.beginPath(),e.arc(t.center.x,t.center.y,w,0,2*x),e.closePath(),e.fill(),e.stroke();for(var a=1;a<4;a++)e.save(),e.globalAlpha=.8-.2*a,e.beginPath(),e.lineWidth=1.5,e.arc(t.center.x,t.center.y,t.radius+3*a,0,2*x),e.closePath(),e.stroke(),e.restore();t.radius+=.18,t.radius>t.center.x-12&&(t.radius=0)}}},S=y,I=Object(A["a"])(S,P,_,!1,null,null,null);I.options.__file="PointWave.vue";var M=I.exports,R=c["a"].TRANSPORT_TRAJECTORY,O=Object(i["a"])(R).mapState,E={name:"TransportTrajectoryInfo",components:{PointWave:M},computed:Object(u["a"])({},O(["currActiveTruck"]))},N=E,j=Object(A["a"])(N,b,k,!1,null,null,null);j.options.__file="Info.vue";var D=j.exports,$=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"search-wrap"},[a("div",{staticClass:"search-input"},[a("input",{ref:"startPlace",staticClass:"place-input",attrs:{type:"text",maxlength:"30",placeholder:"请输入起点"}}),a("input",{ref:"endPlace",staticClass:"place-input",attrs:{type:"text",maxlength:"30",placeholder:"请输入终点"}}),a("button",{on:{click:function(e){t.doSearch()}}},[t._v("搜索")])]),a("div",{staticClass:"search-date"},[a("DatePicker",{staticClass:"transport-date",attrs:{type:"date",placeholder:"请选择日期",clearable:!1,editable:!1},on:{change:t.doDatePickerChange},model:{value:t.currSelectedDate,callback:function(e){t.currSelectedDate=e},expression:"currSelectedDate"}})],1)])},L=[],z=(a("15fe"),a("ad09"),a("8ac1")),W=a.n(z),F=(a("175c"),a("bc97"),a("a5be"),a("f1ed")),U=c["a"].TRANSPORT_TRAJECTORY,V=(Object(i["a"])(U).mapState,{name:"TransportTrajectorySearch",components:{DatePicker:W.a},data:function(){return{startPlace:"",endPlace:"",currSelectedDate:new Date,amapAutoStartPlaceObject:null,amapAutoEndPlaceObject:null}},mounted:function(){var t=this;t.$nextTick(function(){t.initAutoCompletePlugin()})},methods:{initAutoCompletePlugin:function(){var t=this,e=t.$refs;AMap.plugin("AMap.Autocomplete",function(){t.amapAutoStartPlaceObject=new AMap.Autocomplete({input:e.startPlace}),t.amapAutoEndPlaceObject=new AMap.Autocomplete({input:e.endPlace})})},doDatePickerChange:function(t){var e=this;e.currSelectedDate=Object(F["a"])(t,"yyyy-MM-dd")},doSearch:function(){}}}),H=V,J=Object(A["a"])(H,$,L,!1,null,null,null);J.options.__file="Search.vue";var Y=J.exports,G=c["a"].TRANSPORT_TRAJECTORY,Z=(Object(i["a"])(G).mapState,{name:"TransportTrajectoryIndex",components:{Map:g,Info:D,Search:Y},created:function(){var t=this,e=t.$store;e.commit(o["a"].SWITCH_LOADING,!1)},activated:function(){var t=this,e=t.$store;e.commit(o["a"].SWITCH_LOADING,!1)}}),q=Z,K=(a("82f2"),Object(A["a"])(q,n,r,!1,null,null,null));K.options.__file="Index.vue";e["default"]=K.exports},"4f70":function(t,e,a){var n=a("ac1b");n(n.P,"Array",{fill:a("b8cf")}),a("442f")("fill")},5310:function(t,e,a){},6636:function(t,e,a){"use strict";var n=a("690f"),r=a("bdac"),i=a("0016"),o=a("2bbe"),c=a("ae18"),s=a("e96b"),l=a("e2fa").f,u=a("7f0c").f,d=a("9ba3").f,p=a("b703").trim,v="Number",f=n[v],h=f,m=f.prototype,C=i(a("d115")(m))==v,A="trim"in String.prototype,T=function(t){var e=c(t,!1);if("string"==typeof e&&e.length>2){e=A?e.trim():p(e,3);var a,n,r,i=e.charCodeAt(0);if(43===i||45===i){if(a=e.charCodeAt(2),88===a||120===a)return NaN}else if(48===i){switch(e.charCodeAt(1)){case 66:case 98:n=2,r=49;break;case 79:case 111:n=8,r=55;break;default:return+e}for(var o,s=e.slice(2),l=0,u=s.length;l<u;l++)if(o=s.charCodeAt(l),o<48||o>r)return NaN;return parseInt(s,n)}}return+e};if(!f(" 0o1")||!f("0b1")||f("+0x1")){f=function(t){var e=arguments.length<1?0:t,a=this;return a instanceof f&&(C?s(function(){m.valueOf.call(a)}):i(a)!=v)?o(new h(T(e)),a,f):T(e)};for(var g,b=a("241c")?l(h):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),k=0;b.length>k;k++)r(h,g=b[k])&&!r(f,g)&&d(f,g,u(h,g));f.prototype=m,m.constructor=f,a("3871")(n,v,f)}},"82f2":function(t,e,a){"use strict";var n=a("5310"),r=a.n(n);r.a},b703:function(t,e,a){var n=a("ac1b"),r=a("346b"),i=a("e96b"),o=a("d953"),c="["+o+"]",s="​",l=RegExp("^"+c+c+"*"),u=RegExp(c+c+"*$"),d=function(t,e,a){var r={},c=i(function(){return!!o[t]()||s[t]()!=s}),l=r[t]=c?e(p):o[t];a&&(r[a]=l),n(n.P+n.F*c,"String",r)},p=d.trim=function(t,e){return t=String(r(t)),1&e&&(t=t.replace(l,"")),2&e&&(t=t.replace(u,"")),t};t.exports=d},b8cf:function(t,e,a){"use strict";var n=a("e1de"),r=a("3bcf"),i=a("5b7f");t.exports=function(t){var e=n(this),a=i(e.length),o=arguments.length,c=r(o>1?arguments[1]:void 0,a),s=o>2?arguments[2]:void 0,l=void 0===s?a:r(s,a);while(l>c)e[c++]=t;return e}},d953:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"}}]);